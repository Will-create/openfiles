/*
Component: j-Approve
Version: 1
Updated: 2024-07-02T16:30:01.000Z
Author: Peter Širka


Component: j-ASelected
Version: 1
Updated: 2024-06-29T09:40:00.000Z
Author: Peter Širka


Component: j-Attachments
Version: 1
Updated: 2024-10-23T11:17:02.000Z
Author: Peter Širka


Component: j-AutoComplete
Version: 1
Updated: 2025-08-07T11:05:00.000Z
Author: Peter Širka


Component: j-AutoFill
Version: 1
Updated: 2024-06-15T10:10:00.000Z
Author: Peter Širka


Component: j-Box
Version: 1
Updated: 2024-06-19T10:37:00.000Z
Author: Peter Širka


Component: j-Breadcrumb
Version: 1
Updated: 2024-08-16T17:26:00.000Z
Author: Peter Širka


Component: j-Changer
Version: 1
Updated: 2024-08-14T17:55:03.000Z
Author: Peter Širka


Component: j-Children
Version: 1
Updated: 2023-12-06T11:03:01.000Z
Author: Peter Širka


Component: j-Choose
Version: 1
Updated: 2024-06-11T12:18:01.000Z
Author: Peter Širka


Component: j-Cl
Version: 1
Updated: 2024-02-28T12:36:02.000Z
Author: Peter Širka


Component: j-ClBind
Version: 1
Updated: 2024-10-02T11:09:04.000Z
Author: Peter Širka


Component: j-Clipboard
Version: 1
Updated: 2025-02-18T08:47:00.000Z
Author: Peter Širka


Component: j-CloudEditor
Version: 1
Updated: 2025-08-05T08:37:01.000Z
Author: Peter Širka


Component: j-ColorPicker
Version: 1
Updated: 2024-05-02T15:41:01.000Z
Author: Denis Granec


Component: j-Columns
Version: 1
Updated: 2023-01-23T11:07:19.000Z
Author: Peter Širka


Component: j-Configuration
Version: 1
Updated: 2023-11-09T22:34:01.000Z
Author: Peter Širka


Component: j-Crop
Version: 1
Updated: 2025-08-18T10:50:00.000Z
Author: Peter Širka


Component: j-DataGrid
Version: 2
Updated: 2025-07-25T08:39:00.000Z
Author: Peter Širka


Component: j-DataSource
Version: 1
Updated: 2024-02-27T10:46:01.000Z
Author: Peter Širka


Component: j-DatePicker
Version: 1
Updated: 2025-05-07T12:00:00.000Z
Author: Peter Širka


Component: j-Detail
Version: 1
Updated: 2025-03-26T13:57:00.000Z
Author: Peter Širka


Component: j-Directory
Version: 1
Updated: 2025-08-11T11:20:00.000Z
Author: Peter Širka


Component: j-Display
Version: 1
Updated: 2024-08-27T13:20:01.000Z
Author: Peter Širka


Component: j-DrawZone
Version: 1
Updated: 2025-01-10T10:03:00.000Z
Author: Peter Sirka & Dodo Marton


Component: j-DropFiles
Version: 1
Updated: 2023-10-10T12:21:02.002Z
Author: Peter Širka


Component: j-Edit
Version: 1
Updated: 2025-07-10T20:09:00.000Z
Author: Peter Širka


Component: j-Empty
Version: 1
Updated: 2025-02-04T12:16:00.000Z
Author: Peter Širka


Component: j-EmptyInline
Version: 1
Updated: 2024-10-23T11:55:02.000Z
Author: Peter Širka


Component: j-Enter
Version: 1
Updated: 2024-08-31T20:54:00.000Z
Author: Peter Širka


Component: j-ErrorHandler
Version: 1
Updated: 2023-01-25T13:13:01.000Z
Author: Peter Širka


Component: j-Exec
Version: 1
Updated: 2024-06-19T08:14:00.000Z
Author: Peter Širka


Component: j-Expander
Version: 1
Updated: 2025-04-30T13:12:00.000Z
Author: Peter Širka


Component: j-ExpansionPanel
Version: 1
Updated: 2024-11-19T19:55:04.000Z
Author: Peter Širka


Component: j-Extend
Version: 1
Updated: 2024-06-18T15:27:00.000Z
Author: Pete Širka


Component: j-Features
Version: 1
Updated: 2023-01-31T09:04:35.000Z
Author: Peter Širka


Component: j-FileBrowser
Version: 1
Updated: 2023-01-31T09:09:01.000Z
Author: Peter Širka


Component: j-FileReader
Version: 1
Updated: 2024-04-23T13:49:02.000Z
Author: Peter Širka


Component: j-FileSaver
Version: 1
Updated: 2023-02-11T12:53:01.000Z
Author: Peter Širka


Component: j-FileUploader
Version: 1
Updated: 2025-04-18T12:41:03.000Z
Author: Peter Širka


Component: j-Form
Version: 2
Updated: 2024-06-26T19:02:01.000Z
Author: Peter Širka


Component: j-HashChange
Version: 1
Updated: 2024-10-05T20:29:00.000Z
Author: Peter Širka


Component: j-Icons
Version: 1
Updated: 2025-08-05T07:58:00.000Z
Author: Peter Širka


Component: j-ImageViewer
Version: 1
Updated: 2024-01-14T23:28:01.000Z
Author: Peter Širka


Component: j-Importer
Version: 1
Updated: 2024-11-13T09:39:00.000Z
Author: Peter Širka


Component: j-InlineDatePicker
Version: 1
Updated: 2024-10-30T09:32:00.000Z
Author: Peter Širka


Component: j-Input
Version: 1
Updated: 2025-09-04T08:22:00.000Z
Author: Peter Širka


Component: j-InputTags
Version: 1
Updated: 2024-07-19T09:07:00.000Z
Author: Peter Širka


Component: Intranet CSS
Version: 5
Updated: 2024-11-13T08:21:00.000Z
Author: Peter Širka


Component: j-KeyValue
Version: 1
Updated: 2025-03-04T12:50:00.000Z
Author: Peter Širka


Component: j-Leaflet
Version: 1
Updated: 2025-08-05T08:31:00.000Z
Author: Peter Širka


Component: j-ListDetail
Version: 1
Updated: 2023-01-31T14:39:01.000Z
Author: Peter Širka


Component: j-ListForm
Version: 1
Updated: 2025-06-30T09:39:00.000Z
Author: Peter Širka


Component: j-Listing
Version: 1
Updated: 2023-01-31T14:44:01.000Z
Author: Peter Širka


Component: j-Loading
Version: 1
Updated: 2025-03-31T10:04:00.000Z
Author: Peter Širka


Component: j-Locale
Version: 1
Updated: 2025-03-22T19:42:00.000Z
Author: Peter Širka


Component: j-Markdown
Version: 1
Updated: 2025-09-04T09:59:00.000Z
Author: Peter Širka


Component: j-Menu
Version: 1
Updated: 2024-07-22T15:23:00.000Z
Author: Peter Širka


Component: j-Message
Version: 1
Updated: 2024-01-30T11:46:02.000Z
Author: Peter Širka


Component: j-MiniForm
Version: 2
Updated: 2024-02-11T19:38:02.000Z
Author: Peter Širka


Component: j-Movable
Version: 1
Updated: 2023-08-02T12:35:01.000Z
Author: Peter Širka


Component: j-NoScrollbar
Version: 1
Updated: 2023-02-01T08:36:00.000Z
Author: Peter Širka


Component: j-Notify
Version: 1
Updated: 2023-03-11T19:50:02.000Z
Author: Peter Širka


Component: j-Page
Version: 1
Updated: 2024-11-14T13:01:00.000Z
Author: Peter Širka


Component: j-Permissions
Version: 1
Updated: 2025-07-25T10:49:01.000Z
Author: Peter Širka


Component: j-Pictures
Version: 1
Updated: 2024-10-23T11:27:00.000Z
Author: Peter Širka


Component: j-Preview
Version: 1
Updated: 2024-07-11T10:40:00.000Z
Author: Peter Širka


Component: j-Printer
Version: 1
Updated: 2025-01-08T19:04:02.000Z
Author: Peter Širka


Component: j-Prompt
Version: 1
Updated: 2025-02-18T14:09:00.000Z
Author: Peter Širka


Component: j-RadioButton
Version: 1
Updated: 2023-02-01T10:23:00.000Z
Author: Peter Širka


Component: j-Ready
Version: 1
Updated: 2023-02-01T10:38:01.000Z
Author: Peter Širka


Component: j-Search
Version: 1
Updated: 2023-02-01T11:16:03.000Z
Author: Peter Širka


Component: j-SearchData
Version: 1
Updated: 2023-02-01T11:19:03.000Z
Author: Peter Širka


Component: j-SearchInput
Version: 1
Updated: 2025-03-27T08:59:00.000Z
Author: Peter Širka


Component: j-Selected
Version: 1
Updated: 2023-03-05T10:55:01.000Z
Author: Peter Širka


Component: j-Selection
Version: 1
Updated: 2024-10-18T23:55:00.000Z
Author: Peter Širka


Component: j-ServerGrid
Version: 2
Updated: 2025-08-13T13:50:02.001Z
Author: Peter Širka


Component: j-Shortcuts
Version: 1
Updated: 2023-02-01T12:12:00.000Z
Author: Peter Širka


Component: j-Spotlight
Version: 1
Updated: 2023-01-31T12:17:08.000Z
Author: Peter Širka


Component: j-Table
Version: 1
Updated: 2024-10-29T19:37:00.000Z
Author: Peter Širka


Component: j-TabMenu
Version: 1
Updated: 2025-01-09T20:00:03.000Z
Author: Peter Širka


Component: j-Tabs
Version: 1
Updated: 2025-01-09T19:32:01.000Z
Author: Peter Širka


Component: Tangular-AutoFormat
Version: 1
Updated: 2024-11-04T10:24:00.000Z
Author: Peter Širka


Component: Tangular-FileSize
Version: 1
Updated: 2018-11-03T21:40:01.000Z
Author: Peter Širka


Component: Tangular-Initials
Version: 1
Updated: 2023-02-19T22:28:01.000Z
Author: Peter Širka


Component: Tangular-JsonFormat
Version: 1
Updated: 2025-06-25T12:03:08.000Z
Author: Peter Širka


Component: Tangular-RGBA
Version: 1
Updated: 2024-01-11T13:48:03.000Z
Author: Peter Širka


Component: j-TimePicker
Version: 1
Updated: 2023-08-15T09:16:01.000Z
Author: Peter Širka


Component: j-TotalTemplates
Version: 1
Updated: 2025-08-12T10:09:46.000Z
Author: Peter Širka


Component: j-Tree
Version: 1
Updated: 2025-05-20T14:05:00.000Z
Author: Peter Širka


Component: j-Validate
Version: 1
Updated: 2024-08-10T10:07:00.000Z
Author: Peter Širka


Component: j-ViewBox
Version: 1
Updated: 2024-11-12T21:59:00.000Z
Author: Peter Širka


Component: j-VirtualWire
Version: 1
Updated: 2022-06-07T19:11:02.000Z
Author: Peter Širka


Component: j-Windows
Version: 1
Updated: 2025-07-25T12:57:00.000Z
Author: Peter Širka


Component: j-Wysiwyg
Version: 1
Updated: 2024-06-18T15:48:00.000Z
Author: Peter Širka
*/

(W.STYLE?W.STYLE:W.CSS)(`.ui-approve-noscroll,.ui-approve-noscroll body{overflow:hidden}.ui-approve{background-color:rgba(255,255,255,0.9);position:fixed;left:0;right:0;bottom:0;top:0;z-index:100;width:100%;display:table;height:100%;transition:0.5s all;opacity:0}.ui-approve > div{display:table-cell;vertical-align:middle;text-align:center;color:#FFF;padding:15px}.ui-approve-body{color:#000;padding:0;position:relative;display:inline-block;max-width:300px;text-align:left;transform:scale(0.8);transition:0.15s all;border:0;background-color:#FFF;box-shadow:0 0 30px rgba(0,0,0,0.1)}.ui-approve-content{padding:50px 30px;text-align:center}.ui-approve-content > i{font-size:50px;display:block;margin-bottom:10px}.ui-approve-buttons{height:40px}.ui-approve button{font-size:12px;float:left;cursor:pointer;outline:0;background-color:#E0E0E0;border:0;border-radius:0;color:gray;padding:0;width:50%;height:40px;font-weight:normal;margin:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.ui-approve button i{margin-right:5px}.ui-approve button:hover{opacity:0.9}.ui-approve button[data-index='0']{color:#FFF;font-weight:bold;font-weight:bold;background-color:#EC2C28}.ui-approve-close{position:absolute;color:#C0C0C0;font-size:11px;right:8px;top:5px;cursor:pointer}.ui-approve-close:hover{color:#A0A0A0}.ui-approve-visible{opacity:1}.ui-approve-visible .ui-approve-body{-webkit-transform:scale(1);transform:scale(1)}.ui-approve-click{transform:scale(1.07) !important}.ui-approve-style-2{background-color:rgba(0,0,0,0.7)}.ui-approve-style-2 .ui-approve-body{max-width:500px;border-radius:var(--radius)}.ui-approve-style-2 .ui-approve-content{padding:28px 24px 24px;text-align:left;font-size:15px;color:#797982;line-height:1.25rem}.ui-approve-style-2 .ui-approve-content > i{margin-left:38px;margin-bottom:12px}.ui-approve-style-2 .ui-approve-buttons{display:flex;align-items:center;justify-content:end;height:auto;padding:0 24px 24px}.ui-approve-style-2 button{min-width:92px;width:auto;border-radius:var(--radius);border:1px solid #e4e4e7;height:40px;line-height:40px;font-size:14px}.ui-approve-style-2 button[data-index='0']{order:2;margin-left:12px;background-color:#18181b;border-color:#18181b;transition:opacity .2s}.ui-approve-style-2 button[data-index='1']{color:color:#797982;background-color:#fff;transition:background-color .2s}.ui-approve-style-2 .ui-approve-close{display:none}.ui-approve-style-2 button[data-index='0']:hover{opacity:.9}.ui-approve-style-2 button[data-index='1']:hover{background-color:#f0f0f0}@media(max-width:340px){.ui-approve button{display:block;margin:8px 0 0;display:block;width:100%;height:34px;font-size:13px}}

.ui-attachments{padding:0;font-size:13px}.ui-attachments-file{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;background-color:#F0F0F0;border-radius:var(--radius);padding:4px 5px;display:block;vertical-align:top;color:#777;margin-top:2px}.ui-attachments-file:hover{text-decoration:none;background-color:#E0E0E0}.ui-attachments-file > i{margin-right:5px}.ui-attachments-remove{float:right;color:#E73323;margin-left:5px}.ui-attachments-date{float:right;margin-left:5px}.ui-attachments-size{color:#A0A0A0;margin-left:5px;font-size:11px}.ui-attachments-size i{margin-right:5px}

.ui-autocomplete-container{position:absolute;z-index:60}.ui-autocomplete{background-color:#FFF;width:100%;margin:-5px 0 0;padding:2px 0;border-radius:0 0 var(--radius) var(--radius);box-shadow:0 5px 20px rgba(0,0,0,0.1);border:1px solid #E0E0E0;line-height:14px;overflow:hidden}.ui-autocomplete ul{list-style-type:none;margin:0;padding:0}.ui-autocomplete li{margin:0;padding:0 12px;border-bottom:1px solid #F0F0F0;cursor:pointer;font-size:13px;color:#505050;height:30px;line-height:30px}.ui-autocomplete li:last-child{border-bottom:0}.ui-autocomplete .selected{background-color:#F0F0F0}.ui-autocomplete li span{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}

.ui-box-noscroll,.ui-box-noscroll body{overflow:hidden}.ui-box-container{width:100%;position:fixed;left:0;top:0;bottom:0;right:0;z-index:5;overflow:hidden;transform-style:preserve-3d}.ui-box-bg{background-color:rgba(230,233,237,0.8)}.ui-box-nobg .ui-box{border:1px solid #E9E9E9}.ui-box-transparent{pointer-events:none}.ui-box{background-color:#FFF;border-radius:3px;box-shadow:0 10px 30px rgba(0,0,0,0.1);transform:scale(0);transition:all 0.15s;opacity:0;text-align:left;position:relative;margin:0 auto;pointer-events:all}.ui-box-animate{transform:scale(1);opacity:1}.ui-box-title{padding:0 10px 0 var(--gap);line-height:57px;font-size:16px;user-select:none;color:#000;background-color:#FFF;border-bottom:1px solid #E0E0E0;height:58px;border-radius:3px 3px 0 0}.ui-box-title .ui-box-button-close{float:right;cursor:pointer;font-size:18px;margin:1px 0 0;background:none;border:0;outline:0;height:auto;color:red;text-align:right !important;width:20px;padding:0}.ui-box-title .ui-box-button-close:hover{transform:scale(1.1)}.ui-box-title > nav{float:right;margin-right:18px;font-size:14px}.ui-box-title > nav button{border:0;margin:15px 0 0;background-color:#F0F0F0;height:28px;padding:0 10px;color:#000;cursor:pointer;font-family:Arial;line-height:23px;vertical-align:middle;outline:0;font-size:12px;text-decoration:none;transition:all 0.3s;float:left;border-left:1px solid #E0E0E0}.ui-box-title > nav button i{width:12px;text-align:center;margin-right:5px}.ui-box-title > nav button:hover{opacity:0.8}.ui-box-title > nav button:active{background-color:#D0D0D0}.ui-box-title > nav button:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:silver !important;cursor:not-allowed;box-shadow:none}.ui-box-title > nav button:disabled i{color:silver !important}.ui-box-title > nav button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius);border-left:0}.ui-box-title > nav button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-box-title i{margin-right:7px}.ui-box-title > span{font-weight:bold}.ui-box > nav{padding:0 15px 0;border-top:1px solid #E0E0E0;background-color:#FFF;border-radius:0 0 3px 3px;line-height:65px;height:65px;display:block;float:none;width:100%}.ui-box > nav button{border:0;margin:15px 0 0;background-color:#F0F0F0;height:34px;padding:0 20px;color:#000;cursor:pointer;font-family:Arial;line-height:34px;vertical-align:middle;outline:0;font-size:14px;text-decoration:none;transition:all 0.3s;float:left;width:50%}.ui-box > nav button i{width:15px;text-align:center;margin-right:5px}.ui-box > nav button:hover{opacity:0.8}.ui-box > nav button:active{background-color:#D0D0D0}.ui-box > nav button:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:silver !important;cursor:not-allowed;box-shadow:none}.ui-box > nav button:disabled i{color:silver !important}.ui-box > nav button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.ui-box > nav button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-box > nav button[name='submit']{font-weight:bold;background-color:var(--color);color:#FFF}.ui-box-style-2 .ui-box{border-bottom-right-radius:0;border-bottom-left-radius:0}.ui-box-style-3 .ui-box{border-top-right-radius:0;border-top-left-radius:0}.ui-box-align-left{margin:0 auto 0 0}.ui-box-align-right{margin:0 0 0 auto}@media(max-width:767px){.ui-box-container{background:none;padding:0 !important}.ui-box{border-radius:0;max-width:none !important;width:100% !important}}

.ui-breadcrumb{font-size:13px;height:42px;line-height:40px;color:#888;border:1px solid #E0E0E0;margin-bottom:10px;border-radius:var(--radius);padding:0 10px}.ui-breadcrumb > nav a,.ui-breadcrumb > nav span{margin-left:5px;color:#444;cursor:pointer}.ui-breadcrumb > nav a:hover,.ui-breadcrumb > nav span:hover{text-decoration:underline}.ui-breadcrumb > nav a:last-child,.ui-breadcrumb > nav span:last-child{font-weight:bold}.ui-breadcrumb > nav i{width:14px;text-align:center}.ui-breadcrumb > nav i:first-child{margin-right:3px}.ui-breadcrumb > nav .ti-angle-right{margin:0 0 0 5px;font-size:12px}.ui-breadcrumb > nav{float:left;margin:0}.ui-breadcrumb > div{float:right}.ui-breadcrumb-children{background-color:rgba(0,0,0,.05);padding:2px 4px;border-radius:var(--radius)}.ui-breadcrumb-style2{border:0;border-radius:0;border-bottom:1px solid #E0E0E0;height:60px;margin:0;padding:0 15px}.ui-breadcrumb-style2 > nav{padding:10px 0 0}.ui-breadcrumb-style2 .toolbar{margin:18px 0 0}

.ui-children-item{cursor:grabbing}.ui-children-empty{text-align:center;color:#777}.ui-children-empty i{margin-right:5px}

.animation{visibility:hidden}.ui-animation-1-init{transition:all 0.2s;opacity:0}.ui-animation-1-run{opacity:1}.ui-animation-2-init{transition:all 0.2s;transform:scale(1.5)}.ui-animation-2-run{transform:scale(1)}.ui-animation-3-init{transition:all 0.2s;transform:scale(0.5)}.ui-animation-3-run{transform:scale(1)}.ui-animation-4-init{transition:all 0.2s;transform:rotateY(-90deg)}.ui-animation-4-run{transform:rotateY(-1deg)}.ui-animation-5-init{transition:all 0.2s;transform:translate(-100px);opacity:0}.ui-animation-5-run{transform:translate(0);opacity:1}.ui-animation-6-init{transition:all 0.2s;transform:translate(0,-100px);opacity:0}.ui-animation-6-run{transform:translate(0,0);opacity:1}

.ui-clipboard{position:absolute;left:-100px;top:-100px;height:1px;width:1px}

.ui-colorpicker-container{position:absolute;z-index:109}.ui-colorpicker{border:1px solid #E0E0E0;font-size:14px;color:#000;width:254px;background-color:#FFF;box-shadow:0 5px 10px rgba(0,0,0,0.08);border-radius:var(--radius);overflow:hidden;margin:0;padding:7px 0 3px}.ui-colorpicker-body{text-align:center}.ui-colorpicker-body div:nth-child(1){margin-bottom:0}.ui-colorpicker-body div:nth-child(2){margin-bottom:8px;padding-bottom:2px;border-bottom:1px solid #E0E0E0}.ui-colorpicker-cell{cursor:pointer;width:20px;height:16px;display:inline-block;vertical-align:top}.ui-colorpicker-cell span{display:block;height:16px;margin:0 2px;border-radius:2px;border:1px solid rgba(0,0,0,0.1);font-size:9px;line-height:15px;color:red}.ui-colorpicker-body span:hover{border-color:rgba(0,0,0,0.3)}

.ui-columns > section{float:left;border-left:1px solid #E0E0E0}.ui-columns > section:first-child{border-left:0}.ui-columns-noborder > section{border-left:0 !important}

.ui-configuration-group{font-size:16px;font-weight:bold;margin:20px 0 10px;padding:5px 0;border-bottom:2px solid #E0E0E0}.ui-configuration-group i{margin-right:7px}.ui-configuration-group-summary{font-size:12px;color:#777;line-height:15px;margin:5px 0 25px}.ui-configuration-group:first-child{margin-top:0}.ui-configuration-items{margin:0 0 15px 3px;padding-left:20px;border-left:2px solid #F0F0F0}.ui-configuration-items:before{content:' ';width:10px;height:10px;background-color:#F0F0F0;display:block;border-radius:100px;margin:-15px 0 0 -26px}.ui-configuration-items:after{content:' ';width:10px;height:10px;background-color:#F0F0F0;display:block;border-radius:100px;margin:-15px 0 0 -26px}.ui-configuration-button{margin-top:8px}.ui-configuration-button button{font-size:11px;border:1px solid #E0E0E0;border-radius:var(--radius);background-color:#FFF;color:#333;padding:2px 5px;min-width:50px}.ui-configuration-button button:hover{border-color:#D0D0D0}.ui-configuration-button button:disabled{color:#B0B0B0;cursor:not-allowed;border-color:#F0F0F0;background-color:#F8F8F8}.ui-configuration-button i{margin-right:5px}.ui-configuration-item{padding:15px 0 15px;border-bottom:1px solid #E0E0E0}.ui-configuration-monospace{font-family:Menlo, Consolas, monospace}.ui-configuration-item-label{font-size:13px;font-weight:bold}.ui-configuration-item-label i{width:14px;text-align:center;margin-right:5px}.ui-configuration-item-summary{font-size:12px;color:#777;line-height:15px;margin:5px 0}.ui-configuration-item-note{font-size:11px;color:#A0A0A0;line-height:12px;margin:2px 0 0}.ui-configuration-item-control{margin:7px 0}.ui-configuration-noborder{border:0}.ui-configuration-type-string input{border:0;width:100%;height:34px;padding:0 8px;margin:0;outline:0;background-color:transparent;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:12px}.ui-configuration-type-string input:disabled, .ui-configuration-type-number input:disabled{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-type-multiline textarea{border:0;width:100%;height:34px;padding:8px;margin:0;outline:0;background-color:transparent;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:12px;resize:none;height:100px}.ui-configuration-type-multiline textarea:disabled{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-type-number input{border:0;width:100%;height:32px;padding:0 8px;margin:0;outline:0;background-color:transparent;border:0;font-size:12px;border-radius:var(--radius)}.ui-configuration-type-number{max-width:200px;width:100%;border-radius:var(--radius);border:1px solid #D0D0D0}.ui-configuration-type-number > div{margin-right:33px}.ui-configuration-type-number > span{float:right;border-left:1px solid #D0D0D0;width:33px;height:32px;text-align:center;padding:4px 0 0}.ui-configuration-type-number > span i{display:block;line-height:12px;cursor:pointer}.ui-configuration-type-number input{text-align:center}.ui-configuration-disabled .ui-configuration-type-number{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-number > span i{cursor:not-allowed}.ui-configuration-type-boolean{height:28px;position:relative}.ui-configuration-type-boolean div{width:48px;height:24px;border-radius:100px;float:left;border:1px solid #D0D0D0;margin:0;padding:0;line-height:0;cursor:pointer}.ui-configuration-type-boolean span{border-radius:100px;border:1px solid #D0D0D0;position:absolute;top:0;left:0;height:24px;width:24px;text-align:center;background-color:#F0F0F0;transition:all 0.2s}.ui-configuration-type-boolean i{display:none}.ui-configuration-disabled .ui-configuration-type-boolean div{cursor:not-allowed;background-color:#F0F0F0}.ui-configuration-required .ui-configuration-item-label:before{content:'*';margin-right:5px;color:red}.ui-configuration-checked .ui-configuration-type-boolean div{background-color:var(--color);border-color:var(--color)}.ui-configuration-checked span{left:26px;top:2px;border:0;height:20px;width:20px;line-height:22px;font-size:11px;background-color:#FFF}.ui-configuration-checked i{display:inline-block;color:var(--color)}.ui-configuration-type-color{width:50px;border:1px solid #D0D0D0;border-radius:var(--radius);padding:2px;cursor:pointer}.ui-configuration-type-color div{height:44px;border-radius:var(--radius)}.ui-configuration-disabled .ui-configuration-type-color{cursor:not-allowed}.ui-configuration-type-icon{width:50px;height:50px;border:1px solid #D0D0D0;border-radius:var(--radius);text-align:center;cursor:pointer;line-height:49px;font-size:28px}.ui-configuration-disabled .ui-configuration-type-icon{cursor:not-allowed;color:#A0A0A0}.ui-configuration-type-date{height:28px;position:relative;cursor:pointer;max-width:200px}.ui-configuration-type-date label{position:absolute;font-size:12px;line-height:34px;pointer-events:none;color:#A0A0A0;padding-left:10px}.ui-configuration-type-date div{height:34px;border:1px solid #D0D0D0;margin:0;padding:0;border-radius:var(--radius);font-size:12px;line-height:34px;padding:0 8px;text-align:center}.ui-configuration-type-date span{float:right;width:34px;height:34px;border-left:1px solid #D0D0D0;line-height:34px;text-align:center}.ui-configuration-disabled .ui-configuration-type-date{cursor:not-allowed;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-date div{background-color:#F0F0F0}.ui-configuration-type-dropdown{height:28px;position:relative;cursor:pointer}.ui-configuration-type-dropdown label{position:absolute;font-size:12px;line-height:34px;padding:0 10px;pointer-events:none;color:#A0A0A0}.ui-configuration-type-dropdown div{height:34px;border:1px solid #D0D0D0;margin:0;padding:0;border-radius:var(--radius);font-size:12px;line-height:34px;padding:0 8px}.ui-configuration-type-dropdown span{float:right;width:34px;height:34px;border-left:1px solid #D0D0D0;line-height:34px;text-align:center}.ui-configuration-disabled .ui-configuration-type-dropdown{cursor:not-allowed;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-dropdown div{background-color:#F0F0F0}.ui-configuration-type-selectable-item{position:relative;display:inline-block;width:80px;height:60px;text-align:center;border:1px solid #D0D0D0;padding:11px 0 0;font-size:11px;margin:5px 5px 0 0;border-radius:var(--radius);cursor:pointer}.ui-configuration-type-selectable-item:hover{background-color:#F8F8F8}.ui-configuration-selected.ui-configuration-type-selectable-item{background-color:var(--color);border-color:var(--color);color:#FFF}.ui-configuration-type-selectable-item i{display:block;font-size:20px;margin-bottom:5px}.ui-configuration-type-selectable-item span{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 5px}.ui-configuration-last{border-bottom:0}.ui-configuration-align-1 input{text-align:center}.ui-configuration-align-2 input{text-align:right}

.ui-crop{text-align:center;padding:40px 0 60px;background-color:#FFFFF5;position:relative;width:100%;user-select:none}.ui-crop canvas{cursor:crosshair;border:1px solid #4285F4}.ui-crop-dragdrop canvas{border:1px dashed red !important}.ui-crop ul{position:absolute;list-style-type:none;margin:0;padding:0;left:50%;margin-left:-100px;bottom:18px;width:200px;color:#FFF;text-align:center}.ui-crop ul li{font-size:12px;padding:3px 0;width:25px;margin-left:5px;position:relative;display:inline-block;cursor:pointer;text-align:center;background-color:var(--color);line-height:20px;border-radius:var(--radius);user-select:none}.ui-crop ul li:first-child{border-left:0;margin-left:0}.ui-crop ul li:hover{opacity:0.9}

.dg{color:#000;position:relative;visibility:hidden;background-color:#FFF}.dg-body{outline:0 !important;background-color:#FFF}.dg .ui-scrollbar-y{margin-top:62px}.dg .dg-header-scrollbar > .ui-scrollbar-area{overflow-y:hidden}.dg .dg-body-scrollbar > .ui-scrollbar-area{overflow-x:hidden}.dg-container{overflow:hidden;border-top:1px solid #E0E0E0;border-left:1px solid #E0E0E0;border-right:1px solid #E0E0E0;position:relative}.jc-19 .dg-container,.jc-20 .dg-container{border-bottom:1px solid #E0E0E0}.dg-mobile .dg-container{border-right:1px solid #E0E0E0;border-bottom:1px solid #E0E0E0}.dg-header{position:relative;border-bottom:1px solid #E0E0E0}.dg-hrow{height:60px}.dg-hcol{float:left;border-left:1px solid #E0E0E0;height:60px;font-weight:bold;position:relative;background-color:#F9F9F9}.dg-sort{float:right;font-size:11px;width:20px;text-align:center;padding:12px 0 0;color:var(--color)}.dg-monospace{font-family:Menlo,Consolas,monospace;font-size:11px}.dg-btn-columns{cursor:pointer;color:#D0D0D0;font-size:20px;position:absolute;right:0;height:61px;background-color:#D0D0D0;width:13px;text-align:left;z-index:3}.dg-btn-columns span{display:block;padding-top:4px;font-size:6px;color:gray;text-align:center}.dg-btn-columns:hover{background-color:#D9D9D9;color:#D9D9D9}.dg-sorting{cursor:pointer}.dg-label.right{padding-right:0}.dg-sorting .ti-arrows-v{color:#C5C5C5}.dg-hcol:first-child{border-left:0}.dg-resize{position:absolute;width:10px;cursor:col-resize;height:38px;border-right:1px solid #E0E0E0;z-index:2}.dg-label{padding:8px 8px 0;height:37px;font-size:12px;user-select:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.dg-sorting .dg-label.center{padding-left:25px;padding-right:0}.dg-sorting .dg-label{margin-right:24px}.dg-filter{padding:0 8px;border-top:1px solid #E0E0E0;height:23px;background-color:#FFF}.dg-filter input,.dg-filter label{width:100%;outline:0;font-size:11px;background-color:transparent;border:0;margin:0;padding:0;line-height:23px;height:23px;font-weight:normal}.dg-filter label{color:#A0A0A0;cursor:pointer;display:block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.dg-filter.center input{text-align:center}.dg-filter.right input{text-align:right}.dg-filter-empty{border-top:1px solid #E0E0E0;height:23px;cursor:not-allowed !important;background:repeating-linear-gradient(45deg,#FFF,#FFF 10px,#F9F9F9 10px,#F9F9F9 20px)}.dg-hcol .dg-label{padding-top:11px}.dg-filter-selected{background-color:#FBF0CA !important}.dg-filter-selected label{color:#000}.dg-filter > i{position:absolute;right:8px;margin-top:6px;font-size:10px;color:red;display:none;cursor:pointer}.dg-filter-selected > i{display:block}.dg-filter-selected input{padding-right:12px}.dg-clickable .dg-row{cursor:pointer}.dg-row{height:30px;font-size:12px;border-bottom:1px solid #E0E0E0;-webkit-transform:translateZ(0)}.dg-row-changed{background-color:rgba(208,31,33,0.07)}.dg-row.dg-selected{background-color:rgba(249,232,196,0.5) !important}.dg-col{float:left;border-left:1px solid #E0E0E0;height:29px;overflow:hidden;min-width:30px}.dg-col:first-child{border-left:0}.dg-col-changed{background-image:url(data:image/gif;base64,R0lGODdhBgAGAIAAAP8mAAAAACH5BAEAAAEALAAAAAAGAAYAAAIKhI8QGGvt4JKhAAA7);background-repeat:no-repeat;background-position:0 0}.dg-value{padding:6px 8px 0;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;height:30px}.dg-number{padding:6px 5px 0;font-size:11px;text-align:right;height:30px;color:#A0A0A0}.dg-col--1{width:40px}.dg-col--1 .dg-label{text-overflow:clip}.dg-row-empty{height:30px;font-size:12px;border-bottom:1px solid #F0F0F0;background-color:#FFF !important;cursor:default}.dg-footer{border:1px solid #E0E0E0;border-top:0;height:33px}.dg-pagination{float:left}.dg-pagination button{background-color:#FFF;border:0;border-left:1px solid #E0E0E0;height:31px;width:40px;color:#000;font-size:12px;text-align:center;outline:0}.dg-pagination button:hover{background-color:#F0F0F0}.dg-pagination button:disabled{background-color:#F9F9F9;color:#A0A0A0}.dg-pagination button:first-child{border-left:0}.dg-pagination button[name='page-prev']{border-right:1px solid #E0E0E0;width:41px}.dg-pagination button[name='page-last']{border-right:1px solid #E0E0E0}.dg-pagination input{width:40px;text-align:center;border:0;outline:0;font-size:12px;padding:0;margin:0;background:transparent}.dg-pagination > div{position:relative;display:inline-block}.dg-pagination-items{float:right;font-size:12px;margin:7px 10px 0 0;font-weight:bold}.dg-pagination-pages{float:left;font-size:12px;margin:7px 0 0 10px}.dg-visible{visibility:visible}.dg-columns{position:absolute;right:0;top:35px;width:182px;background-color:#FFF;z-index:1;box-shadow:0 5px 20px rgba(0,0,0,0.1);border-radius:var(--color);font-size:12px;line-height:16px;z-index:6;color:#000;border:1px solid #E0E0E0;user-select:none}.dg-columns-checkbox > span{border-radius:4px;border:1px solid #D0D0D0;margin:2px 5px 0 0;font-size:8px;color:#FFF;width:12px;height:12px;line-height:12px;float:left;text-align:center}.dg-columns-checkbox > span i{visibility:hidden}.dg-columns-checkbox-checked > span{background-color:#000;border-color:#000}.dg-columns-checkbox-checked > span i{visibility:visible}.dg-columns > div{border-bottom:1px solid #D0D0D0;overflow:hidden}.dg-columns-body{max-height:180px;overflow-scrolling:touch;overflow-y:auto;padding:8px 50px 10px 3px;width:210px;overflow-x:hidden}.dg-columns label{display:block;cursor:pointer;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}.dg-columns label input{vertical-align:middle}.dg-columns label span{vertical-align:middle;margin-left:5px}.dg-columns-button{margin:10px 10px 0;display:block;width:160px;background-color:#000;border-radius:var(--radius);color:#FFF;border:0;font-size:11px;height:24px}.dg-columns-button:hover{background-color:#404040}.dg-columns-button i{margin-right:6px}.dt-columns-reset{display:block;font-size:11px;padding:3px 0 8px 10px;cursor:pointer;color:#888}.dt-columns-reset:hover{text-decoration:underline}.dg-hcol .dg-checkbox{margin-top:0}.dg-checkbox{width:15px;height:15px;border:1px solid #D0D0D0;vertical-align:middle;font-size:11px;text-align:center;padding:1px 0 0 1px;background-color:#FFF;border-radius:4px;margin:0 auto 0}.dg-checkbox i{display:none}.dg-checked{background-color:var(--color);border-color:var(--color);color:#FFF}.dg-checked i{display:block}.dg-required:before{content:'*';font-size:14px;color:red;font-weight:bold;margin-right:3px;vertical-align:top}.dg input:-ms-input-placeholder{color:#A0A0A0 !important}.dg input::placeholder{color:#A0A0A0;opacity:1}.dg input::-ms-input-placeholder{color:#A0A0A0 !important}.dg-col button{margin:4px 0 0 1px;border:0;background-color:#F0F0F0;font-size:12px;color:#404040;height:19px;border:1px solid #F0F0F0;border-left:0;padding:0 3px;outline:0;line-height:10px;min-width:20px}.dg-col button:hover{background-color:var(--color);border-color:var(--color);color:#FFF}.dg-col button[name='remove']{background-color:#FFE5DD;border-color:#FFE5DD;color:red}.dg-col button[name='remove']:hover{background-color:#E8483F;border-color:#E8483F;color:#FFF}.dg-col button:first-child{border-top-left-radius:3px;border-bottom-left-radius:3px;margin-left:0}.dg-col button:last-child{border-top-right-radius:3px;border-bottom-right-radius:3px}.dg-col button:disabled{background-color:#F0F0F0 !important;color:#A0A0A0 !important;cursor:not-allowed}.dg-editable .dg-checkbox{position:relative;display:inline-block;margin-left:5px;margin-right:5px}.dg-editable > div > .dg-checkbox{border-color:var(--color)}.dg-checkbox-main{margin-top:7px}.dg-bool{height:30px;padding-top:7px}.dg-bool .dg-checked{background-color:#D0D0D0;border-color:#D0D0D0;color:gray}.dg-editable{background-color:rgba(255,241,164,0.1)}.dg-editable input{width:100%;height:28px;background-color:transparent;border:0;outline:0;padding:0 8px}.dg-noscroll .ui-scrollbar-area{overflow-y:hidden}.dg-noscroll .ui-scrollbar-y span{visibility:hidden}.dg-noborder .dg-container{border:0}.dg-noborder .dg-footer{border:0;border-top:1px solid #E0E0E0}.dg-header-scrollbar{overflow-y:hidden}.dg-header-scrollbar-container{height:58px;overflow:hidden}.dg-resize-line{position:absolute;width:1px;background-color:#E0E0E0;z-index:6}.dg-colorize{padding:2px 3px;border-radius:4px;color:#FFF}.dg-fluid{border-right:1px solid #E0E0E0}.dg-noborder.dg-fluid{border-right:0}.dg-link{color:inherit}.dg-link i{margin-right:5px}.dg-controls{position:absolute;right:20px;background-color:#FFF;border:1px solid #D0D0D0;height:34px;color:#000;z-index:1;margin-right:5px;border-radius:var(--radius);box-shadow:1px 0 15px rgba(0,0,0,0.1);transition:all 0.1s;transform:scale(0)}.dg-controls button{border:0;min-width:34px;height:32px;background-color:#F0F0F0;border-left:1px solid #E0E0E0;background-color:transparent;font-size:12px;float:left;color:#000;padding:0 10px}.dg-controls button i{font-size:14px}.dg-controls button span{padding:0 5px}.dg-controls button:hover{background-color:#F0F0F0}.dg-controls button:first-child{border-left:0}.dg-controls button:disabled{color:#A0A0A0;cursor:not-allowed;background-color:transparent !important}.dg-controls button:disabled i{color:#A0A0A0 !important}.dg-controls-visible{transform:scale(1)}.dg-row:hover, .dg-row-hover{background-color:rgba(130,130,130,0.07)}.dg-hfunc{width:15px;height:15px;vertical-align:middle;font-size:11px;text-align:center;background-color:#FFF;margin:0px auto 0}

.ui-datepicker-container{bottom:0;left:0;position:absolute;right:0;top:0;z-index:99}.ui-datepicker{-moz-transform:scale(0.6);-moz-transition:all 0.2s;-ms-transform:scale(0.6);-ms-transition:all 0.2s;-webkit-transform:scale(0.6);-webkit-transition:all 0.2s;background-color:#FFF;border-radius:var(--radius);border:1px solid #E0E0E0;box-shadow:0 5px 25px rgba(0,0,0,0.1);color:gray;filter:alpha(opacity=0);font-size:12px;left:100px;opacity:0;position:absolute;top:100px;transform:scale(0.6);transition:all 0.2s;width:247px;z-index:100}.ui-datepicker-visible{-moz-transform:scale(1);-ms-transform:scale(1);-webkit-transform:scale(1);filter:alpha(opacity=100);opacity:1;transform:scale(1)}.ui-datepicker-disabled{color:silver !important;cursor:pointer}.ui-datepicker-body,.ui-datepicker-months,.ui-datepicker-years{height:235px}.ui-datepicker-footer{background-color:#F8F8F8;border-top:1px solid #E0E0E0;display:flex;font-size:11px;height:28px;justify-content:space-between;line-height:26px;padding:0 8px;border-radius:0 0 var(--radius) var(--radius)}.ui-datepicker-footer > span:hover{text-decoration:underline}.ui-datepicker-now,.ui-datepicker-clear{color:#000;cursor:pointer}.ui-datepicker-day-today div{background-color:#F0F0F0;font-weight:bold}.ui-datepicker-selected div{background-color:var(--color);color:#FFF;font-weight:bold}.ui-datepicker-date i{color:red;font-size:12px;left:12px;position:absolute;top:25px}.ui-datepicker-months > div{cursor:pointer;display:inline-block;font-weight:bold;height:78px;line-height:76px;position:relative;text-align:center;text-transform:uppercase;width:61px}.ui-datepicker-months > div > div{border-radius:100%;border:2px solid transparent;display:inline-block;height:50px;line-height:46px;position:relative;width:50px}.ui-datepicker-months > div:hover > div{border-color:#E0E0E0;color:#000}.ui-datepicker-years{padding:5px 0 0}.ui-datepicker-years > div{cursor:pointer;display:inline-block;height:46px;line-height:44px;position:relative;text-align:center;width:49px}.ui-datepicker-years > div > div{border-radius:100%;border:2px solid transparent;display:inline-block;height:40px;line-height:36px;position:relative;width:40px}.ui-datepicker-years > div:hover > div{border-color:#E0E0E0;color:#000}.ui-datepicker-header{border-bottom:1px solid #E0E0E0;font-size:14px;height:35px;text-align:center}.ui-datepicker-prev{color:#000;cursor:pointer;float:left;line-height:34px;width:34px}.ui-datepicker-next{color:#000;cursor:pointer;float:right;line-height:34px;width:34px}.ui-datepicker-prev:hover,.ui-datepicker-next:hover{background-color:#F0F0F0}.ui-datepicker-info{line-height:34px;margin:0 34px}.ui-datepicker-info > span{cursor:pointer}.ui-datepicker-info > span:hover{color:#000}.ui-datepicker-info .ui-datepicker-year{margin-left:5px}.ui-datepicker-week > div,.ui-datepicker-days > div{display:inline-block;height:35px;line-height:35px;position:relative;text-align:center;vertical-align:middle;width:35px}.ui-datepicker-week > div{border-bottom:1px solid #E0E0E0;color:#000;font-weight:bold;height:25px;line-height:25px}.ui-datepicker-days > div{cursor:pointer;font-size:11px}.ui-datepicker-date:hover > div{border-color:#E0E0E0;color:#000}.ui-datepicker-selected:hover > div{border-color:var(--color);color:#FFF}.ui-datepicker-days > div > div{border-radius:100%;border:2px solid transparent;display:inline-block;height:28px;line-height:24px;margin:0 auto;position:relative;width:28px}.ui-datepicker-time{align-items:center;background-color:white;border-top:1px solid #E0E0E0;display:flex;justify-content:center;padding:10px}.ui-datepicker-time .ti-clock{margin-right:32px}.ui-datepicker-select-wrapper{border-radius:3px;border:1px solid #E0E0E0;gap:0;overflow:hidden;transform:translateX(-22px)}.ui-datepicker-select-wrapper.col-2{columns:2}.ui-datepicker-select-wrapper.col-3{columns:3}.ui-datepicker-time select{-moz-appearance:none;-webkit-appearance:none;appearance:none;background:none;border-radius:0;border:none;color:inherit;color:#000;font:inherit;margin:0;outline:none;padding:0;padding:5px 10px;width:100%}.ui-datepicker-selecticon{position:relative;width:50px}.ui-datepicker-selecticon i{pointer-events:none;position:absolute;right:8px;top:50%;transform:translateY(-50%)}.ui-datepicker-select-wrapper > .ui-datepicker-selecticon:first-of-type::after{content:':';position:absolute;right:-1px;top:4px}.ui-datepicker-selecticon.ampm::after{content:':';left:-1px;position:absolute;top:4px}

.ui-detail-group-nolabel .ui-detail-item:first-child{border-radius:var(--radius) var(--radius) 0 0}.ui-detail-group:last-child,.ui-detail-group:last-child section{margin-bottom:0}.ui-detail-group{padding:0;margin-bottom:20px;border:1px solid #E0E0E0;border-radius:var(--radius);background-color:#FFF}.ui-detail-group label{display:block;padding:10px 15px;font-size:16px;font-weight:bold;background-color:#F8F8F8;border-bottom:1px solid #E0E0E0;border-radius:var(--radius) var(--radius) 0 0}.ui-detail-group label i{width:22px}.ui-detail-group label i:before{content:'\\f146'}.ui-detail-hidden label i:before{content:'\\f0fe' !important}.ui-detail-hidden section{display:none}.ui-detail-item{padding:6px 0;background-color:#FFF;margin-bottom:1px;font-size:13px;border-top:1px solid #E0E0E0}.ui-detail-item:first-child{border-top:0}.ui-detail-note{color:gray;font-size:11px;line-height:13px;font-weight:normal}.ui-detail-password{cursor:pointer}.ui-detail-string, .ui-detail-password, .ui-detail-number, .ui-detail-date, .ui-detail-list, .ui-detail-file{padding:0}.ui-detail-date > i{float:right;width:18px;margin:4px 0 0;text-align:right;font-size:12px}.ui-detail-date > div{margin-right:18px}.ui-detail-bool, .ui-detail-list, .ui-detail-color, .ui-detail-fontawesome, .ui-detail-emoji, .ui-detail-file{line-height:22px}.ui-detail-bool span{width:15px;height:15px;display:inline-block;border:1px solid #D0D0D0;line-height:15px;font-size:9px;text-align:center;margin:4px 0 5px;border-radius:var(--radius);position:relative;color:#FFF;vertical-align:top}.ui-detail-bool.checked span{background-color:var(--color);border-color:var(--color)}.ui-detail-fontawesome, .ui-detail-emoji, .ui-detail-color{line-height:22px;display:block;font-size:20px;position:relative;text-align:left;margin-bottom:2px}.ui-detail-list i{float:right;width:20px;line-height:23px;text-align:right;font-size:12px}.ui-detail-list span{display:block;margin-right:25px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-detail-color{padding:3px 0 0}.ui-detail-color span b{height:18px;display:block;border-radius:var(--radius);color:gray;width:60px}.ui-detail-colorize{padding:2px 3px;border-radius:var(--radius);color:#FFF}.ui-detail-style-1 .ui-detail-item{padding:6px 0;margin-bottom:1px;font-size:13px;border-top:1px solid #E0E0E0}.ui-detail-style-1 .ui-detail-item:first-child{border-top:0}.ui-detail-style-1 .ui-detail-key{float:left;width:170px;line-height:24px;padding:0 5px 0 15px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#707070}.ui-detail-style-1 .ui-detail-key i{margin-right:7px}.ui-detail-style-1 .ui-detail-value{margin:0 10px 0 170px;line-height:21px}.ui-detail-style-2 .ui-detail-item{padding:10px 0;background-color:#FFF;margin-bottom:1px;font-size:12px;border-top:1px solid #E0E0E0}.ui-detail-style-2 .ui-detail-item:first-child{border-top:0}.ui-detail-style-2 .ui-detail-key{line-height:14px;padding:0 5px 0 15px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#707070}.ui-detail-style-2 .ui-detail-key i{margin-right:7px}.ui-detail-style-2 .ui-detail-value{margin:0 15px;line-height:17px}.ui-detail-style-2 .ui-detail-color span b{border-radius:5px;width:20px}.ui-detail-style-2 .ui-detail-fontawesome{padding-top:5px}.ui-detail-style-2 .ui-detail-bool span{width:18px;height:18px;line-height:18px;font-size:12px}.ui-detail-style-3{background-color:#F0F0F0;padding:5px 0}.ui-detail-style-3 .ui-detail-group{background-color:#F0F0F0;border:0;padding:0 5px;margin-bottom:0}.ui-detail-style-3 .ui-detail-group label{padding:3px 5px 0;font-size:12px;background-color:transparent;border:0}.ui-detail-style-3 .ui-detail-group section{padding:5px 0}.ui-detail-style-3 .ui-detail-item{padding:0;margin:1px 5px;border:none;background-color:#FFF;font-size:12px}.ui-detail-style-3 .ui-detail-item:first-child{border-top:0;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.ui-detail-style-3 .ui-detail-item:last-child{border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-detail-style-3 .ui-detail-note{display:none}.ui-detail-style-3 .ui-detail-key{float:left;width:150px;line-height:20px;padding:0 5px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#707070}.ui-detail-style-3 .ui-detail-key i{margin-right:7px}.ui-detail-style-3 .ui-detail-value{margin:0 10px 0 150px;line-height:20px;border-left:1px solid #E0E0E0;padding:0 5px;height:22px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ui-detail-style-3 .ui-detail-fontawesome, .ui-detail-style-3 .ui-detail-emoji, .ui-detail-style-3 .ui-detail-color{line-height:20px;font-size:14px;margin-bottom:0}.ui-detail-style-3 .ui-detail-color span b{height:14px}.ui-detail-style-4 .ui-detail-item{padding:1px 0;margin-bottom:1px;font-size:13px;border-top:0}.ui-detail-style-4 .ui-detail-item:first-child{border-top:0}.ui-detail-style-4 .ui-detail-key{float:left;width:170px;line-height:20px;padding:0 5px 0 0;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#999}.ui-detail-style-4 .ui-detail-key i{margin-right:7px}.ui-detail-style-4 .ui-detail-value{margin:0 0 0 170px;line-height:18px}.ui-detail-style-4 .ui-detail-group{background-color:transparent;border:0;padding:0;margin-bottom:0}.ui-detail-style-4 .ui-detail-group label{background-color:transparent;border:0;border-bottom:1px solid #E0E0E0;padding:6px 0;margin-bottom:5px}.ui-detail-style-4 .ui-detail-group section{padding:5px 0}.ui-detail-style-4.ui-detail-small .ui-detail-item{font-size:12px;padding:2px 0;min-height:14px}.ui-detail-style-4.ui-detail-small .ui-detail-key{padding-left:8px;line-height:14px}.ui-detail-style-4.ui-detail-small .ui-detail-value{line-height:14px}.ui-detail-small .ui-detail-value{line-height:20px}.ui-detail-small .ui-detail-bool{line-height:18px}.ui-detail-small .ui-detail-bool span{width:13px;height:13px;line-height:12px;font-size:7px;margin:4px 0px 3px}.ui-detail-small .ui-detail-group label{padding:8px;font-size:13px}.ui-detail-style-1.ui-detail-small .ui-detail-item{font-size:12px;padding:3px 0;min-height:24px}.ui-detail-style-2.ui-detail-small .ui-detail-item{font-size:12px;padding:5px 0;min-height:24px}.ui-detail-style-1.ui-detail-small .ui-detail-key{padding-left:8px;line-height:20px}.ui-detail-style-2.ui-detail-small .ui-detail-key{padding-left:8px}.ui-detail-style-2.ui-detail-small .ui-detail-value{margin:0 8px}.ui-detail-style-3.ui-detail-small .ui-detail-key{width:120px;font-size:11px}.ui-detail-style-3.ui-detail-small .ui-detail-value{margin-left:120px;font-size:11px}.ui-detail-style-3.ui-detail-small .ui-detail-group label{padding:3px 5px 0;font-size:11px}.ui-detail-small .ui-detail-color span b{height:15px;width:40px}.ui-detail-small .ui-detail-fontawesome{font-size:14px;line-height:16px;padding-top:2px}.ui-detail-small .ui-detail-emoji{font-size:14px;line-height:16px;padding-top:2px}.ui-detail-small .ui-detail-list{line-height:18px}

.ui-directory-area{position:absolute;left:0;top:0;right:0;bottom:0;z-index:99}.ui-directory{position:absolute;opacity:0;transition:0.25s transform cubic-bezier(0.23,1,0.32,1);left:-100;top:-100;z-index:100;box-shadow:0 1px 20px rgba(0,0,0,0.1);background-color:#FFF;border-radius:var(--radius);border:1px solid #E0E0E0;overflow:hidden;transition:all 0.2s}.ui-directory-search{height:42px;background:#FFF;border-radius:var(--radius) var(--radius) 0 0;border-bottom:1px solid #E0E0E0;line-height:26px}.ui-directory-search input{width:100%;background-color:#FFF;border:0;font-size:14px;outline:0;padding:0;margin:0;line-height:28px;outline:0}.ui-directory-search > div{margin:0 22px 0 35px;padding:6px 10px 0 0;line-height:24px}.ui-directory-search > span{float:left;width:16px;text-align:center;padding:7px 0 0 12px;font-size:14px}.ui-directory-add{float:right !important;padding-left:0 !important;color:#83c83c;text-align:left !important;font-size:14px !important;cursor:pointer;width:24px !important;font-weight:bold;padding-top:8px}.ui-directory .ui-disabled{color:#A0A0A0 !important;cursor:not-allowed}.ui-directory-search .ti-times{color:red;cursor:pointer}.ui-directory-visible{opacity:1}.ui-directory-container{height:180px;overflow-x:hidden;overflow-y:auto;overflow-scrolling:touch;margin:0 30px 0 0;padding:0}.ui-directory ul{list-style-type:none;margin:0;padding:0}.ui-directory .selected{background-color:#F8F8F8;color:#000}.ui-directory .current{background-color:#F2F2F2;color:#000}.ui-directory-default li{padding:0 40px 0 10px;height:32px;line-height:32px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-directory li{border-bottom:1px solid #F0F0F0;font-size:14px;background-color:#FFF;cursor:pointer;margin:0}.ui-directory-checkbox{width:16px;height:16px;float:left;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:10px;line-height:16px;margin:8px 6px 0 0;text-align:center;background-color:#FFF}.ui-directory-checkbox i{visibility:hidden}.ui-directory .selected .ui-directory-checkbox{background-color:#4285F4;border-color:#4285F4;color:#FFF}.ui-directory .selected .ui-directory-checkbox i{visibility:visible}.ui-directory li:last-child{border-bottom:0}.ui-directory-search-hidden .ui-directory-search{height:0;overflow:hidden;opacity:0}

.ui-centered-noscroll,.ui-centered-noscroll body{overflow:hidden}.ui-centered-container{position:fixed;width:100%;height:100%;z-index:5;background-color:rgba(255,255,255,0.95);left:0;top:0}.ui-centered-body{display:table-cell;vertical-align:middle;text-align:center}.ui-centered-content{display:table;width:100%;height:100%}.ui-centered-button{font-size:14px;color:#A0A0A0;position:absolute;right:15px;top:15px;cursor:pointer;opacity:0.7;transition:all 0.3s;width:24px;height:24px;text-align:center;line-height:24px;z-index:2}.ui-centered-button:active{top:21px}.ui-centered-button:hover{opacity:1}

.ui-dropfiles{position:fixed;left:10px;top:10px;right:10px;bottom:10px;z-index:-1;display:none;background-color:rgba(0,0,0,0.4);border:2px dashed rgba(0,0,0,0.6);border-radius:var(--radius)}.ui-dropfiles-visible{display:block;z-index:500}.ui-dropfiles > div{display:flex;width:100%;height:100%;align-items:center;justify-content:center;font-size:16px;color:#FFF;pointer-events:none}.ui-dropfiles-enabled iframe{pointer-events:none}

.ui-edit-window{position:absolute;box-shadow:0 0 10px rgba(0,0,0,0.1);padding:10px;border-radius:var(--radius);width:100px;background-color:#FFF;border:1px solid #EAEAEA;z-index:5;outline:0}

.ui-empty-table{display:table;width:100%;height:100%;color:#777;font-size:13px}.ui-empty-cell{display:table-cell;width:100%;height:100%;text-align:center;vertical-align:middle}.ui-empty-cell > i{font-size:40px;width:100px;height:100px;line-height:100px;text-align:center;background-color:#F0F0F0;border-radius:100px;color:#D0D0D0;transform:scale(1)}.ui-empty-cell > div{margin-top:15px}

.ui-emptyinline{padding:5px 0;color:#777;font-size:12px}.ui-emptyinline i{margin-right:5px}

.exec{cursor:pointer}

.ui-expander{position:relative;width:100%;font-size:14px}.ui-expander-container{overflow:hidden;transition:all 0.5s}.ui-expander-fade{position:absolute;left:0;top:50%;margin-top:-30px;background:linear-gradient(transparent,#FFF);height:50%;width:100%;text-align:center;display:none}.ui-expander-button{display:none;text-align:center;margin:10px auto;cursor:pointer;font-size:15px;color:#A0A0A0;max-width:200px;border-top:1px solid #E0E0E0;padding:3px 0;border-radius:0 0 var(--radius) var(--radius)}.ui-expander-button:hover{background-color:#F8F8F8}.ui-expander-visible .ui-expander-button{display:block}.ui-expander-visible .ui-expander-fade{display:block}.ui-expander-visible.ui-expander-expanded .ui-expander-fade{display:none}.ui-expander-visible.ui-expander-expanded .ui-expander-container{max-height:1500px !important}

.ui-expansionpanel{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-expansionpanel-item{border-top:1px solid #E0E0E0}.ui-expansionpanel-item.selected > label{background:#F8F8F8;font-weight:bold}.ui-expansionpanel-item > label{display:block;cursor:pointer;padding:10px 15px;font-size:13px}.ui-expansionpanel-item > label i{margin-right:8px}.ui-expansionpanel-item:first-child{border-top:0}.ui-expansionpanel-item:first-child > label{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.ui-expansionpanel-item:last-child > label{border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-expansionpanel-item.selected:last-child > label{border-bottom-left-radius:0;border-bottom-right-radius:0}

.ui-features-layer{position:fixed;width:100%;height:100%;left:0;top:0;overflow:hidden;z-index:101;background-color:rgba(0,0,0,0.8);transition:0.25s transform cubic-bezier(0.23,1,0.32,1);transform:scale(0.8)}.ui-features{position:absolute;left:-100px;top:-100px;z-index:20;width:500px;box-shadow:0 1px 20px rgba(0,0,0,0.2);transform:translate(0px,20px);background-color:#FFF;border-radius:var(--radius);overflow:hidden}.ui-features-search{height:60px;background:#FFF;border-radius:var(--radius) var(--radius) 0 0;border-bottom:1px solid #E0E0E0}.ui-features-search input{width:100%;background-color:#FFF;border:0;font-size:20px;outline:0}.ui-features-search > div{margin-left:42px;padding:15px 10px 0 0}.ui-features-search > span{float:left;width:32px;text-align:right;padding:17px 0 0;font-size:18px}.ui-features .selected{font-weight:bold;background-color:var(--color);color:#FFF !important}.ui-features-visible{opacity:1;transform:scale(1)}.ui-features-scrollbar{height:200px}.ui-features ul{list-style-type:none;margin:0;padding:10px 0}.ui-features li{font-size:14px;margin:2px 10px;padding:0 10px;cursor:pointer;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:35px;border-radius:var(--radius)}.ui-features li i{width:18px;text-align:center;margin-right:5px}.ui-features li:hover{background-color:var(--color);color:#FFF}.ui-features-noscroll{overflow:hidden !important}

.ui-form-noscroll,.ui-form-noscroll body{overflow:hidden}.ui-form-container{width:100%;position:fixed;left:0;top:0;bottom:0;right:0;background-color:rgba(230,233,237,0.8);z-index:5;overflow-y:scroll;transform-style:preserve-3d;overflow-scrolling:touch}.ui-form{background-color:#FFF;margin:0 auto 30px;border-radius:var(--radius);box-shadow:0 2px 30px rgba(0,0,0,0.10);transform:translate(0,-500px);transition:all 0.2s;opacity:0}.ui-form-animate{transform:skewX(0deg);opacity:1}.ui-form .padding{padding:15px}.ui-form-title{padding:18px 15px;font-size:16px;user-select:none;color:#000;background-color:#FFF;border-bottom:1px solid #E0E0E0;height:58px}.ui-form-title .ui-form-button-close{float:right;cursor:pointer;font-size:18px;margin:-2px 0 0;transition:all 0.2s;background:none;border:0;outline:0;height:auto;color:red;text-align:right !important;width:20px;padding:0}.ui-form-title .ui-form-button-close:hover{transform:scale(1.2)}.ui-form-title > i{margin-right:7px}.ui-form > nav{padding:0 15px 0;border-top:1px solid #E0E0E0;background-color:#FFF;border-radius:0 0 var(--radius) var(--radius);line-height:65px;height:65px;display:block;float:none;position:relative}.ui-form > nav button{border:0;margin:15px 0 0;background-color:#F0F0F0;height:34px;padding:0 20px;color:#000;cursor:pointer;font-family:Arial;line-height:34px;vertical-align:middle;outline:0;font-size:14px;text-decoration:none;transition:all 0.3s;float:left;width:50%}.ui-form > nav button i{width:15px;text-align:center;margin-right:5px}.ui-form > nav button:hover{opacity:0.9}.ui-form-title > span{font-weight:bold}.ui-form > nav button:active{background-color:#D0D0D0}.ui-form > nav button:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:silver !important;cursor:not-allowed;box-shadow:none}.ui-form > nav button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.ui-form > nav button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-form > nav button[name='submit']{font-weight:bold;background-color:var(--color);color:#FFF}@media(max-width:767px){.ui-form-container-padding{padding:0}.ui-form > nav button[name='submit']{max-width:180px}}@media(max-width:350px){.ui-form-container-padding{padding:0}.ui-form > nav button[name='submit']{max-width:150px}}

.ui-icons-area{position:absolute;left:0;right:0;bottom:0;top:0;z-index:100}.ui-icons-container{position:absolute;z-index:1;border:1px solid #E0E0E0;font-size:14px;color:#000;width:330px;background-color:#FFF;box-shadow:0 5px 10px rgba(0,0,0,0.08);border-radius:var(--radius);overflow:hidden}.ui-icons-header{height:50px;background-color:#fcfcfc;border-bottom:1px solid #e0e0e0;padding:10px 0 0}.ui-icons-nav{padding:13px 5px 6px;text-align:center}.ui-icons-nav span{cursor:pointer;font-size:24px;width:11%;display:inline-block;user-select:none}.ui-icons-search{padding:0 10px}.ui-icons-search span{float:left;width:30px;text-align:center;height:30px;padding:7px 0 0;font-size:12px;background-color:#FFF;border:1px solid #e0e0e0;border-radius:var(--radius) 0 0 var(--radius);color:#A0A0A0;cursor:pointer}.ui-icons-search .ti-times{color:#ff0000}.ui-icons-search div{margin-left:30px}.ui-icons-search-input{margin:0;width:100%;border:1px solid #e0e0e0;padding:0 9px;height:30px;border-radius:0 var(--radius) var(--radius) 0;border-left:0;appearance:none}.ui-icons-search-input:focus{outline:none}.ui-icons-scroll{overflow:auto;height:305px}.ui-icons-content{position:relative;padding:5px}.ui-icons-content span{padding:5px;cursor:pointer;font-size:20px;width:12.5%;height:30px;display:inline-block;text-align:center;user-select:none;color:#404040}.ui-icons-content span:hover{transform:scale(1.15);color:#000}.ui-icons-scrollbar{height:305px}@media(max-width:767px){.ui-icons .ui-icons-nav span{cursor:pointer;font-size:26px}.ui-icons .ui-icons-content span{min-width:45px}}

.ui-imageviewer{position:fixed;left:0;top:0;bottom:0;right:0;z-index:1000;background-color:rgba(240,240,240,0.9)}.ui-imageviewer img{box-shadow:0 0 10px rgba(0,0,0,0.05)}.ui-imageviewer-loading{position:absolute;left:0;top:45px;right:0;bottom:0;background-color:rgba(255,255,255,0.9);z-index:2}.ui-imageviewer-loading > div{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IHgxPSI4LjA0MiUiIHkxPSIwJSIgeDI9IjY1LjY4MiUiIHkyPSIyMy44NjUlIiBpZD0iYSI+PHN0b3Agc3RvcC1jb2xvcj0iI0EwQTBBMCIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjAlIi8+PHN0b3Agc3RvcC1jb2xvcj0iI0EwQTBBMCIgc3RvcC1vcGFjaXR5PSIuNjMxIiBvZmZzZXQ9IjYzLjE0NiUiLz48c3RvcCBzdG9wLWNvbG9yPSIjQTBBMEEwIiBvZmZzZXQ9IjEwMCUiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxIDEpIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMwLTkuOTQtOC4wNi0xOC0xOC0xOCIgc3Ryb2tlPSJ1cmwoI2EpIiBzdHJva2Utd2lkdGg9IjIiPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiBmcm9tPSIwIDE4IDE4IiB0bz0iMzYwIDE4IDE4IiBkdXI9IjAuOXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9wYXRoPjxjaXJjbGUgZmlsbD0iI0EwQTBBMCIgY3g9IjM2IiBjeT0iMTgiIHI9IjEiPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiBmcm9tPSIwIDE4IDE4IiB0bz0iMzYwIDE4IDE4IiBkdXI9IjAuOXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9jaXJjbGU+PC9nPjwvc3ZnPg==) no-repeat 50% 50%;background-size:80px 80px;width:80px;height:80px;position:absolute;left:50%;top:50%;margin:-40px 0 0 -40px}.ui-imageviewer-header{height:45px;border-bottom:1px solid #E0E0E0;background-color:#FFF;box-shadow:0 2px 10px rgba(0,0,0,0.05)}.ui-imageviewer-header > div{line-height:16px;float:left;margin:7px 0 0 15px}.ui-imageviewer-header .help{margin-top:0}.ui-imageviewer-header button{float:right;font-size:14px;background-color:transparent;border:0;margin:0;width:45px;height:44px;border-left:1px solid #E5E5E5;cursor:pointer;color:red;line-height:44px;padding:0}.ui-imageviewer-header button:hover{background-color:#F8F8F8}.ui-imageviewer-buttons{position:absolute;left:0;right:0;top:45px;bottom:0}.ui-imageviewer-buttons button{background-color:#FFF;border:1px solid #FFF;border-radius:var(--radius);width:35px;height:35px;line-height:35px;position:absolute;top:50%;margin-top:-17px;box-shadow:0 0 10px rgba(0,0,0,0.07);padding:0}.ui-imageviewer-buttons button:disabled{color:#A0A0A0;cursor:not-allowed;border-color:#FFF;background-color:#F8F8F8}.ui-imageviewer-buttons button[name='prev']{left:15px}.ui-imageviewer-buttons button[name='next']{right:15px}.ui-imageviewer-viewer{display:table;width:100%}.ui-imageviewer-cell{display:table-cell;width:100%;height:100%;vertical-align:middle;text-align:center}

.ui-inlinedatepicker{font-size:12px;width:247px;height:300px;background-color:#FFF;border:1px solid #E0E0E0;color:gray}.ui-inlinedatepicker-disabled{color:silver !important;cursor:pointer}.ui-inlinedatepicker-body,.ui-inlinedatepicker-months,.ui-inlinedatepicker-years{height:235px}.ui-inlinedatepicker-footer{height:28px;border-top:1px solid #E0E0E0;font-size:11px;padding:0 8px;line-height:26px;background-color:#F8F8F8}.ui-inlinedatepicker-footer > span:hover{text-decoration:underline}.ui-inlinedatepicker-now{float:left;color:#000;cursor:pointer}.ui-inlinedatepicker-day-today div{background-color:#F0F0F0;font-weight:bold}.ui-inlinedatepicker-selected div{background-color:var(--color);font-weight:bold;color:#FFF}.ui-inlinedatepicker-date i{position:absolute;left:12px;top:25px;font-size:12px;color:red}.ui-inlinedatepicker-months > div{width:61px;height:78px;line-height:76px;position:relative;display:inline-block;text-align:center;cursor:pointer;text-transform:uppercase;font-weight:bold}.ui-inlinedatepicker-months > div > div{width:50px;height:50px;line-height:46px;position:relative;display:inline-block;border-radius:100%;border:2px solid transparent}.ui-inlinedatepicker-months > div:hover > div{border-color:var(--color);color:#000}.ui-inlinedatepicker-years{padding:5px 0 0}.ui-inlinedatepicker-years > div{width:49px;height:46px;line-height:44px;position:relative;display:inline-block;text-align:center;cursor:pointer}.ui-inlinedatepicker-years > div > div{width:40px;height:40px;line-height:36px;position:relative;display:inline-block;border-radius:100%;border:2px solid transparent}.ui-inlinedatepicker-years > div:hover > div{border-color:var(--color);color:#000}.ui-inlinedatepicker-header{height:35px;border-bottom:1px solid #E0E0E0;text-align:center;font-size:14px}.ui-inlinedatepicker-prev{float:left;line-height:34px;width:34px;color:#000;cursor:pointer}.ui-inlinedatepicker-next{float:right;line-height:34px;width:34px;color:#000;cursor:pointer}.ui-inlinedatepicker-prev:hover,.ui-inlinedatepicker-next:hover{background-color:#F0F0F0}.ui-inlinedatepicker-info{margin:0 34px;line-height:34px}.ui-inlinedatepicker-info > span{cursor:pointer}.ui-inlinedatepicker-info > span:hover{color:#000}.ui-inlinedatepicker-info .ui-inlinedatepicker-year{margin-left:5px}.ui-inlinedatepicker-week > div,.ui-inlinedatepicker-days > div{width:35px;height:35px;line-height:35px;position:relative;display:inline-block;vertical-align:middle;text-align:center}.ui-inlinedatepicker-week > div{height:25px;line-height:25px;font-weight:bold;color:#000;border-bottom:1px solid #E0E0E0}.ui-inlinedatepicker-days > div{font-size:11px;cursor:pointer}.ui-inlinedatepicker-date:hover > div{border-color:var(--color);color:#000}.ui-inlinedatepicker-selected:hover > div{border-color:var(--color);color:#FFF}.ui-inlinedatepicker-days > div > div{width:28px;height:28px;line-height:24px;border-radius:100%;margin:0 auto;position:relative;display:inline-block;border:2px solid transparent}

.ui-input{position:relative;font-size:13px}.ui-input textarea{tab-size:2;overflow-y:scroll;-ms-overflow-style:none;scrollbar-width:none;background:transparent}.ui-input textarea:::-webkit-scrollbar{display:none}.ui-input-required .ui-input-control{border-color:#D0D0D0}.ui-input-label{margin-bottom:3px;font-size:12px;color:#777}.ui-input-label i{margin-right:4px}.ui-input-required.ui-input-raw .ui-input-label:before{content:'*';color:red;margin-right:3px}.ui-input-control{border:1px solid #E0E0E0;border-radius:var(--radius);min-height:36px;background-color:#FFF}.ui-input-input{padding:6px 8px 0;position:relative;line-height:24px}.ui-input-checkbox{margin-bottom:5px}.ui-input-checkbox *{height:25px;cursor:pointer}.ui-input-checkbox span{width:20px;height:20px;line-height:21px;font-size:11px;margin:0 7px 0 0;text-align:center;float:left;border:1px solid #D0D0D0;border-radius:4px;background:#FFF}.ui-input-checkbox span i{display:none;font-weight:bold}.ui-input-checkbox label{line-height:19px}.ui-input-checked .ui-input-checkbox span i{display:inline-block}.ui-disabled .ui-input-checkbox{color:#A0A0A0}.ui-disabled.ui-input *, .ui-disabled.ui-input{cursor:not-allowed !important}.ui-disabled .ui-input-checkbox span{background-color:#F0F0F0;color:#B0B0B0;border-color:#E0E0E0}.ui-input-placeholder{pointer-events:none;position:absolute;color:gray;margin:0;user-select:none;width:100%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-input-control input, .ui-input-control textarea{border:0;outline:0;background:transparent !important;width:100%;padding:0;margin:0;line-height:16px;font-size:13px;color:#000;font-family:Arial;resize:none}.ui-input-control textarea{padding:4px 0}.ui-input-control .ui-input-value{line-height:24px;height:22px;cursor:pointer;border-radius:var(--radius);outline:0}.ui-input-control input::-ms-expand{display:none}.ui-input-icon-left{width:34px;height:34px;line-height:33px;float:left;text-align:center;border-right:1px solid #E0E0E0}.ui-input-icon-right{width:34px;height:34px;line-height:33px;float:right;border-left:1px solid #E0E0E0;text-align:center}.ui-input-required .ui-input-icon-left{border-color:#D0D0D0}.ui-input-required .ui-input-icon-right{border-color:#D0D0D0}.ui-input-ricon .ui-input-input{margin-right:37px}.ui-input-licon .ui-input-input{margin-left:34px}.ui-input-ricon .ti-times, .ui-input-licon .ti-times{color:red}.ui-input-value{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ui-input-click{cursor:pointer}.ui-input-error{margin-top:7px;font-size:11px;color:red}.ui-input .right input{text-align:right}.ui-input .right .ui-input-placeholder{text-align:right;padding-right:15px}.ui-input .center input{text-align:center}.ui-input .center .ui-input-placeholder{text-align:center;padding-right:15px}.ui-input-dropdown, .ui-input-dropdown input, .ui-input-dropdown .ui-input-placeholder{cursor:pointer}.ui-input-invalid .ui-input-control, .ui-input-invalid .ui-input-icon-left, .ui-input-invalid .ui-input-icon-right{border-color:red !important}.ui-input.ui-disabled .ui-input-control{background-color:#F0F0F0;color:#777}.ui-input.ui-disabled input{background-color:#F0F0F0;color:#A0A0A0}.ui-input.ui-disabled .ui-input-placeholder{color:#A0A0A0}.ui-input.ui-disabled .ui-input-icon-left, .ui-input.ui-disabled .ui-input-icon-right{color:gray}.ui-input-dropdown.ui-disabled .ui-input-control{cursor:not-allowed !important}.ui-input-raw .ui-input-increment{padding:7px 0 0 !important}.ui-input-increment i{line-height:11px;font-size:10px;cursor:pointer;display:block}.ui-input-increment i:first-child{margin-left:0}.ui-input-required.ui-input-inner .ui-input-label:after{content:'*';color:red;margin-left:3px}.ui-input-inner{background-color:#F5F5F5;border:1px solid #E5E5E5;padding:10px 5px 10px 10px;width:100%;border-radius:var(--radius)}.ui-input-inner.ui-disabled .ui-input-control{background-color:transparent !important}.ui-input-inner .ui-input-increment{padding-top:2px;color:#777}.ui-input-inner .ui-input-label{height:18px;margin:0;color:#6A7280;font-weight:bold}.ui-input-inner .ui-input-placeholder{color:#9DA4B0}.ui-input-inner input, .ui-input-inner textarea{font-size:14px}.ui-input-inner .ui-input-input{padding:0;font-size:14px}.ui-input-inner .ui-input-control{min-height:24px;border:0;background-color:transparent}.ui-input-inner .ui-input-icon-left, .ui-input-inner .ui-input-icon-right{height:24px;line-height:24px;color:#777;font-size:15px}.ui-input-inner.ui-input-focused{border-color:var(--color);box-shadow:0 0 #0000,0 0 #0000,0px 0px 0px 4px #4AAEFF1A}.ui-input-inner.ui-input-invalid{border-color:#EEB7B7;box-shadow:0 0 #0000,0 0 #0000,0px 0px 0px 4px #D85A5A1A}.ui-input-inner .ui-input-checkbox{margin-bottom:0}.ui-input-inner .ui-input-icon-right{border:0;padding-left:10px}.ui-input-masked input{letter-spacing:1px;font-family:Menlo,Consolas,monospace}.ui-input-monospace input, .ui-input-monospace textarea{font-family:Menlo,Consolas,monospace}.ui-input-icon-custom{font-size:11px}.ui-input-inner .ui-input-value{line-height:24px;height:24px}.ui-input-type-icon .ui-input-value, .ui-input-type-emoji .ui-input-value{font-size:15px}.ui-input-type-icon .ui-input-control, .ui-input-type-color .ui-input-control, .ui-input-type-color .ui-input-emoji{cursor:pointer}.ui-input-radiobuttons{margin-top:5px}.ui-input-radiobuttons > div{position:relative;display:inline-block;margin-left:10px;cursor:pointer;height:26px;line-height:21px}.ui-input-radiobuttons.ui-input-multiline > div{display:block;margin-left:0}.ui-input-radiobuttons > div:first-child{margin-left:0}.ui-input-radiobuttons > div span{border-radius:var(--radius);float:left;border:1px solid #D0D0D0;background-color:#FFF;width:20px;height:20px;margin-right:7px;padding:3px}.ui-input-radiobuttons > div.ui-input-checked i{border-radius:var(--radius);background-color:#000;height:12px;display:block}.ui-disabled .ui-input-radiobuttons > div span{border-color:#E0E0E0;background:#F0F0F0}.ui-disabled .ui-input-radiobuttons > div{color:#A0A0A0}.ui-disabled .ui-input-radiobuttons > div.ui-input-checked i{background-color:#B0B0B0}.ui-input-tags .ui-input-value{min-width:30px;display:inline-block;line-height:24px;cursor:text}.ui-input-tags.ui-input-inner{padding-bottom:5px}.ui-input-tag{background-color:var(--color);color:#FFF;border-radius:var(--radius);padding:2px 5px;margin-right:5px;white-space:nowrap;vertical-align:top}.ui-input-tag i{color:rgb(255,196,196,0.8);cursor:pointer;user-select:none;margin-right:3px}.ui-disabled .ui-input-tag i{display:none}.ui-disabled.ui-input-tags .ui-input-value{display:none}

.ui-inputtags{position:relative;font-size:13px}.ui-inputtags-required .ui-inputtags-control{border-color:#D0D0D0}.ui-inputtags-label{margin-bottom:3px;font-size:12px;color:#777}.ui-inputtags-label i{margin-right:4px}.ui-inputtags-required .ui-inputtags-label:before{content:'*';color:red;margin-right:3px}.ui-inputtags-control{border:1px solid #E0E0E0;border-radius:var(--radius);min-height:36px;background-color:#FFF}.ui-inputtags-input{padding:6px 2px 0 6px;position:relative;line-height:22px;min-height:34px}.ui-inputtags-placeholder{position:absolute;color:gray;margin:0;user-select:none;cursor:text;width:100%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-inputtags-icon-left{width:32px;height:34px;line-height:34px;float:left;text-align:center;border-right:1px solid #E0E0E0}.ui-inputtags-icon-right{width:32px;height:34px;line-height:34px;float:right;border-left:1px solid #E0E0E0;text-align:center}.ui-inputtags-required .ui-inputtags-icon-left{border-color:#D0D0D0}.ui-inputtags-required .ui-inputtags-icon-right{border-color:#D0D0D0}.ui-inputtags-ricon .ui-inputtags-input{margin-right:35px}.ui-inputtags-licon .ui-inputtags-input{margin-left:32px}.ui-inputtags-click{cursor:pointer}.ui-inputtags-error{margin-top:7px;font-size:11px;color:red}.ui-inputtags-dropdown, .ui-inputtags-dropdown .ui-inputtags-placeholder{cursor:pointer}.ui-inputtags-invalid .ui-inputtags-control, .ui-inputtags-invalid .ui-inputtags-icon-left, .ui-inputtags-invalid .ui-inputtags-icon-right{border-color:red}.ui-inputtags.ui-disabled .ui-inputtags-control{background-color:#F0F0F0}.ui-inputtags.ui-disabled .ui-inputtags-placeholder{color:#A0A0A0}.ui-inputtags.ui-disabled .ui-inputtags-icon-left, .ui-inputtags.ui-disabled .ui-inputtags-icon-right{color:gray}.ui-inputtags-inner .ui-inputtags-label{position:absolute;z-index:1;margin:12px 0 0 7px;font-size:13px}.ui-inputtags-inner.ui-inputtags-binded .ui-inputtags-label{font-size:11px;margin:-9px 0 0 4px;background:#FFF;padding:0 2px;border-radius:var(--radius)}.ui-inputtags-inner .ui-inputtags-input{padding-top:9px}.ui-inputtags-binded.ui-inputtags-inner .ui-inputtags-input{padding-top:8px}.ui-inputtags-inner .ui-inputtags-control{min-height:38px}.ui-inputtags-inner .ui-inputtags-icon-left, .ui-inputtags-inner .ui-inputtags-icon-right{height:100%;line-height:37px}.ui-inputtags-inner.ui-inputtags-required .ui-inputtags-label:before{content:'*'}.ui-inputtags-tags{padding:0 0 3px}.ui-inputtags-tags span{padding:0 5px;line-height:20px;margin:0 3px 3px 0;cursor:default}.ui-inputtags-tags span i{margin-right:5px;font-size:12px;cursor:pointer;transition:transform 0.1s;border-right:1px solid rgba(0,0,0,0.2);width:15px}.ui-inputtags-tag{position:relative;display:inline-block;color:#FFF;background-color:#4783EE;color:#FFF;border-radius:var(--radius);border:1px solid rgba(0,0,0,0.1)}.ui-inputtags-editable{outline:0;min-width:50px;padding-left:1px !important;padding-right:1px;width:100%;line-height:12px}.ui-disabled .ui-inputtags-tags span i{display:none}.ui-disabled .ui-inputtags-tag{background-color:#D0D0D0;color:gray;border:1px solid #C0C0C0}

.bg-smoke{background-color:#F8F8F8}.panel{background-color:#FFF;border-radius:var(--radius);border:1px solid #E0E0E0}.panel > .toolbar{float:right;margin:15px 20px 0 10px}.panel > .toolbar button{height:30px;line-height:30px;min-width:60px}.panel > label{display:block;padding:18px 20px;border-bottom:1px solid #E0E0E0;font-size:16px;color:#000;font-weight:bold;border-radius:var(--radius) var(--radius) 0 0}.panel > label i{margin-right:7px}.panel .padding{padding:18px var(--gap)}.toolbar{height:26px}.toolbar button{outline:0;background:#FFF;border:1px solid #E0E0E0;border-left:0;font-size:11px;height:26px;padding:0 8px;color:#000;min-width:80px;text-align:center;vertical-align:top;background-color:#FFF;line-height:24px;float:left;text-align:center !important}.toolbar button i{margin-right:5px}.toolbar button .ti-plus-circle,.toolbar button .ti-check-circle{color:#68B25B}.toolbar button:first-child{border-left:1px solid #E0E0E0;border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.toolbar button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.toolbar button:hover{border-color:#D0D0D0}.toolbar button:active{background:#F0F0F0;color:#888;border-color:#DFDFDF}.toolbar button:disabled{color:silver;cursor:not-allowed;border-color:#E0E0E0 !important;background:#F8F8F8}.toolbar button:disabled i{color:silver !important}.toolbar button.right{float:right;margin-left:5px;margin-right:0;text-align:center}.toolbar-bg{height:44px;background-color:#F0F0F0;padding:10px 10px 0}.nav{background-color:#F0F0F0}.nav nav{padding:10px 5px;display:block}.nav nav > div,.nav nav > a{display:block;height:30px;margin:0 5px 2px;line-height:30px;padding:0 10px;border-radius:var(--radius);cursor:pointer;font-size:13px;color:#888;border:0;text-decoration:none !important}.nav nav > div > i,.nav nav > a i{width:14px;text-align:center;margin-right:10px}.nav nav > div:hover,.nav nav > a:hover{background-color:rgba(0,0,0,0.05);color:#000;text-decoration:none !important}.nav nav > div.ui-disabled,.nav nav > a.ui-disabled,.nav nav > div.disabled,.nav nav > a.disabled{cursor:not-allowed;color:#C0C0C0;background-color:transparent !important}.nav nav .selected{background-color:rgba(100,100,100,0.1);color:#000}.nav label{font-size:12px;color:#999;display:block;margin:0 15px 10px;padding:0;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.nav label i{margin-right:5px}.listing{z-index:2;position:relative;overflow:hidden}.listing figure{cursor:pointer}.listing figure > section{margin:-1px 10px 0;border-bottom:1px solid #E0E0E0;padding:10px 0}.listing figure:first-child section{margin-top:0}.listing figure.selected{background-color:#F8F8F8;border-radius:var(--radius)}.listing figure:hover{background-color:#F0F0F0;border-radius:var(--radius)}.listing figure.selected > section,.listing figure:hover > section{border-bottom-color:transparent !important}.listing figure:last-child > section{border-bottom-color:transparent}.listing2 figure{cursor:pointer;background-color:rgba(0,0,0,0.05);margin-bottom:2px;border-radius:var(--radius)}.listing2 figure > section{padding:10px}.listing2 figure:first-child section{margin-top:0}.listing2 figure.selected{background-color:rgba(0,0,0,0.09)}.listing2 figure:hover{background-color:rgba(0,0,0,0.08)}.listing2 figure.selected > section,.listing2 figure:hover > section{border-bottom-color:transparent !important}.listing2 figure:last-child > section{border-bottom-color:transparent}.configuration{background-color:#FFF;border-radius:var(--radius);border:1px solid #E0E0E0}.configuration p{margin:0 0 15px;font-size:13px;padding:0;color:#666}.configuration > section > .toolbar{float:right;margin:10px 10px 0}.configuration > section > .toolbar button{height:22px;line-height:20px;min-width:60px}.configuration > section > label{display:block;padding:10px;font-size:15px;color:#000;font-weight:bold;border-top:1px solid #E0E0E0}.configuration > section > label i{margin:3px 6px 0 0;width:15px;text-align:center;float:left}.configuration > section:first-child > label{border-top:0;border-radius:var(--radius) var(--radius) 0 0}.configuration > section > article{border-top:1px solid #E0E0E0}.configuration > section:first-child article:first-child{border-top:0;border-radius:var(--radius) var(--radius) 0 0}.configuration .padding{padding:var(--gap) 15px}.configuration > .toolbar{float:right;margin:10px 10px 0}.configuration > .toolbar button{height:22px;line-height:20px;min-width:60px}.message{padding:10px;border:2px solid #E0E0E0;border-radius:var(--radius);font-size:12px;margin-bottom:10px}.message i{margin-right:5px}.message-error{border-color:#D63A32;color:#A72C26}.message-alert{border-color:#DEBA31;color:#8c7727}.message-success{border-color:#68B25B;color:#4A7543}.badge{font-size:12px;padding:4px 6px;border-radius:var(--radius);background-color:var(--color);line-height:12px;vertical-align:middle;position:relative;display:inline-block;color:#FFF}.badge i{margin-right:3px}.badge-blue{background-color:#0E68A6}.badge-red{background-color:#D63B32}.badge-green{background-color:#8CC152}.badge-yellow{background-color:#EFDC05}.badge-orange{background-color:#F49519}.badge-gray{background-color:#606060}.badge-purple{background-color:#967ADC}.badge-pink{background-color:#D770AD}.badge-silver{background-color:#E0E0E0;color:gray}.badge-large,.badge.large{padding:3px 8px;font-size:14px;line-height:16px}.badge-large i,.badge.large i{margin-right:5px}.badge-small,.badge.small{font-size:10px;padding:0px 3px 1px}.badge-medium,.badge.medium{font-size:11px;padding:2px 6px}.badge-medium i,.badge.medium i{margin-right:5px}.caption > .toolbar{float:right;margin:10px 0 0 10px}.caption > .toolbar button{height:22px;line-height:20px;min-width:60px}.caption > label{display:block;padding:10px 0;border-bottom:1px solid #E0E0E0;font-size:15px;color:#000;font-weight:bold}.caption > label i{margin-right:7px}.keyvalue.small{font-size:11px;min-height:14px;line-height:14px}.keyvalue.small > span i{width:12px}.keyvalue.small > div i{width:12px}.keyvalue.small .badge{padding:2px 4px}.keyvalue.small .badge.small{padding:0 3px 1px}.keyvalue{min-height:20px;font-size:13px;margin-bottom:2px;line-height:17px}.keyvalue > span{width:120px;float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#777}.keyvalue > span i{width:14px;margin-right:5px}.keyvalue > div{margin-left:120px}.keyvalue > div i{width:14px;margin-right:5px}p{font-size:13px;color:#777;margin:0 0 15px}.iconmenu{height:54px;text-align:center}.iconmenu i{font-size:20px;display:block;padding:8px 0 0}.iconmenu span{font-size:11px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:3px 5px 0;color:#777}.iconmenu > div.selected{background-color:rgba(0,0,0,0.07)}.iconmenu > div{height:54px;width:75px;border:1px solid #E0E0E0;border-left-width:0;float:left;cursor:pointer}.iconmenu > div:first-child{border-left-width:1px;border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.iconmenu > div:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.detail figure{min-height:35px;padding:8px 0 5px;border-top:1px solid #E0E0E0;font-size:13px}.detail figure > p{margin:0 0 20px}.detail figure:first-child{border-top:0}.detail figure > span{float:left;width:140px;color:#777;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-right:5px}.detail figure > span i{width:14px;margin-right:5px;text-align:center}.detail figure > div{margin-left:150px}.divider{position:relative;margin:25px 0}.divider div{position:absolute;left:0;top:-10px;right:0;text-align:center}.divider span{background-color:#F0F0F0;border-radius:var(--radius);padding:5px 8px;font-size:11px;color:#999}.divider span i{margin-right:5px}.btn{border:0;margin:0;background-color:#E7E7E7;height:40px;padding:0 20px;color:#000;cursor:pointer;font-family:Arial;line-height:34px;vertical-align:middle;outline:0;font-size:14px;text-decoration:none;transition:all 0.3s;width:100%}.btn i{width:15px;text-align:center;margin-right:5px}.btn:hover{opacity:0.8}.btn[name='submit']{font-weight:bold;background-color:var(--color);color:#FFF}.btn:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:#A0A0A0 !important;cursor:not-allowed;box-shadow:none;opacity:1 !important}.btn:disabled i{color:#A0A0A0 !important}.btn:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.btn:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.btn.small{height:24px;padding:0 8px;line-height:14px;font-size:12px}table.board{border-collapse:separate;border-spacing:0;font-size:12px}table.board tr th{font-size:13px;font-weight:500;color:#555;padding:8px 7px;background:#f3f3f3;text-align:left;border-top:solid 1px #ddd}table.board tr th i{margin-right:5px}table.board tr td{padding:7px;vertical-align:middle}table.board tr th,table.board tr td{border-right:1px solid #ddd;border-bottom:1px solid #ddd}table.board tr th:first-child,table.board tr td:first-child{border-left:1px solid #ddd}table.board tr:first-child th:first-child{border-top-left-radius:var(--radius)}table.board tr:first-child th:last-child{border-top-right-radius:var(--radius)}table.board tr:last-child td:first-child{border-bottom-left-radius:var(--radius)}table.board tr:last-child td:last-child{border-bottom-right-radius:var(--radius)}.tabmenu{max-width:100%;overflow-x:auto;white-space:nowrap;height:26px;font-size:13px;list-style-type:none;padding:0;margin:0 0 10px;-ms-overflow-style:none;scrollbar-width:none}.tabmenu::-webkit-scrollbar{display:none}.tabmenu div,.tabmenu li,.tabmenu2 a{display:inline-block;line-height:26px;border:0;margin:0 1px 0 0;padding:0 8px;background-color:#F0F0F0;text-align:center;color:gray;cursor:pointer;min-width:80px;text-decoration:none}.tabmenu div:first-child,.tabmenu2 li:first-child,.tabmenu2 div:first-child,.tabmenu2 a:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.tabmenu div:last-child,.tabmenu2 li:last-child,.tabmenu2 a:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.tabmenu .selected{background-color:var(--color);color:#FFF}.tabmenu i{margin-right:5px}.tabmenu.ui-disabled .selected{background-color:#E0E0E0}.tabmenu.ui-disabled div,.tabmenu.ui-disabled li,.tabmenu.ui-disabled a{cursor:not-allowed;color:#A0A0A0}

.ui-keyvalue-label{margin-bottom:5px;font-size:12px}.ui-keyvalue-label i{margin-right:5px}.ui-keyvalue-items > div:first-child{border-radius:var(--radius) var(--radius) 0 0}.ui-keyvalue-item{height:32px;background-color:#FFF;border:1px solid #E0E0E0;border-bottom:0}.ui-keyvalue-item-remove{float:right;width:32px;height:32px;border-left:1px solid #E0E0E0;text-align:center;color:#DA4453;font-size:14px}.ui-keyvalue-item-key{height:31px;padding:3px 0 4px;float:left;width:200px;border-right:1px solid #E0E0E0;font-weight:bold;background-color:#F8F8F8}.ui-keyvalue-item-value{padding:3px 0 0;margin:0 32px 0 202px}.ui-keyvalue-item i{cursor:pointer;display:block;padding:8px 0 0}.ui-keyvalue-item i:active{margin-top:1px}.ui-keyvalue-item input{width:100%;background-color:transparent;border:0;padding:3px 10px 0;outline:0;font-size:13px;color:#000}.ui-keyvalue-item:first-child .ui-keyvalue-item-key{border-top-left-radius:var(--radius)}.ui-keyvalue-base .ui-keyvalue-item-remove{display:none}.ui-keyvalue-base{border-radius:0 0 var(--radius) var(--radius);border-bottom:1px solid #E0E0E0}.ui-keyvalue-base .ui-keyvalue-item-key{height:30px;border-bottom-left-radius:var(--radius)}.ui-keyvalue.ui-disabled input{color:#777;cursor:not-allowed}.ui-keyvalue.ui-disabled i{display:none}.ui-keyvalue-empty .ui-keyvalue-base{border-radius:var(--radius)}.ui-keyvalue-empty .ui-keyvalue-item-key{border-top-left-radius:var(--radius)}

.leaflet-container{font-size:11px !important;font-family:Arial}.leaflet-container .leaflet-control-attribution{color:#777}.leaflet-container .leaflet-control-attribution a{color:#777}

.ui-listdetail-resizer{display:none}.ui-listdetail-detail{border-left:1px solid #E0E0E0;float:right}.ui-listdetail-visible .ui-listdetail-resizer{display:block;width:1px;background-color:#E0E0E0;position:absolute;cursor:ew-resize;z-index:2}.ui-listdetail-visible .ui-listdetail-resizer:hover{background-color:#D0D0D0}.ui-listdetail-resizing .ui-listdetail-resizer{background-color:#C0C0C0 !important}

.ui-listform-invalid .ui-listform-items{border-color:red}.ui-listform-container{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-listform-items .ui-listform-item:first-child{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.ui-listform-items .ui-listform-item:last-child{border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-listform-form-container{background-color:#F8F8F8;padding:15px}.ui-listform-form{border-radius:var(--radius);border:1px solid #E0E0E0;background-color:#FFF}.ui-listform-emptylabel{text-align:center;display:none;padding:15px;font-size:12px;color:gray}.ui-listform-empty .ui-listform-emptylabel{display:block}.ui-listform-item{border-bottom:1px solid #E0E0E0;cursor:pointer}.ui-listform-selected{font-weight:bold;background-color:#F8F8F8}.ui-listform-item:last-child{border-bottom:0}.ui-disabled .ui-listform-item{cursor:not-allowed;color:gray}.ui-listform-new button[name='remove']{display:none}.ui-listform-item-highlight{background-color:rgba(0,0,0,0.1)}

.ui-listing-paginate{padding:11px 0 0;height:50px}.ui-listing-paginate button{width:28px;height:28px;background-color:#FFF;border:1px solid var(--color);border-left:0;outline:0;border-radius:0;font-size:12px;color:var(--color);padding:1px 0 0;margin:0;user-select:none}.ui-listing-paginate button:first-child{margin-left:0;border-bottom-left-radius:var(--radius);border-top-left-radius:var(--radius);border-left:1px solid var(--color)}.ui-listing-paginate button:last-child{margin-left:0;border-bottom-right-radius:var(--radius);border-top-right-radius:var(--radius)}.ui-listing-paginate .selected{background-color:var(--color) !important;color:#FFF}.ui-listing-info{float:right;color:gray;font-size:12px;padding:5px 0}.ui-listing-fixed .ui-listing-info{padding-right:10px}.ui-listing-fixed .ui-listing-paginate{padding-left:10px;border-top:1px solid #E0E0E0}

.ui-loading{position:fixed;width:100%;height:100%;background-color:rgba(255,255,255,0.8);left:0;top:0;z-index:1000}.ui-loading-1 > div{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IHgxPSI4LjA0MiUiIHkxPSIwJSIgeDI9IjY1LjY4MiUiIHkyPSIyMy44NjUlIiBpZD0iYSI+PHN0b3Agc3RvcC1jb2xvcj0iI0EwQTBBMCIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjAlIi8+PHN0b3Agc3RvcC1jb2xvcj0iI0EwQTBBMCIgc3RvcC1vcGFjaXR5PSIuNjMxIiBvZmZzZXQ9IjYzLjE0NiUiLz48c3RvcCBzdG9wLWNvbG9yPSIjQTBBMEEwIiBvZmZzZXQ9IjEwMCUiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxIDEpIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMwLTkuOTQtOC4wNi0xOC0xOC0xOCIgc3Ryb2tlPSJ1cmwoI2EpIiBzdHJva2Utd2lkdGg9IjIiPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiBmcm9tPSIwIDE4IDE4IiB0bz0iMzYwIDE4IDE4IiBkdXI9IjAuOXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9wYXRoPjxjaXJjbGUgZmlsbD0iI0EwQTBBMCIgY3g9IjM2IiBjeT0iMTgiIHI9IjEiPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiBmcm9tPSIwIDE4IDE4IiB0bz0iMzYwIDE4IDE4IiBkdXI9IjAuOXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9jaXJjbGU+PC9nPjwvc3ZnPg==) no-repeat 50% 50%;background-size:80px 80px;width:80px;height:80px;position:absolute;left:50%;top:50%;margin:-40px 0 0 -40px}.ui-loading-2 > div{min-height:5px;background-color:var(--color);width:0;position:absolute;z-index:1;animation:loadinganimation 5s infinite}.ui-loading-1 .ui-loading-text{position:absolute;width:250px;text-align:center;margin:90px 0 0 -125px;left:50%;font-size:12px;color:#000;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-loading-2 .ui-loading-text{font-size:11px;padding:0 5px}.ui-loading-text i{margin-right:5px}@keyframes loadinganimation{0%{left:0}60%{left:0;width:100%}70%{left:70%;width:30%}90%{left:100%;width:30%}100%{left:0;width:0}}

.markdown-small .markdown{font-size:14px;line-height:20px}.markdown{font-size:16px;line-height:22px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';color:#404040;overflow:hidden;padding:0}.markdown-container > *:last-child{margin-bottom:0}.markdown code{font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;white-space:pre}.markdown h1{cursor:default;margin:0 0 20px;font-size:30px;padding:0 0 13px;border-bottom:1px solid #E0E0E0;color:#000;line-height:38px;font-family:-apple-systm, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';font-weight:normal;line-height:32px;font-weight:bold}.markdown h2{cursor:default;margin:0 0 18px;font-weight:bold;font-size:25px;padding:0 0 8px;border-bottom:1px solid #E0E0E0;color:#000;line-height:28px;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'}.markdown h3{cursor:default;margin:0 0 10px;font-size:20px;padding:0 0 5px;color:#404040;font-weight:bold;line-height:22px;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'}.markdown h4, .markdown h5{cursor:default;margin:0 0 10px;font-size:17px;color:#404040;font-weight:bold;line-height:22px;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:#F0F0F0;padding:4px 3px;border-radius:var(--radius);border-bottom:1px solid #E0E0E0}.markdown p{margin:0 0 15px;padding-left:0;padding-right:0}.markdown p code, .markdown li code, .markdown section code, .markdown blockquote code, .markdown h1 code, .markdown h2 code, .markdown h3 code, .markdown h4 code, .markdown td code{background-color:#E0E0E0;padding:1px 4px 2px;border-radius:var(--radius);font-size:14px}.markdown p code, .markdown section code, .markdown li code, .markdown blockquote code, .markdown td code{border:1px solid #E0E0E0;background-color:#F5F5F5}.markdown pre{padding:0;border-radius:var(--radius);margin:20px 0;width:100%}.markdown pre code{padding:10px;font-size:14px;line-height:18px;overflow-scrolling:touch;border-radius:var(--radius)}.markdown table{margin:0 0 15px;width:auto !important}.markdown ul{margin:0 0 20px;padding:0 0 0 2em}.markdown ul ul{margin-bottom:0}.markdown img{max-width:100%}.markdown th{background-color:#F8F8F8}.markdown blockquote{padding:15px 20px;background-color:#F0F0F0;margin:10px 0 20px;border-radius:var(--radius)}.markdown section{padding:15px 20px;background-color:#FFFED1;margin:10px 0 15px;border-radius:var(--radius)}.markdown hr{border-color:#E0E0E0;border-width:2px}.markdown-line2{border-width:4px !important;margin:15px 0 30px !important}.markdown h1 code{font-size:28px;font-weight:normal;background-color:#DAE8F8}.markdown h2 code{font-size:23px;font-weight:normal;background-color:#DAE8F8}.markdown h3 code{font-size:18px;font-weight:normal;background-color:#DAE8F8}.markdown h4 code{font-size:17px;font-weight:normal;background-color:#DAE8F8}.markdown a code{background-color:#DAE8F8;text-decoration:none !important;border-color:#D5DFEB}.markdown-footnote{background-color:rgba(0,0,0,0.1);padding:0 2px;border-radius:var(--radius);cursor:help}.markdown-footnotebody{font-size:11px;border-top:1px solid #E0E0E0;font-family:Arial;color:#505050}.markdown-showsecret{cursor:pointer;display:block;padding:8px 15px;user-select:none;font-size:14px}.markdown-showsecret b{margin-left:8px}.markdown-showsecret .pull-right{margin:2px 0 0}.markdown-secret{padding:0;border-radius:var(--radius);border:1px solid #E0E0E0}.markdown-secret > div{padding:15px 15px 1px;border-radius:0 0 var(--radius) var(--radius);background-color:#F8F8F8}.markdown-small li code, .markdown-small section code, .markdown-small blockquote code, .markdown-small td code, .markdown-small pre code{font-size:12px}.markdown-task > i:first-child{margin-right:5px}.markdown-code{margin-bottom:15px}.markdown-block{margin:0}.markdown-block:last-child{margin-bottom:15px}.markdown-block > div{padding:10px 10px 1px;border:1px solid #E0E0E0;margin:10px 0;border-radius:var(--radius)}.markdown-block > div > *:last-child{margin-bottom:10px}.markdown-showblock{cursor:pointer;display:block;padding:3px 0;user-select:none;border-bottom:1px solid #E0E0E0}.markdown-showblock i{width:16px;font-size:12px;padding:6px 0 0;float:left}.markdown-showblock-visible{border-bottom:0}.markdown-video{position:relative;padding-bottom:56.25%;padding-top:25px;height:0;margin-bottom:15px}.markdown-video iframe{position:absolute;top:0;left:0;width:100%;height:100%}.markdown-small p, .markdown-small section, .markdown-small blockquote, .markdown-small table, .markdown-small .markdown-code{margin-bottom:10px}

.ui-menu-area{position:absolute;left:0;right:0;bottom:0;top:0;z-index:100}.ui-menu{position:absolute;z-index:1;transform-origin:top left;padding:10px 0}.ui-menu-items{background-color:#FFF;padding:5px 0;border-radius:var(--radius);box-shadow:2px 5px 10px rgba(0,0,0,0.05);border:1px solid #E0E0E0;position:relative}.ui-menu-submenu{position:absolute;z-index:101;background-color:#FFF;padding:5px 0;border-radius:var(--radius);box-shadow:2px 5px 10px rgba(0,0,0,0.05);border:1px solid #E0E0E0}.ui-menu-visible{}.ui-menu ul{margin:0;padding:0}.ui-menu li{margin:0;padding:5px;list-style-type:none;font-size:12px;cursor:pointer}.ui-menu-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:15px}.ui-menu-note{font-size:10px;margin:0 10px 3px 35px;color:#A0A0A0;line-height:11px}.ui-menu-nofa .ui-menu-note{margin-left:0}.ui-menu-selected{background-color:#F5F5F5}.ui-menu li:hover{background-color:#F0F0F0}.ui-menu-nofa{padding-left:12px !important}.ui-menu .pull-right{margin:1px 5px 0 0;width:20px;text-align:right;font-size:10px}.ui-menu-name i{width:30px;margin:0 5px 0 0;text-align:center;color:#000}.ui-menu-name b{position:absolute;right:10px;font-size:11px;color:gray;margin:1px 5px 0}.ui-menu-divider{padding:0 !important;background:transparent !important;cursor:default !important;color:gray;font-size:11px !important}.ui-menu-divider span{display:block;margin:5px 12px}.ui-menu-divider hr{margin:5px 0;border-color:#E0E0E0}.ui-menu li.ui-menu-disabled{color:#a0a0a0;background-color:#FFF;cursor:not-allowed}.ui-menu li.ui-menu-disabled i{color:#c5c5c5 !important}.ui-menu-style-2 .ui-menu-items{border-radius:var(--radius)}.ui-menu-style-2 li{margin:2px 10px;padding:7px 2px;border-radius:var(--radius);font-size:13px}.ui-menu-style-2 .pull-right{margin-top:3px}.ui-menu-style-2 .ui-menu-submenu{border-radius:var(--radius)}.ui-menu-style-2 .ui-menu-divider{margin:7px 0}.ui-menu-style-2 .ui-menu-divider span{padding-left:10px}.ui-large .ui-menu-divider{font-size:14px !important}.ui-large .ui-menu li{font-size:14px;padding:7px 15px}.ui-large.ui-menu li{font-size:14px;padding:7px 15px}.ui-large .ui-menu-note{font-size:13px}@media (max-width:600px){.ui-menu-mobile.ui-menu-style-1 .ui-menu-divider{margin:7px 0;font-size:13px !important}.ui-menu-mobile.ui-menu-style-1 li{margin:0;padding:5px 8px;list-style-type:none;font-size:15px;cursor:pointer}.ui-menu-mobile.ui-menu-style-2 li{margin:2px 10px;padding:6px 5px;border-radius:var(--radius);font-size:15px}.ui-menu-mobile.ui-menu-style-2 .ui-menu-divider{margin:7px 0;font-size:13px !important}.ui-menu-mobile.ui-menu-style-2 .ui-menu-divider span{padding-left:12px}.ui-menu-mobile .ui-menu-note{font-size:12px}}

.ui-message{background-color:rgba(255,255,255,0.9);position:fixed;left:0;right:0;bottom:0;top:0;z-index:1010;width:100%;display:table;height:100%;transition:0.3s all;opacity:0}.ui-message > div{display:table-cell;vertical-align:middle;text-align:center;padding:15px}.ui-message-body{padding:30px 25px 20px;position:relative;display:inline-block;color:#000;border-radius:var(--radius);max-width:500px;text-align:left;transform:scale(1.5);transition:0.2s all;box-shadow:0 5px 20px rgba(0,0,0,0.1);background-color:#FFF;border-width:3px;border-style:solid}.ui-message-warning .ui-message-body{border-color:#DA4453;min-width:300px}.ui-message-success .ui-message-body{border-color:#8CC152;min-width:300px}.ui-message-info .ui-message-body{border-color:var(--color);min-width:300px}.ui-message button{display:block;min-width:100px;margin:20px auto 0;cursor:pointer;outline:0;background-color:#FFF;border:1px solid #E0E0E0;border-radius:var(--radius);color:#000;padding:0 20px;height:34px;font-weight:bold}.ui-message button:hover{background-color:#F0F0F0}.ui-message button:active{border-color:#D0D0D0}.ui-message-icon{border-radius:100px;width:60px;height:60px;padding:0;line-height:54px;font-size:30px;text-align:center;position:absolute;left:50%;border:4px solid #3BAFDA;margin-left:-30px;z-index:5;background-color:#FFF;color:#3BAFDA;margin-top:-40px;transform:scale(2);transition:all 0.3s}.ui-message-icon-animate{transform:scale(1)}.ui-message-success .ui-message-icon{border-color:#8CC152;color:#8CC152}.ui-message-warning .ui-message-icon{border-color:#DA4453;color:#DA4453}.ui-message-info .ui-message-icon{border-color:var(--color);color:var(--color)}.ui-message-error i{margin-right:5px;color:red}.ui-message-visible{opacity:1}.ui-message-visible .ui-message-body{transform:scale(1)}.ui-message2{background-color:rgba(220,220,220,0.9)}.ui-message2 .ui-message-body{padding:110px 0 0;border-width:0;border-radius:var(--radius);max-width:400px}.ui-message2 .ui-message-text{padding:0 20px 30px;text-align:center}.ui-message2 hr{display:none}.ui-message2 button{width:100%;border:0 !important;color:#FFF;border-radius:0 0 var(--radius) var(--radius);height:40px;margin:0}.ui-message2 button:hover{opacity:0.9}.ui-message2.ui-message-success button{background-color:#8CC152}.ui-message2.ui-message-warning button{background-color:#DA4453}.ui-message2.ui-message-info button{background-color:var(--color)}.ui-message2 .ui-message-icon{margin-top:30px;border-radius:0;border:0;background:transparent !important;font-size:50px}

.ui-miniform-noscroll,.ui-miniform-noscroll body{overflow:hidden}.ui-miniform-container{width:100%;position:fixed;left:0;top:0;bottom:0;right:0;background-color:rgba(230,233,237,0.8);z-index:5;overflow-y:scroll;transform-style:preserve-3d;overflow-scrolling:touch;padding:15px}.ui-miniform-container-table{display:table;width:100%;height:100%}.ui-miniform-container-cell{display:table-cell;width:100%;height:100%;vertical-align:middle;text-align:center}.ui-miniform{background-color:#FFF;border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,0.1);transform:scale(0);transition:all 0.15s;opacity:0;text-align:left;position:relative;margin:0 auto}.ui-miniform-animate{transform:scale(1);opacity:1}.ui-miniform-title{padding:10px 15px 18px 20px;font-size:18px;user-select:none;color:#000;background-color:#FFF;border-bottom:1px solid #E0E0E0;height:58px;border-radius:var(--radius) var(--radius) 0 0;line-height:14px}.ui-miniform-title .ui-miniform-button-close{float:right;cursor:pointer;font-size:18px;margin:10px 0 0;transition:all 0.2s;background:none;border:0;outline:0;height:auto;color:red;text-align:right !important;width:20px;padding:0}.ui-miniform-title .ui-miniform-button-close:hover{transform:scale(1.1)}.ui-miniform-title > i{float:left;margin:12px 7px 0 0}.ui-miniform-title span{float:left;margin-top:14px;font-weight:bold}.ui-miniform-title > nav{float:right;margin:5px 18px 0 0;font-size:14px}.ui-miniform-title > nav button{border:0;margin:0;background-color:#F0F0F0;height:28px;padding:0 10px;color:#000;cursor:pointer;font-family:Arial;line-height:23px;vertical-align:middle;outline:0;font-size:12px;text-decoration:none;transition:all 0.3s;float:left;border-left:1px solid #E0E0E0}.ui-miniform-title > nav button i{width:12px;text-align:center;margin-right:5px}.ui-miniform-title > nav button:hover{opacity:0.8}.ui-miniform-title > nav button:active{background-color:#D0D0D0}.ui-miniform-title > nav button:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:silver !important;cursor:not-allowed;miniform-shadow:none}.ui-miniform-title > nav button:disabled i{color:silver !important}.ui-miniform-title > nav button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius);border-left:0}.ui-miniform-title > nav button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-miniform > nav{padding:0 15px 0;border-top:1px solid #E0E0E0;background-color:#FFF;border-radius:0 0 var(--radius) var(--radius);line-height:65px;height:65px;display:block;float:none;position:relative}.ui-miniform > nav button{border:0;margin:15px 0 0;background-color:#F0F0F0;height:34px;padding:0 15px;color:#000;cursor:pointer;font-family:Arial;line-height:34px;vertical-align:middle;outline:0;font-size:14px;text-decoration:none;transition:all 0.3s;float:left;width:50%}.ui-miniform > nav button i{width:15px;text-align:center;margin-right:5px}.ui-miniform > nav button:hover{opacity:0.9}.ui-miniform > nav button:active{background-color:#D0D0D0}.ui-miniform > nav button:disabled{background-color:#F5F5F5 !important;border-color:#E0E0E0 !important;color:silver !important;cursor:not-allowed;box-shadow:none}.ui-miniform > nav button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.ui-miniform > nav button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-miniform > nav button[name='submit']{font-weight:bold;background-color:var(--color);color:#FFF}

.ui-viewbox{overflow:hidden;-ms-overflow-style:none;box-sizing:content-box}.ui-viewbox-disabled{z-index:5;position:absolute;background-color:rgba(255,255,255,0.8)}.ui-viewbox-hidden{visibility:hidden}.ui-viewbox-centered-table{display:table;width:100%;height:100%}.ui-viewbox-centered-cell{display:table-cell;width:100%;height:100%;vertical-align:middle;text-align:center}

.ui-notify-container{position:fixed;max-width:400px;z-index:100;text-align:center;width:100%}.ui-notify{height:80px;transition:0.15s transform,opacity;transform:scale(1);transition-timing-function:ease-in;opacity:1}.ui-notify figure{background-color:#FFF;box-shadow:0 3px 20px rgba(0,0,0,0.2);border-radius:var(--radius);font-size:14px;padding:0;color:#000;cursor:default;position:relative;height:60px;display:block}.ui-notify-dot{width:10px;height:10px;position:absolute;border-radius:var(--radius) var(--radius) var(--radius) var(--radius);right:5px;bottom:5px}.ui-notify-1 .ui-notify-dot{background-color:#8CC152}.ui-notify-2 .ui-notify-dot{background-color:#F43D35}.ui-notify-3 .ui-notify-dot{background-color:var(--color)}.ui-notify-1 .ui-notify-icon{color:#8CC152}.ui-notify-2 .ui-notify-icon{color:#F43D35}.ui-notify-3 .ui-notify-icon{color:var(--color)}.ui-notify-icon{float:left;font-size:25px;padding:0 0 0 10px;width:50px;text-align:center;height:60px;line-height:60px;border-radius:var(--radius) 0 0 var(--radius)}.ui-notify-message{margin:1px 0 0 60px;line-height:16px;height:60px;display:table-cell;width:100%;vertical-align:middle;padding:0 10px;text-align:left;word-break:break-all}.ui-notify-hidden{transform:scale(0.7);opacity:0.1}.ui-notify-container-top{left:50%;margin-left:-200px;top:20px}.ui-notify-container-top-left{left:25px;top:20px}.ui-notify-container-top-right{right:25px;top:20px}.ui-notify-container-bottom{bottom:10px;left:50%;margin-left:-150px}.ui-notify-container-bottom-left{bottom:10px;left:25px}.ui-notify-container-bottom-right{bottom:10px;right:25px}@media(max-width:767px){.ui-notify-container{left:20px;right:20px;margin-left:0;width:auto}}

.page{position:absolute;z-index:10;background-color:#FFF}

.ui-permissions-header{height:30px;cursor:pointer;color:#777;font-size:12px}.ui-permissions-header:hover{color:#000}.ui-permissions-header .green{float:right;width:30px;line-height:30px;text-align:right;transform:scale(1);font-size:14px}.ui-permissions-header span{margin:0 30px 0 0;display:block;line-height:30px}.ui-permissions-header span:after{content:':'}.ui-permissions table{width:100%;table-layout:fixed;font-size:13px}.ui-permissions tr{border-top:1px solid #E0E0E0}.ui-permissions td{border-left:1px solid #E0E0E0;padding:5px 8px}.ui-permissions tr:first-child{border-top:0}.ui-permissions td:first-child{border-left:0}.ui-permissions-remove{margin-right:8px;cursor:pointer}.ui-permissions-type{width:60px;color:#A0A0A0;font-size:10px;cursor:pointer;text-align:center;padding-left:0 !important;padding-right:0 !important}.ui-permissions-type i{margin-right:5px;color:#E0E0E0}.ui-permissions-type i:before{content:'\\ea8c'}.ui-permissions-checked{background-color:#FFFED5;color:#000}.ui-permissions-checked i{color:#68B25B}.ui-permissions-empty{color:#A0A0A0;padding:10px 20px !important;text-align:center}.ui-permissions-empty i{margin-right:5px}.ui-permissions-type.ui-permissions-checked i:before{content:'\\e955'}.ui-permissions-container{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-permissions-disabled .green{display:none}.ui-permissions-disabled .ui-permissions-header:hover{cursor:default;color:gray}.ui-permissions-disabled .ui-permissions-type{cursor:not-allowed}.ui-permissions-disabled .ti-times{display:none}

.ui-pictures ui-component{gap:var(--margin)}.ui-pictures-item{position:relative;cursor:grab}.ui-pictures-item span{background-color:#E73323;border-radius:20px;position:absolute;text-align:center;top:-5px;right:-5px;width:21px;height:21px;line-height:20px;font-size:11px;cursor:pointer !important;display:none}.ui-pictures-item:hover span{display:inline-block}.ui-pictures.ui-disabled .ui-pictures-remove{display:none !important}.ui-pictures-item span i{color:#FFF}.ui-pictures-item img{border-radius:var(--radius);border:1px solid #D0D0D0}

.ui-preview-label{margin-bottom:5px;font-size:12px;text-align:left}.ui-preview-label i{margin-right:5px}.ui-preview img{cursor:pointer;border:2px solid #E0E0E0;border-radius:var(--radius);min-width:150px}.ui-preview-centered img{margin-left:auto;margin-right:auto}.ui-preview-centered .ui-preview-label{text-align:center}

.ui-printer iframe{position:absolute;width:21cm;min-height:29.7cm;z-index:-1;opacity:0;pointer-events:none}

.ui-prompt-noscroll,.ui-prompt-noscroll body{overflow:hidden}.ui-prompt-container{position:fixed;left:0;right:0;bottom:0;top:0}.ui-prompt-body{background-color:#FFF;margin:20px auto;border-radius:10px;box-shadow:0 2px 30px rgba(0,0,0,0.2);overflow:hidden;border:1px solid #D0D0D0;width:100%;padding:20px}.ui-prompt-title{font-size:16px;color:#000;margin:0 0 5px;font-weight:bold}.ui-prompt-summary{font-size:13px;color:#777;margin:0 0 7px}.ui-prompt-input{border:2px solid #E0E0E0;padding:2px 5px;border-radius:var(--radius)}.ui-prompt-input input{width:100%;border:0;background:transparent;height:24px;outline:0}.ui-prompt-buttons{text-align:right;margin:5px 0 0}.ui-prompt-centered .ui-prompt-area{width:100%;height:100%;display:grid;align-items:center}.ui-prompt button{border:0;margin:15px 0 0;background-color:#F0F0F0;height:34px;padding:0 15px;color:#000;cursor:pointer;font-family:Arial;line-height:34px;vertical-align:middle;outline:0;font-size:14px;text-decoration:none;transition:all 0.3s;min-width:90px}.ui-prompt button i{width:15px;text-align:center;margin-right:5px}.ui-prompt button:hover{opacity:0.9}.ui-prompt button:active{background-color:#D0D0D0}.ui-prompt button:disabled{background-color:#F5F5F5 !important;color:silver !important;cursor:not-allowed;box-shadow:none}.ui-prompt button:first-child{border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius)}.ui-prompt button:last-child{border-top-right-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-prompt button[name='submit']{font-weight:bold;background-color:var(--color);color:#FFF}

.ui-radiobutton{color:#000;font-size:12px}.ui-radiobutton div[data-value]{cursor:pointer;margin:0 10px 10px 0;line-height:16px;position:relative;display:inline-block}.ui-radiobutton span{vertical-align:middle}.ui-radiobutton-block div[data-value]{margin-bottom:4px;display:block}.ui-radiobutton i{width:14px;height:14px;display:inline-block;position:relative;border-radius:100px;border:1px solid #A0A0A0;margin-right:5px;vertical-align:middle}.ui-radiobutton-selected i{border-color:#000}.ui-radiobutton-selected i:before{content:' ';width:8px;height:8px;background-color:var(--color);display:block;position:absolute;border-radius:100px;margin:2px 0 0 2px}.ui-radiobutton-label{margin-bottom:5px;font-size:12px;text-align:left}.ui-radiobutton-label-required:before{color:red;content:'***';margin-right:5px}.ui-radiobutton.ui-disabled div[data-value]{cursor:not-allowed !important;color:gray}.ui-radiobutton.ui-disabled .ui-radiobutton-selected{color:gray !important}.ui-radiobutton.ui-disabled div[data-value] i{border-color:gray}.ui-radiobutton.ui-disabled div[data-value] i:before{background-color:gray}

.ui-searchinput{height:30px;border:1px solid #E0E0E0}.ui-searchinput-left > span{float:left}.ui-searchinput-left > div{margin-left:28px}.ui-searchinput-right > span{float:right}.ui-searchinput-right > div{margin-right:28px;padding-left:5px}.ui-searchinput input{border:0;width:100%;background-color:transparent;outline:0;margin:0;padding:0;height:28px;font-size:12px}.ui-searchinput span{width:28px;text-align:center;font-size:12px;line-height:29px;color:gray}.ui-searchinput-is span{cursor:pointer;color:red}

.ui-servergrid{border:1px solid #E0E0E0;border-radius:var(--radius);font-size:13px;background:#FFF;position:relative}.ui-servergrid-filter{display:flex;border-bottom:1px solid #E0E0E0;align-items:center;height:22px;gap:0;background:#FFF}.ui-servergrid-filter:last-child{border-right:1px solid #E0E0E0}.ui-servergrid-filter input{border:0;background:transparent;outline:0;font-size:11px;height:21px;padding:0 5px;margin:0;width:100%}.ui-servergrid-filter input[readonly]{cursor:pointer;user-select:none;caret-color:transparent}.ui-servergrid-filter input:disabled{background:#F9F9F9 repeating-linear-gradient(45deg,#FFF,#FFF 10px,#F9F9F9 10px,#F9F9F9 20px)}.ui-servergrid-clear{position:absolute;right:5px;top:4px;cursor:pointer;color:#D72727;visibility:hidden}.ui-servergrid-row{display:flex;border-bottom:1px solid #E0E0E0;align-items:center;border-right:1px solid #E0E0E0;gap:0}.ui-servergrid-row-empty{border-bottom:1px solid #F0F0F0;align-items:center;border-right:1px solid #E0E0E0;height:32px}.ui-servergrid-noscroll .ui-servergrid-rows{overflow-y:hidden}.ui-servergrid-noscroll .ui-scrollbar-y span{visibility:hidden}.ui-servergrid-data{margin-bottom:15px}.ui-servergrid-rows,.ui-servergrid-header{margin-right:15px}.ui-servergrid-rows{background:#FFF}.ui-servergrid-header{background:#F4F4F4}.ui-servergrid-th,.ui-servergrid-td{border:1px solid transparent;border-left-color:#E0E0E0;height:32px;line-height:32px;padding:0 5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ui-servergrid-tf{border-left:1px solid #E0E0E0;position:relative;background-color:#FFF}.ui-servergrid-tf-is input{padding-right:20px}.ui-servergrid-tf-is{background-color:rgb(255,245,167,0.26)}.ui-servergrid-tf-is .ui-servergrid-clear{visibility:visible}.ui-servergrid-th{height:36px;line-height:36px;font-weight:bold}.ui-servergrid-th > div{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ui-servergrid-th.ui-servergrid-sort > div{padding-right:15px}.ui-servergrid-th:first-child,.ui-servergrid-td:first-child{border-left:0}.ui-servergrid-th{background:#F4F4F4;position:relative}.ui-servergrid-th > div i{margin-right:5px;color:#999}.ui-servergrid-rows .ui-servergrid-row:hover{background:#F8F8F8}.ui-servergrid-row.selected .ui-servergrid-number{visibility:visible}.ui-servergrid-container{overflow:scroll;-ms-overflow-style:none;scrollbar-width:none}.ui-servergrid-rows::-webkit-scrollbar{display:none}.ui-servergrid-rows{overflow:scroll;-ms-overflow-style:none;scrollbar-width:none}.ui-servergrid-number{width:40px;font-size:11px;color:#999;text-align:center}.ui-servergrid-number em{margin:7px 0 0 7px;display:none;border:1px solid #D0D0D0;border-radius:var(--radius);width:16px;height:16px;line-height:14px;text-align:center;background:#FFF;cursor:pointer}.ui-servergrid-number em i{visibility:hidden}.ui-servergrid-number span{display:block}.ui-servergrid-checkbox .ui-servergrid-number:hover em{display:block}.ui-servergrid-checkbox .ui-servergrid-number:hover span{display:none}.ui-servergrid-row.selected em i{visibility:visible !important}.ui-servergrid-row.selected em{display:block;color:var(--color);border-color:var(--color)}.ui-servergrid-row.selected .ui-servergrid-number span{display:none}.ui-servergrid-th-number{width:40px;justify-content:center;text-align:center}.ui-servergrid-th-number i{margin-right:0 !important;color:#000}.ui-servergrid-sort{cursor:pointer}.ui-servergrid-btn-sort{position:absolute;right:4px;top:0;color:#999}.ui-servergrid-left{text-align:left}.ui-servergrid-right{text-align:right}.ui-servergrid-center{text-align:center}.ui-servergrid-pagination{height:36px;line-height:36px;border-top:1px solid #E0E0E0;padding:0 5px}.ui-servergrid-pagination-pages{color:#999}.ui-servergrid-pagination-count{float:right;color:#999}.ui-servergrid-pagination input{width:50px;height:24px;line-height:24px;outline:0;text-align:center;border:0;margin-right:5px;font-size:12px;background:#F0F0F0;border-radius:var(--radius)}.ui-servergrid-pagination button{width:25px;border:0;background:#F0F0F0;transparent;padding:0;height:24px;border-radius:var(--radius);margin-right:5px;line-height:24px}.ui-servergrid-pagination button:hover{background:#F8F8F8}.ui-servergrid-pagination button:disabled,.ui-servergrid-pagination input:disabled{background:#F8F8F8;cursor:not-allowed;color:#999}.ui-servergrid-td.highlight{border-color:#156EE1}.ui-servergrid-row.highlight{background-color:rgb(255,245,167,0.26)}.ui-servergrid-noborder{border:0;border-radius:0}.ui-servergrid-th-number em{margin:10px 0 0 7px;border:1px solid #D0D0D0;border-radius:var(--radius);width:16px;height:16px;line-height:14px;text-align:center;background:#FFF;cursor:pointer;display:block;font-size:11px}.ui-servergrid-th-number em i{visibility:hidden}.ui-servergrid-th-number.selected em{display:block;border-color:var(--color)}.ui-servergrid-th-number.selected em i{visibility:visible;color:var(--color)}.ui-servergrid-pointer .ui-servergrid-row{cursor:pointer}

.ui-spotlight-layer{position:fixed;width:100%;height:100%;left:0;top:0;overflow:hidden;z-index:101;background-color:rgba(200,200,200,0.8);transition:0.25s transform cubic-bezier(0.23,1,0.32,1);transform:scale(0.8)}.ui-spotlight{position:absolute;top:8%;z-index:20;box-shadow:0 1px 20px rgba(0,0,0,0.05);transform:translate(0px,20px);background-color:#FFF;border-radius:var(--radius);overflow:hidden}.ui-spotlight-search{height:60px;background:#FFF;border-radius:var(--radius) var(--radius) 0 0;border-bottom:1px solid #E0E0E0}.ui-spotlight-search input{width:100%;background-color:#FFF;border:0;font-size:20px;outline:0}.ui-spotlight-search > div{margin-left:42px;padding:15px 10px 0 0}.ui-spotlight-search > span{float:left;width:32px;text-align:right;padding:17px 0 0;font-size:18px}.ui-spotlight .selected{background-color:#F8F8F8}.ui-spotlight-visible{opacity:1;transform:scale(1)}.ui-spotlight img{vertical-align:middle}.ui-spotlight-container{max-height:200px;overflow-x:hidden;overflow-y:auto;overflow-scrolling:touch;width:}.ui-spotlight figure{border-bottom:1px solid #E5E5E5;font-size:14px;padding:0 10px 0;background-color:#FFF;cursor:pointer;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:40px;margin:0;display:block;line-height:39px}.ui-spotlight figure i{width:15px;text-align:center;margin-right:7px}.ui-spotlight figure:hover{background-color:#F8F8F8}.ui-spotlight-noscroll{overflow:hidden !important}

.ui-table-border > table{border:1px solid #E0E0E0}.ui-table-border .ui-table-head > thead > tr > th,.ui-table-border .ui-table-tbody > tr > td{border-left:1px solid #E0E0E0;border-right:1px solid #E0E0E0;padding-left:8px;padding-right:8px}.ui-table-border .ui-table-head > thead > tr > th:first-child,.ui-table-border .ui-table-tbody > tr > td:first-child{border-left:0 !important}.ui-table-flat .ui-table-head > thead > tr > th,.ui-table-flat .ui-table-tbody > tr > td{padding-left:0;padding-right:0}.ui-table-table,.ui-table-head{width:100%;margin:0;padding:0;font-size:13px;table-layout:fixed}.ui-table-head{border-bottom:0;background-color:#FFF}.ui-table-border .ui-table-headcontainer{border:1px solid #E0E0E0;border-bottom:0;border-right:0}.ui-table-border .ui-table-headcontainer.ui-table-scrollbar{border-right:1px solid #E0E0E0}.ui-table-scrollbar{padding-right:4px;background-color:#F0F0F0}.ui-table-border .ui-table-scrollbar .ui-table-head{border-right:1px solid #E0E0E0}.ui-table-head th{padding:8px 4px}.ui-table-head .sort{cursor:pointer;user-select:none}.ui-table-head .sort i{text-align:left;color:#4783EE}.ui-table-head .sort .ti-long-arrow-up,.ui-table-head .sort .ti-long-arrow-down{width:12px;margin-right:3px}.ui-table-head .sort .ti-sort{color:black}.ui-table-nohead,.ui-table-nohead tr,.ui-table-nohead th{height:0 !important;overflow:hidden !important;padding:0 !important;margin:0 !important;border-bottom:0}.ui-table-tbody > tr{border-bottom:1px solid #E0E0E0}.ui-table-tbody > tr > td{padding:5px 4px}.ui-table-tbody button{width:28px;background-color:transparent;border:0;border-left:1px solid #E0E0E0;border-radius:0;color:#777;font-size:12px}.ui-table-tbody button:hover{color:#000}.ui-table-tbody button:disabled,.ui-table-tbody button:disabled i{color:#B0B0B0 !important;cursor:not-allowed}.ui-table-tbody button:first-child{border-left:0}.ui-table-selectable .ui-table-tbody tr{cursor:pointer}.ui-table-selectable .ui-table-tbody tr:hover{background-color:rgba(100,100,100,.05)}.ui-table-selected{background-color:rgba(253,255,191,.41) !important}.ui-table-detailed .ui-table-selected{border-bottom-color:transparent}.ui-table-detail{background-color:transparent !important;cursor:inherit !important}.ui-table-detail td{padding:20px 4px !important}.ui-table-empty{font-size:12px;color:gray;padding:30px 0;text-align:center;background-color:#F8F8F8}.ui-table-empty i{margin-right:5px}.ui-table-border > .ui-table-container{border-left:1px solid #E0E0E0;border-top:1px solid #E0E0E0}.ui-table-border.ui-table-isempty .ui-table-container{border:1px solid #E0E0E0}.ui-table-footer{border:1px solid #E0E0E0;border-top:0;height:32px}.ui-table-pagination{float:left}.ui-table-pagination button{background-color:#FFF;border:0;border-left:1px solid #E0E0E0;height:31px;width:40px;color:black;font-size:12px;text-align:center;outline:0}.ui-table-pagination button:hover{background-color:#F0F0F0}.ui-table-pagination button:disabled{background-color:#F9F9F9;color:#A0A0A0}.ui-table-pagination button:first-child{border-left:0}.ui-table-pagination button[name="page-prev"]{border-right:1px solid #E0E0E0;width:41px}.ui-table-pagination button[name="page-last"]{border-right:1px solid #E0E0E0}.ui-table-pagination input{width:40px;text-align:center;border:0;outline:0;font-size:12px;padding:0;margin:0;background-color:transparent}.ui-table-pagination > div{position:relative;display:inline-block}.ui-table-pagination-items{float:right;font-size:12px;margin:7px 10px 0 0;font-weight:bold}.ui-table-pagination-pages{float:left;font-size:12px;margin:7px 0 0 10px}.noborder .ui-table-headcontainer{border:0}.noborder .ui-table-container{border-left:0;border-right:0;border-bottom:0}.noborder .ui-table-headcontainer.ui-table-scrollbar{border-right:0}

.ui-tabmenu ul{padding:0;margin:0 0 10px;font-size:12px;list-style-type:none;display:flex;justify-content:flex-start;gap:8px}.ui-tabmenu li{min-width:100px;text-align:center;padding:5px 15px;background-color:#F0F0F0;border-radius:var(--radius);cursor:pointer;flex-shrink:0;font-size:13px}.ui-tabmenu li:hover{background-color:#F5F5F5}.ui-tabmenu li.selected{background-color:var(--color);color:#FFF}.ui-tabmenu i{margin-right:5px}.ui-tabmenu.ui-disabled li.selected{background-color:#E0E0E0}.ui-tabmenu.ui-disabled li{cursor:not-allowed;color:#A0A0A0}

.ui-tabs-tabs{display:flex;justify-content:flex-start;gap:8px}.ui-tabs-item{min-width:100px;text-align:center;padding:5px 15px;background-color:#F0F0F0;border-radius:var(--radius);cursor:pointer;flex-shrink:0;font-size:13px}.ui-tabs-item i{margin-right:5px}.ui-tabs-item:hover{background-color:#F5F5F5}.ui-tabs-item.selected{background-color:var(--color);color:#FFF}

.initials{width:37px;height:37px;line-height:37px;text-align:center;color:#FFF;display:block;font-weight:bold;border-radius:100px;cursor:default}

.json{font-family:Menlo,Consolas,monospace;color:#000;tab-size:2;overflow:hidden;white-space:pre-wrap}.json-key{color:#1A8B95}.json-number{color:#3990B5}.json-true{color:#1B7F16}.json-false{color:#9C251D}.json-null{color:#777;font-style:italic}.json-uid{color:#1A4795}.json-color i{margin-right:5px;vertical-align:middle}.json-icon{color:#451393}.json-icon i{margin-right:5px;vertical-align:middle}.json-date{color:#BF3CB3}

.ui-timepicker{position:absolute;background-color:#FFF;border-radius:var(--radius);height:70px;font-size:14px;box-shadow:0 2px 5px rgba(0,0,0,0.1);border:1px solid #E0E0E0;z-index:100}.ui-timepicker-0{width:82px}.ui-timepicker-1{width:122px}.ui-timepicker-2{width:162px}.ui-timepicker i{display:block;text-align:center;cursor:pointer;height:20px}.ui-timepicker i:hover{color:gray}.ui-timepicker > div{float:left;width:40px}.ui-timepicker > div .ti-chevron-up{padding-top:5px}.ui-timepicker-hours{border-right:1px solid #F0F0F0}.ui-timepicker-seconds{border-left:1px solid #F0F0F0}.ui-timepicker-ampm{border-left:1px solid #F0F0F0}.ui-timepicker-ampm span{height:30px;display:block;line-height:30px;text-align:center}.ui-timepicker input{display:block;width:100%;border:0;background-color:#FFF;text-align:center;outline:0;height:30px;color:#000}

.ui-tree{background-color:#FFF;height:100%}.ui-tree-children{display:none}.ui-tree-item i{width:16px;margin-right:3px}.ui-tree-item span{position:absolute;right:5px;color:#000;cursor:pointer;font-size:12px;margin:2px 0 0;top:7px;display:none}.ui-tree-item{cursor:pointer;padding:7px 18px;font-size:13px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;border-bottom:1px solid #E8E8E8;position:relative;user-select:none;line-height:0}.ui-tree-item:hover{background-color:#F8F8F8}.ui-tree-item:hover span{display:block}.ui-tree-item > div,.ui-tree .ui-tree-label > div{position:relative;display:inline-block}.ui-tree-show > .ui-tree-children{display:block}.ui-tree-show > .ui-tree-item{font-weight:bold}.ui-tree-label{margin-left:25px;display:block !important;padding:2px 0 0;position:static !important}.ui-tree-selected{background-color:#FFFDE1 !important}.ui-tree input{padding:0;margin:0;outline:0;background-color:#FFF;border:1px solid #E0E0E0;line-height:0;color:#000;outline:0}.ui-tree .ui-tree-ddhere{background-color:#F0F0F0 !important}.ui-tree-checkbox{width:16px;height:16px;line-height:16px;border-radius:2px;background-color:#FFF;border:1px solid #E0E0E0;font-size:11px;text-align:center;float:left;padding:1px 0 0}.ui-tree-checkbox i{display:none;margin:0;width:100% !important}.ui-tree-checkbox-checked{background-color:#4285F4 !important;border-color:#4285F4 !important;color:#FFF}.ui-tree-checkbox-checked i{display:block !important}.ui-tree-folder:before{content:'\\e9a6';font-weight:normal}.ui-tree-show > .ui-tree-expand .ui-tree-folder:before{content:'\\e9a4'}.ui-tree-children1 .ui-tree-item{padding-left:33px}.ui-tree-children2 .ui-tree-item{padding-left:48px}.ui-tree-children3 .ui-tree-item{padding-left:63px}.ui-tree-children4 .ui-tree-item{padding-left:78px}.ui-tree-children5 .ui-tree-item{padding-left:93px}.ui-tree-children6 .ui-tree-item{padding-left:108px}.ui-tree-children7 .ui-tree-item{padding-left:123px}.ui-tree-children8 .ui-tree-item{padding-left:138px}.ui-tree-children9 .ui-tree-item{padding-left:153px}.ui-tree-children10 .ui-tree-item{padding-left:168px}

.ui-viewbox{overflow:hidden;-ms-overflow-style:none;box-sizing:content-box}.ui-viewbox-disabled{z-index:5;position:absolute;background-color:rgba(255,255,255,0.8)}.ui-viewbox-hidden{visibility:hidden}.ui-viewbox-centered-table{display:table;width:100%;height:100%}.ui-viewbox-centered-cell{display:table-cell;width:100%;height:100%;vertical-align:middle;text-align:center}

.ui-windows-item{position:absolute;border-radius:var(--radius);box-shadow:0 10px 20px rgba(0,0,0,0.03);background-color:#FFF;z-index:4}.ui-windows-title{border:1px solid #E0E0E0;border-radius:var(--radius) var(--radius) 0 0;height:36px}.ui-windows-control{float:right;width:34px;text-align:center;border-left:1px solid #E0E0E0;line-height:34px;cursor:pointer;font-size:13px}i.ui-windows-control{transform:scale(1);font-size:15px}.ui-windows-control:hover{background-color:#F9F9F9}.ui-windows-control.ti-times{color:red;border-radius:0 var(--radius) 0 0}.ui-windows-title span{cursor:default;line-height:35px;display:block;margin-right:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 0 0 10px;font-weight:bold}.ui-windows-nomove .ui-windows-title span{cursor:default}.ui-windows-title span i{margin-right:5px}.ui-windows-body{border:1px solid #E0E0E0;border-top:0;border-radius:0 0 var(--radius) var(--radius);overflow-x:hidden}.ui-windows-moving .ui-windows-item{pointer-events:none}.ui-windows-dragged{z-index:6;pointer-events:unset !important}.ui-windows-dragged .ui-windows-title{background-color:#FAFAFA}.ui-windows-maximized{box-shadow:none}.ui-windows-maximized .ui-windows-title .ui-windows-control.ti-maximize:before{content:'\\ea01'}.ui-windows-maximized .ui-windows-title{border-left:0;border-right:0;border-radius:0;border-top:0}.ui-windows-maximized .ui-windows-control{height:35px}.ui-windows-maximized .ui-windows-body{border:0}.ui-windows-maximized .ui-windows-title .ti-window:before{content:'\\ea01'}.ui-windows-minimized .ui-windows-body{display:none}.ui-windows-nominimize .ui-windows-control[data-name='minimize']{display:none}.ui-windows-nomaximize .ui-windows-control[data-name='maximize']{display:none}.ui-windows-noclose .ui-windows-control[data-name='close']{display:none}.ui-windows-nomenu .ui-windows-control[data-name='menu']{display:none}.ui-windows-noresize .ui-windows-resize{display:none}.ui-windows-minimized .ui-windows-resize{display:none}.ui-windows-resize{position:absolute;width:5px;height:5px}.ui-windows-resize-tl{left:0;top:0;cursor:nwse-resize}.ui-windows-resize-tr{right:0;top:0;cursor:nesw-resize}.ui-windows-resize-bl{left:0;bottom:0;cursor:nesw-resize}.ui-windows-resize-br{right:0;bottom:0;cursor:nwse-resize}.ui-windows-block iframe, .ui-windows-block webview{pointer-events:none}.ui-windows-resizer{position:absolute;border-radius:var(--radius);border:1px dashed #C0C0C0;z-index:7;pointer-events:none}

.ui-wysiwyg{position:relative}.ui-wysiwyg-toolbar{border-radius:var(--radius) var(--radius) 0 0;border:1px solid #E0E0E0;height:45px;padding-left:10px}.ui-wysiwyg-toolbar button{float:left;width:24px;height:24px;line-height:24px;outline:0;text-align:center;border:0;background-color:#FFF;margin:10px 5px 0 0;font-size:12px;border-radius:var(--radius)}.ui-wysiwyg-toolbar button:hover,.ui-wysiwyg-toolbar button.selected{background-color:#F0F0F0}.ui-wysiwyg-body{outline:0;background-color:#FFF;color:#000;border:1px solid #E0E0E0;border-top:0;padding:15px 10px;border-radius:0 0 var(--radius) var(--radius);position:relative;display:inline-block;width:100%}.ui-wysiwyg-placeholder{position:absolute;margin:15px 0 0 15px;color:#A0A0A0;cursor:text;z-index:1}.ui-wysiwyg .marked{background-color:rgba(0,0,0,0.1);padding:0 2px;border-radius:var(--radius)}.ui-wysiwyg code{font-family:Menlo,Consolas,monospace;color:#000;font-size:13px;background-color:#F0F0F0;padding:0 3px;border-radius:var(--radius)}`);

COMPONENT('approve','cancel:Cancel',function(self,config,cls){var cls2='.'+cls,events={},buttons,oldcancel;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+' hidden');self.aclass(cls+'-style-'+(config.style||1));self.html('<div><div class="{0}-body"><span class="{0}-close"><i class="ti ti-times"></i></span><div class="{0}-content"></div><div class="{0}-buttons"><button data-index="0"></button><button data-index="1"></button></div></div></div>'.format(cls));buttons=self.find(cls2+'-buttons').find('button');self.event('click','button',function(){self.hide(+$(this).attrd('index'))});self.event('click',cls2+'-close',function(){self.callback=null;self.hide(-1)});self.event('click',function(e){var t=e.target.tagName;if(t!=='DIV')return;var el=self.find(cls2+'-body');el.aclass(cls+'-click');setTimeout(function(){el.rclass(cls+'-click')},300)})};events.keydown=function(e){var index=e.which===13?0:e.which===27?1:null;if(index!=null){self.find('button[data-index="{0}"]'.format(index)).trigger('click');e.preventDefault();e.stopPropagation();events.unbind()}};events.bind=function(){$(W).on('keydown',events.keydown)};events.unbind=function(){$(W).off('keydown',events.keydown)};self.show=function(message,a,b,fn,cancel){clearTimeout2(self.id);if(typeof(b)==='function'){cancel=fn;fn=b;b=config.cancel}if(M.scope)self.currscope=M.scope();self.callback=fn;self.callbackcancel=typeof(cancel)==='function'?cancel:null;var icon=a.match(/[":][a-z0-9-\s]+[":]/);if(icon){var tmp=icon+'';if(tmp.indexOf(' ')==-1)tmp='ti ti-'+tmp;a=a.replace(icon,'').trim();icon='<i class="{0}"></i>'.format(tmp.replace(/"|:/g,''))}else icon='';var color=a.match(/#[0-9a-f]+/i);if(color)a=a.replace(color,'').trim();buttons.eq(0).css('background-color',color||'').html(icon+a);if(oldcancel!==b){oldcancel=b;buttons.eq(1).html(b)}self.find(cls2+'-content').html(message.replace(/\n/g,'<br />'));$('html').aclass(cls+'-noscroll');self.rclass('hidden');events.bind();self.aclass(cls+'-visible',5);document.activeElement&&document.activeElement.blur()};self.hide=function(index){if(!index){self.currscope&&M.scope(self.currscope);self.callback&&self.callback()}else if(self.callbackcancel)self.callbackcancel();self.rclass(cls+'-visible');events.unbind();setTimeout2(self.id,function(){$('html').rclass(cls+'-noscroll');self.aclass('hidden')},50)}});

COMPONENT('aselected','selector:a;attr:href;class:selected;delay:300',function(self,config){self.readonly();var timeoutid;self.make=function(){self.refresh();self.on('location',self.refresh);config.watch&&self.datasource(config.watch,self.setter)};self.refresh=function(){timeoutid&&clearTimeout(timeoutid);timeoutid=null;var arr=self.find(config.selector);var url=NAV.url;for(var i=0;i<arr.length;i++){var el=$(arr[i]);var href=el.attr(config.attr)||'';var selected=config.strict?url===href:url.length===1||href.length===1?href===url:url.indexOf(href)===0;el.tclass(config.class,selected)}};self.setter=function(){timeoutid&&clearTimeout(timeoutid);timeoutid=setTimeout(self.refresh,config.delay)}});

COMPONENT('attachments',function(self,config,cls){let cls2='.'+cls;self.template=Tangular.compile('<a href="{{ value.url}}" target="_blank" data-id="{{ value.url}}" class="{0}-file">{{ if $.remove}}<span class="{0}-remove"><i class="ti ti-remove"></i></span>{{ fi}}<span class="{0}-date">{{ value.dtcreated | format(\'[date]\') }}</span><i class="ti ti-file"></i>{{ value.name}}{{ if value.size}}<span class="{0}-size">({{ value.size | format(2) }} MB)</span>{{ fi}}</a>'.format(cls));self.make=function(){self.aclass(cls);self.event('click',cls2+'-remove',function(e){e.preventDefault();e.stopPropagation();let el=$(this);let url=ATTRD(el);let model=self.get();let item=model.findItem('url',url);if(item){model.splice(model.indexOf(item),1);self.bind('@modified @touched @setter',model)}})};self.setter=function(value){if(!value)value=[];let builder=[];let model={};let second={remove:!config.disabled};for(let m of value){let file=CLONE(m);file.remove=!config.disabled;file.size=file.length||file.size||0;file.size=file.size/1024/1024;file.size=file.size.round(2);model.value=file;builder.push(self.template(model,second))}self.html(builder.join(''))}});

COMPONENT('autocomplete','height:200',function(self,config,cls){var clssel='selected',container,old,searchtimeout,searchvalue,blurtimeout,datasource,offsetter,scroller,skipmouse=false,margin={},is=false,prev;self.template=Tangular.compile('<li{{ if select}} class="'+clssel+'"{{ fi}} data-index="{{ index}}"><span>{{ name}}</span></li>');self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+'-container hidden');self.html('<div class="'+cls+'"><div class="noscrollbar"><ul></ul></div></div>');scroller=self.find('.noscrollbar');container=self.find('ul');self.event('mousedown touchstart','li',function(e){e.preventDefault();e.stopPropagation();if(self.opt.callback){var val=datasource[+$(this).attrd('index')];self.opt.scope&&M.scope(self.opt.scope);if(self.opt.path)SET(self.opt.path,val.value===undefined?val.name:val.value);else self.opt.callback(val,old)}self.visible(false)});self.event('mouseenter mouseleave','li',function(e){if(!skipmouse){prev&&prev.rclass(clssel);prev=$(this).tclass(clssel,e.type==='mouseenter')}});$(document).on('click',function(){is&&self.visible(false)});self.on('scroll + resize + reflow + resize2',function(){is&&self.visible(false)})};self.prerender=function(value){self.render(value)};self.configure=function(name,value){switch(name){case'height':value&&scroller.css('height',value);break}};function keydown(e){var c=e.which,input=this;if(c!==38&&c!==40&&c!==13){if(c!==8&&c<32)return;clearTimeout(searchtimeout);searchtimeout=setTimeout(function(){var val=input.value||input.innerHTML;if(!val)return self.render(EMPTYARRAY);if(searchvalue===val)return;searchvalue=val;self.resize();self.opt.search(val,self.prerender)},200);return}if(!datasource||!datasource.length||!is)return;var current=container.find('.'+clssel);if(c===13){if(prev){prev=null;self.visible(false);if(current.length){var val=datasource[+current.attrd('index')];self.opt.scope&&M.scope(self.opt.scope);if(self.opt.callback)self.opt.callback(val,old);else if(self.opt.path)SET(self.opt.path,val.value===undefined?val.name:val.value);e.preventDefault();e.stopPropagation()}}return}e.preventDefault();e.stopPropagation();if(current.length){current.rclass(clssel);current=c===40?current.next():current.prev()}skipmouse=true;!current.length&&(current=self.find('li:{0}-child'.format(c===40?'first':'last')));prev&&prev.rclass(clssel);prev=current.aclass(clssel);var index=+current.attrd('index');var h=current.innerHeight();var offset=((index+1)*h)+(h*2);scroller[0].scrollTop=offset>config.height?offset-config.height:0;setTimeout2(self.ID+'skipmouse',function(){skipmouse=false},100)}function blur(){clearTimeout(blurtimeout);blurtimeout=setTimeout(self.visible,300,false)}self.visible=function(visible){clearTimeout(blurtimeout);self.tclass('hidden',!visible);is=visible};self.resize=function(){if(!offsetter||!old)return;var offset=offsetter.offset();offset.top+=offsetter.height();offset.width=offsetter.width();if(margin.left)offset.left+=margin.left;if(margin.top)offset.top+=margin.top;if(margin.width)offset.width+=margin.width;self.css(offset)};self.show=function(opt,callback){clearTimeout(searchtimeout);var selector='input,[contenteditable]';if(callback)opt.callback=callback;if(opt.input==null)opt.input=opt.element;opt.input=opt.input.setter?opt.input.find(selector):$(opt.input);if(opt.input[0].tagName!=='INPUT'&&!opt.input.attr('contenteditable'))opt.input=opt.input.find(selector);if(opt.element.setter){if(!opt.callback)opt.callback=opt.element.path;opt.element=opt.element.element}if(old){old.removeAttr('autocomplete');old.off('blur',blur);old.off('keydown',keydown)}opt.input.on('keydown',keydown);opt.input.on('blur',blur);opt.input.attr('autocomplete','off');old=opt.input;margin.left=opt.offsetX;margin.top=opt.offsetY;margin.width=opt.offsetWidth;opt.scope=M.scope?M.scope():'';offsetter=$(opt.element);self.opt=opt;self.resize();searchvalue='';self.visible(false)};self.attach=function(input,search,callback,left,top,width){self.attachelement(input,input,search,callback,left,top,width)};self.attachelement=function(element,input,search,callback,left,top,width){if(typeof(callback)==='number'){width=left;left=top;top=callback;callback=null}var opt={};opt.offsetX=left;opt.offsetY=top;opt.offsetWidth=width;if(typeof(callback)==='string')opt.path=callback;else opt.callback=callback;opt.search=search;opt.element=input;opt.input=input;self.show(opt)};self.render=function(arr){datasource=arr;if(!arr||!arr.length){self.visible(false);return}var builder=[];for(var i=0;i<arr.length;i++){var obj=arr[i];if(!i&&self.opt.autoselect)obj.select=true;obj.index=i;if(!obj.name)obj.name=obj.text;builder.push(self.template(obj))}container.empty().append(builder.join(''));skipmouse=true;setTimeout(function(){scroller[0].scrollTop=0;skipmouse=false},100);prev=container.find('.'+clssel);self.visible(true);setTimeout(scroller.noscrollbar,100,true)}});

COMPONENT('autofill',function(self){self.readonly();self.blind();self.make=function(){var form=document.createElement('FORM');while(self.dom.children.length)form.appendChild(self.dom.children[0]);self.dom.appendChild(form);$(form).attr('action','#').attr('method','POST').on('submit',function(e){e.preventDefault();e.stopPropagation();return false})}});

COMPONENT('box','zindex:12;padding:25;scrollbar:1;scrolltop:1;style:1;align:center;background:1;transparent:0',function(self,config,cls){var cls2='.'+cls,csspos={},nav=false,init=false;if(!W.$$box){W.$$box_level=W.$$box_level||1;W.$$box=true;$(document).on('click',cls2+'-button-close',function(){$(this).component().set(null)});var resize=function(){setTimeout2(self.name,function(){for(var m of M.components){if(m.name===self.name&&!HIDDEN(m.dom)&&(m.ready||(m.$ready&&!m.$removed)))m.resize()}},200)};self.on('resize2',resize);$(document).on('click',cls2+'-container',function(e){if(e.target===this){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}var el=$(e.target);if(el.hclass(cls+'-container')&&el.hclass(cls+'-style-1')){var form=el.find(cls2);var c=cls+'-animate-click';form.aclass(c);form.rclass(c,300)}})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){if(config.cancel)self.EXEC(config.cancel,self.hide);else self.hide()};self.hide=function(){config.close&&self.EXEC(config.close);if(config.independent)self.hideforce();self.set('')};self.resize=function(){if(self.hclass('hidden'))return;var padding=WIDTH()==='xs'?0:config.padding;var ui=self.find(cls2);csspos.height=WH-(config.style==1?(padding*2):padding);csspos.top=config.style===3?0:padding;var w=config.width;if(w>WW){csspos.width='';csspos.maxwidth='';w=0}else{csspos.width=w+'px';csspos.maxwidth=w+'px'}ui.css(csspos);self.element.css('padding','0 '+padding+'px');var el=self.find(cls2+'-title');var th=el.height();csspos={height:csspos.height-th};if(w)csspos.width=w;if(nav)csspos.height-=nav.height()+5;self.find(cls2+'-body').css(csspos);self.scrollbar&&self.scrollbar.resize();self.element.SETTER('*/resize')};self.make=function(){var html='<div id="{0}" class="hidden {4}-container invisible{6}"><div class="{4}{5}"{1}><div class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="ti ti-times"></i></button><i class="{4}-icon hidden"></i><span class="{4}-label"></span></div><div class="{4}-body"></div></div>'.format(self.ID,config.width?(' style="max-width:'+config.width+'px"'):'',self.path,config.closebutton==false?' hidden':'',cls,config.align==='center'?'':(' '+cls+'-align-'+config.align),' '+cls+'-'+(config.background?'':'no')+'bg');$(document.body).append(html);var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';scr.length&&scr.remove();var el=$('#'+self.ID);var body=el.find(cls2+'-body')[0];var counter=0;el.css('padding','0 '+config.padding+'px');while(self.dom.children.length){var child=self.dom.children[0];if(child.tagName==='NAV'){nav=$(child);if(counter){body.parentNode.appendChild(child)}else{el.find(cls2+'-title')[0].appendChild(child);nav=null}}else body.appendChild(child);counter++}self.rclass('hidden invisible');var csscls=self.attr('class');csscls&&el.aclass(csscls);self.replace(el,true);if(config.scrollbar)self.scrollbar=SCROLLBAR(self.find(cls2+'-body'),{shadow:config.scrollbarshadow,visibleY:config.visibleY,orientation:'y'});self.aclass(cls+'-style-'+config.style);if(config.transparent)self.aclass(cls+'-transparent');self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){if(e.which===13&&!self.find('button[name="submit"]')[0].disabled)setTimeout2(self.ID+'enter',self.submit,500)})};self.configure=function(key,value,init,prev){switch(key){case'title':self.find(cls2+'-label').text(value);break;case'icon':var icon=self.find(cls2+'-icon');icon.rclass2('fa ti');if(value)icon.aclass(self.icon(value)).rclass('hidden');else icon.aclass('hidden');break;case'background':!init&&self.tclass(cls+'-bg',!!value);break;case'algin':!init&&self.rclass2(cls+'-align').aclass(cls+'–align-'+value);break;case'width':if(!init&&value!==prev){self.find(cls2).css('max-width',value+'px');self.resize()}break;case'closebutton':!init&&self.find(cls2+'-button-close').tclass('hidden',value!==true);break}};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){config.hide&&self.SEEX(config.hide);self.aclass('hidden');self.release&&self.release(true);self.esc(false);self.find(cls2).rclass(cls+'-animate');W.$$box_level--}};var allowscrollbars=function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)};self.setter=function(value){setTimeout2(self.name+'-noscroll',allowscrollbars,50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$box_level<1)W.$$box_level=1;W.$$box_level++;self.css('z-index',W.$$box_level*config.zindex);self.aclass('invisible');self.rclass('hidden');self.release&&self.release(false);self.find(cls2).css({'max-width':value+'px',width:''});config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);self.resize();setTimeout(function(){self.rclass('invisible');self.find(cls2).aclass(cls+'-animate');if(!init&&isMOBILE)$('body').aclass('hidden').rclass('hidden',200);config.autofocus&&self.autofocus(config.autofocus);init=true},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$box_level*config.zindex)+1)},500);config.closeesc&&self.esc(true)}});

COMPONENT('breadcrumb','icon:ti ti-home;historyapi:1;root:Root;arrowicon:ti ti-angle-right;usetitle:false;rooturl:/',function(self,config,cls){var nav;self.make=function(){self.aclass(cls+(config.style===2?(' '+cls+'-style2'):''));self.element.prepend('<nav></nav>');nav=self.find('> nav');nav.on('click','a,span',function(e){e.preventDefault();var el=$(this);var url=el.attrd('id')||el.attr('href');var items=self.get();var item=items.findItem('url',url);if(item&&item.callback){item.callback(el,e);return}if(config.exec){self.SEEX(config.exec,url,el);return}if(config.historyapi)REDIRECT(url);else location.href=url})};self.root=function(){if(config.root){var arr=[];arr.push({name:config.root,url:config.rooturl});self.set(arr)}};self.add=function(name,url,callback){var arr=[];config.root&&arr.push({name:config.root,url:config.rooturl});if(!name){callback&&callback();return}var fn=function(name,url,callback){name&&arr.push({name:name,url:url,callback:callback});return fn};setTimeout(()=>self.set(arr),1);return fn(name,url||NAV.url,callback)};self.setter=function(value,path,type){if(!value)value=EMPTYARRAY;var builder=[];for(var i=0;i<value.length;i++){var item=value[i];builder.push('<{0}="{1}"{4}>{2}</{3}>'.format(config.exec?'span data-id':'a href',item.url||item.id,Thelpers.encode(item.name),config.exec?'span':'a',item.callback?' class="{0}-children"'.format(cls):''))}if(config.title)document.title=(value.length>1?(item.name+' / '):'')+config.title;var html=builder.join('<i class="{0}"></i>'.format(config.arrowicon));if(config.icon&&html)html='<i class="{0}"></i>'.format(config.icon)+html;nav.html(html);if(!type||(M.is20&&!type.init))self.rclass('hidden invisible')}});

COMPONENT('changer',NOOP);

COMPONENT('children',function(self,config,cls){var cls2='.'+cls,template='<div class="{0}-item" draggable="true" data-id="{id}">{html}</div>'.format(cls);var dragdrop,delay;self.items={};self.parents={};self.novalidate&&self.novalidate();self.nocompile();self.getter=null;self.make=function(){self.aclass(cls);self.template=Tangular.compile(self.find('script').html());self.event('dragover dragenter dragstart drag drop',cls2+'-item',function(e){switch(e.type){case'dragstart':dragdrop=$(e.target);if(!dragdrop.hclass(cls+'-item'))dragdrop=dragdrop.closest(cls2+'-item');dragdrop.aclass(cls+'-drag');e.originalEvent.dataTransfer.setData('text','1');return;case'drop':dragdrop.rclass(cls+'-drag');var el=$(e.target);if(!el.hclass(cls+'-item'))el=el.closest(cls2+'-item');if(!el.length||el.closest(dragdrop).length||el[0]===dragdrop[0])return;clearTimeout(delay);delay=setTimeout(self.move,50,el,dragdrop);break}e.preventDefault()})};self.move=function(target,dragged){if(delay){clearTimeout(delay);delay=null}var arr=self.get();var a=self.finditem(target.attrd('id'),arr);var b=self.finditem(dragged.attrd('id'),arr);var ac=a.children||a.items,bc=b.children||b.items;if(ac===bc){var items=bc,ai=items.indexOf(a.item);var bi=items.indexOf(b.item);if(ai<bi){items.splice(bi,1);ai=items.indexOf(a.item);items.splice(ai,0,b.item)}else{items.splice(ai,1);bi=items.indexOf(b.item);items.splice(bi,0,a.item)}}else{bc.splice(bc.indexOf(b.item),1);ac.push(b.item)}self.bind('@touched @modified @setter',arr);config.onchange&&self.SEEX(config.onchange,arr)};self.finditem=function(id,items){for(var i=0;i<items.length;i++){var item=items[i];if(item.id===id)return{children:items,item:item};var children=item.children||item.items;if(children){item=self.finditem(id,children);if(item)return item}}};var renderchildren=function(parent,level){var children=parent.children||parent.items||EMPTYARRAY;if(!children.length)return'';var builder=['<div class="'+cls+'-children">'];for(var i=0;i<children.length;i++){var item=children[i],childrenhtml=renderchildren(item,level+1);self.parents[item.id]=parent;self.items[item.id]=item;builder.push(template.args({id:item.id,html:self.template({value:item,level:level})+childrenhtml}))}builder.push('</div>');return builder.join('')};self.setter=function(value){if(!value)value=EMPTYARRAY;self.db={};self.parents={};var builder=[];for(var i=0;i<value.length;i++){var item=value[i],childrenhtml=renderchildren(item,1);self.items[item.id]=item;builder.push(template.args({id:item.id,html:self.template({value:item,level:0})+childrenhtml,level:0}))}self.html(builder.length?builder.join(''):config.empty?'<div class="{0}-empty">{1}</div>'.format(cls,config.empty):'')}});

COMPONENT('choose','limit:1;attr:id;key:id;selector:.selection;event:click;class:selected;type:string;uncheck:false',function(self,config,cls){var convert=function(val){switch(config.type){case'number':return val?val.parseInt():null;default:return val}};self.getter=null;self.validate=function(value){if(config.disabled||!config.required)return true;return config.limit===1?value!=null:value&&value.length>0};self.make=function(){self.aclass(cls);self.event(config.event,config.selector,function(e){e.preventDefault();e.stopPropagation();self.toggle($(this))})};self.toggle=function(id){if(config.disabled)return;id=convert(ATTRD(id,config.attr));var model=self.get();var tmp;if(model==null){self.rewrite(model);tmp=config.limit===1?id:[id];self.set(tmp);config.click&&self.EXEC(config.click,tmp)}else{if(config.limit===1){if(model===id){if(config.uncheck){self.bind('@modified @touched @setter',null);config.click&&self.EXEC(config.click,null)}}else{self.bind('@modified @touched @setter',id);config.click&&self.EXEC(config.click,id)}}else{var index=model.indexOf(id);if(index===-1){if(config.limit<=model.length)model.pop();model.push(id)}else model.splice(index,1);config.click&&self.EXEC(config.click,model);self.bind('@modified @touched @setter',model)}}self.change(true)};self.recalc=function(){var arr=self.find(config.selector);var model=self.get();for(var i=0;i<arr.length;i++){var el=$(arr[i]);var is=false;if(config.limit===1)is=model==null?false:model===convert(el.attrd(config.attr));else is=model&&model instanceof Array&&model.length?model.indexOf(el.attrd(config.attr))!==-1:false;el.tclass(config.class,is)}};var datasource=function(){self.update()};self.configure=function(key,value){if(key==='datasource')self.datasource(value,datasource)};self.setter=function(){setTimeout2(self.ID,self.recalc,10)}});

COMPONENT('cl',function(self,config){self.nocompile();self.readonly();self.make=function(){var data=config.items||self.attr('value')||self.attr('items')||self.attrd('items')||self.html();data&&self.set(data.parseSource())}});

COMPONENT('clbind','nullable:1;key:id',function(self,config,cls){var datasource=[],template=null,curr=null,bind=function(){var item=datasource.findItem(config.key,curr);if(template&&(config.nullable||item))self.html(template({value:item}));if(!config.nullable)self.tclass('hidden',!item);config.bind&&self.SEEX(config.bind,item,self.element);config.exec&&self.SEEX(config.exec,item,self.element)};self.make=function(){var scr=self.find('scr'+'ipt,template');var str=(scr.length?scr.html():self.html()).trim();if(str)template=Tangular.compile(str)};self.configure=function(key,value){if(key==='dirsource'||key==='datasource'||key==='source'){self.datasource(value,function(path,value){datasource=(M.is20?path:value)||[];setTimeout2(self.ID,bind,10)})}};self.setter=function(value){curr=value;setTimeout2(self.ID,bind,10)}});

COMPONENT('clipboard','native:0',function(self,config,cls){var container;self.singleton();self.readonly();self.nocompile();self.make=function(){if(config.native&&navigator.clipboard&&W.isSecureContext&&W.self===W.top){self.copy=function(value){navigator.clipboard.writeText(value).catch(err=>console.error(err));config.oncopy&&self.EXEC(config.oncopy,value)}}else{var id='clipboard'+self.id;$(document.body).append('<textarea id="{0}" class="{1}"></textarea>'.format(id,cls));container=$('#'+id);self.copy=function(value){container.val(value);container.focus();container.select();document.execCommand('copy');container.blur();config.oncopy&&self.EXEC(config.oncopy,value)}}};self.setter=function(value){value&&self.copy(value)}});

COMPONENT('cloudeditor','parent:auto;autosave:1;realtime:0;margin:0',function(self,config){var iframe,savetimeout,callbacks={},callbackid=1,init=false,save=function(){savetimeout=null;send({TYPE:'body'},function(msg){var model=self.get();model.body=msg.value;self.bind('@modified @touched',model)})};var send=function(msg,callback){if(callback){var id=(callbackid++)+'';msg.callbackid=id;callbacks[id]=callback}msg.id=self.ID;iframe[0].contentWindow.postMessage(STRINGIFY(msg),'*')};var onmessage=function(e){if(e.originalEvent.source!==iframe[0].contentWindow)return;var msg=e.originalEvent?e.originalEvent.data:'';if(typeof(msg)==='string'){if(msg.indexOf('"totaleditor"')===-1||msg.indexOf('"id":"'+self.ID+'"')===-1)return;msg=PARSE(msg)}else if(!msg)return;if(msg.totaleditor!==1||msg.id!==self.ID)return;if(msg.callbackid){var fn=callbacks[msg.callbackid];if(fn){delete callbacks[msg.callbackid];fn(msg)}return}switch(msg.TYPE){case'click':case'shortcut':case'errors':case'change':config.event&&self.SEEX(config.event,msg.TYPE,msg.value);break;case'menu':case'contextmenu':var offset=self.element.offset();msg.x+=offset.left;msg.y+=offset.top;msg.instance=self;config.contextmenu&&self.SEEX(config.contextmenu,msg);break;case'cursor':config.event&&self.SEEX(config.event,msg.TYPE,msg.value);if(config.autosave){savetimeout&&clearTimeout(savetimeout);savetimeout=setTimeout(save,500)}break;case'init':init=true;break}};self.make=function(){if(!config.url)config.url=(DEF.cdn||'https://cdn.componentator.com')+'/editor/1.min.html';self.append('<iframe src="{1}?id={0}" frameborder="0" scrolling="no" allowtransparency="true" allow="geolocation *; microphone *; camera *; midi *; encrypted-media *" style="width:100%;overflow:hidden;display:block"></iframe>'.format(self.ID,config.url));iframe=self.find('iframe');self.resize();$(W).on('message',onmessage)};self.destroy=function(){$(W).off('message',onmessage)};self.replace=function(text,to){send({TYPE:'replace',value:text,to:to})};self.readonly=function(is){send({TYPE:'readonly',value:is})};self.search=function(text,callback){send({TYPE:'search',value:text},callback)};self.select=function(from,to){send({TYPE:'select',from:from,to:to})};self.goto=function(pos){send({TYPE:'goto',value:pos})};self.clear=function(){send({TYPE:'clear'})};self.replaceselections=function(val){send({TYPE:'replaceselections',value:val})};self.replaceselection=function(val){send({TYPE:'replaceselection',value:val})};self.replacerange=function(val,from,to){send({TYPE:'replacerange',value:val,from:from,to:to})};self.change=function(arr){send({TYPE:'change',value:arr})};self.focus=function(){iframe.focus();send({TYPE:'focus'})};self.command=function(value){send({TYPE:'command',value:value})};self.exec=function(a,b,c){send({TYPE:'exec',a:a,b:b,c:c})};self.insert=function(value){send({TYPE:'insert',value:value})};self.save=function(callback){send({TYPE:'body'},function(msg){send({TYPE:'clear'});if(callback){callback(msg.value)}else{var model=self.get();model.body=msg.value;self.bind('@modified',model)}})};self.send=send;self.resize=function(){var parent=self.parent(config.parent);var w=parent.width();var h=parent.height()-config.margin;if(config.minheight&&h<config.minheight)h=config.minheight;iframe.css({width:w,height:h})};self.marker=function(name,from,to,color){send({TYPE:'marker',from:from,to:to,value:name,color:color})};self.darkmode=function(){send({TYPE:'darkmode',value:$('body').hclass('ui-dark')})};var settertimeout;self.setter=function(){if(init){settertimeout=null;var model=self.get();model&&send({TYPE:'init',linenumbers:model.linenumbers,realtime:config.realtime,readonly:config.readonly,mode:model.type||'clientside',value:model.body,keywords:model.keywords||config.keywords,darkmode:$('body').hclass('ui-dark')})}else{settertimeout&&clearTimeout(settertimeout);settertimeout=setTimeout(self.setter,100)}}});

COMPONENT('colorpicker',function(self,config,cls){var cls2='.'+cls,is=false,events={},colors=[['','E73323','EC8632','FFFD54','68B25B','7CFBFD','4285F4','E73CF7','E8357E','73197B','91683C','808080'],['FFFFFF','E8E8E8','D1D1D1','B9B9B9','A2A2A2','8B8B8B','747474','5D5D5D','464646','2E2E2E','171717','000000'],['5C0E07','5E350F','66651C','41641A','2D6419','2D6438','2D6465','133363','000662','2D0962','5C1262','5C0F32','8A1A11','8E501B','99982F','62962B','47962A','479654','479798','214D94','010E93','451393','8A2094','8A1C4C','B9261A','BD6B27','CCCB41','83C83C','61C83B','61C871','62C9CA','2E67C5','0216C4','5C1DC4','B92EC5','B92865','E73323','EC8632','FFFD54','A4FB4E','7BFA4C','7BFA8D','7CFBFD','3B80F7','041EF5','7327F5','E73CF7','E7357F','E8483F','EF9D4B','FFFE61','B4FB5C','83FA5A','83FAA2','83FBFD','5599F8','343CF5','8C42F6','E84FF7','E84A97','EA706B','F2B573','FFFE7E','C5FC7C','96FA7A','96FBB9','96FCFD','7BB2F9','666AF6','A76EF7','EB73F8','EA71B0','F6CECD','FAE6CF','FFFED1','EBFED1','D7FDD0','D7FDE7','D8FEFE','D1E5FD','CCCDFB','E1CEFB','F6CFFC','F6CEE4']];self.singleton();self.readonly();self.blind();self.nocompile();self.make=function(){var html='';for(var i=0;i<colors.length;i++){html+='<div>';for(var j=0;j<colors[i].length;j++){var color=colors[i][j];html+='<span class="{0}-cell" data-color="{2}"><span style="{1}">{3}</span></span>'.format(cls,color?('background-color:#'+color):'',color,color?'':'<i class="ti ti-ban"></i>')}html+='</div>'}self.html('<div class="{0}"><div class="{0}-body">{1}</div></div>'.format(cls,html));self.aclass(cls+'-container hidden');self.event('click',cls2+'-cell',function(){var el=$(this);var color=el.find('span').attr('style').replace('background-color:','');self.opt.callback&&self.opt.callback(color?self.opt.opacity?self.hex2rgba(color,self.opt.opacity):color:'');self.hide()});events.click=function(e){var el=e.target,parent=self.dom;do{if(el==parent)return;el=el.parentNode}while(el);self.hide()};self.on('scroll + reflow + resize + resize2',self.hide)};self.hex2rgba=function(hex,opacity){var c=(hex.charAt(0)==='#'?hex.substring(1):hex).split('');if(c.length===3)c=[c[0],c[0],c[1],c[1],c[2],c[2]];var a=c.splice(6);if(a.length)a=parseFloat(parseInt((parseInt(a.join(''),16)/255)*1000)/1000);else a=opacity||'1';c='0x'+c.join('');return'rgba('+[(c>>16)&255,(c>>8)&255,c&255].join(',')+','+a+')'};self.bindevents=function(){if(!events.is){events.is=true;$(document).on('click',events.click)}};self.unbindevents=function(){if(events.is){events.is=false;$(document).off('click',events.click)}};self.show=function(opt){var tmp=opt.element?opt.element instanceof jQuery?opt.element[0]:opt.element.element?opt.element.dom:opt.element:null;if(is&&tmp&&self.target===tmp){self.hide();return}events.is&&self.unbindevents();self.target=tmp;self.opt=opt;var css={};if(is){css.left=0;css.top=0;self.element.css(css)}else self.rclass('hidden');var target=$(opt.element);var w=self.element.width();var offset=target.offset();if(opt.element){switch(opt.align){case'center':css.left=Math.ceil((offset.left-w/2)+(target.innerWidth()/2));break;case'right':css.left=(offset.left-w)+target.innerWidth();break;default:css.left=offset.left;break}css.top=opt.position==='bottom'?(offset.top-self.element.height()-10):(offset.top+target.innerHeight()+10)}else{css.left=opt.x;css.top=opt.y}if(opt.offsetX)css.left+=opt.offsetX;if(opt.offsetY)css.top+=opt.offsetY;is=true;if($(W).scrollTop()===0){if(css.top+self.element.height()>W.innerHeight)css.top=W.innerHeight-self.element.height()-20}self.element.css(css);setTimeout(self.bindevents,10)};self.hide=function(){if(is){is=false;self.target=null;self.opt=null;setTimeout(self.unbindevents,50);self.aclass('hidden')}}});

COMPONENT('columns','parent:window;margin:0;fontsize:0',function(self,config,cls){var columns,cache;self.readonly();self.make=function(){self.aclass(cls+(config.noborder?(' '+cls+'-noborder'):''));columns=self.find('> section').aclass(cls+'-col');self.rclass('hidden');self.resize();self.on('resize2',self.resize)};self.resize=function(){setTimeout2(self.ID,self.resizeforce,200)};self.resizeforce=function(){var parent=self.parent(config.parent);var wh=parent.height();var w=self.element.width()||parent.width();if(!w)return;var key=w+'x'+wh;if(cache===key)return;cache=key;var notdefined=[],total=0,css={},d=WIDTH();var m=config['margin'+d]||0;if(config.margin)wh-=config.margin;if(m)wh-=m;var index=0;switch(d){case'md':index=1;break;case'sm':index=2;break;case'xs':index=3;break}for(var i=0;i<columns.length;i++){var el=$(columns[i]);var size=el.attrd('size');if(size){size=size.split(',');var s=size[index];if(s==null){while(index>-1&&!s){index--;s=size[index]}}if(s==='0')s=0;if(s){var p=s.charAt(s.length-1)==='%';if(p)s=s.substring(0,s.length-1);if(p){size=+s;size=(w/100)*size}else size=+s;total+=size;css.width=size;css.height=wh;if(config.fontsize)css['font-size']=Math.ceil((size/w)*100)+'%';el.css(css).rclass('hidden invisible')}else el.aclass('hidden')}else notdefined.push(el)}var sum=((w-total)/notdefined.length).floor(3);for(var i=0;i<notdefined.length;i++){var el=notdefined[i];css.width=sum;css.height=wh;if(config.fontsize)css['font-size']=Math.ceil((sum/w)*100)+'%';el.css(css)}self.css('height',wh);self.rclass('invisible');self.element.SETTER('*/resize')};self.setter=function(){self.resize()}});

COMPONENT('configuration','dateformat:yyyy-MM-dd',function(self,config,cls){var cls2='.'+cls,datasource,items=EMPTYARRAY;self.validate=function(value){if(config.disabled)return true;if(!value)value=EMPTYOBJECT;var errors=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.required&&item.isdisabled!==true&&item.isvisible!==false){var val=value[item.id],is=item.validate(item.prepare(val));item.element.tclass(cls+'-invalid',!is);if(!is)errors.push(item)}}return!errors.length};self.reload=function(){var model=self.get();var prev;for(var i=0;i<items.length;i++){var item=items[i];item.$disable&&item.disable(item.$disable(model||EMPTYOBJECT));var is=true;if(item.$visible){is=item.$visible(model||EMPTYOBJECT);item.element.tclass('hidden',!is)}if(item.element[0].getAttribute('class').indexOf(cls+'-last')!==-1)item.element.rclass(cls+'-last');if(prev&&prev.group!==item.group)prev.element.aclass(cls+'-last');if(is)prev=item}if(prev)prev.element.aclass(cls+'-last')};self.compilefn=function(fn){var index=fn.indexOf('=>');if(index!==-1)fn=fn.substring(index+2);return new Function('value','model',fn)};self.types={};self.types.template=function(item){var icon='';if(item.icon)icon='<i class="'+self.icon(item.icon)+'"></i>';var builder=[],align=item.align||0;if(align==='center')align=1;else if(align==='right')align=2;builder.push('<div class="{0}-item{1}">'.format(cls,align?(' '+cls+'-align-'+align):''));builder.push('<div class="{0}-item-label">{1}{2}</div>'.format(cls,icon,item.name||item.text));item.summary&&builder.push('<div class="{0}-item-summary">{1}</div>'.format(cls,item.summary));builder.push('<div class="{0}-item-control"></div>'.format(cls));item.note&&builder.push('<div class="{0}-item-note">{1}</div>'.format(cls,item.note));item.button&&builder.push('<div class="{0}-button"><button>{1}</button></div>'.format(cls,item.button));item.html&&builder.push(item.html);builder.push('</div>');var T,get=function(){var model=self.get()||EMPTYOBJECT;return model[item.id]};var set=function(val){var model=self.get();var empty=false;if(!model){empty=true;model={}}var old=model[item.id];val=T.prepare(val);if(old!=val){model[item.id]=val;if(empty){self.bind('@modified @touched',model)}else{self.bind('@modified @touched');UPD(self.path.toString()+'.'+item.id)}self.change(true);return true}};var el=$(builder.join(''));item.required&&el.aclass(cls+'-required');var control=el.find(cls2+'-item-control');var type=self.types[item.type||'string'](item,control,set,get);T=type;type.element=el;type.control=control;type.id=item.id;type.required=item.required;var fndisable=item.disable?self.compilefn(item.disable):null;if(fndisable){type.$disable=function(model){var is=!!fndisable(model,model);item.button&&type.element.find(cls2+'-button button').prop('disabled',is);type.isdisabled=is;return is}}else{type.$disable=null;type.isdisabled=false}var fnvisible=item.visible?self.compilefn(item.visible):null;if(fnvisible){type.$visible=function(model){var is=!!fnvisible(model,model);type.isvisible=is;return is}}else{type.$visible=null;type.isvisible=true}item.noborder&&el.aclass(cls+'-noborder');item.click&&el.find(cls2+'-button button').on('click',function(){var meta={};meta.item=item;meta.value=get();meta.set=set;meta.type=type;self.EXEC(item.click,meta)});return type};self.types.string=function(item,el,set,get){var obj={};obj.bind=function(val){var input=el.find('input');if(item.camouflage){var arr=[];for(var i=0;i<val.length;i++)arr.push('•');val=arr.join('')}input.val(val)};obj.validate=function(val){if(val==null)return false;if(item.transform==='email')return val.isEmail();if(item.transform==='phone')return val.isPhone();if(item.transform==='url')return val.isURL();return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.prepare=function(val){if(val==null)return'';val=(val+'').trim();switch(item.transform){case'phone':case'url':return val.replace(/\s/g,'');case'email':case'lowercase':return val.toLowerCase();case'uppercase':return val.toUppercase();case'slug':return val.slug();case'id':return val.slug().replace(/-/g,'')}return val};el.append('<div class="{0}-type-string"{1}><input type="text" placeholder="{2}" /></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');item.maxlength&&input.prop('maxlength',item.maxlength);input.on('change',function(){set(this.value)}).blur(function(){if(item.camouflage)obj.bind(this.value)}).on('focus',function(){if(item.camouflage){var val=obj.prepare(get());this.value=val}});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.multiline=self.types.textarea=function(item,el,set){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('textarea').prop('disabled',!!val)};obj.prepare=function(val){return val!=null?(val+'').trim():''};el.append('<div class="{0}-type-multiline"{2}><textarea placeholder="{1}"></textarea></div>'.format(cls,(item.placeholder||'').encode(),item.height?' style="height:{0}"'.format(item.height):''));var input=el.find('textarea').on('change',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.group=function(item){var icon='';if(item.icon)icon='<i class="'+self.icon(item.icon)+'"></i>';var builder=['<div>'];builder.push('<div class="{0}-group">{1}</div>'.format(cls,icon+item.name||item.text));if(item.summary)builder.push('<div class="{0}-group-summary">{1}</div>'.format(cls,item.summary));else builder.push('<br>');return builder.join('')+'</div>'};self.types.number=function(item,el,set,get){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.validate=function(val){return val!=0};obj.prepare=function(val){if(val==null)return 0;if(item.min!=null&&val<item.min)val=item.min;else if(item.max!=null&&val>item.max)val=item.max;var type=typeof(val);return type==='string'?val.parseFloat():type==='number'?val:0};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-number"{1}><span><i class="ti ti-angle-up"></i><i class="ti ti-angle-down"></i></span><div><input type="text" placeholder="{2}" /></div></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');input.prop('maxlength',item.maxlength||12);input.on('change blur',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&item.aclass('b');el.find('span i').on('click',function(){if(input[0].disabled)return;var inc=item.increment||1,val=get()||0;if(this.getAttribute('class').indexOf('-up')!==-1){set(val+inc)}else{set(val-inc)}});return obj};self.types.boolean=self.types.checkbox=function(item,el,set){var tcls=cls+'-checked',obj={};obj.bind=function(val){el.tclass(tcls,!!val)};obj.validate=function(val){return val===true};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return!!val};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-boolean"><div><span><i class="ti ti-check"></i></span></div></div>'.format(cls));el.find(cls2+'-type-boolean > div').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){el.tclass(tcls);set(el.hclass(tcls))}});return obj};self.types.dropdown=function(item,el,set){var obj={};obj.bind=function(val){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var obj=(items||EMPTYARRAY).findItem('id',val);el.find('label').tclass('hidden',!!obj);el.find(cls2+'-value').text(obj?obj.name:'')};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?null:val};el.append('<div class="{0}-type-dropdown"><span><i class="ti ti-angle-down"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-dropdown').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var opt={};opt.element=$(this);opt.items=items;opt.placeholder=item.dirplaceholder;opt.search=item.dirsearch;opt.empty=item.dirempty;opt.callback=function(val){set(val?val.id:null)};SETTER('directory/show',opt)}});return obj};self.types.color=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-color div').css('background-color',val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-color"><div></div></div>'.format(cls));el.find(cls2+'-type-color').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('colorpicker/show',opt)}});return obj};self.types.icon=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-icon').html('<i class="{0}"></i>'.format(val))};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-icon"></div>'.format(cls));el.find(cls2+'-type-icon').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('icons/show',opt)}});return obj};self.types.date=function(item,el,set,get){var obj={};obj.bind=function(val){el.find(cls2+'-value').html(val?val.format(item.format||DEF.dateformat||config.dateformat):'');el.find('label').tclass('hidden',!!val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){if(val==null)return null;var type=typeof(val);return type==='string'?val.parseDate():type==='number'?new Date(val):val instanceof Date?val:null};el.append('<div class="{0}-type-date"><span><i class="ti ti-calendar"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-date').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.value=get();opt.element=$(this);opt.callback=set;SETTER('datepicker/show',opt)}});return obj};self.types.selectable=function(item,el,set){var obj={},prev,items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));if(!(items instanceof Array))items=(items||EMPTYARRAY);obj.bind=function(val){var elements=el.find(cls2+'-type-selectable-item');el.find(cls2+'-selected').rclass(cls+'-selected');if(val instanceof Array){for(var i=0;i<val.length;i++){var index=items.findIndex('id',val[i]);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}}else{var index=items.findIndex('id',val);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}};obj.validate=function(val){return item.multiple?val&&val.length>0:!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':item.multiple&&val instanceof Array?val:(val+'')};var builder=[];for(var i=0;i<items.length;i++)builder.push('<div class="{0}-type-selectable-item"><i class="{icon}"></i><span>{name}</div>'.format(cls).args(items[i]));el.append('<div class="{0}-type-selectable">{1}</div>'.format(cls,builder.join('')));el.find(cls2+'-type-selectable-item').on('click',function(){var selcls=cls+'-selected';if(!el.parent().hclass(cls+'-disabled')){var target=$(this);if(item.multiple){target.tclass(selcls)}else{if(prev&&prev[0]!==target[0])prev.rclass(selcls);prev=target.tclass(selcls)}var arr=el.find(cls2+'-selected');var selected=[];for(var i=0;i<arr.length;i++){var index=$(arr[i]).index();selected.push(items[index].id)}set(item.multiple?selected:(selected[0]||null))}});return obj};self.configure=function(key,value){if(key==='datasource'){self.datasource(value,function(path,value){datasource=value;self.redraw();self.refresh()},true)}};self.rebind=function(val){datasource=val instanceof Array?val:new Function('val','return '+val.trim())(val);self.redraw();self.refresh()};self.redraw=function(){items=[];self.empty();var container=self.element,was=false,group,count=0;for(var i=0;i<datasource.length;i++){var item=datasource[i];if(item.type==='group'){if(count&&!was)self.append('<br>');group=item;self.append(self.types.group(item));var div=document.createElement('DIV');self.append(div);container=$(div).aclass(cls+'-items')}else{count++;item=self.types.template(item);item.group=group;container.append(item.element);items.push(item)}}};self.make=function(){self.aclass(cls);var template=self.find('script').html();template&&self.rebind(template)};self.setter=function(value,path){if(!value)value={};var p=self.path.toString();var diff=path.substring(p.length+1);for(var key in value){var val=value[key];for(var j=0;j<items.length;j++){var item=items[j];if(item.id===key&&item.type!=='group'&&(!diff||diff.indexOf(path)===-1))item.bind(item.prepare(val))}}self.reload();self.rclass('invisible')}});

COMPONENT('crop','dragdrop:true;format:{0}',function(self,config,cls){var canvas,context,img=new Image();var can=false,is=false,zoom=100,current={x:0,y:0},offset={x:0,y:0},cache={x:0,y:0,zoom:0},width=0,filename;self.samesize='';self.novalidate&&self.novalidate();self.nocompile&&self.nocompile();self.getter=null;self.loadimage=function(){can=true;zoom=100;var width=config.width,height=config.height;self.samesize=img.width===width&&img.height===height&&img.src.substring(0,5)!=='data:'?$(img).attr('src'):'';var nw=(img.width/2);var nh=(img.height/2);if(img.width>width){var p=(width/(img.width/100));zoom-=zoom-p;nh=((img.height*(p/100))/2);nw=((img.width*(p/100))/2)}cache.x=current.x=(width/2)-nw;cache.y=current.y=(height/2)-nh;cache.zoom=zoom;self.redraw()};self.resizeimage=function(){if(img.width&&img.height)self.loadimage();else self.redraw()};self.configure=function(key,value,init){if(init)return;switch(key){case'width':case'height':if(cache[key]!==value){cache.x=current.x=cache.y=current.y=0;cache[key]=value;setTimeout2(self._id+'resize',self.resizeimage,10)}break}};self.output=function(type,returnobj){if(type===true){returnobj=true;type=null}var canvas2=document.createElement('canvas');var ctx2=canvas2.getContext('2d');canvas2.width=config.width;canvas2.height=config.height;ctx2.clearRect(0,0,canvas2.width,canvas2.height);if(config.background){ctx2.fillStyle=config.background;ctx2.fillRect(0,0,canvas2.width,canvas2.height)}var w=img.width,h=img.height;w=((w/100)*zoom);h=((h/100)*zoom);ctx2.drawImage(img,current.x||0,current.y||0,w,h);var t=type||(!config.background&&self.isTransparent(canvas2)?'image/png':'image/jpeg');self.filename=(filename||('image'+(new Date()).format('yyyy-MM-dd_HHmmss'))).replace(/\.[a-z]+$/i,'')+(t.indexOf('png')===-1?'.jpg':'.png');var data=canvas2.toDataURL(t);return returnobj?{filename:self.filename,data:data}:data};self.make=function(){img.crossOrigin='anonymous';img.onload=self.loadimage;self.aclass(cls);self.append(('<input type="file" style="display:none" accept="image/*" /><ul>'+(config.browse?'<li data-type="browse"><span class="ti ti-folder"></span></li>':'')+'<li data-type="upload"><span class="ti ti-upload"></span></li><li data-type="plus"><span class="ti ti-plus"></span></li><li data-type="refresh"><span class="ti ti-redo"></span></li><li data-type="minus"><span class="ti ti-minus"></span></li></ul><canvas></canvas>'));canvas=self.find('canvas')[0];context=canvas.getContext('2d');context.mozImageSmoothingEnabled=true;context.imageSmoothingQuality='low';context.webkitImageSmoothingEnable=true;context.msImageSmoothingEnabled=true;context.imageSmoothingEnabled=true;self.event('click','li',function(e){e.preventDefault();e.stopPropagation();var type=$(this).attr('data-type');switch(type){case'upload':self.find('input').trigger('click');break;case'browse':self.EXEC(config.browse,function(url){img.src=url;self.change(true)});break;case'plus':zoom+=3;if(zoom>300)zoom=300;current.x-=3;current.y-=3;self.samesize='';self.redraw();self.change(true);break;case'minus':zoom-=3;if(zoom<3)zoom=3;current.x+=3;current.y+=3;self.samesize='';self.redraw();self.change(true);break;case'refresh':zoom=cache.zoom;self.redraw();break}});self.find('input').on('change',function(){var file=this.files[0];self.load(file);this.value=''});$(canvas).on('mousedown',function(e){if(self.disabled||!can)return;is=true;var rect=canvas.getBoundingClientRect();var x=e.clientX-rect.left,y=e.clientY-rect.top;offset.x=x-current.x;offset.y=y-current.y;self.samesize=''});config.dragdrop&&$(canvas).on('dragenter dragover dragexit drop dragleave',function(e){if(self.disabled)return;e.stopPropagation();e.preventDefault();switch(e.type){case'drop':self.rclass('ui-crop-dragdrop');break;case'dragenter':case'dragover':self.aclass('ui-crop-dragdrop');return;case'dragexit':case'dragleave':default:self.rclass('ui-crop-dragdrop');return}var files=e.originalEvent.dataTransfer.files;files[0]&&self.load(files[0])});self.load=function(file){filename=file.name;self.getOrientation(file,function(orient){var reader=new FileReader();reader.onload=function(){if(orient<2){img.src=reader.result;setTimeout(()=>self.change(true),500)}else{SETTER('loading/show');self.resetorientation(reader.result,orient,function(url){SETTER('loading/hide',500);img.src=url;self.change(true)})}};reader.readAsDataURL(file)})};self.event('mousemove mouseup',function(e){if(e.type==='mouseup'){is&&self.change();is=false;return}if(self.disabled||!can||!is)return;var rect=canvas.getBoundingClientRect();var x=e.clientX-rect.left,y=e.clientY-rect.top;current.x=x-offset.x;current.y=y-offset.y;self.samesize='';self.redraw()})};self.redraw=function(){var ratio=width<config.width?width/config.width:1;canvas.width=width<config.width?width:config.width;canvas.height=width<config.width?(config.height/config.width)*width:config.height;var w=img.width,h=img.height;w=((w/100)*zoom);h=((h/100)*zoom);context.clearRect(0,0,canvas.width,canvas.height);if(config.background){context.fillStyle=config.background;context.fillRect(0,0,canvas.width,canvas.height)}context.drawImage(img,(current.x||0)*ratio,(current.y||0)*ratio,w*ratio,h*ratio)};let timeout;self.setter=function(value){width=self.width();if(!width){timeout&&clearTimeout(timeout);timeout=setTimeout(self.setter,100,value);return}if(timeout){clearTimeout(timeout);timeout=null}if(value)img.src=config.format.format(value);else self.redraw()};self.isTransparent=function(canvas){var id=canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);for(var i=0,length=id.data.length;i<length;i+=4){if(id.data[i+3]!==255)return true}return false};self.getOrientation=function(file,callback){var reader=new FileReader();reader.onload=function(e){var view=new DataView(e.target.result);if(view.getUint16(0,false)!=0xFFD8)return callback(-2);var length=view.byteLength,offset=2;while(offset<length){var marker=view.getUint16(offset,false);offset+=2;if(marker==0xFFE1){if(view.getUint32(offset+=2,false)!=0x45786966)return callback(-1);var little=view.getUint16(offset+=6,false)==0x4949;offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++)if(view.getUint16(offset+(i*12),little)==0x0112)return callback(view.getUint16(offset+(i*12)+8,little))}else if((marker&0xFF00)!=0xFF00)break;else offset+=view.getUint16(offset,false)}return callback(-1)};reader.readAsArrayBuffer(file.slice(0,64*1024))};self.clear=function(){canvas&&context&&context.clearRect(0,0,canvas.width,canvas.height)};self.resetorientation=function(src,srcOrientation,callback){var img=new Image();img.onload=function(){var width=img.width,height=img.height,canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');if(4<srcOrientation&&srcOrientation<9){canvas.width=height;canvas.height=width}else{canvas.width=width;canvas.height=height}switch(srcOrientation){case 2:ctx.transform(-1,0,0,1,width,0);break;case 3:ctx.transform(-1,0,0,-1,width,height);break;case 4:ctx.transform(1,0,0,-1,0,height);break;case 5:ctx.transform(0,1,1,0,0,0);break;case 6:ctx.transform(0,1,-1,0,height,0);break;case 7:ctx.transform(0,-1,-1,0,height,width);break;case 8:ctx.transform(0,-1,1,0,0,width);break}ctx.drawImage(img,0,0);callback(canvas.toDataURL())};img.src=src}});

COMPONENT('datagrid','checkbox:true;colwidth:150;schema:default;rowheight:30;minheight:200;clusterize:true;limit:80;rememberfilter:1;filterlabel:Filter;height:auto;margin:0;resize:true;reorder:true;sorting:true;boolean:true,on,yes;pluralizepages:# pages,# page,# pages,# pages;pluralizeitems:# items,# item,# items,# items;remember:true;highlight:false;unhighlight:true;autoselect:false;buttonapply:Apply;buttonreset:Reset;allowtitles:false;fullwidth_xs:false;clickid:id;dirplaceholder:Search;autoformat:1;controls:1;hfuncicon:square-root-alt;pagination:true;ovalue:id;otext:name',function(self,config){var opt={filter:{},filtercache:{},filtercl:{},filtervalues:{},scroll:false,selected:{},operation:''},header,vbody,footer,container,ecolumns,isecolumns=false,ready=false,sheader,sbody,econtrols,Theadercol=Tangular.compile('<div class="dg-hcol dg-col-{{ index}}{{ if sorting}} dg-sorting{{ fi}}" data-index="{{ index}}">{{ if sorting}}<i class="dg-sort ti"></i>{{ fi}}<div class="dg-label{{ alignheader}}"{{ if labeltitle}} title="{{ labeltitle}}"{{ fi}}{{ if reorder}} draggable="true"{{ fi}}>{{ label | raw}}</div>{{ if filter}}<div class="dg-filter{{ alignfilter}}{{ if filterval != null && filterval !== \'\' }} dg-filter-selected{{ fi}}"><i class="ti dg-filter-cancel ti-times"></i>{{ if options}}<label data-name="{{ name}}">{{ if filterval}}{{ if raw}}{{ filterval | raw}}{{ else}}{{ filterval}}{{ fi}}{{ else}}{{ filter}}{{ fi}}</label>{{ else}}<input autocomplete="new-password" type="text" placeholder="{{ filter}}" class="dg-filter-input" name="{{ name}}{{ ts}}" data-name="{{ name}}" value="{{ filterval}}" />{{ fi}}</div>{{ else}}<div class="dg-filter-empty">&nbsp;</div>{{ fi}}</div>');var isIE=(/msie|trident/i).test(navigator.userAgent);var isredraw=false,forcescroll='',schemas={},controls={el:null,timeout:null,is:false,cache:{}};self.meta=opt;function Cluster(el,config){var self=this,dom=el[0],scrollel=el;self.row=config.rowheight;self.rows=[];self.limit=config.limit;self.pos=-1;self.enabled=!!config.clusterize;self.plus=0;self.scrolltop=0;self.prev=0;var seh='<div style="height:0"></div>',set=$(seh);var seb=$(seh);var div=document.createElement('DIV');dom.appendChild(set[0]);dom.appendChild(div);dom.appendChild(seb[0]);self.el=$(div);self.render=function(){var t=self.pos*self.frame,b=(self.rows.length*self.row)-(self.frame*2)-t;var pos=self.pos*self.limit,posto=pos+(self.limit*2);set.css('height',t);seb.css('height',b<2?isMOBILE?(config.exec&&config.pagination?(self.row+1):(self.row*2.25))>>0:3:b);var tmp=self.scrollbar[0].scrollTop,node=self.el[0];var child=node.firstChild;while(child){node.removeChild(child);child=node.firstChild}for(var i=pos;i<posto;i++){if(typeof(self.rows[i])==='string')self.rows[i]=$(self.rows[i])[0];if(self.rows[i])node.appendChild(self.rows[i]);else break}if(self.prev<t)self.scrollbar[0].scrollTop=t;else self.scrollbar[0].scrollTop=tmp;self.prev=t;if(self.grid.selected){var index=opt.rows.indexOf(self.grid.selected);if(index!==-1&&(index>=pos||index<=(pos+self.limit)))self.el.find('.dg-row[data-index="{0}"]'.format(index)).aclass('dg-selected')}};self.scrolling=function(){var y=self.scrollbar[0].scrollTop+1;self.scrolltop=y;if(y<0)return;var frame=Math.ceil(y/self.frame)-1;if(frame===-1)return;if(self.pos!==frame){var plus=(self.el[0].offsetHeight/2)-self.frame;if(plus>0){frame=Math.ceil(y/(self.frame+plus))-1;if(self.pos===frame)return}if(self.max&&frame>=self.max)frame=self.max;self.pos=frame;if(self.enabled)self.render();else{var node=self.el[0],child=node.firstChild;while(child){node.removeChild(child);child=node.firstChild}for(var i=0;i<self.rows.length;i++){if(typeof(self.rows[i])==='string')self.rows[i]=$(self.rows[i])[0];self.el[0].appendChild(self.rows[i])}}self.scroll&&self.scroll();config.change&&self.grid.SEEX(config.change,null,null,self.grid)}if(self.grid.config.exec&&!self.grid.config.pagination&&!self.grid.isloading){var tmp=self.height+y,h=self.scrollbar[0].scrollHeight;if(!self.grid.hclass('noscroll')&&tmp>=h&&h!==self.scrollheight){self.scrollheight=h;self.grid.isloading=true;self.grid.operation('page')}}};self.update=function(rows,noscroll){if(noscroll!=true)self.el[0].scrollTop=0;self.limit=self.grid.config.limit;self.pos=-1;self.rows=rows;self.max=Math.ceil(rows.length/self.limit)-1;self.frame=self.limit*self.row;self.height=self.scrollbar.height();self.grid.isloading=false;if(!self.enabled){self.frame=1000000}else if(config.height==='fluid'){self.limit=1000000}else if(self.limit*2>rows.length){self.limit=rows.length;self.frame=self.limit*self.row;self.max=1}self.scrolling()};self.destroy=function(){self.el.off('scroll');self.rows=null};self.scrollbar=scrollel.closest('.ui-scrollbar-area');self.scrollbar.on('scroll',self.scrolling)}self.destroy=function(){opt.cluster&&opt.cluster.destroy()};self.init=function(){ON('resize + resize2',function(){setTimeout2('datagridresize',()=>SETTER('datagrid/resize'),500)});Thelpers.ui_datagrid_autoformat=function(val,type){switch(type){case'email':return val&&val.length>2?'<a href="mailto:{0}" class="dg-link"><i class="ti ti-envelope"></i>{0}</a>'.format(val):val;case'phone':return val&&val.length>2?'<a href="tel:{0}" class="dg-link"><i class="ti ti-phone"></i>{0}</a>'.format(val):val;case'url':return val&&val.length>7&&(/http(s):\/\//i).test(val)?'<a href="{0}" target="_blank" class="dg-link"><i class="ti ti-globe-world"></i>{0}</a>'.format(val):val}return val};Thelpers.ui_datagrid_checkbox=function(val){return'<div class="dg-checkbox'+(val?' dg-checked':'')+'" data-custom="1"><i class="ti ti-check"></i></div>'};Thelpers.ui_datagrid_colorize=function(val,encode){var hash=HASH(val+'');var color='#';for(var i=0;i<3;i++){var value=(hash>>(i*8))&0xFF;color+=('00'+value.toString(16)).substr(-2)}var tmp=encode?Thelpers.encode(val):val;return tmp?'<span style="background:{0}" class="dg-colorize">{1}</span>'.format(color,tmp):''}};self.readonly();self.nocompile();var reconfig=function(){self.tclass('dg-clickable',!!(config.click||config.dblclick))};self.configure=function(key,value,init){switch(key){case'schema':!init&&self.schema(value);break;case'noborder':self.tclass('dg-noborder',!!value);break;case'checkbox':case'numbering':!init&&self.cols(NOOP);break;case'pluralizepages':config.pluralizepages=value.split(',').trim();break;case'pluralizeitems':config.pluralizeitems=value.split(',').trim();break;case'checked':case'button':case'exec':if(value&&value.SCOPE)config[key]=value.SCOPE(self,value);break;case'dblclick':if(value&&value.SCOPE)config.dblclick=value.SCOPE(self,value);break;case'click':if(value&&value.SCOPE)config.click=value.SCOPE(self,value);break;case'columns':self.datasource(value,function(path,value,type){if(value){opt.sort=null;opt.filter={};opt.scroll='';opt.selected={};self.rebind(value,true);type&&self.setter(null)}});break;case'hfunc':if(value&&typeof(value)==='string')config.hfunc=self.makepath(value);break}setTimeout2(self.ID+'reconfigure',reconfig)};self.refresh=function(){self.refreshfilter()};self.applycolumns=function(use){isecolumns=false;ecolumns.aclass('hidden');if(use){var nothidden={};ecolumns.find('.dg-columns-checkbox-checked').each(function(){nothidden[this.getAttribute('data-id')]=true});self.cols(function(cols){for(var i=0;i<cols.length;i++){var col=cols[i];col.hidden=nothidden[col.id]!==true}})}};self.fn_in_changed=function(arr){config.changed&&self.SEEX(config.changed,arr||self.changed(),self)};self.fn_in_checked=function(arr){config.checked&&self.SEEX(config.checked,arr||self.checked(),self)};self.fn_refresh=function(){setTimeout2(self.ID+'filter',function(){if(config.exec)self.operation(opt.operation);else self.refreshfilter(true)},50)};var makeopt=function(){return{filter:{},filtervalues:{},filtercl:{},filtercache:{}}};self.make=function(){self.IDCSS=GUID(5);self.aclass('dg dg-noscroll dg-'+self.IDCSS+(config.height==='fluid'?' dg-fluid':''));self.find('script').each(function(){var el=$(this);var id=el.attrd('id');var html=el.html();if(id)schemas[id]={schema:html,opt:makeopt()};if(!schemas.default)schemas.default={schema:html,opt:makeopt()}});controls.show=function(dom){if(controls.ishidding||!opt.controls||!config.controls)return;var el=$(dom);var off=el.position();var css={},clshover='dg-row-hover',index=el.attrd('index');controls.el&&controls.el.rclass(clshover);controls.el=$(dom).aclass(clshover);var div=controls.cache[index];if(div===null){controls.hide();return}if(!div){var html=opt.controls(opt.rows[+index]);div=controls.cache[index]=html?$('<div>'+html+'</div>')[0]:null;controls.cache[index]=div;if(div===null){controls.hide();return}}while(true){var child=econtrols[0].firstChild;if(child)econtrols[0].removeChild(child);else break}econtrols[0].appendChild(div);css.top=Math.ceil(off.top-((econtrols.height()/2)-(config.rowheight/2)))-2;econtrols.css(css).rclass('hidden').aclass('dg-controls-visible',50).attrd('index',index);controls.timeout=null;controls.is=true;controls.y=self.scrollbarY?self.scrollbarY.scrollTop():0};controls.hide=function(type){if(controls.is){if(type===1){var y=self.scrollbarY?self.scrollbarY.scrollTop():0;if(controls.y===y)return}else if(type===2){controls.ishidding=true;setTimeout(function(){controls.ishidding=false},1000)}controls.el.rclass('dg-row-hover');controls.el=null;controls.is=false;econtrols.aclass('hidden').rclass('dg-controls-visible')}};ON('scroll',function(){controls.hide(1)});self.event('mouseenter','.dg-row',function(e){controls.timeout&&clearTimeout(controls.timeout);controls.timeout=setTimeout(controls.show,controls.is?50:500,this,e)});var pagination='';if(config.exec&&config.pagination)pagination='<div class="dg-footer hidden"><div class="dg-pagination-items hidden-xs"></div><div class="dg-pagination"><button name="page-first" disabled><i class="ti ti-angle-double-left"></i></button><button name="page-prev" disabled><i class="ti ti-angle-left"></i></button><div><input type="text" name="page" maxlength="5" class="dg-pagination-input" /></div><button name="page-next" disabled><i class="ti ti-angle-right"></i></button><button name="page-last" disabled><i class="ti ti-angle-double-right"></i></button></div><div class="dg-pagination-pages"></div></div>';self.dom.innerHTML='<div class="dg-btn-columns"><span class="ti ti-columns"></span></div><div class="dg-columns hidden"><div><div class="dg-columns-body"></div></div><button class="dg-columns-button" name="columns-apply"><i class="ti ti-check-circle"></i>{1}</button><span class="dt-columns-reset">{2}</span></div><div class="dg-container"><div class="dg-controls"></div><span class="dg-resize-line hidden"></span><div class="dg-header-scrollbar"><div class="dg-header"></div><div class="dg-body-scrollbar"><div class="dg-body"></div></div></div></div>{0}'.format(pagination,config.buttonapply,config.buttonreset);header=self.find('.dg-header');vbody=self.find('.dg-body');footer=self.find('.dg-footer');container=self.find('.dg-container');ecolumns=self.find('.dg-columns');sheader=self.find('.dg-header-scrollbar');sbody=self.find('.dg-body-scrollbar');econtrols=self.find('.dg-controls');container.on('mouseleave',function(){controls.hide(2)});self.scrollbarY=config.height!=='fluid'?SCROLLBAR(sbody,{visibleY:true,orientation:'y',controls:container,marginY:isMOBILE?0:60}):null;self.scrollbarX=SCROLLBAR(sheader,{visibleX:true,orientation:'x',controls:container});var schemaname=config.schema,schema=schemas[schemaname];if(schema){self.rebind(schema.schema);schemas.$current=schemaname}var events={};events.mouseup=function(e){if(r.is){r.is=false;r.line.aclass('hidden');r.el.css('height',r.h);var x=r.el.css('left').parseInt();var index=+r.el.attrd('index');var width=opt.cols[index].width+(x-r.x);self.resizecolumn(index,width);e.preventDefault();e.stopPropagation()}events.unbind()};container.on('contextmenu',function(e){if(config.contextmenu){e.preventDefault();self.EXEC(config.contextmenu,e,self)}});events.unbind=function(){$(W).off('mouseup',events.mouseup).off('mousemove',events.mousemove)};events.bind=function(){$(W).on('mouseup',events.mouseup).on('mousemove',events.mousemove)};var hidedir=function(){ishidedir=true;SETTER('!directory/hide');setTimeout(function(){ishidedir=false},800)};var ishidedir=false,r={is:false};self.event('click','.dg-btn-columns',function(e){e.preventDefault();e.stopPropagation();controls.hide();var cls='hidden';if(isecolumns){self.applycolumns()}else{var builder=[];for(var i=0;i<opt.cols.length;i++){var col=opt.cols[i];(col.listcolumn&&!col.$hidden)&&builder.push('<div><label class="dg-columns-checkbox{1}" data-id="{0}"><span><i class="ti ti-check"></i></span>{2}</label></div>'.format(col.id,col.hidden?'':' dg-columns-checkbox-checked',col.text))}ecolumns.find('.dg-columns-body')[0].innerHTML=builder.join('');ecolumns.rclass(cls);isecolumns=true}});header.on('click','label',function(){var el=$(this);var index=+el.closest('.dg-hcol').attrd('index');var col=opt.cols[index],opts=col.options instanceof Array?col.options:GET(self.makepath(col.options));var dir={};if(typeof opts==='function')opts=opts();controls.hide();dir.element=el;dir.items=opts;dir.key=col.otext;dir.offsetX=-6;dir.offsetY=-2;dir.placeholder=config.dirplaceholder;dir.raw=col.raw==true;dir.callback=function(item){self.applyfilterdirectory(el,col,item)};SETTER('directory/show',dir)});self.event('dblclick','.dg-col',function(e){controls.hide();e.preventDefault();e.stopPropagation();self.editcolumn($(this))});var dblclick={ticks:0,id:null,row:null};r.line=container.find('.dg-resize-line');var findclass=function(node){var count=0;while(true){for(var i=1;i<arguments.length;i++){if(node.classList.contains(arguments[i]))return true}node=node.parentNode;if((count++)>4)break}};self.event('click','.dg-row',function(e){var now=Date.now();var el=$(this);var type=e.target.tagName,target=$(e.target);if((type==='DIV'||type==='SPAN')){var cls='dg-selected',elrow=el.closest('.dg-row');var index=+elrow.attrd('index');var row=opt.rows[index];if(!row)return;if(config.dblclick&&dblclick.ticks&&dblclick.ticks>now&&dblclick.row===row&&!findclass(e.target,'dg-checkbox','dg-editable')){config.dblclick&&self.SEEX(config.dblclick,row,self,elrow,target);if(config.highlight&&self.selected!==row){opt.cluster.el.find('.'+cls).rclass(cls);self.selected=row;elrow.aclass(cls)}e.preventDefault();return}dblclick.row=row;dblclick.ticks=now+300;var rowarg=row;if(config.highlight){opt.cluster.el.find('.'+cls).rclass(cls);if(!config.unhighlight||self.selected!==row){self.selected=row;elrow.aclass(cls);controls.show(el[0])}else{rowarg=self.selected=null;controls.is&&controls.hide()}}else{if(controls.is)controls.hide();else if(rowarg)controls.show(el[0])}config.click&&self.SEEX(config.click,rowarg,self,elrow,target)}});self.reload=function(){self.operation('refresh')};self.empty=function(){self.set({page:1,pages:0,count:0,items:[],limit:0})};self.released=function(is){!is&&setTimeout(self.resize,500)};self.event('click','.dg-filter-cancel,.dt-columns-reset',function(){var el=$(this);controls.hide();if(el.hclass('dt-columns-reset'))self.resetcolumns();else{var tmp=el.parent();var input=tmp.find('input');if(input.length){input.val('');input.trigger('change');return}var label=tmp.find('label');if(label.length){tmp.rclass('dg-filter-selected');var index=+el.closest('.dg-hcol').attrd('index');var col=opt.cols[index],k=label.attrd('name');label.html(col.filter);forcescroll=opt.scroll='y';opt.operation='filter';delete opt.filter[k];delete opt.filtervalues[col.id];delete opt.filtercl[k];self.fn_refresh()}}});self.event('click','.dg-label,.dg-sort',function(){var el=$(this).closest('.dg-hcol');controls.hide();if(!el.find('.dg-sort').length)return;var index=+el.attrd('index');for(var i=0;i<opt.cols.length;i++){if(i!==index)opt.cols[i].sort=0}var col=opt.cols[index];switch(col.sort){case 0:col.sort=1;break;case 1:col.sort=2;break;case 2:col.sort=0;break}opt.sort=col;opt.operation='sort';forcescroll='-';if(config.exec)self.operation(opt.operation);else self.refreshfilter(true)});isIE&&self.event('keydown','input',function(e){if(e.keyCode===13)$(this).blur();else if(e.keyCode===27)$(this).val('')});self.event('mousedown',function(e){var el=$(e.target);if(!el.hclass('dg-resize'))return;controls.hide();events.bind();var offset=self.element.offset().left;r.el=el;r.offset=offset;var prev=el.prev();r.min=(prev.length?prev.css('left').parseInt():(config.checkbox?70:30))+50;r.h=el.css('height');r.x=el.css('left').parseInt();r.line.css('height',opt.height);r.is=true;r.isline=false;e.preventDefault();e.stopPropagation()});header.on('mousemove',function(e){if(r.is){var x=(e.pageX-r.offset-10);var x2=self.scrollbarX.scrollLeft()+x;if(x2<r.min)x2=r.min;r.el.css('left',x2);r.line.css('left',x+9);if(!r.isline){r.isline=true;r.line.rclass('hidden')}e.preventDefault();e.stopPropagation()}});self.applyfilterdirectory=function(label,col,item){var val=item[col.ovalue],is=val!=null&&val!=='',name=label.attrd('name');opt.filtervalues[col.id]=val;if(is){if(opt.filter[name]==val)return;opt.filter[name]=val}else delete opt.filter[name];delete opt.filtercache[name];opt.filtercl[name]=val;forcescroll=opt.scroll='y';opt.operation='filter';label.parent().tclass('dg-filter-selected',is);var text=is?(item[col.otext]||''):col.filter;if(col.raw)label.html(text);else label.text(text);self.fn_refresh()};var d={is:false};self.event('dragstart',function(e){d.prevent=true;!isIE&&e.originalEvent.dataTransfer.setData('text/plain',GUID())});self.event('dragenter dragover dragexit drop dragleave',function(e){if(d.prevent){e.stopPropagation();e.preventDefault()}else return;switch(e.type){case'drop':if(d.is){var col=opt.cols[+$(e.target).closest('.dg-hcol').attrd('index')];col&&self.reordercolumn(d.index,col.index)}d.is=false;break;case'dragenter':d.prevent=true;if(!d.is){d.index=+$(e.target).closest('.dg-hcol').attrd('index');d.is=true}return;case'dragover':return;default:return}});self.event('change','.dg-pagination-input',function(){var value=self.get();var val=+this.value;if(isNaN(val))return;if(val>=value.pages)val=value.pages;else if(val<1)val=1;value.page=val;forcescroll=opt.scroll='y';self.operation('page');controls.hide()});self.event('change','.dg-filter-input',function(){var input=this,$el=$(this);var el=$el.parent();var val=$el.val();var name=input.getAttribute('data-name');var col=opt.cols[+el.closest('.dg-hcol').attrd('index')];delete opt.filtercache[name];delete opt.filtercl[name];if(col.options){if(val)val=(col.options instanceof Array?col.options:GET(self.makepath(col.options)))[+val][col.ovalue];else val=null}var is=val!=null&&val!=='';if(col)opt.filtervalues[col.id]=val;if(is){if(opt.filter[name]==val)return;opt.filter[name]=val}else delete opt.filter[name];forcescroll=opt.scroll='y';opt.operation='filter';el.tclass('dg-filter-selected',is);self.fn_refresh();controls.hide()});self.select=function(row){var index;if(typeof(row)==='number'){index=row;row=opt.rows[index]}else if(row)index=opt.rows.indexOf(row);var cls='dg-selected';if(!row||index===-1){self.selected=null;opt.cluster&&opt.cluster.el.find('.'+cls).rclass(cls);config.highlight&&config.click&&self.SEEX(config.click,null,self);return}self.selected=row;var elrow=opt.cluster.el.find('.dg-row[data-index="{0}"]'.format(index));if(elrow&&config.highlight){opt.cluster.el.find('.'+cls).rclass(cls);elrow.aclass(cls)}config.click&&self.SEEX(config.click,row,self,elrow,null);controls.hide()};self.event('click','.dg-hfunc',function(e){var t=$(this);e.preventDefault();e.stopPropagation();self.SEEX(config.hfunc,t)});self.event('click','.dg-checkbox',function(e){var t=$(this);var custom=t.attrd('custom');if(custom==='1')return;e.preventDefault();e.stopPropagation();t.tclass('dg-checked');if(custom==='2')return;var val=t.attrd('value');var checked=t.hclass('dg-checked');if(val==='-1'){if(checked){opt.checked={};for(var i=0;i<opt.rows.length;i++)opt.checked[opt.rows[i].ROW]=1}else opt.checked={};self.scrolling()}else if(checked)opt.checked[val]=1;else delete opt.checked[val];self.fn_in_checked()});self.event('click','.dg-columns-checkbox',function(){$(this).tclass('dg-columns-checkbox-checked')});self.event('click','button',function(e){switch(this.name){case'columns-apply':self.applycolumns(true);break;case'page-first':forcescroll=opt.scroll='y';self.get().page=1;self.operation('page');break;case'page-last':forcescroll=opt.scroll='y';var tmp=self.get();tmp.page=tmp.pages;self.operation('page');break;case'page-prev':forcescroll=opt.scroll='y';self.get().page-=1;self.operation('page');break;case'page-next':forcescroll=opt.scroll='y';self.get().page+=1;self.operation('page');break;default:var el=$(this);var index=+el.closest('.dg-row,.dg-controls').attrd('index');var row=opt.rows[index];config.button&&self.SEEX(config.button,this.name,row,el,e);break}});self.scrollbarX.area.on('scroll',function(){!ishidedir&&hidedir();isecolumns&&self.applycolumns()});self.resize();};self.operation=function(type){var value=self.get();if(value==null)value={};if(type==='filter'||type==='init')value.page=1;var keys=Object.keys(opt.filter);self.EXEC(config.exec,type,keys.length?opt.filter:null,opt.sort&&opt.sort.sort?[(opt.sort.name+'_'+(opt.sort.sort===1?'asc':'desc'))]:null,value.page,self);switch(type){case'sort':self.redrawsorting();break}};function align(type){return type===1?'center':type===2?'right':type}self.clear=function(){for(var i=0;i<opt.rows.length;i++)opt.rows[i].CHANGES=undefined;self.renderrows(opt.rows,true);opt.cluster&&opt.cluster.update(opt.render);self.fn_in_changed()};self.editcolumn=function(rindex,cindex){var col,row;if(cindex==null){if(rindex instanceof jQuery){cindex=rindex.attr('class').match(/\d+/);if(cindex)cindex=+cindex[0];else return;col=rindex}}else row=opt.cluster.el.find('.dg-row-'+(rindex+1));if(!col)col=row.find('.dg-col-'+cindex);var index=cindex;if(index==null)return;if(!row)row=col.closest('.dg-row');var data={};data.col=opt.cols[index];if(!data.col.editable)return;data.rowindex=+row.attrd('index');data.row=opt.rows[data.rowindex];data.colindex=index;data.value=data.row[data.col.name];data.elrow=row;data.elcol=col;var clone=col.clone();var cb=function(data){if(data==null){col.replaceWith(clone);return}data.row[data.col.name]=data.value;if(opt.rows[data.rowindex]!=data.row)opt.rows[data.rowindex]=data.row;if(!data.row.CHANGES)data.row.CHANGES={};data.row.CHANGES[data.col.name]=true;opt.render[data.rowindex]=$(self.renderrow(data.rowindex,data.row))[0];data.elrow.replaceWith(opt.render[data.rowindex]);self.fn_in_changed()};if(config.change)self.EXEC(config.change,data,cb,self);else self.datagrid_edit(data,cb)};self.applyfilter=function(obj,add){if(!ready){setTimeout(self.applyfilter,100,obj,add);return}if(!add)opt.filter={};for(var key in obj){var col=opt.cols.findItem('name',key);if(col.options){var items=col.options instanceof Array?col.options:GET(self.makepath(col.options));if(items instanceof Array){var item=items.findItem(col.ovalue,obj[key]);if(item){var el=header.find('.dg-hcol[data-index="{0}"] label'.format(col.index));if(el.length)self.applyfilterdirectory(el,col,item)}}}}header.find('input').each(function(){var t=this,el=$(t);var val=obj[el.attrd('name')];if(val!==undefined)el.val(val==null?'':val)}).trigger('change')};self.schema=function(name){var tmp=schemas.$current?schemas[schemas.$current]:null;if(tmp&&config.rememberfilter){for(var key in opt.filter)tmp.opt.filter[key]=opt.filter[key];for(var key in opt.filtercache)tmp.opt.filtercache[key]=opt.filtercache[key];for(var key in opt.filtercl)tmp.opt.filtercl[key]=opt.filtercl[key];for(var key in opt.filtervalues)tmp.opt.filtervalues[key]=opt.filtervalues[key]}schemas.$current=name;self.selected=null;tmp=schemas[name];if(!tmp){tmp=schemas.default;schemas.$current='default'}opt.filter={};if(config.rememberfilter){for(var key in tmp.opt.filter)opt.filter[key]=tmp.opt.filter[key]}opt.filtercache={};if(config.rememberfilter){for(var key in tmp.opt.filtercache)opt.filtercache[key]=tmp.opt.filtercache[key]}opt.filtercl={};if(config.rememberfilter){for(var key in tmp.opt.filtercl)opt.filtercl[key]=tmp.opt.filtercl[key]}opt.filtervalues={};if(config.rememberfilter){for(var key in tmp.opt.filtervalues)opt.filtervalues[key]=tmp.opt.filtervalues[key];for(var col of opt.cols)col.filtervalue=null}else{for(var col of opt.cols)col.filtervalue=null}self.rebind(tmp.schema,true);if(config.exec){self.set(null)}else{setTimeout(()=>self.refresh(),100)}};self.rebind=function(code,prerender){if(code.length<30&&code.indexOf(' ')===-1){schemas.$current=code;self.selected=null;var tmp=schemas[code];if(!tmp){tmp=schemas.default;schemas.$current='default'}self.rebind(tmp.schema,prerender);return}opt.declaration=code;var type=typeof(code);if(type==='string'){code=code.trim();self.gridid='dg'+HASH(code)}else self.gridid='dg'+HASH(JSON.stringify(code));var cache=config.remember?W.PREF?W.PREF.get(self.gridid):CACHE(self.gridid):null;var cols=type==='string'?new Function('return '+code)():CLONE(code);var tmp;opt.rowclasstemplate=null;opt.search=false;opt.colsfilter={};for(var i=0;i<cols.length;i++){var col=cols[i];if(typeof(col)==='string'){opt.rowclasstemplate=Tangular.compile(col);cols.splice(i,1);i--;continue}if(col.type==='controls'||col.type==='buttons'){opt.controls=col.template?Tangular.compile(col.template):null;cols.splice(i,1);i--;continue}col.id=col.id||HASH(i.padLeft(2)+(col.name||'')+(col.text||'')+(col.width||'')+(col.template||'')).toString(36);col.realindex=i;if(!col.name)col.name=col.id;if(col.listcolumn==null)col.listcolumn=true;if(col.hidden){col.$hidden=FN(col.hidden)(col)===true;col.hidden=col.$hidden}if(col.hide){col.hidden=col.hide===true;delete col.hide}if(col.options){!col.otext&&(col.otext=config.otext);!col.ovalue&&(col.ovalue=config.ovalue)}if(col.sort!=null)col.sorting=col.sort;if(cache){var c=cache[i];if(c){col.index=c.index;col.width=c.width;col.hidden=c.hidden}}if(col.index==null)col.index=i;if(col.sorting==null)col.sorting=config.sorting;if(col.alignfilter!=null)col.alignfilter=' '+align(col.alignfilter);if(col.alignheader!=null)col.alignheader=' '+align(col.alignheader);col.sort=0;if(col.search){opt.search=true;col.search=col.search===true?Tangular.compile(col.template):Tangular.compile(col.search)}if(!col.align){switch(col.type){case'date':col.align=1;break;case'number':col.align=2;break;case'boolean':col.align=1;break}}if(col.align&&col.align!=='left'){col.align=align(col.align);col.align=' '+col.align;if(!col.alignfilter)col.alignfilter=' center';if(!col.alignheader)col.alignheader=' center'}var cls=col.class?(' '+col.class):'';if(col.editable){cls+=' dg-editable';if(col.required)cls+=' dg-required'}if(config.autoformat){switch(col.type){case'number':if(col.monospace==null)col.monospace=true;break}}var isbool=col.type&&col.type.substring(0,4)==='bool';var TC=Tangular.compile;if(col.template){col.templatecustom=true;col.template=TC((col.template.indexOf('<button')===-1?('<div class="dg-value'+(col.monospace?' dg-monospace':'')+cls+'">{0}</div>'):'{0}').format(col.template))}else col.template=TC(('<div class="'+(isbool?'dg-bool':('dg-value'+(col.monospace?' dg-monospace':'')))+cls+'"'+(config.allowtitles?' title="{{ {0} }}"':'')+'>{{ {0} }}</div>').format((col.options&&col.pair?'$':col.name)+(col.currency?' | currency(\'{0}\')'.format(col.currency):col.format!=null?' | format({0})'.format(col.format&&typeof(col.format)==='string'?('\''+col.format+'\''):col.format):'')+(col.type&&config.autoformat?' | ui_datagrid_autoformat(\'{0}\')'.format(col.type):'')+(col.empty?' | def({0})'.format(col.empty===true||col.empty=='1'?'':('\''+col.empty+'\'')):'')+(isbool?' | ui_datagrid_checkbox':'')+(col.colorize&&col.type!=='boolean'?(' | ui_datagrid_colorize('+(col.currency||col.format?0:1)+')'):'')+(col.raw&&col.options?' | raw':'')));if(col.header)col.header=TC(col.header);else col.header=TC('{{ text | raw}}');if(!col.text)col.text=col.name;if(col.text.substring(0,1)==='.')col.text='<i class="{0}"></i>'.format(col.text.substring(1));if(col.filter!==false&&!col.filter)col.filter=config.filterlabel;if(!col.filtervalue&&opt.filtervalues!=null)col.filtervalue=opt.filtervalues[col.id];if(col.filtervalue!=null){tmp=col.filtervalue;if(typeof(tmp)==='function')tmp=tmp(col);opt.filter[col.name]=opt.filtervalues[col.id]=tmp}opt.colsfilter[col.name]=col}cols.quicksort('index');opt.filter={};opt.cols=cols;self.rebindcss();prerender&&self.rendercols();controls.hide()};self.rebindcss=function(){var cols=opt.cols,css=[],indexes={};opt.width=(config.numbering!==false?40:0)+(config.checkbox?40:0)+30;for(var i=0;i<cols.length;i++){var col=cols[i];if(!col.width)col.width=config.colwidth;css.push('.dg-{2} .dg-col-{0}{width:{1}px}'.format(i,col.width,self.IDCSS));if(!col.hidden){opt.width+=col.width;indexes[i]=opt.width}}(W.STYLE?W.STYLE:W.CSS)(css,self.ID);var w=self.element.width();if(w>opt.width)opt.width=w-2;if(sheader){css={width:opt.width};header.css(css);}header&&header.find('.dg-resize').each(function(){var el=$(this);el.css('left',indexes[el.attrd('index')]-39)})};self.cols=function(callback){callback(opt.cols);opt.cols.quicksort('index');self.rebindcss();self.rendercols();opt.rows&&self.renderrows(opt.rows);self.save();opt.cluster&&opt.cluster.update(opt.render);self.resize()};self.rendercols=function(){var Trow='<div class="dg-hrow dg-row-{0}">{1}</div>';if(config.hfunc)config.numbering='<div class="dg-hfunc dg-hfunc-main" data-value="-1"><i class="{0}"></i></div>'.format(self.icon(config.hfuncicon));var column=config.numbering!==false?Theadercol({index:-1,label:config.numbering,filter:false,name:'$',sorting:false}):'';var resize=[];opt.width=(config.numbering!==false?40:0)+(config.checkbox?40:0)+30;if(config.checkbox)column+=Theadercol({index:-1,label:'<div class="dg-checkbox dg-checkbox-main" data-value="-1"><i class="ti ti-check"></i></div>',filter:false,name:'$',sorting:false});for(var i=0;i<opt.cols.length;i++){var col=opt.cols[i];if(!col.hidden){var filteritems=col.options?col.options instanceof Array?col.options:GET(self.makepath(col.options)):null;var filtervalue=opt.filtervalues[col.id],obj={index:i,ts:NOW.getTime(),label:col.header(col),filter:col.filter,reorder:config.reorder,sorting:col.sorting,name:col.name,alignfilter:col.alignfilter,alignheader:col.alignheader,filterval:filtervalue==null?null:filteritems?filteritems.findValue(col.ovalue,filtervalue,col.otext,'???'):filtervalue,labeltitle:col.title||col.text,options:filteritems,raw:col.raw==true};opt.width+=col.width;config.resize&&resize.push('<span class="dg-resize" style="left:{0}px" data-index="{1}"></span>'.format(opt.width-39,i));column+=Theadercol(obj)}}column+='<div class="dg-hcol"></div>';header[0].innerHTML=resize.join('')+Trow.format(0,column);var w=self.element.width();if(w>opt.width)opt.width=w;self.redrawsorting()};self.redraw=function(update){var x=self.scrollbarX.scrollLeft();var y=self.scrollbarY?self.scrollbarY.scrollTop():0;isredraw=update?2:1;self.refreshfilter();isredraw=0;self.scrollbarX.scrollLeft(x);self.scrollbarY&&self.scrollbarY.scrollTop(y)};self.redrawrow=function(oldrow,newrow){var index=opt.rows.indexOf(oldrow);if(index!==-1){controls.cache={};if(newrow){if(self.selected===oldrow)self.selected=newrow;oldrow=opt.rows[index]=newrow}var el=vbody.find('.dg-row[data-index="{0}"]'.format(index));if(el.length){opt.render[index]=$(self.renderrow(index,oldrow))[0];el[0].parentNode.replaceChild(opt.render[index],el[0])}}};self.appendrow=function(row,scroll,prepend){var index=prepend?0:(opt.rows.push(row)-1);var model=self.get();controls.cache={};if(model==null){return}else{var arr=model.items?model.items:model;if(prepend){arr.unshift(row)}else if(model.items)arr.push(row);else arr.push(row)}if(prepend){var tmp;for(var i=0;i<opt.render.length;i++){var node=opt.render[i];if(typeof(node)==='string')node=opt.render[i]=$(node)[0];var el=$(node);var tmpindex=i+1;tmp=el.rclass2('dg-row-').aclass('dg-row-'+tmpindex).attrd('index',tmpindex);tmp.find('.dg-number').html(tmpindex+1);tmp.find('.dg-checkbox-main').attrd('value',tmpindex);if(opt.rows[i])opt.rows[i].ROW=tmpindex}row.ROW=index;tmp={};var keys=Object.keys(opt.checked);for(var i=0;i<keys.length;i++)tmp[(+keys[i])+1]=1;opt.checked=tmp;opt.render.unshift(null)}opt.render[index]=$(self.renderrow(index,row))[0];opt.cluster&&opt.cluster.update(opt.render,!opt.scroll||opt.scroll==='-');if(scroll){var el=opt.cluster.el[0];el.scrollTop=el.scrollHeight}self.scrolling()};self.renderrow=function(index,row,plus){if(plus===undefined&&config.exec){var val=self.get();plus=(val.page-1)*val.limit}var Trow='<div><div class="dg-row dg-row-{0}{3}{4}" data-index="{2}">{1}</div></div>',Tcol='<div class="dg-col dg-col-{0}{2}{3}">{1}</div>',column='';if(config.numbering!==false)column+=Tcol.format(-1,'<div class="dg-number">{0}</div>'.format(index+1+(plus||0)));if(config.checkbox)column+=Tcol.format(-1,'<div class="dg-checkbox-main dg-checkbox{1}" data-value="{0}"><i class="ti ti-check"></i></div>'.format(row.ROW,opt.checked[row.ROW]?' dg-checked':''));for(var j=0;j<opt.cols.length;j++){var col=opt.cols[j];if(!col.hidden){var secondvalue=null;if(!col.templatecustom&&col.pair&&col.options){if(!col.optionscache)col.optionscache=(((typeof(col.options)==='string')?GET(col.options):col.options)||EMPTYARRAY);secondvalue=col.optionscache.findValue(col.ovalue,row[col.name],col.otext,row[col.name])}column+=Tcol.format(j,col.template(row,secondvalue),col.align,row.CHANGES&&row.CHANGES[col.name]?' dg-col-changed':'')}}column+='<div class="dg-col">&nbsp;</div>';var rowcustomclass=opt.rowclasstemplate?opt.rowclasstemplate(row):'';return Trow.format(index+1,column,index,self.selected===row?' dg-selected':'',(row.CHANGES?' dg-row-changed':'')+(rowcustomclass||''))};self.renderrows=function(rows,noscroll){opt.rows=rows;controls.cache={};var output=[],plus=0;if(config.exec){var val=self.get();plus=(val.page-1)*val.limit}var is=false;for(var col of opt.cols)col.optionscache=null;for(var i=0,length=rows.length;i<length;i++){var row=rows[i];if(!is&&self.selected){if(self.selected===row){is=true}else if(config.clickid&&self.selected[config.clickid]===row[config.clickid]){self.selected=row;is=true}}output.push(self.renderrow(i,rows[i],plus))}var min=((((opt.height||config.minheight)-120)/config.rowheight)>>0)+1;var is=output.length<min;if(is){for(var i=output.length;i<min+1;i++)output.push('<div class="dg-row-empty">&nbsp;</div>')}self.tclass('dg-noscroll',is);if(noscroll){self.scrollbarX.scrollLeft(0);self.scrollbarY&&self.scrollbarY.scrollTop(0)}opt.render=output;self.onrenderrows&&self.onrenderrows(opt)};self.exportrows=function(page_from,pages_count,callback,reset_page_to,sleep){var arr=[],source=self.get();if(reset_page_to===true)reset_page_to=source.page;if(page_from===true)reset_page_to=source.page;pages_count=page_from+pages_count;if(pages_count>source.pages)pages_count=source.pages;for(var i=page_from;i<pages_count+1;i++)arr.push(i);!arr.length&&arr.push(page_from);var index=0,rows=[];arr.wait(function(page,next){opt.scroll=(index++)===0?'xy':'';self.get().page=page;self.operation('page');self.onrenderrows=function(opt){rows.push.apply(rows,opt.rows);setTimeout(next,sleep||100)}},function(){self.onrenderrows=null;callback(rows,opt);if(reset_page_to>0){self.get().page=reset_page_to;self.operation('page')}})};self.reordercolumn=function(index,position){var col=opt.cols[index];if(!col)return;var old=col.index;opt.cols[index].index=position+(old<position?0.2:-0.2);opt.cols.quicksort('index');for(var i=0;i<opt.cols.length;i++){col=opt.cols[i];col.index=i}opt.cols.quicksort('index');self.rebindcss();self.rendercols();self.renderrows(opt.rows);opt.sort&&opt.sort.sort&&self.redrawsorting();opt.cluster&&opt.cluster.update(opt.render,true);self.scrolling();controls.hide();config.remember&&self.save()};self.resizecolumn=function(index,size){opt.cols[index].width=size;self.rebindcss();config.remember&&self.save();self.resize()};self.save=function(){var cache={};for(var i=0;i<opt.cols.length;i++){var col=opt.cols[i];col.index=i;cache[col.realindex]={index:col.index,width:col.width,hidden:col.hidden}}if(W.PREF)W.PREF.set(self.gridid,cache,'1 month');else CACHE(self.gridid,cache,'1 month')};self.rows=function(){return opt.rows.slice(0)};var resizecache={};self.resize=function(){setTimeout2(self.ID+'resize',self.resizeforce,100)};self.resizeforce=function(){if(!opt.cols||HIDDEN(self.dom)){resizecache.timeout&&clearTimeout(resizecache.timeout);resizecache.timeout=setTimeout(self.resizeforce,ready?1000:400);return}if(resizecache.timeout){clearTimeout(resizecache.timeout);resizecache.timeout=null}var el,footerh=opt.footer=footer.length?footer.height():0;if(typeof(config.height)==='string'&&config.height.substring(0,6)==='parent'){el=self.element.parent();var count=+config.height.substring(6);if(count){for(var i=0;i<count;i++)el=el.parent()}opt.height=(el.height()-config.margin)}else{switch(config.height){case'auto':var wh=config.parent?self.parent(config.parent).height():WH;el=self.element;opt.height=(wh-(el.offset().top+config.margin));break;case'window':opt.height=WH-config.margin;break;case'fluid':opt.height=((opt.rows?opt.rows.length:0)*config.rowheight)+header.outerHeight()+6;break;default:if(config.height>0){opt.height=config.height}else{el=self.element.closest(config.height);opt.height=((el.length?el.height():200)-config.margin)}break}}var mr=(vbody.parent().css('margin-right')||'').parseInt();var h=opt.height-footerh,sh=SCROLLBARWIDTH();controls.hide();var mh=config.minheight;if(h<mh)h=mh;var ismobile=isMOBILE&&isTOUCH;if(resizecache.mobile!==ismobile&&!config.noborder){resizecache.mobile=ismobile;self.tclass('dg-mobile',ismobile)}if(resizecache.h!==h){resizecache.h=h;sheader.css('height',h)}var tmpsh=h-(sh?(sh+self.scrollbarX.thinknessX-2):(footerh-2));resizecache.tmpsh=h;sbody.css('height',tmpsh+self.scrollbarX.marginY+(config.exec&&self.scrollbarX.size.empty?footerh:0));var w;if(config.fullwidth_xs&&WIDTH()==='xs'&&isMOBILE){var isfrm=false;try{isfrm=W.self!==W.top}catch(e){isfrm=true}if(isfrm){w=screen.width-(self.element.offset().left*2);if(resizecache.wmd!==w){resizecache.wmd=w;self.css('width',w)}}}if(w==null)w=self.element.width();var emptyspace=50-mr;if(emptyspace<50)emptyspace=50;var width=(config.numbering!==false?40:0)+(config.checkbox?40:0)+emptyspace;for(var i=0;i<opt.cols.length;i++){var col=opt.cols[i];if(!col.hidden)width+=col.width+1}if(w>width)width=w-2;if(resizecache.hc!==h){resizecache.hc=h;container.css('height',h)}if(resizecache.width!==width){resizecache.width=width;header.css('width',width);vbody.css('width',width);sbody.css('width',width);opt.width2=w}opt.height=h+footerh;self.scrollbarX.resize();self.scrollbarY&&self.scrollbarY.resize();ready=true;};self.refreshfilter=function(useraction){var obj=self.get()||EMPTYARRAY;var items=(obj instanceof Array?obj:obj.items)||EMPTYARRAY;var output=[];if(isredraw){if(isredraw===2){self.fn_in_checked();self.fn_in_changed()}}else{opt.checked={};config.checkbox&&header.find('.dg-checkbox-main').rclass('dg-checked');self.fn_in_checked(EMPTYARRAY)}for(var i=0;i<items.length;i++){var item=items[i];item.ROW=i;if(!config.exec){if(opt.filter&&!self.filter(item))continue;if(opt.search){for(var j=0;j<opt.cols.length;j++){var col=opt.cols[j];if(col.search)item['$'+col.name]=col.search(item)}}}output.push(item)}if(!isredraw){if(opt.scroll){if(self.scrollbarY&&(/y/).test(opt.scroll))self.scrollbarY.scrollTop(0);if((/x/).test(opt.scroll)){if(useraction){var sl=self.scrollbarX.scrollLeft();self.scrollbarX.scrollLeft(sl?sl-1:0)}else self.scrollbarX.scrollLeft(0)}opt.scroll=''}if(opt.sort!=null){if(!config.exec)opt.sort.sort&&output.quicksort(opt.sort.name,opt.sort.sort===1);self.redrawsorting()}}self.resize();self.renderrows(output,isredraw);setTimeout(self.resize,100);opt.cluster&&opt.cluster.update(opt.render,!opt.scroll||opt.scroll==='-');self.scrolling();if(isredraw){if(isredraw===2){self.select(self.selected||null)}}else{var sel=self.selected;if(config.autoselect&&output&&output.length){setTimeout(function(){var index=sel?output.indexOf(sel):0;if(index===-1)index=0;self.select(output[index])},1)}else{var index=sel?output.indexOf(sel):-1;self.select(index===-1?null:output[index])}}};self.redrawsorting=function(){var arr=self.find('.dg-sorting');for(var i=0;i<arr.length;i++){var el=$(arr[i]);var col=opt.cols[+el.attrd('index')];if(col){var ti=el.find('.dg-sort').rclass2('ti-');switch(col.sort){case 1:ti.aclass('ti-arrow-up');break;case 2:ti.aclass('ti-arrow-down');break;default:ti.aclass('ti-arrows-v');break}}}controls.hide()};self.resetcolumns=function(){if(W.PREF)W.PREF.set(self.gridid);else CACHE(self.gridid,null,'-1 day');self.rebind(opt.declaration);self.cols(NOOP);ecolumns.aclass('hidden');isecolumns=false;controls.hide()};self.redrawcolumns=function(){self.rebind(opt.declaration);self.cols(NOOP);ecolumns.aclass('hidden');isecolumns=false;controls.hide()};self.resetfilter=function(){opt.filter={};opt.filtercache={};opt.filtercl={};opt.filtervalues={};opt.cols&&self.rendercols();if(config.exec)self.operation('refresh');else self.refresh();controls.hide()};var pagecache={pages:-1,count:-1};self.redrawpagination=function(){if(!config.exec||!config.pagination)return;var value=self.get();if(!value.page)value.page=1;if(value.pages==null)value.pages=0;if(value.count==null)value.count=0;var is=false;if(value.page===1||(value.pages!=null&&value.count!=null)){pagecache.pages=value.pages;pagecache.count=value.count;is=true}footer.find('button').each(function(){var el=$(this);var dis=true;switch(this.name){case'page-next':dis=value.page>=pagecache.pages;break;case'page-prev':dis=value.page===1;break;case'page-last':dis=!value.page||value.page>=pagecache.pages;break;case'page-first':dis=value.page===1;break}el.prop('disabled',dis)});footer.find('input')[0].value=value.page;if(is){var num=pagecache.pages||0;footer.find('.dg-pagination-pages')[0].innerHTML=num.pluralize.apply(num,config.pluralizepages);num=pagecache.count||0;footer.find('.dg-pagination-items')[0].innerHTML=num.pluralize.apply(num,config.pluralizeitems)}footer.rclass('hidden')};self.setter=function(value,path,type){if(!ready){setTimeout(self.setter,100,value,path,type);return}controls.hide();if(config.exec&&(value==null||(config.pagination&&value.items==null))){if(value&&W.ERROR&&ERROR(value))return;self.operation('refresh');if(config.pagination){if(value&&value.items==null)value.items=[];else return}else return}if(value&&value.schema&&schemas.$current!==value.schema){self.rebind(value.schema,true);setTimeout(function(){self.setter(value,path,type)},100);return}if(!opt.cols)return;opt.checked={};if(forcescroll){opt.scroll=forcescroll;forcescroll=''}else opt.scroll=type!=='noscroll'&&!self.isloading?'xy':'';self.applycolumns();self.refreshfilter();self.redrawsorting();self.redrawpagination();self.fn_in_changed();!config.exec&&self.rendercols();setTimeout2(self.ID+'resize',self.resize,100);if(opt.cluster)return;config.exec&&self.rendercols();opt.cluster=new Cluster(vbody,config);opt.cluster.grid=self;opt.cluster.scroll=self.scrolling;opt.render&&opt.cluster.update(opt.render);self.aclass('dg-visible')};self.scrolling=function(){config.checkbox&&setTimeout2(self.ID,function(){vbody.find('.dg-checkbox-main').each(function(){$(this).tclass('dg-checked',opt.checked[this.getAttribute('data-value')]==1)})},80,10)};var REG_STRING=/\/\|\\|,/,REG_DATE1=/\s-\s/,REG_DATE2=/\/|\||\\|,/,REG_SPACE=/\s/g;self.filter=function(row){for(let key in opt.filter){var column=key,filter=opt.filter[column],val2=opt.filtercache[column],val=row['$'+column]||row[column],type=typeof(val);if(val instanceof Array){val=val.join(' ');type='string'}else if(val&&type==='object'&&!(val instanceof Date)){val=JSON.stringify(val);type='string'}if(type==='number'){if(val2==null)val2=opt.filtercache[column]=typeof(filter)==='number'?[filter]:self.parseNumber(filter+'');if(val2.length===1&&val!==val2[0])return false;if(val<val2[0]||val>val2[1])return false}else if(type==='string'){var is=false;if(opt.filtercl[column]!=null){is=opt.filtercl[column]==val;if(!is)return false}var col=opt.colsfilter[column];if(val2==null){val2=opt.filtercache[column]=filter.split(REG_STRING).trim();if(!col.filtertype){for(var j=0;j<val2.length;j++)val2[j]=val2[j].toSearch()}}var s=col.filtertype?val:val.toSearch();for(var j=0;j<val2.length;j++){if(s.indexOf(val2[j])!==-1){is=true;break}}if(!is)return false}else if(type==='boolean'){if(val2==null)val2=opt.filtercache[column]=typeof(filter)==='string'?config.boolean.indexOf(filter.replace(REG_SPACE,''))!==-1:filter;if(val2!==val)return false}else if(val instanceof Date){val=new Date(val.getTime());val.setHours(0);val.setMinutes(0);if(val2==null){val2=filter.trim().replace(REG_DATE1,'/').split(REG_DATE2).trim();var arr=opt.filtercache[column]=[];for(var j=0;j<val2.length;j++){var dt=val2[j].trim();var a=self.parseDate(dt,j===1);if(a instanceof Array){if(val2.length===2){arr.push(j?a[1]:a[0])}else{arr.push(a[0]);if(j===val2.length-1){arr.push(a[1]);break}}}else arr.push(a)}if(val2.length===2&&arr.length===2){arr[1].setHours(23);arr[1].setMinutes(59);arr[1].setSeconds(59)}val2=arr}if(val2.length===1){if(val2[0].YYYYMM)return val.format('yyyyMM')===val2[0].format('yyyyMM');if(val.format('yyyyMMdd')!==val2[0].format('yyyyMMdd'))return false}if(val<val2[0]||val>val2[1])return false}else return false}return true};self.checked=function(){var arr=Object.keys(opt.checked);var output=[],model=self.get()||EMPTYARRAY;var rows=model instanceof Array?model:model.items;for(var i=0;i<arr.length;i++){var index=+arr[i];output.push(rows[index])}return output};self.readfilter=function(){return opt.filter};self.changed=function(){var output=[],model=self.get()||EMPTYARRAY;var rows=model instanceof Array?model:model.items;for(var i=0;i<rows.length;i++)rows[i].CHANGES&&output.push(rows[i]);return output};self.parseDate=function(val,second){var index=val.indexOf('.');var m,y,d,a,special,tmp;if(index===-1){if((/[a-z]+/).test(val)){var dt;try{dt=NOW.add(val)}catch(e){return[0,0]}return dt>NOW?[NOW,dt]:[dt,NOW]}if(val.length===4)return[new Date(+val,0,1),new Date(+val+1,0,1)]}else if(val.indexOf('.',index+1)===-1){a=val.split('.');if(a[1].length===4){y=+a[1];m=+a[0]-1;d=second?new Date(y,m,0).getDate():1;special=true}else{y=NOW.getFullYear();m=+a[1]-1;d=+a[0]}tmp=new Date(y,m,d);if(special)tmp.YYYYMM=true;return tmp}index=val.indexOf('-');if(index!==-1&&val.indexOf('-',index+1)===-1){a=val.split('-');if(a[0].length===4){y=+a[0];m=+a[1]-1;d=second?new Date(y,m,0).getDate():1;special=true}else{y=NOW.getFullYear();m=+a[0]-1;d=+a[1]}tmp=new Date(y,m,d);if(special)tmp.YYYYMM=true;return tmp}return val.parseDate()};var REG_NUM1=/\s-\s/,REG_COMMA=/,/g,REG_NUM2=/\/|\|\s-\s|\\/;self.parseNumber=function(val){var arr=[],num=val.replace(REG_NUM1,'/').replace(REG_SPACE,'').replace(REG_COMMA,'.').split(REG_NUM2).trim();for(var i=0,length=num.length;i<length;i++){var n=num[i];arr.push(+n)}return arr};self.datagrid_cancel=function(meta,force){var current=self.editable;if(current&&current.is){current.is=false;force&&current.el.replaceWith(current.backup);current.input&&current.input.off();$(W).off('keydown',current.fn).off('click',current.fn)}};self.datagrid_edit=function(meta,next){if(!meta||!meta.col.editable)return;if(!self.editable)self.editable={};var el=meta.elcol,current=self.editable;current.is&&self.datagrid_cancel(meta,true);current.is=true;current.backup=el.find('.dg-editable').aclass('dg-editable').clone();el=el.find('.dg-editable');if(!meta.col.type){if(meta.value instanceof Date)meta.col.type='date';else meta.col.type=typeof(meta.value)}if(typeof(meta.col.editable)==='string'){meta.next=function(value){if(value!==undefined)meta.value=value;next(meta);self.datagrid_cancel(meta)};meta.cancel=function(){self.datagrid_cancel(meta)};self.EXEC(meta.col.editable,meta);return}if(meta.col.options){current.el=el;var opt={};opt.element=el;opt.items=meta.col.options;opt.raw=meta.col.raw;if(typeof(opt.items)==='string')opt.items=self.makepath(opt.items);opt.key=meta.col.otext;opt.placeholder=meta.col.dirsearch?meta.col.dirsearch:'';if(meta.col.dirsearch===false)opt.search=false;opt.callback=function(item){current.is=false;meta.value=item[meta.col.ovalue];next(meta);self.datagrid_cancel(meta)};SETTER('directory/show',opt);return}var align=meta.col.align;el.rclass('dg-value').html(meta.col.type.substring(0,4)==='bool'?'<div{1}><div class="dg-checkbox{0}" data-custom="2"><i class="ti ti-check"></i></div></div>'.format(meta.value?' dg-checked':'',align?(' class="'+align.trim()+'"'):''):'<input type="{0}" maxlength="{1}"{2} />'.format(meta.col.ispassword?'password':'text',meta.col.maxlength||100,align?(' class="'+align.trim()+'"'):''));current.el=el;var input=meta.elcol.find('input');input.val(meta.value instanceof Date?meta.value.format(meta.col.format):meta.value);input.focus();current.input=input;if(meta.col.type==='date'){var opt={};opt.element=el;opt.value=meta.value;opt.callback=function(date){current.is=false;meta.value=date;next(meta);self.datagrid_cancel(meta)};SETTER('datepicker/show',opt)}current.fn=function(e){if(!current.is)return;if(e.type==='click'){if(e.target.tagName==='INPUT')return;e.preventDefault();e.keyCode=13;if(meta.col.type==='date'){e.type='keydown';setTimeout(current.fn,800,e);return}else if(meta.col.type.substring(0,4)==='bool'){var tmp=$(e.target);var is=tmp.hclass('dg-checkbox');if(!is){tmp=tmp.closest('.dg-checkbox');is=tmp.length}if(is){meta.value=tmp.hclass('dg-checked');next(meta);self.datagrid_cancel(meta);return}}}switch(e.keyCode){case 13:case 9:var val=input.val();if(val==meta.value){next=null;self.datagrid_cancel(meta,true)}else{if(meta.col.type==='number'){val=val.parseFloat();if(val==meta.value||(meta.min!=null&&meta.min>val)||(meta.max!=null&&meta.max<val)){next=null;self.datagrid_cancel(meta,true);return}}else if(meta.col.type==='date'){val=val.parseDate(meta.format?meta.format.env():undefined);if(!val||isNaN(val.getTime()))val=null;if(val&&meta.value&&val.getTime()===meta.value.getTime()){next=null;self.datagrid_cancel(meta,true);return}}if(meta.col.required&&(val==null||val==='')){self.datagrid_cancel(meta,true);return}meta.value=val;next(meta);self.datagrid_cancel(meta)}if(e.which===9){var elcol=meta.elcol;while(true){elcol=elcol.next();if(!elcol.length)break;var eledit=elcol.find('.dg-editable');if(eledit.length){setTimeout(function(meta,elcol){self.editcolumn(meta.rowindex,+elcol.attr('class').match(/\d+/)[0])},200,meta,elcol);break}}}break;case 27:next=null;self.datagrid_cancel(meta,true);break}};$(W).on('keydown',current.fn).on('click',current.fn)}});

COMPONENT('datasource','delay:0',function(self,config){var fn=null;self.nocompile();self.readonly();self.make=function(){var scr=self.find('scr'+'ipt');if(scr.length)fn=new Function('value',scr.html())};self.reload=function(url){if(!url.includes(' '))url='GET '+url;AJAX(url,response=>SET(self.makepath(config.path),fn?fn(response):response))};self.configure=function(key,value){switch(key){case'url':if(config.delay)setTimeout2(self.ID,()=>self.reload(value),config.delay);else self.reload(value);break}};self.setter=function(value){if(value){if(config.delay)setTimeout2(self.ID,()=>self.reload(value),config.delay);else self.reload(value)}}});

COMPONENT('datepicker','today:Set today;clear:Clear;firstday:-1',function(self,config,cls){var cls2='.'+cls,skip=false,visible=false,current,elyears,elmonths,elbody,main;self.days=EMPTYARRAY;self.days_short=EMPTYARRAY;self.months=EMPTYARRAY;self.months_short=EMPTYARRAY;self.years_from;self.years_to;self.singleton();self.readonly();self.nocompile();self.configure=function(key,value){switch(key){case'days':if(value instanceof Array)self.days=value;else self.days=value.split(',').trim();self.days_short=[];for(var i=0;i<DAYS.length;i++){DAYS[i]=self.days[i];self.days_short[i]=DAYS[i].substring(0,2).toUpperCase()}break;case'months':if(value instanceof Array)self.months=value;else self.months=value.split(',').trim();self.months_short=[];for(var i=0,length=self.months.length;i<length;i++){var m=self.months[i];MONTHS[i]=m;if(m.length>4)m=m.substring(0,3)+'.';self.months_short.push(m)}break;case'yearfrom':if(value.indexOf('current')!==-1)self.years_from=+(NOW.format('yyyy'));else self.years_from=+(NOW.add(value).format('yyyy'));break;case'yearto':if(value.indexOf('current')!==-1)self.years_to=+(NOW.format('yyyy'));else self.years_to=+(NOW.add(value).format('yyyy'));break}};function getMonthDays(dt){var m=dt.getMonth();var y=dt.getFullYear();if(m===-1){m=11;y--}return(32-new Date(y,m,32).getDate())}self.calculate=function(year,month,selected){var d=new Date(year,month,1,12,0);var output={header:[],days:[],month:month,year:year},firstday=config.firstday===-1?DEF.firstdayofweek:config.firstday,firstcount=0,frm=d.getDay()-firstday;var today=NOW,ty=today.getFullYear();var tm=today.getMonth();var td=today.getDate();var sy=selected?selected.getFullYear():-1;var sm=selected?selected.getMonth():-1;var sd=selected?selected.getDate():-1;var days=getMonthDays(d);if(frm<0)frm=7+frm;while(firstcount++<7){output.header.push({index:firstday,name:self.days_short[firstday]});firstday++;if(firstday>6)firstday=0}var index=0,indexEmpty=0,count=0,prev=getMonthDays(new Date(year,month-1,1,12,0))-frm;var cur;for(var i=0;i<days+frm;i++){var obj={today:false,selected:false,empty:false,future:false,number:0,index:++count};if(i>=frm){obj.number=++index;obj.selected=sy===year&&sm===month&&sd===index;obj.today=ty===year&&tm===month&&td===index;obj.future=ty<year;if(!obj.future&&year===ty){if(tm<month)obj.future=true;else if(tm===month)obj.future=td<index}}else{indexEmpty++;obj.number=prev+indexEmpty;obj.empty=true;cur=d.add('-'+indexEmpty+' days')}if(!obj.empty)cur=d.add(i+' days');obj.month=i>=frm&&obj.number<=days?d.getMonth():cur.getMonth();obj.year=i>=frm&&obj.number<=days?d.getFullYear():cur.getFullYear();obj.date=cur;output.days.push(obj)}indexEmpty=0;for(var i=count;i<42;i++){var cur=d.add(i+' days');var obj={today:false,selected:false,empty:true,future:true,number:++indexEmpty,index:++count};obj.month=cur.getMonth();obj.year=cur.getFullYear();obj.date=cur;output.days.push(obj)}return output};self.hide=function(){if(visible){self.unbindevents();self.opt.close&&self.opt.close();self.opt=null;self.older=null;self.target=null;self.aclass('hidden');self.rclass(cls+'-visible');visible=false}return self};self.show=function(opt){setTimeout(function(){clearTimeout2('datepickerhide')},5);var el=$(opt.element);var dom=el[0];if(self.target===dom){self.hide();return}if(self.opt&&self.opt.close)self.opt.close();var off=el.offset();var w=el.innerWidth();var h=el.innerHeight();var l=0,t=0,height=305+(opt.cancel?25:0);var s=250;if(opt.element){switch(opt.align){case'center':l=Math.ceil((off.left-s/2)+(w/2));break;case'right':l=(off.left+w)-s;break;default:l=off.left;break}t=opt.position==='bottom'?(off.top-height):(off.top+h+12)}if(opt.offsetX)l+=opt.offsetX;if(opt.offsetY)t+=opt.offsetY;if((l+s)>WW)l=(l+w)-s;if($(W).scrollTop()===0){if((t+height)>WH)t=WH-height-10}var restrict=true,parent=dom.parentNode;while(parent){if(parent.tagName==='BODY'){restrict=false;break}if(parent.classList.contains('ui-scrollbar-area'))break;parent=parent.parentNode}if(restrict&&(t+height)>WH)t=(t+h)-height;var dt=typeof(opt.value)==='string'?GET(opt.value):opt.value;if((!(dt instanceof Date))||isNaN(dt.getTime()))dt=NOW;opt.scope=M.scope?M.scope():'';self.opt=opt;self.time=dt.format('HH:mm:ss');self.rclass('hidden');self.date(dt);main.css({left:l,top:t});main.aclass(cls+'-visible',50);self.bindevents();self.target=dom;visible=true};self.setdate=function(dt){if(!dt){if(typeof(self.opt.value)==='string')SET(self.opt.value+' @change',dt);else self.opt.callback(dt);return}if(!self.opt.clock){var time=self.time.split(':');if(time.length>1){dt.setHours(+(time[0]||'0'));dt.setMinutes(+(time[1]||'0'));dt.setSeconds(+(time[2]||'0'))}}else{}self.opt.scope&&M.scope(self.opt.scope);if(typeof(self.opt.value)==='string')SET(self.opt.value+' @change',dt);else self.opt.callback(dt)};self.make=function(){self.aclass(cls+'-container hidden');var conf={},reconfigure=false;if(!config.days){conf.days=[];for(var i=0;i<DAYS.length;i++)conf.days.push(DAYS[i]);reconfigure=true}if(!config.months){conf.months=MONTHS;reconfigure=true}reconfigure&&self.reconfigure(conf);W.$datepicker=self;self.event('click',function(e){e.stopPropagation()});var hide=function(){visible&&W.$datepicker&&W.$datepicker.hide()};var hide2=function(){visible&&setTimeout2('datepickerhide',function(){W.$datepicker&&W.$datepicker.hide()},20)};self.bindevents=function(){if(!visible)$(W).on('scroll',hide2)};self.unbindevents=function(){if(visible)$(W).off('scroll',hide2)};self.element.on('click',function(e){if(e.target===self.dom)hide()});self.on('reflow + scroll + resize + resize2',hide)};self.makehtml=function(){var builder=[];builder.push('<div class="{0}-header"><span class="{0}-next"><i class="ti ti-angle-right"></i></span><span class="{0}-prev"><i class="ti ti-angle-left"></i></span><div class="{0}-info"><span class="{0}-month">---</span><span class="{0}-year">---</span></div></div><div class="{0}-years hidden"></div><div class="{0}-months"></div><div class="{0}-body hidden"><div class="{0}-week">'.format(cls));for(var i=0;i<7;i++)builder.push('<div></div>');builder.push('</div><div class="{0}-days">'.format(cls));var clearbtn=self.opt.clear===false?null:'<span>{1}</span>'.format(cls,config.clear);for(var i=0;i<42;i++)builder.push('<div class="{0}-date"><div></div></div>'.format(cls,i));builder.push('</div></div>');if(self.opt.clock){var cols=self.opt.ampm?' col-3':' col-2',timepicker='<div class="{0}-time"><i class="ti ti-clock"></i><div class="{0}-select-wrapper{1}">{{ content}}</div></div>'.format(cls,cols);var selecthours='<div class="{0}-selecticon"><select class="{0}-hours">{{ options}}</select><i class="ti ti-angle-down"></i></div>'.format(cls);var selectminutes='<div class="{0}-selecticon"><select class="{0}-minutes">{{ options}}</select><i class="ti ti-angle-down"></i></div>'.format(cls);var selectampm='',hoursopt=[],minutesopt=[];if(self.opt.ampm){for(let i=1;i<=12;i++){let val=i.toString().padStart(2,'0');hoursopt.push('<option value="{0}">{0}</option>'.format(val))}}else{for(let i=0;i<24;i++){let val=i.toString().padStart(2,'0');hoursopt.push('<option value="{0}">{0}</option>'.format(val))}}for(let i=0;i<60;i++){let val=i.toString().padStart(2,'0');minutesopt.push('<option value="{0}">{0}</option>'.format(val))}if(self.opt.ampm)selectampm='<div class="{0}-selecticon ampm"><select class="{0}-ampm"><option value="am">AM</option><option value="pm">PM</option></select><i class="ti ti-angle-down"></i></div>'.format(cls);selecthours=selecthours.args({options:hoursopt.join('')});selectminutes=selectminutes.args({options:minutesopt.join('')});timepicker=timepicker.args({content:selecthours+selectminutes+selectampm});builder.push(timepicker)}builder.push('<div class="{0}-footer"><span class="{0}-now">{2}</span><span class="{0}-clear">{3}</span></div>'.format(cls,config.close,config.today,clearbtn));self.html('<div class="{0}">{1}</div>'.format(cls,builder.join('')));main=$(self.find(cls2)[0]);builder=[];elbody=self.find(cls2+'-body');elmonths=self.find(cls2+'-months');for(var i=0;i<12;i++)builder.push('<div class="{0}-month" data-index="{1}"><div></div></div>'.format(cls,i));elmonths.html(builder.join(''));builder=[];elyears=self.find(cls2+'-years');for(var i=0;i<25;i++)builder.push('<div class="{0}-year"><div></div></div>'.format(cls));elyears.html(builder.join(''));self.makehtml=null;self.find(cls2+'-month').on('click',function(e){var el=$(this);var index=el.attrd('index');var h='hidden';if(index){current.setMonth(+index);self.date(current,true)}else if(!elmonths.hclass(h))index=1;elyears.aclass(h);if(index)elmonths.aclass(h);else{elmonths.find(cls2+'-today').rclass(cls+'-today');elmonths.find(cls2+'-month').eq(current.getMonth()).aclass(cls+'-today');elmonths.rclass(h)}elbody.tclass(h,!elmonths.hclass(h));e.preventDefault();e.stopPropagation()});self.find(cls2+'-year').on('click',function(e){var el=$(this);var year=el.attrd('year');var h='hidden';if(year){current.setFullYear(+year);self.date(current,true)}else if(!elyears.hclass(h))year=1;elmonths.aclass(h);if(year)elyears.aclass(h);else{self.years();elyears.rclass(h)}elbody.tclass(h,!elyears.hclass(h));e.preventDefault();e.stopPropagation()});self.years=function(){var dom=self.find(cls2+'-years').find(cls2+'-year');var year=current.getFullYear();var index=12;for(var i=0;i<25;i++){var val=year-(index--);$(dom[i]).tclass(cls+'-today',val===year).attrd('year',val).find('div')[0].innerHTML=val}};self.find(cls2+'-date').on('click',function(){var dt=$(this).attrd('date').split('-');var hours=12,minutes=0;if(self.opt.clock){hours=parseInt(self.find(cls2+'-hours').val());minutes=parseInt(self.find(cls2+'-minutes').val());if(self.opt.ampm){var ampm=self.find(cls2+'-ampm').val();if(ampm==='pm'&&hours<12){hours+=12}else if(ampm==='am'&&hours===12){hours=0}}}self.setdate(new Date(+dt[0],+dt[1],+dt[2],hours,minutes,0));self.hide()});self.find(cls2+'-now').on('click',function(){current=new Date();self.date(current,true)});self.find(cls2+'-clear').on('click',function(){if(self.opt.clock){self.find(cls2+'-minutes').val('00');if(self.opt.ampm){self.find(cls2+'-hours').val('01');self.find(cls2+'-ampm').val('am')}else{self.find(cls2+'-hours').val('00')}}self.setdate(null);self.hide()});self.find(cls2+'-next').on('click',function(e){if(elyears.hclass('hidden')){current.setMonth(current.getMonth()+1);self.date(current,true)}else{current.setFullYear(current.getFullYear()+25);self.years()}e.preventDefault();e.stopPropagation()});self.find(cls2+'-prev').on('click',function(e){if(elyears.hclass('hidden')){current.setMonth(current.getMonth()-1);self.date(current,true)}else{current.setFullYear(current.getFullYear()-25);self.years()}e.preventDefault();e.stopPropagation()});self.opt.clock&&self.find(cls2+'-hours').on('change',function(){var el=$(this);var value=parseInt(el.val());if(self.opt.ampm){var ampm=self.find(cls2+'-ampm').val();if(ampm==='pm'&&value<12){value+=12}else if(ampm==='am'&&value===12){value=0}}current.setHours(value);self.setdate(current)});self.opt.clock&&self.find(cls2+'-minutes').on('change',function(){var el=$(this);var value=parseInt(el.val());current.setMinutes(value);self.setdate(current)});self.opt.clock&&self.opt.ampm&&self.find(cls2+'-ampm').on('change',function(){var el=$(this);var value=el.val();var hour=current.getHours();if(value==='pm'&&hour<12){hour+=12}else if(value==='am'&&hour>=12){hour-=12}current.setHours(hour);self.setdate(current)})};self.date=function(value,skipday){var clssel=cls+'-selected';self.makehtml&&self.makehtml();if(typeof(value)==='string')value=value.parseDate();var year=value==null?null:value.getFullYear();if(year&&(year<self.years_from||year>self.years_to))return;if(!value||isNaN(value.getTime())){self.find('.'+clssel).rclass(clssel);value=NOW}var empty=!value;if(skipday){skipday=false;empty=true}if(skip){skip=false;return}value=new Date((value||NOW).getTime());if(self.opt.clock){var hour=value.getHours();var minutes=value.getMinutes().toString().padStart(2,'0');self.find(cls2+'-minutes').val(minutes);if(self.opt.ampm){var hour12=hour%12||12,ampm=hour>=12?'pm':'am';self.find(cls2+'-hours').val(hour12.toString().padStart(2,'0'));self.find(cls2+'-ampm').val(ampm)}else{self.find(cls2+'-hours').val(hour.toString().padStart(2,'0'))}}var output=self.calculate(value.getFullYear(),value.getMonth(),value);var dom=self.find(cls2+'-date');self.find(cls2+'-body').rclass('hidden');self.find(cls2+'-months,'+cls2+'-years').aclass('hidden');current=value;for(var i=0;i<42;i++){var item=output.days[i],classes=[cls+'-date'];if(item.empty)classes.push(cls+'-disabled');if(!empty&&item.selected)classes.push(cls+'-selected');if(item.today)classes.push(cls+'-day-today');var el=$(dom[i]);el.attrd('date',item.year+'-'+item.month+'-'+item.number);el.find('div').html(item.number);el.find('i').remove();el.rclass().aclass(classes.join(' '))}if(!skipday){dom=self.find(cls2+'-week').find('div');for(var i=0;i<7;i++)dom[i].innerHTML=output.header[i].name;dom=self.find(cls2+'-months').find(cls2+'-month');for(var i=0;i<12;i++)$(dom[i]).find('div').attrd('index',i)[0].innerHTML=self.months_short[i]}self.opt.badges&&self.opt.badges(current,function(date){if(!(date instanceof Array))date=[date];for(var i=0;i<date.length;i++){var dt=date[i].getFullYear()+'-'+date[i].getMonth()+'-'+date[i].getDate();var el=self.find(cls2+'-date[data-date="{0}"]'.format(dt));if(el.length&&!el.find('i').length)el.append('<i class="ti ti-bull"></i>')}});var info=self.find(cls2+'-info');info.find(cls2+'-month').html(self.months[current.getMonth()]);info.find(cls2+'-year').html(current.getFullYear())}});

COMPONENT('detail','datetimeformat:yyyy-MM-dd HH:mm;dateformat:yyyy-MM-dd;timeformat:HH:mm;defaultgroup:Default',function(self,config,cls){var cls2='.'+cls,types={},container,mapping,track,colorize=function(val,encode){var hash=HASH(val+'');var color='#';for(var i=0;i<3;i++){var value=(hash>>(i*8))&0xFF;color+=('00'+value.toString(16)).substr(-2)}return('<span style="background:{0}" class="'+cls+'-colorize">{1}</span>').format(color,encode?Thelpers.encode(val):val)};self.make=function(){self.aclass(cls+' '+cls+'-style-'+(config.style||1)+(config.small?(' '+cls+'-small'):''));var scr=self.find('script');if(scr.length){mapping=(new Function('return '+scr.html().trim()))();for(var i=0;i<mapping.length;i++){var item=mapping[i];if(item.show)item.show=new Function('value','return '+item.show)}}self.html('<div class="{0}-container"></div>'.format(cls));container=self.find(cls2+'-container');var keys=Object.keys(types);for(var i=0;i<keys.length;i++){var key=keys[i];types[key].init&&types[key].init()}};self.nocompile();self.readvalue=function(path,value){return M.is20?M.get(value,path):GET(path,value)};self.mapvalue=function(item,raw){var val=item.path?item.path.indexOf('.')===-1?item.value[item.path]:self.readvalue(item.path,item.value):item.value;return raw?val:(val===false||val===true?val:val==null||val===''?(item.empty||DEF.empty):val)};self.register=function(name,init,render){types[name]={};types[name].init=init;types[name].render=render;init(self)};types.template={};types.template.init=NOOP;types.template.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-template">{1}</div>'.format(cls,Tangular.render(item.template,{value:value,item:item.value})))};types.string={};types.string.init=NOOP;types.string.render=function(item,next){var value=Thelpers.encode(self.mapvalue(item));if(item.autoformat){var text=item.colorize?colorize(value):value;if(value.isEmail())value='<a href="mailto:{0}">{1}</a>'.format(value,text);else if(value.length>5&&(/^[0-9+-\s]+$/).test(value))value='<a href="tel:{0}">{1}</a>'.format(value.replace(/\s/g,''),text)}else if(item.colorize)value=colorize(value);next('<div class="{0}-string">{1}{2}</div>'.format(cls,value,item.plus))};types.password={};types.password.init=function(){self.event('click',cls2+'-password',function(){var el=$(this);var html=el.html();if(html.substring(0,DEF.empty.length)===DEF.empty){return}var tmp=el.attrd('value');el.attrd('value',html);el.html(tmp)})};types.password.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-password" data-value="{1}">{2}</div>'.format(cls,Thelpers.encode(value),value?'************':DEF.empty))};types.number={};types.number.init=NOOP;types.number.render=function(item,next){var value=self.mapvalue(item);var format=item.format||config.numberformat;value=format?value.format(format):value;next('<div class="{0}-number">{1}{2}</div>'.format(cls,item.colorize?colorize(value+'',true):Thelpers.encode(value+''),item.plus))};types.date={};types.date.init=NOOP;types.date.render=function(item,next){var value=self.mapvalue(item);value=value?value.format(item.format||config.dateformat):'';next('<div class="{0}-date">{1}{2}</div>'.format(cls,item.colorize?colorize(value):value,item.plus))};types.bool={};types.bool.init=NOOP;types.bool.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-bool{1}"><span><i class="ti ti-check"></i></span></div>'.format(cls,value?' checked':''))};types.list={};types.list.init=NOOP;types.list.render=function(item,next){var value=self.mapvalue(item);var template='<div class="{0}-list"><span>{1}</span></div>';if(item.detail){AJAX('GET '+item.detail.format(encodeURIComponent(value)),function(response){next(template.format(cls,response[item.dirkey||'name']||item.placeholder||DEF.empty))})}else{var arr=typeof(item.items)==='string'?GET(item.items):item.items;var m=(arr||EMPTYARRAY).findValue(item.dirvalue||'id',value,item.dirkey||'name',item.placeholder||DEF.empty);next(template.format(cls,m))}};types.color={};types.color.init=NOOP;types.color.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-color"><span><b{1}>&nbsp;</b></span></div>'.format(cls,value?(' style="background-color:'+value+'"'):''))};types.fontawesome={};types.fontawesome.init=NOOP;types.fontawesome.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-fontawesome"><i class="{1}"></i></div>'.format(cls,value||''))};types.emoji={};types.emoji.init=NOOP;types.emoji.render=function(item,next){var value=self.mapvalue(item);next('<div class="{0}-emoji">{1}</div>'.format(cls,value||DEF.empty))};self.render=function(item,index){var type=types[item.type==='boolean'?'bool':item.type],c=cls,meta={label:item.label||item.name};if(item.icon){var tmp=item.icon;if(tmp.indexOf(' ')===-1)tmp='ti ti-'+tmp;meta.icon='<i class="{0}"></i>'.format(tmp)}else meta.icon='';var el=$('<div class="{2}-item{3}" data-index="{1}"><div class="{0}-key">{{ icon}}{{ label}}</div><div class="{0}-value">&nbsp;</div></div>'.format(cls,index,c,item.required?(' '+cls+'-required'):'').args(meta));type.render(item,function(html){if(item.note)html+='<div class="{0}-note">{1}</div>'.format(cls,item.note);el.find(cls2+'-value').html(html)});return el};self.configure=function(key,value){if(key==='track')track=value.split(',').trim()};self.setter=function(value,path,type){if(!value)value=EMPTYARRAY;if((type===1||type===2)&&track&&track.length){var tracked=0,diff=path.substring(self.path.length+1);if(diff){for(var i=0;i<track.length;i++){if(path.indexOf(track[i])!==-1){tracked=1;break}}if(tracked!=1)return}}var raw;if(mapping&&value&&value!==EMPTYARRAY){raw=value;for(var i=0;i<mapping.length;i++){var m=mapping[i];m.value=raw}value=mapping}container.empty();var groups={};for(var i=0;i<value.length;i++){var item=value[i];if(raw&&item.show&&!item.show(raw))continue;if(config.notnull&&self.mapvalue(item,true)==null)continue;var g=item.group||config.defaultgroup;if(!groups[g])groups[g]={html:[]};groups[g].html.push(self.render(item,i))}for(var key in groups){var group=groups[key],hash='g'+HASH(key).toString(36);var el=$(('<div class="{0}-group'+(key.length>1?'':' {0}-group-nolabel')+'" data-id="{2}">'+(key.length>1?'<label>{1}</label>':'')+'<section></section></div>').format(cls,key,hash));var section=el.find('section');for(var j=0;j<group.html.length;j++)section.append(group.html[j]);container.append(el)}}});

COMPONENT('directory','minwidth:200;create:Create',function(self,config,cls){var cls2='.'+cls,container,timeout,icon,plus,skipreset=false,skipclear=false,ready=false,input=null,issearch=false,is=false,selectedindex=0,resultscount=0,templateE='{{ name | encode | ui_directory_helper}}',templateR='{{ name | raw}}',template='<li data-index="{{ $.index}}" data-search="{{ $.search}}" class="{{ $.classes}}">{{ if $.checkbox}}<span class="'+cls+'-checkbox"><i class="ti ti-check"></i></span>{{ fi}}{0}</li>',templateraw=template.format(templateR);var regstrip=/(&nbsp;|<([^>]+)>)/ig;var parentclass=null,parentclass2=null,skiphide=false,skipmouse=false,customvalue,search,main;template=template.format(templateE);Thelpers.ui_directory_helper=function(val){var t=this;return self.opt.templatecompiled?self.opt.templatecompiled(this):t.template?(typeof(t.template)==='string'?t.template.indexOf('{{')===-1?t.template:Tangular.render(t.template,this):t.render(this,val)):self.opt.render?self.opt.render(this,val):val};self.template=Tangular.compile(template);self.templateraw=Tangular.compile(templateraw);self.readonly();self.singleton();self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'placeholder':self.find('input').prop('placeholder',value);break}};self.make=function(){self.aclass('hidden '+cls+'-area');self.append('<div class="{1}"><div class="{1}-search"><span class="{1}-add hidden"><i class="ti ti-plus"></i></span><span class="{1}-button"><i class="ti ti-search"></i></span><div><input type="text" placeholder="{0}" class="{1}-search-input" name="dir{2}" spellcheck="false" role="combobox" aria-expanded="true" aria-invalid="false" aria-autocomplete="list" aria-expanded="true" aria-haspopup="false" autocapitalize="off" autocomplete="off" autocorrect="off" /></div></div><div class="{1}-container"><ul></ul></div></div>'.format(config.placeholder,cls,Date.now()));customvalue=$('<li data-index="-2"></li>')[0];main=self.find(cls2);container=self.find('ul');input=self.find('input');icon=self.find(cls2+'-button').find('.ti');plus=self.find(cls2+'-add');search=self.find(cls2+'-search');self.event('mouseenter mouseleave','li',function(){if(ready&&!issearch&&!skipmouse){container.find('li.current').rclass('current');$(this).aclass('current');var arr=container.find('li:visible');for(var i=0;i<arr.length;i++){if($(arr[i]).hclass('current')){selectedindex=i;break}}}});self.element.on('click',function(e){if(e.target===self.dom)self.hide(1)});var skiphidedelay,skipmousedelay,skipmousefalse=function(){skipmousedelay=null;skipmouse=false};var skipmouseforce=function(){skipmouse=true;skipmousedelay&&clearTimeout(skipmousedelay);skipmousedelay=setTimeout(skipmousefalse,500)};self.event('focus','input',function(){skiphide=true;skiphidedelay&&clearTimeout(skiphidedelay);skiphidedelay=setTimeout(function(){skiphide=false},800);if(self.opt.search===false)$(this).blur()});self.event('click',cls2+'-button',function(e){skipclear=false;input.val('');self.search();e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-add',function(){if(self.opt.custom&&self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback(input.val(),self.opt.element,true);self.hide()}});self.event('click','li',function(e){var el=$(this);if(el.hclass('ui-disabled'))return;if(self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);var index=+el.attrd('index');if(index===-2){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback(input.val(),self.opt.element,true);self.hide();return}var item=self.opt.items[index];if(self.opt.checkbox){item.selected=!item.selected;if(item.selected)item.selectedts=Date.now();else delete item.selectedts;el.tclass('selected',item.selected);if(self.opt.checked){var tmpindex=self.opt.checked.indexOf(item.id);if(item.selected){if(tmpindex===-1)self.opt.checked.push(item.id)}else if(tmpindex!==-1)self.opt.checked.splice(tmpindex,1)}var response=null;if(self.opt.checked){response=self.opt.checked.slice(0)}else{response=[];for(var i=0;i<self.opt.items.length;i++){var m=self.opt.items[i];if(m.selected)response.push(m)}}response.quicksort('selectedts');self.opt.callback(response,self.opt.element,false,e)}else self.opt.callback(item,self.opt.element,false,e)}is=true;if(!self.opt.checkbox){self.hide(0);e.preventDefault();e.stopPropagation()}});self.event('keydown','input',function(e){var o=false;switch(e.which){case 8:skipclear=false;break;case 27:o=true;self.hide();break;case 13:o=true;var sel=self.find('li.current');if(!sel.hclass('ui-disabled'))sel.trigger('click');break;case 38:o=true;selectedindex--;if(selectedindex<0)selectedindex=0;self.move();break;case 40:o=true;selectedindex++;if(selectedindex>=resultscount)selectedindex=resultscount;self.move();break}if(o){skipmouseforce();e.preventDefault();e.stopPropagation()}});self.event('input','input',function(){issearch=true;setTimeout2(self.ID,self.search,100,null,this.value)});var fn=function(){is&&!skiphide&&self.hide(1)};self.on('reflow + scroll + resize + resize2',fn);$(W).on('scroll',fn)};self.move=function(){var counter=0,scroller=container.parent();var li=container.find('li');var hli=0,was=false,last=-1,lastselected=0,plus=0;for(var i=0;i<li.length;i++){var el=$(li[i]);if(el.hclass('hidden')){el.rclass('current');continue}var is=selectedindex===counter;el.tclass('current',is);if(is){hli=(el.innerHeight()||30)+1;plus=(hli*2);was=true;var t=(hli*(counter||1));scroller[0].scrollTop=t-plus}counter++;last=i;lastselected++}if(!was&&last>=0){selectedindex=lastselected;li.eq(last).aclass('current')}};var nosearch=function(){issearch=false};self.nosearch=function(){setTimeout2(self.ID+'nosearch',nosearch,500)};self.search=function(value){if(!self.opt)return;icon.tclass('ti-times',!!value).tclass('ti-search',!value);if(self.opt.custom){plus.tclass('hidden',!value);customvalue.innerHTML=(typeof(self.opt.custom)==='string'?self.opt.custom:config.create)+': <b>'+(value?Thelpers.encode(value.toString()):'...')+'</b>'}if(!value&&!self.opt.ajax){if(!skipclear)container.find('li').rclass('hidden');if(!skipreset)selectedindex=0;resultscount=self.opt.items?self.opt.items.length:0;customvalue.classList.toggle('hidden',!value);self.move();self.nosearch();return}resultscount=0;selectedindex=0;if(self.opt.ajax){var val=value||'';if(self.ajaxold!==val){self.ajaxold=val;setTimeout2(self.ID,function(val){self.opt&&self.opt.ajax(val,function(items){if(!self.opt)return;var builder=[],indexer={},item,key=(self.opt.search==true?self.opt.key:(self.opt.search||self.opt.key))||'name';for(var i=0;i<items.length;i++){item=items[i];if(self.opt.exclude&&self.opt.exclude(item))continue;if(self.opt.checked)item.selected=self.opt.checked.indexOf(item.id)!==-1;indexer.index=i;indexer.search=item[key]?item[key].replace(regstrip,''):'';indexer.checkbox=self.opt.checkbox===true;resultscount++;builder.push(self.opt.ta(item,indexer))}if(self.opt.empty){item={};var tmp=self.opt.raw?'<b>{0}</b>'.format(self.opt.empty):self.opt.empty;item[self.opt.key||'name']=tmp;if(!self.opt.raw)item.template='<b>{0}</b>'.format(self.opt.empty);indexer.index=-1;builder.unshift(self.opt.ta(item,indexer))}if(customvalue.parentNode)customvalue.parentNode.removeChild(customvalue);skipclear=true;self.opt.items=items;container.html(builder);if(self.opt.custom){container.prepend(customvalue);customvalue.classList.toggle('hidden',!value)}self.move();self.nosearch()})},300,null,val)}}else if(value){value=value.toSearch().split(' ');var arr=container.find('li');for(var i=0;i<arr.length;i++){var el=$(arr[i]);var val=el.attrd('search')||'';if(!val)continue;val=val.toSearch();var is=false;for(var j=0;j<value.length;j++){if(val.indexOf(value[j])===-1){is=true;break}}el.tclass('hidden',is);if(!is)resultscount++}customvalue.classList.toggle('hidden',!value);skipclear=true;self.move();self.nosearch()}};self.show=function(opt){if(opt.checked==true)opt.checked=[];var el=opt.element instanceof jQuery?opt.element[0]:opt.element;if(opt.items==null)opt.items=[];self.tclass(cls+'-default',!opt.render);if(opt.classname){main.aclass(opt.classname);parentclass=opt.classname}if(opt.class){main.aclass(opt.class);parentclass2=opt.class}if(!opt.minwidth)opt.minwidth=config.minwidth;if(is){clearTimeout(timeout);if(self.target===el){self.hide(1);return}}if(opt.template)opt.templatecompiled=Tangular.compile(opt.template);self.initializing=true;self.target=el;opt.ajax=null;self.ajaxold=null;var element=opt.element?$(opt.element):null;var callback=opt.callback,items=opt.items,type=typeof(items);var item;if(type==='string'){items=opt.items=GET(items);type=typeof(items)}if(type==='function'&&callback){type='';opt.ajax=items;items=null}if(!items&&!opt.ajax){self.hide(0);return}self.tclass(cls+'-search-hidden',opt.search===false);self.opt=opt;opt.class&&main.aclass(opt.class);skiphide=true;input.val('');var builder=[],selected=null;opt.ta=opt.key?Tangular.compile((opt.raw?templateraw:template).replace(/\{\{\sname/g,'{{ '+opt.key)):opt.raw?self.templateraw:self.template;if(!opt.ajax){var indexer={},key=(opt.search==true?opt.key:(opt.search||opt.key))||'name';for(var i=0;i<items.length;i++){item=items[i];if(typeof(item)==='string')item={name:item,id:item,selected:item===opt.selected};if(opt.exclude&&opt.exclude(item))continue;if(item.selected||opt.selected===item){selected=i;skipreset=true;item.selected=true}else item.selected=false;if(opt.checked&&item.selected)opt.checked.push(item.id);var c='';if(item.selected)c+=(c?' ':'selected current');if(item.classname)c+=(c?' ':item.classname);if(item.disabled)c+=(c?' ':'ui-disabled');indexer.classes=c;indexer.checkbox=opt.checkbox===true;indexer.index=i;indexer.search=item[key]?item[key].replace(regstrip,''):'';builder.push(opt.ta(item,indexer))}if(opt.empty){item={};var tmp=opt.raw?'<b>{0}</b>'.format(opt.empty):opt.empty;item[opt.key||'name']=tmp;if(!opt.raw)item.template='<b>{0}</b>'.format(opt.empty);indexer.index=-1;builder.unshift(opt.ta(item,indexer))}}self.target=element?element[0]:null;var w=element?element.width():config.minwidth;var offset=element?element.offset():EMPTYOBJECT;var width=w+(opt.offsetWidth||0);if(opt.minwidth&&width<opt.minwidth)width=opt.minwidth;else if(opt.maxwidth&&width>opt.maxwidth)width=opt.maxwidth;ready=false;opt.ajaxold=null;plus.aclass('hidden');self.find('input').prop('placeholder',opt.placeholder||config.placeholder);var scroller=self.find(cls2+'-container').css('width',width+30);if(customvalue.parentNode)customvalue.parentNode.removeChild(customvalue);container.html(builder);if(opt.custom)container.prepend(customvalue);var options={left:0,top:0,width:width},height=opt.height||scroller.height();scroller.css('height',opt.height||'');if(opt.element){switch(opt.align){case'center':options.left=Math.ceil((offset.left-width/2)+(opt.element.innerWidth()/2));break;case'right':options.left=(offset.left-width)+opt.element.innerWidth();break;default:options.left=offset.left;break}options.top=opt.position==='bottom'?((offset.top-height)+element.height()):offset.top}else{options.top=opt.y;options.left=opt.x}options.scope=M.scope?M.scope():'';if(opt.offsetX)options.left+=opt.offsetX;if(opt.offsetY)options.top+=opt.offsetY;var mw=width,mh=scroller.height();if(options.left<0)options.left=10;else if((mw+options.left)>WW)options.left=(WW-mw)-10;mh+=search.height();if($(W).scrollTop()===0){if((mh+options.top)>WH)options.top=(WH-mh)-10}if(options.top<10)options.top=10;main.css(options);!isMOBILE&&setTimeout(function(){if(opt.search!==false)input.focus()},200);setTimeout(function(){self.initializing=false;skiphide=false;is=true;if(selected){var h=container.find('li:first-child').innerHeight()+1;var y=(container.find('li.selected').index()*h)-(h*2);scroller[0].scrollTop=y<0?0:y}else scroller[0].scrollTop=0;ready=true;self.rclass('invisible')},100);if(is){self.search();return}selectedindex=selected||0;resultscount=items?items.length:0;skipclear=true;self.search();self.aclass('invisible');self.rclass('hidden');setTimeout(function(){if(self.opt&&((self.opt.x!=null&&self.opt.y!=null)||(self.target&&self.target.offsetParent)))main.aclass(cls+'-visible');else self.hide(1)},100);skipreset=false};self.hide=function(sleep){if(!is||self.initializing)return;clearTimeout(timeout);timeout=setTimeout(function(){self.rclass(cls+'-visible').aclass('hidden');if(parentclass){main.rclass(parentclass);parentclass=null}if(parentclass2){main.rclass(parentclass2);parentclass2=null}if(self.opt){self.opt.close&&self.opt.close();self.opt=null}is=false},sleep?sleep:100)}});

COMPONENT('display','delay:100;xs:768;sm:992;md:1200',function(self,config,cls){var initialized=false,sizes={},prev;self.readonly();self.make=function(){self.aclass(cls);self.resizeforce();self.on('resize + resize2',self.resize)};self.resizeforce=function(){var width=self.element.width();var size='lg';if(width<=config.xs)size='xs';else if(width<=config.sm)size='sm';else if(width<=config.md)size='md';if(!prev||prev.substring(3)!==size){prev&&self.rclass(prev);prev=(M.version<19?'jc-':'d-')+size;self.aclass(prev);self.path&&self.set(size);if(!initialized){initialized=true;self.rclass('invisible hidden')}}};self.resize=function(){setTimeout2(self.ID,self.resizeforce,config.delay)}});

COMPONENT('drawzone','height:200;zoom:13;stroke:2;radius:7;color:#fcba03;readonly:0;opacity:40;margin:0;geolocation:1;center:48.73702478789267,19.137712002562715',function(self,config,cls){var meta={points:[],zoom:config.zoom,color:config.color},skip=false;self.nocompile();self.meta=meta;self.validate=function(value){return(config.disabled||!config.required)?true:value&&value.points&&value.points.length>0};self.destroy=function(){for(var m of meta.points)m.remove();meta.points=null;meta.map=null;meta.polygon=null;meta.source=null;meta.view=null};self.make=function(){self.aclass(cls);self.append('<div style="height:{height}px"></div>'.args(config));meta.container=self.find('div')[0];var extent=new ol.proj.get('EPSG:3857').getExtent().slice();extent[0]+=extent[0];extent[2]+=extent[2];var tile=new ol.layer.Tile({source:new ol.source.OSM()});tile.on('prerender',function(e){if(config.filter){var ctx=e.context;ctx.canvas.style.filter=config.filter;ctx.globalCompositeOperation='source-over'}});meta.view=new ol.View({center:[0,0],zoom:config.zoom,extent});meta.map=new ol.Map({layers:[tile],target:meta.container,view:meta.view});meta.map.on('moveend',function(){var zoom=meta.view.getZoom()>>0;if(meta.zoom!==zoom){meta.zoom=zoom;var model=self.get();if(model){model.zoom=zoom;self.change(true)}}});self.on('resize + resize2',self.resize);self.resize()};self.resize=function(){setTimeout2(self.ID,self.resizeforce,300)};self.resizeforce=function(){var container=$(meta.container);var height=config.height;if(config.parent){var parent=self.parent(config.parent);var tmp=parent.height()-config.margin;if(height<tmp)height=tmp}container.css('height',height)};self.export=function(opt,callback){var opacity=opt.opacity||config.opacity;if(opacity)opacity=opacity/100;if(callback)opt.callback=callback;var picture=document.createElement('canvas');var div=document.createElement('DIV');var extent=new ol.proj.get('EPSG:3857').getExtent().slice();extent[0]+=extent[0];extent[2]+=extent[2];div.style='width:{width}px;height:{height}px;position:absolute;visibility:hidden;zindex:0;left:-{width}px;top:-{height}px'.args(opt);document.body.appendChild(div);var view=new ol.View({center:[0,0],zoom:opt.zoom||13,extent,duration:0});var map=new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.OSM()})],controls:[],target:div,view:view});var polygon=self.createpolygon(opt.points,opt.color||config.color,opt.radius||config.radius);map.addLayer(polygon);view.fit(polygon.getSource().getFeatures()[0].getGeometry());opt.zoom&&view.animate({zoom:opt.zoom,duration:0});picture.width=opt.width;picture.height=opt.height;var ctx=picture.getContext('2d');ctx.globalAlpha=1;ctx.setTransform(1,0,0,1,0,0);map.renderSync();setTimeout(function(){var nodes=map.getViewport().querySelectorAll('.ol-layer canvas, canvas.ol-layer');for(var canvas of nodes){if(canvas.width>0){var opacity=opt.opacity,transform=canvas.style.transform,matrix;ctx.globalAlpha=opacity===''?1:Number(opacity);if(transform){matrix=transform.match(/^matrix\(([^\(]*)\)$/)[1].split(',').map(Number)}else matrix=[parseFloat(canvas.style.width)/canvas.width,0,0,parseFloat(canvas.style.height)/canvas.height,0,0];CanvasRenderingContext2D.prototype.setTransform.apply(ctx,matrix);var bgcolor=canvas.parentNode.style.backgroundColor;if(bgcolor){ctx.fillStyle=bgcolor;ctx.fillRect(0,0,canvas.width,canvas.height)}ctx.drawImage(canvas,0,0)}}opt.callback(picture.toDataURL(opt.type==='jpg'||opt.type==='jpeg'?'image/jpeg':'image/png',opt.quality));var layers=map.getAllLayers();for(var m of layers)map.removeLayer(m);map=null;setTimeout(()=>document.body.removeChild(div),1000)},1000)};self.modify=function(){meta.modify&&meta.map.removeInteraction(meta.modify);meta.modify=null;if(config.readonly||!meta.polygon)return;meta.modify=new ol.interaction.Modify({source:meta.polygon.getSource(),deleteCondition:e=>ol.events.condition.doubleClick(e)});meta.modify.on('modifyend',function(e){self.coords(e.features.item(0));meta.zoom=meta.view.getZoom()>>0});meta.map.addInteraction(meta.modify)};self.draw=function(){meta.draw&&meta.map.removeInteraction(meta.draw);meta.draw=null;if(config.readonly)return;meta.draw=new ol.interaction.Draw({source:meta.source,type:'Polygon',style:meta.style});meta.map.addInteraction(meta.draw);meta.draw.on('drawend',function(e){meta.map.removeInteraction(meta.draw);meta.zoom=meta.view.getZoom()>>0;meta.draw=null;self.coords(e.feature)})};self.center=function(){meta.view.fit(meta.polygon.getSource().getFeatures()[0].getGeometry());meta.view.animate({zoom:meta.zoom,duration:250})};self.createpolygon=function(arr,color,radius){var points=[];for(var item of arr)points.push(ol.proj.transform([item.lng,item.lat],'EPSG:4326','EPSG:3857'));var source=new ol.source.Vector({});var feature=new ol.Feature({geometry:new ol.geom.Polygon([points])});source.addFeature(feature);var polygon=new ol.layer.Vector({source:source,style:[meta.style,new ol.style.Style({image:new ol.style.Circle({radius:radius||3,fill:new ol.style.Fill({color:color})}),geometry:function(feature){var coordinates=feature.getGeometry().getCoordinates()[0];return new ol.geom.MultiPoint(coordinates)}})]});return polygon};self.coords=function(feature){var p=feature.getGeometry();var format=new ol.format.WKT();var wkt=format.writeGeometry(p.transform(ol.proj.get('EPSG:3857'),ol.proj.get('EPSG:4326')));var center=ol.extent.getCenter(p.getExtent());var tmp=wkt.replace('POLYGON((','').replace('))','').split(',');var arr=[];p.transform(ol.proj.get('EPSG:4326'),ol.proj.get('EPSG:3857'));for(var item of tmp){var tmpitem=item.split(' ');var latlng={};latlng.lat=+tmpitem[1];latlng.lng=+tmpitem[0];arr.push(latlng)}var obj=self.get()||{};obj.zoom=meta.view.getZoom()>>0;obj.color=obj.color||config.color;obj.points=arr;obj.center={lat:center[1],lng:center[0]};self.clear(false,true);meta.polygon=self.createpolygon(arr,obj.color,config.radius);meta.map.addLayer(meta.polygon);self.bind('@modified @touched',obj);if(!config.readonly){config.exec&&self.EXEC(config.exec,obj,self);self.modify()}};self.clear=function(draw,noreset){var layers=meta.map.getAllLayers();for(var i=1;i<layers.length;i++)meta.map.removeLayer(layers[i]);meta.draw&&meta.map.removeInteraction(meta.draw);meta.draw=null;meta.polygon=null;if(!noreset){var obj=self.get();obj.points=[];self.bind('@modified @touched',obj)}draw&&self.draw()};self.move=function(lat,lng){meta.view.setCenter(ol.proj.fromLonLat([lng,lat],'EPSG:3857'))};self.setter=function(value){if(skip){skip=false;return}self.clear(false,true);var refresh=false;if(!value){value={points:[]};refresh=true}var color=value.color||config.color,zoom=value.zoom||config.zoom;value.zoom=zoom;value.color=color;meta.style={'fill-color':color+config.opacity,'stroke-color':color,'stroke-width':config.stroke,'circle-radius':config.radius,'circle-fill-color':color,};var view=meta.view;if(value.points&&value.points.length){meta.polygon=self.createpolygon(value.points,color,config.radius);meta.map.addLayer(meta.polygon);if(value.center){view.setCenter(ol.proj.fromLonLat([value.center.lng,value.center.lat],'EPSG:3857'));view.setZoom(zoom)}else setTimeout(self.center,800)}else{var arr;if(value.center){arr=[value.center.lat,value.center.lng]}else{arr=config.center.split(',');arr[0]=arr[0].parseFloat();arr[1]=arr[1].parseFloat()}view.setCenter(ol.proj.fromLonLat([arr[1],arr[0]],'EPSG:3857'));view.setZoom(zoom);self.draw()}if(!config.readonly)self.modify();if(refresh){skip=true;self.update(true)}}},['https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js','https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css']);

COMPONENT('dropfiles',function(self,config,cls){self.readonly();self.singleton();self.nocompile();var has=false,is=false,events='dragenter dragover dragexit drop dragleave',check=null,hide=function(){is=false;self.rclass(cls+'-visible');config.class&&has&&self.rclass('over');has&&$('body').rclass(cls+'-enabled');has=false;check=null};self.destroy=function(){$(W).off(events,self.filehandler)};self.make=function(){self.aclass(cls).rclass('hidden');self.element.wrapInner('<div><div></div></div>');$(W).on(events,self.filehandler)};self.filehandler=function(e){if(config.check){if(!check)check=GET(self.makepath(config.check));if(check&&!check(e)){hide();return}}if(config.disabled)return;if(e.type==='dragenter'){is=e.originalEvent.dataTransfer.types.includes('Files');self.tclass(cls+'-visible',is);$('body').tclass(cls+'-enabled',is)}if(!is)return;e.stopPropagation();e.preventDefault();switch(e.type){case'drop':break;case'dragenter':case'dragover':has=true;return;case'dragleave':case'dragexit':default:if(is&&e.target===self.dom)setTimeout2(self.ID,hide,300);return}hide();self.EXEC(config.exec,e.originalEvent.dataTransfer.files,e)}});

COMPONENT('edit','dateformat:yyyy-MM-dd;padding:10;floating:0',function(self,config,cls){var cls2='.'+cls,events={},floating;self.readonly();self.singleton();var findfn=function(opt,path){if(path.charAt(0)==='@'){var com=opt.element.component();return com?com[path.substring(1)]:null}else return GET(opt.scope?opt.scope.makepath(path):path)};self.parse=function(el){var t=el[0];if(t.$edit)return t.$edit;var opt=(el.attrd('edit')||'').parseConfig();opt.scope=opt.plugin=M.is20?el.plugin():el.scope();opt.html=el.html();if(opt.type)opt.type=opt.type.toLowerCase();if(opt.type==='date'&&!opt.format)opt.format=config.dateformat;if(opt.offsetX==null)opt.offsetX=config.offsetX;if(opt.offsetY==null)opt.offsetY=config.offsetY;if(opt.floating==null)opt.floating=config.floating;if(opt.check){opt.checkforce=function(el){var opt=el[0].$edit,path=opt.scope?opt.scope.makepath(opt.check):opt.check;var fn=findfn(opt,path);return fn?fn(opt,el):NOOP}}if(opt.focus&&opt.scope)opt.focus=opt.scope.makepath(opt.focus);if(opt.blur&&opt.scope)opt.blur=opt.scope.makepath(opt.blur);t.$edit=opt;return opt};self.movecursor=function(el,beg){var range,selection,doc=document;if(doc.createRange){range=doc.createRange();range.selectNodeContents(el[0]);range.collapse(beg?true:false);selection=W.getSelection();selection.removeAllRanges();selection.addRange(range)}else if(doc.selection){range=doc.body.createTextRange();range.moveToElementText(el[0]);range.collapse(beg?true:false);range.select()}};self.focusnext=function(el,e){el=$(el);var parent=el[0];for(var i=0;i<12;i++){parent=parent.parentNode;if(parent===document.body)break}var arr=$(parent).find('.edit,.edit2');for(var i=0;i<arr.length;i++){if(arr[i]===el[0]){var next=arr[i+1];e&&e.preventDefault();next&&self.edit($(next));return true}}};self.make=function(){self.aclass(cls);self.append('<div class="{0}-window hidden"></div>'.format(cls));floating=self.find(cls2+'-window');$(document).on('click','.edit',self.edit).on('dblclick','.edit2',self.edit);events.keydown=function(e){var t=this;if(!t.$editevents)return;var keydown=e.type==='keydown',meta=t.$edit;if(meta.clear){t.innerHTML='';meta.clear=0}if(keydown){if(!meta.keypressed){meta.keypressed=1;$(t).aclass('edit-keypressed')}if((e.metaKey||e.ctrlKey)&&(e.which===66||e.which===76||e.which===73||e.which===85)){if(meta.type!=='html'){e.preventDefault();e.stopPropagation()}}}var el;if(!keydown&&e.which===27){el=$(t);t.$edit.is=false;self.detach(el);return}if(e.which===13||e.which===9){if(e.which===13&&meta.multiline)return;e.preventDefault();if(!keydown){el=$(t);if(self.approve(el)){self.detach(el);el.rclass('edit-keypressed');if(e.which===9&&self.focusnext(t,e))return}else self.detach(el)}}};events.blur=function(){var t=this;if(t.$editevents){var el=$(t);el.rclass('edit-keypressed');t.$edit.is&&self.approve(el);self.detach(el)}};events.paste=function(e){e.preventDefault();e.stopPropagation();var meta=this.$edit,text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');text&&document.execCommand('insertText',false,meta.multiline?text.trim():text.replace(/\n|\r/g,'').trim())}};self.edit=function(e){var is=e instanceof jQuery,t=is?e:this;if(!is){e.preventDefault();e.stopPropagation()}if(t.$edit&&t.$edit.is)return;var el=$(t);var opt=self.parse(el);if(!opt||(opt.checkforce&&!opt.checkforce(el)))return;if(opt.prevent){e.preventDefault();e.stopPropagation()}var value=opt.attr?el.attrd(opt.attr):el.html();var empty=false;if(opt.attr)opt.html=el.html();else opt.html=value;var jcbind=el[0].$jcbind||{};if(jcbind.empty&&jcbind.empty==el[0].innerText){empty=true}if(opt.floating){var target=opt.parent?(opt.parent==='parent'?el.parent():el.closest(opt.parent)):el;var offset=opt.floating==='position'?target.position():target.offset();var width=opt.width||(target.width()+(config.padding*2)+(opt.offsetWidth||0));if(width<config.minwidth)width=config.minwidth;var align=opt.align||'';floating.css({width:width,left:(offset.left-config.padding)+(opt.offsetX||0),top:(offset.top-config.padding)+(opt.offsetY||0),font:el.css('font'),'text-align':align});floating.html(empty?'':value);floating.rclass('hidden');floating[0].$edit=opt}else{floating.aclass('hidden');delete floating[0].$edit;if(opt.attr)el.text(value);empty&&el.empty()}opt.is=true;opt.keypressed=0;opt.element=el;opt.set=function(value){var el=this.element;this.html='';if(opt.attr)el.attrd(opt.attr,value);el.html(value);if(self.approve(el))self.detach(el)};self.attach(opt.floating?floating:el)};self.approve=function(el){var opt=el[0].$edit,cur=el.html();if(opt.html===cur)return true;var val=cur;if(opt.type!=='html'){var area=document.createElement('TEXTAREA');area.innerHTML=val;val=$(area).text();val=val.replace(/<br(\s\/)?>/g,opt.multiline?'\n':'').trim()}if(opt.maxlength&&val.length>opt.maxlength)val=val.substring(0,opt.maxlength);opt.value=val;switch(opt.type){case'number':opt.value=opt.value?opt.value.parseFloat():0;if((opt.minvalue!=null&&opt.value<opt.minvalue)||(opt.maxvalue!=null&&opt.value>opt.maxvalue))return false;break;case'phone':if(opt.required){if(!opt.value.isPhone())return false}else if(opt.value&&!opt.value.isPhone())return false;break;case'url':if(opt.required){if(!opt.value.isURL())return false}else if(opt.value&&!opt.value.isURL())return false;break;case'email':if(opt.required){if((!opt.value||!opt.value.isEmail()))return false}else if(opt.value&&!opt.value.isEmail())return false;break;case'date':if(!opt.empty){opt.value=opt.value?opt.value.parseDate(opt.format):null;if(opt.required&&!opt.value)return false}break;default:if(opt.required&&!opt.value)return false;break}self.save(el);return true};self.save=function(el){var opt=el[0].$edit,fn=opt.exec||opt.save||config.exec;if(fn){fn=findfn(opt,fn);if(typeof(fn)==='function'){opt.detached=true;fn(opt,function(body){if(body==null||body===false)opt.value=opt.html;else if(body!==true)opt.value=body+'';opt.element.html(opt.value+'');opt.notify&&EXEC(opt.scope?opt.scope.makepath(opt.notify):opt.notify,opt)});return}}if(!opt.nobind&&opt.bind!==true){setTimeout(function(){var b=opt.element.binder();if(b){b.disabled=true;b.exec(opt.value,b.path);SET(b.path,opt.value,2);b.disabled=false;opt.notify&&EXEC(opt.scope?opt.scope.makepath(opt.notify):opt.notify,opt)}},100)}};self.attach=function(el){if(!el[0].$editevents){var o=el[0].$edit;el[0].$editevents=true;el.aclass('edit-open'+(o.multiline?' edit-multiline':''));el.on('keydown',events.keydown);el.on('keyup',events.keydown);el.on('blur',events.blur);el.on('paste',events.paste);el.attr('contenteditable',true);o.focus&&EXEC(o.focus,o,el);el.focus();if(o.clear||o.cursor==='beg'||o.cursor==='begin')setTimeout(self.movecursor,10,el,1);else self.movecursor(el,0);if(o.select||o.selectall)setTimeout(()=>document.execCommand('selectAll',false,null),20)}};self.detach=function(el){if(el[0].$editevents){el.off('keydown',events.keydown);el.off('blur',events.blur);el.off('paste',events.paste);el[0].$editevents=false;if(el[0]===floating[0])floating.aclass('hidden');var opt=el[0].$edit;if(!opt.detached&&opt.html!=null)opt.element.html(opt.html);delete opt.detached;opt.is=false;el.rclass('edit-open edit-multiline');el.attr('contenteditable',false);opt.blur&&EXEC(opt.blur,opt,el)}}});

COMPONENT('empty','icon:ti ti-database;parent:parent;margin:0;wait:1',function(self,config,cls){var visible=false,special=false,table;self.readonly();self.make=function(){self.aclass(cls);var scr=self.find('> scri'+'pt,> template');var text=scr.length?scr.html():self.html();var html='<div class="{0}-table hidden"><div class="{0}-cell"><i class="{1}"></i><div>{2}</div></div></div>'.format(cls,config.icon,text);if(scr.length){special=true;scr.remove();self.element.prepend(html)}else self.html(html);table=self.find('> .'+cls+'-table');self.on('resize2 + resize',function(){if(!visible)self.resize()});self.rclass('hidden invisible')};self.resize=function(){setTimeout2(self.ID,self.resizeforce,300)};self.resizeforce=function(){if(visible)return;if(config.height){table.css('height',config.height);table.tclass('hidden',visible);return}var parent=self.parent(config.parent);var wh=parent.height()-10;if(config.topoffset)wh-=self.element.offset().top;if(config.topposition)wh-=self.element.position().top;table.css('height',wh<100?'auto':wh-config.margin);table.rclass('hidden')};self.setter=function(value,path,flags){if(!value&&config.wait&&(flags===0||flags.init))return;visible=false;if(value instanceof Array)visible=!!value.length;else if(value)visible=value.items&&!!value.items.length;if(visible)table.aclass('hidden');else self.resize();if(special){for(var i=1;i<self.dom.children.length;i++)$(self.dom.children[i]).tclass('hidden',!visible)}}});

COMPONENT('emptyinline','icon:ti ti-ban',function(self,config,cls){self.make=function(){self.aclass(cls+' hidden');config.icon&&self.element.prepend('<i class="{icon}"></i>'.args(config))};self.setter=function(value){self.tclass('hidden',value instanceof Array?value.length>0:!!value)}});

COMPONENT('enter','validate:1;trigger:button[name="submit"];flags:visible;timeout:1500;delay:500',function(self,config){var delay=null,flags,submit=function(btn){delay=null;if(btn)btn.trigger('click');else self.EXEC(config.exec,self)};self.readonly();self.make=function(){var isvalid=function(){var arr=COMPONENTS(self.path);var modified=false,disabled=false;for(var m of arr){if(m===self)continue;if(config.validonly){if(m.config.invalid){disabled=true;break}}else if(m.config.invalid){disabled=true;break}else if(m.config.modified)modified=true}return modified&&!disabled};self.event('keydown','input',function(e){if(e.which===13&&(!config.validate||!self.path||isvalid())){if(config.exec){if(!BLOCKED(self.ID,config.timeout)){delay&&clearTimeout(delay);delay=setTimeout(submit,config.delay)}}else{var btn=self.find(config.trigger);if(!btn.prop('disabled')){if(!BLOCKED(self.ID,config.timeout)){delay&&clearTimeout(delay);delay=setTimeout(submit,config.delay,btn)}}}}})};self.configure=function(key,value){switch(key){case'flags':if(value){flags=value.split(',');for(var i=0;i<flags.length;i++)flags[i]='@'+flags[i]}else flags=null;break}}});

COMPONENT('errorhandler','keywords:401=login',function(self,config){self.readonly();self.singleton();self.nocompile();self.blind();self.make=function(){var keywords=config.keywords?config.keywords.split(','):EMPTYARRAY;for(var i=0;i<keywords.length;i++)keywords[i]=keywords[i].split('=');self.on('ERROR',function(err){if(err instanceof Error)err=[{error:err.message}];else if(!(err instanceof Array))err=[{error:err.error||err.message||err.err}];var arr=[],response={};for(var m of err){if(!m.error)continue;for(var k of keywords){if((m.name&&m.name.indexOf(k[0])!==-1)||m.error.indexOf(k[0])!==-1)response[k[1]]=true}arr.push(m.error.toString().encode())}response.items=arr;if(config.exec){response.message=arr.join('<br />');self.SEEX(config.exec,response)}else{var name=self.caniuse('message')?'message':self.caniuse('notify')?'notify':self.caniuse('notifybar')?'notifybar':self.caniuse('snackbar')?'snackbar':'';if(name)SETTER(name+'/warning',response.items.join('<br />'));else if(W.console)console.error('ERROR():',response.items.join('<br />'))}SETTER('!loading/hide',100)})}});

COMPONENT('exec',function(self,config){var regparent=/\?\d/,extensions=[],skiptimeout=null;self.readonly();self.blind();self.singleton();self.register=function(fn){extensions.push(fn)};self.make=function(){var fn=function(plus,forceprevent){return function execlick(e){var el=$(this);if(!plus&&skiptimeout)return;if(!e.$force&&!plus&&el.hclass('exec2')){skiptimeout&&clearTimeout(skiptimeout);skiptimeout=setTimeout(function(ctx,e){skiptimeout=null;e.$force=true;execlick.call(ctx,e)},300,this,e);return}var attr=el.attrd('exec'+plus);var href=el.attrd('href'+plus);if(skiptimeout){clearTimeout(skiptimeout);skiptimeout=null}var prevent=forceprevent?'1':el.attrd('prevent'+plus);if(prevent==='true'||prevent==='1'){e.preventDefault();e.stopPropagation()}if(attr){if(extensions.length){for(var ext of extensions){if(ext(attr,el,e,plus))return}}if(M.is20){el.EXEC(attr,el,e)}else{if(attr.includes('?'))attr=el.scope().makepath(attr);EXEC(attr,el,e)}}href&&REDIRECT(href)}};var el=$(document.body);el.on('contextmenu',config.selector3||'.exec3',fn('3',true));el.on('dblclick',config.selector2||'.exec2',fn('2'));el.on('click',config.selector||'.exec',fn(''))}});

COMPONENT('expander','height:150;iconup:ti-angle-double-up;icondown:ti-angle-double-down',function(self,config,cls){var cls2='.'+cls;self.readonly();self.toggle=function(v){if(v==null)v=!self.hclass(cls+'-expanded');self.tclass(cls+'-expanded',v);var ti=self.find(cls2+'-button').find('.ti');ti.tclass(config.icondown,!v);ti.tclass(config.iconup,v)};self.make=function(){self.aclass(cls+(config.expand?(' '+cls):''));self.element.wrapInner('<div class="{0}-container" style="max-height:{1}px"><div class="{0}-nodes"></div></div>'.format(cls,config.height));self.append('<div class="'+cls+'-fade"></div><div class="'+cls+'-button"><span class="ti {0}"></span></div>'.format(config.icondown));self.event('click',cls2+'-button',()=>self.toggle());self.resizeforce();self.resize()};self.resizeforce=function(){let height=self.find(cls2+'-nodes').height();self.tclass(cls+'-visible',height>config.height)};self.resize=function(){setTimeout2(self.ID,self.resizeforce,300)};self.setter=function(){self.resize()}});

COMPONENT('expansionpanel','multiple:0;icon:ti ti-caret-right',function(self,config,cls){var cls2='.'+cls,open=[],manual=false;self.make=function(){self.aclass(cls);self.find('> section').aclass('hidden').each(function(){let parent=this.parentNode;let el=$(this);let div=document.createElement('DIV');let label=document.createElement('LABEL');el.aclass('hidden');div.classList.add(cls+'-item');let icon=el.attrd('icon')||config.icon;label.classList.add(cls+'-label');label.innerHTML='<i class="{0}"></i>'.format(icon)+(el.attr('title')||el.attrd('name'));div.appendChild(label);div.appendChild(this);parent.appendChild(div)});self.event('click',cls2+'-label',function(e){let el=$(this).parent();let section=el.find('> section');let id=section.attrd('id');if(section.hclass('hidden')){if(config.multiple)open.push(id);else open=[id]}else open.splice(open.indexOf(id),1);self.bind('@touched @modified @setter',config.multiple?open:(open[0]||null))})};self.setter=function(value){var selected=value instanceof Array?value:value?[value]:[];self.find(cls2+'-item').each(function(){let item=$(this);let el=item.find('> section');let id=el.attrd('id');let is=selected.includes(id);el.tclass('hidden',!is);item.tclass('selected',is)});self.rclass('invisible hidden')}});

COMPONENT('extend',function(self,config,cls){self.readonly();self.make=function(){self.aclass(cls);var opt={};opt.name=config.name;opt.type=config.type;opt.element=self.element;opt.dom=self.dom;opt.component=self;opt.path=self.path;opt.name&&EMIT('extend_'+opt.name,opt);EMIT('extend',opt)}});

COMPONENT('features','height:35',function(self,config,cls){var cls2='.'+cls,container,timeout,input,search,scroller=null,is=false,results=false,selectedindex=0,resultscount=0;self.oldsearch='';self.items=null;self.template=Tangular.compile('<li data-search="{{ $.search}}" data-index="{{ $.index}}"{{ if selected}} class="selected"{{ fi}}>{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ name | raw}}</li>');self.callback=null;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'placeholder':self.find('input').prop('placeholder',value);break}};self.make=function(){self.aclass(cls+'-layer hidden');self.append('<div class="{1}"><div class="{1}-search"><span><i class="ti ti-search"></i></span><div><input type="text" placeholder="{0}" class="{1}-search-input" /></div></div><div class="{1}-scrollbar"><div class="{1}-container"><ul></ul></div></div></div>'.format(config.placeholder,cls));container=self.find('ul');self.scrollbar=SCROLLBAR(self.find(cls2+'-scrollbar'),{visibleY:true,orientation:'y'});input=self.find('input');search=self.find(cls2);scroller=self.find(cls2+'-container');self.event('click','li[data-index]',function(e){self.callback&&self.callback(self.items[+this.getAttribute('data-index')]);self.hide();e.preventDefault();e.stopPropagation()});$(document).on('touchstart mousedown',function(e){if(is&&e.target.tagName!=='INPUT'&&!container[0].contains(e.target))self.hide(0)});$(W).on('resize',function(){is&&self.hide(0)});self.event('keydown','input',function(e){var o=false;switch(e.which){case 27:o=true;self.hide();break;case 13:o=true;var sel=self.find('li.selected');if(sel.length&&self.callback)self.callback(self.items[+sel.attrd('index')]);self.hide();break;case 38:o=true;selectedindex--;if(selectedindex<0)selectedindex=0;else self.move();break;case 40:o=true;selectedindex++;if(selectedindex>=resultscount)selectedindex=resultscount;else self.move();break}if(o&&results){e.preventDefault();e.stopPropagation()}});self.event('keyup','input',function(){setTimeout2(self.id,self.search,100,null,this.value)})};self.search=function(value){if(!value){if(self.oldsearch===value)return;self.oldsearch=value;selectedindex=0;results=true;resultscount=self.items.length;container.find('li').rclass('hidden selected');self.move();return}if(self.oldsearch===value)return;self.oldsearch=value;value=value.toSearch().split(' ');results=false;resultscount=0;selectedindex=0;var li=container.find('li');for(var j=0;j<li.length;j++){var el=$(li[j]);var val=el.attrd('search');var h=false;for(var i=0;i<value.length;i++){if(val.indexOf(value[i])===-1){h=true;break}}if(!h){results=true;resultscount++}el.tclass('hidden',h);el.rclass('selected')}self.scrollbar.resize();self.move()};self.move=function(){var counter=0,h=scroller.css('max-height').parseInt();var li=container.find('li');for(var i=0;i<li.length;i++){var el=$(li[i]);if(el.hclass('hidden'))continue;var is=selectedindex===counter;el.tclass('selected',is);if(is){var t=(config.height*counter)-config.height;if((t+config.height*5)>h)self.scrollbar.scrollTop(t);else self.scrollbar.scrollTop(0)}counter++}};self.open=self.show=function(opt,callback){if(opt.scrolltop){selectedindex=0;self.scrollbar.scrollTop(0)}if(opt instanceof Array)self.render.apply(self.arguments);else self.render(opt.items,opt.callback||callback,opt.placeholder)};self.render=function(items,callback,placeholder){if(is){clearTimeout(timeout);self.hide(0);return}self.find('input').prop('placeholder',placeholder==null?config.placeholder:placeholder);var type=typeof(items);var item;if(type==='string')items=self.get(items);if(!items){self.hide(0);return}self.items=items;self.callback=callback;results=true;resultscount=self.items.length;input.val('');var builder=[],indexer={};for(var i=0;i<items.length;i++){item=items[i];indexer.index=i;indexer.search=(item.name+' '+(item.keywords||'')).trim().toSearch();item.icon=self.icon(item.icon);!item.value&&(item.value=item.name);builder.push(self.template(item,indexer))}container.html(builder);var w=$(W);var top=((w.height()/2)-(search.height()/2))-self.scrollbar.element.height();var options={top:top,left:(w.width()/2)-(search.width()/2)};search.css(options);self.move();if(is)return;isMOBILE&&self.find(cls2).css({left:'30px',width:WW-(30*2)});self.rclass('hidden');self.aclass(cls+'-visible',100);!isMOBILE&&setTimeout(function(){input.focus()},500);is=true;$('html,body').aclass(cls+'-noscroll')};self.hide=function(sleep){if(!is)return;clearTimeout(timeout);timeout=setTimeout(function(){self.aclass('hidden').rclass(cls+'-visible');self.callback=null;self.target=null;is=false;$('html,body').rclass(cls+'-noscroll')},sleep?sleep:100)}});

COMPONENT('filebrowser',function(self){var input;self.singleton();self.readonly();self.nocompile();self.open=self.show=self.browse=function(opt,callback){if(!opt.callback&&callback)opt.callback=callback;self.opt=opt;self.find('input').attr('accept',opt.accept||'*/*').prop('multiple',!!opt.multiple);input[0].value='';input.click()};self.make=function(){self.aclass('hidden');self.append('<input type="file" multiple />');self.event('change','input',function(e){self.opt.callback(e.target.files,e);this.value=''});input=self.find('input')}});

COMPONENT('filereader',function(self){var input;self.readonly();self.nocompile();self.singleton();self.make=function(){self.aclass('hidden');self.append('<input type="file" />');input=self.find('input');input.on('change',function(e){self.process(e.target.files)})};self.open=function(opt,callback){self.opt=opt;if(!opt.callback)opt.callback=callback;if(opt.files){self.process(opt.files,opt.multiple)}else{input.attr('accept',opt.accept||'*/*').prop('multiple',!!opt.multiple);input.trigger('click')}};self.process=function(files,multiple){SETTER('loading/show');var arr=[];for(var i=0;i<files.length;i++){arr.push(i);if(multiple!=null&&multiple==false)break}var length=arr.length;arr.wait(function(index,next){var file=files[index],reader=new FileReader();reader.onload=function(){self.opt.progress&&self.opt.progress((100/length)*(index+1),file);var data={body:reader.result,filename:file.name,type:file.type,size:file.size};if(self.opt.callback)self.opt.callback(data);else self.set(data);reader=null;setTimeout(next,500)};if(self.opt.base64)reader.readAsDataURL(file);else reader.readAsText(file)},function(){SETTER('loading/hide',1000);input[0].value=''})}});

COMPONENT('filesaver',function(self){self.singleton();self.readonly();(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});self.save=function(filename,body,type){var plus=false;if(!type){var ext=filename.substring(filename.lastIndexOf('.')+1);if(ext==='htm')ext='html';switch(ext){case'json':type='application/json';plus=true;break;case'js':type='text/javascript';plus=true;break;case'ts':type='text/typescript';plus=true;break;case'svg':type='image/svg+xml';break;case'ics':case'ifb':type='text/calendar';plus=true;break;case'doc':type='application/msword';break;case'docx':type='application/vnd.openxmlformats-officedocument.wordprocessingml.document';break;case'xls':type='application/vnd.ms-excel';break;case'xlsx':type='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';break;case'pdf':type='application/pdf';break;case'jpg':case'jpeg':type='image/jpeg';break;case'ico':type='image/x-icon';break;case'png':case'gif':type='image/'+ext;break;case'less':case'css':case'sass':case'scss':type='text/'+ext;plus=true;break;case'xml':case'html':case'csv':type='text/'+ext;plus=true;break;default:type='text/plain';plus=true;break}}if(plus)type+='; charset=utf-8';var blob;if(typeof(body)==='string')blob=new Blob([body],{type:type});else blob=body;saveAs(blob,filename)}});

COMPONENT('fileuploader',function(self,config){var input;self.singleton();self.readonly();self.nocompile();self.preparefilename=function(filename){var index=filename.lastIndexOf('/');if(index===-1)index=filename.lastIndexOf('\\');if(index!==-1)filename=filename.substring(index+1);return filename};self.upload=self.browse=function(opt){self.opt=opt;self.opt.fd=new FormData();self.opt.indexer=0;if(!opt.url)opt.url=config.url;if(opt.files){self.processfiles(opt.files)}else if(opt.base64){fetch(opt.base64).then(res=>res.blob()).then(function(blob){self.opt.fd.append((self.opt.prefix||'file{0}').format(self.opt.indexer++),blob,opt.filename||opt.name);self.uploadfiles(null)})}else{input[0].value='';self.find('input').attr('accept',opt.accept||'*/*').prop('multiple',!!opt.multiple);input.click()}};self.processfiles=function(files,callback){if(self.opt.width||self.opt.height){var queue=[];for(var i=0;i<files.length;i++)queue.push(files[i]);queue.wait(function(item,next){if(item.type.substring(0,6)==='image/'){self.processimage(item,function(filename,blob){self.opt.fd.append((self.opt.prefix||'file{0}').format(self.opt.indexer++),blob,filename);next()})}else{self.opt.fd.append((self.opt.prefix||'file{0}').format(self.opt.indexer++),item,item.name);next()}},()=>self.uploadfiles(null,callback))}else self.uploadfiles(files,callback)};self.make=function(){self.aclass('hidden');self.append('<input type="file" multiple />');input=self.find('input');self.event('change','input',function(e){self.processfiles(e.target.files,()=>this.value='')})};self.uploadfiles=function(files,callback){if(files){for(var i=0;i<files.length;i++){var filename=self.preparefilename(files[i].name);self.opt.fd.append((self.opt.prefix||'file{0}').format(self.opt.indexer++),files[i],filename)}}if(self.opt.data){for(var key in self.opt.data)self.opt.fd.append(key,self.opt.data[key])}SETTER('loading/show');UPLOAD(self.opt.url,self.opt.fd,function(response,err){SETTER('loading/hide',500);if(!response&&err)self.opt.callback(null,err);else if(response instanceof Array&&response[0]&&response[0].error)self.opt.callback(null,response[0].error);else self.opt.callback(response)},function(percentage,speed,remaining){self.opt.progress&&self.opt.progress(percentage,speed,remaining);if(percentage===100&&callback){callback();callback=null}});setTimeout(function(){input[0].value=''},1500)};self.processimage=function(file,callback){var name=self.preparefilename(file.name.replace(/\.(ico|png|jpeg|jpg|gif|svg|webp|heic)$/i,self.opt.background==='transparent'?'.png':'.jpg'));self.getorientation(file,function(orient){var reader=new FileReader();reader.onload=function(){var img=new Image();img.onload=function(){if(self.opt.keeporiginal&&((img.width==self.opt.width&&img.height==self.opt.height)||(self.opt.width&&self.opt.onlylarger&&img.width<=self.opt.width))){name=self.preparefilename(file.name);fetch(reader.result).then(res=>res.blob()).then(blob=>callback(name,blob))}else self.resizeimage(img,name,callback)};img.crossOrigin='anonymous';if(orient<2)img.src=reader.result;else self.resetorientation(reader.result,orient,url=>img.src=url)};reader.readAsDataURL(file)})};var resizewidth=function(w,h,size){return Math.ceil(w*(size/h))};var resizeheight=function(w,h,size){return Math.ceil(h*(size/w))};self.resizeimage=function(image,name,callback){var opt=self.opt,canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var w=0,h=0,x=0,y=0,is=false,diff=0;if(!opt.width)opt.width=(image.width*(opt.height/image.height))>>0;if(!opt.height)opt.height=image.height*(opt.width/image.width);canvas.width=opt.width;canvas.height=opt.height;if(opt.background!=='transparent'){ctx.fillStyle=opt.background||'#FFFFFF';ctx.fillRect(0,0,opt.width,opt.height)}if(image.width>opt.width||image.height>opt.height){if(image.width>image.height){if(opt.disproportionate){w=opt.width;h=resizeheight(image.width,image.height,w);canvas.width=w;canvas.height=h}else{w=resizewidth(image.width,image.height,opt.height);h=opt.height;if(w<opt.width){w=opt.width;h=resizeheight(image.width,image.height,opt.width)}if(w>opt.width){diff=w-opt.width;x-=(diff/2)>>0}}is=true}else if(image.height>image.width){if(opt.disproportionate){h=opt.height;w=resizewidth(image.width,image.height,h);canvas.width=w;canvas.height=h}else{w=opt.width;h=resizeheight(image.width,image.height,opt.width);if(h<opt.height){h=opt.height;w=resizewidth(image.width,image.height,opt.height)}if(h>opt.height){diff=h-opt.height;y-=(diff/2)>>0}}is=true}}if(!is){if(opt.disproportionate){canvas.width=w=opt.width=image.width;canvas.height=h=opt.height=image.height}if(image.width<opt.width&&image.height<opt.height){w=image.width;h=image.height;x=(opt.width/2)-(image.width/2);y=(opt.height/2)-(image.height/2)}else if(image.width>=image.height){w=opt.width;h=image.height*(opt.width/image.width);y=(opt.height/2)-(h/2)}else{h=opt.height;w=(image.width*(opt.height/image.height))>>0;x=(opt.width/2)-(w/2)}}ctx.drawImage(image,x,y,w,h);var base64=opt.background==='transparent'?canvas.toDataURL('image/png'):canvas.toDataURL('image/jpeg',(opt.quality||90)*0.01);if(base64.length>10)fetch(base64).then(res=>res.blob()).then(blob=>callback(name,blob))};self.getorientation=function(file,callback){var reader=new FileReader();reader.onload=function(e){var view=new DataView(e.target.result);if(view.getUint16(0,false)!=0xFFD8)return callback(-2);var length=view.byteLength,offset=2;while(offset<length){var marker=view.getUint16(offset,false);offset+=2;if(marker==0xFFE1){if(view.getUint32(offset+=2,false)!=0x45786966)return callback(-1);var little=view.getUint16(offset+=6,false)==0x4949;offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++)if(view.getUint16(offset+(i*12),little)==0x0112)return callback(view.getUint16(offset+(i*12)+8,little))}else if((marker&0xFF00)!=0xFF00)break;else offset+=view.getUint16(offset,false)}return callback(-1)};reader.readAsArrayBuffer(file.slice(0,64*1024))};self.resetorientation=function(src,srcOrientation,callback){var img=new Image();img.onload=function(){var width=img.width,height=img.height,canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');canvas.width=width;canvas.height=height;switch(srcOrientation){case 2:ctx.transform(-1,0,0,1,width,0);break;case 3:ctx.transform(-1,0,0,-1,width,height);break;case 4:ctx.transform(1,0,0,-1,0,height);break;case 5:ctx.transform(0,1,1,0,0,0);break;case 6:ctx.transform(-1,0,0,1,width,0);break;case 7:ctx.transform(0,-1,-1,0,height,width);break;case 8:ctx.transform(0,-1,1,0,0,width);break}ctx.drawImage(img,0,0);if(srcOrientation===6){var canvas2=document.createElement('canvas');canvas2.width=width;canvas2.height=height;var ctx2=canvas2.getContext('2d');ctx2.scale(-1,1);ctx2.drawImage(canvas,-width,0);callback(canvas2.toDataURL())}else callback(canvas.toDataURL())};img.src=src}});

COMPONENT('form','zindex:12;scrollbar:1',function(self,config,cls){var cls2='.'+cls,container,csspos={};if(!W.$$form){W.$$form_level=W.$$form_level||1;W.$$form=true;$(document).on('click',cls2+'-button-close',function(){$(this).component().set(null)});var resize=function(){setTimeout2('form',function(){for(var m of M.components){if(m.name===self.name&&!HIDDEN(m.dom)&&(m.ready||(m.$ready&&!m.$removed)))m.resize()}},200)};ON('resize2',resize);$(document).on('click',cls2+'-container',function(e){var el=$(e.target);if(e.target===this||el.hclass(cls+'-container-padding')){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}if(!(el.hclass(cls+'-container-padding')||el.hclass(cls+'-container')))return;var form=$(this).find(cls2);var c=cls+'-animate-click';form.aclass(c);setTimeout(function(){form.rclass(c)},300)})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){if(config.cancel)self.EXEC(config.cancel,self.hide);else self.hide()};self.hide=function(){config.close&&self.EXEC(config.close);config.independent&&self.hideforce();self.set('')};self.resize=function(){if(self.scrollbar){container.css('height',WH);self.scrollbar.resize()}if(!config.center||self.hclass('hidden'))return;var ui=self.find(cls2);var fh=ui.innerHeight();var wh=WH,r=(wh/2)-(fh/2);csspos.marginTop=(r>30?(r-15):20)+'px';ui.css(csspos)};self.make=function(){$(document.body).append('<div id="{0}" class="hidden {4}-container invisible"><div class="{4}-scrollbar"><div class="{4}-container-padding"><div class="{4}" style="max-width:{1}px"><div class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="ti ti-times"></i></button><i class="{4}-icon hidden"></i><span></span></div></div></div></div>'.format(self.ID,config.width||800,self.path,config.closebutton==false?' hidden':'',cls));var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';if(scr.length)scr.remove();var el=$('#'+self.ID);var body=el.find(cls2)[0];container=el.find(cls2+'-scrollbar');if(config.scrollbar){el.css('overflow','hidden');self.scrollbar=SCROLLBAR(el.find(cls2+'-scrollbar'),{visibleY:1,orientation:'y'})}while(self.dom.children.length)body.appendChild(self.dom.children[0]);self.rclass('hidden invisible');var csscls=self.attr('class');csscls&&el.aclass(csscls);self.replace(el,true);self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){e.which===13&&!self.find('button[name="submit"]')[0].disabled&&setTimeout2(self.ID+'enter',self.submit,500)})};self.configure=function(key,value,init,prev){switch(key){case'title':self.find(cls2+'-title > span').text(value);break;case'icon':var icon=self.find(cls2+'-icon');icon.rclass2('fa ti');if(value)icon.aclass(self.icon(value)).rclass('hidden');else icon.aclass('hidden');break;case'width':!init&&value!==prev&&self.find(cls2).css('max-width',value+'px');break;case'closebutton':!init&&self.find(cls2+'-button-close').tclass('hidden',value!==true);break}};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){config.hide&&self.SEEX(config.hide);self.aclass('hidden');self.release(true);self.esc(false);self.find(cls2).rclass(cls+'-animate');W.$$form_level--}};var allowscrollbars=function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)};self.setter=function(value){setTimeout2(self.name+'-noscroll',allowscrollbars,50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$form_level<1)W.$$form_level=1;W.$$form_level++;self.css('z-index',W.$$form_level*config.zindex);self.aclass('invisible');self.rclass('hidden');self.resize();self.release(false);if(self.scrollbar)self.scrollbar.scrollTop(0);else self.element.scrollTop(0);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);setTimeout(function(){self.rclass('invisible');if(self.scrollbar)self.scrollbar.scrollTop(0);else self.element.scrollTop(0);self.find(cls2).aclass(cls+'-animate');config.autofocus&&self.autofocus(config.autofocus)},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$form_level*config.zindex)+1)},500);config.closeesc&&self.esc(true)}});

COMPONENT('hashchange',function(self,config){var prev='';self.singleton();self.readonly();self.ee=function(){EMIT('hash',prev)};self.handler=function(){var hash=location.hash.substring(1);if(prev!==hash){prev=hash;if(config.delay)setTimeout2(self.ID,self.ee,config.delay);else self.ee()}};self.make=function(){$(W).on('hashchange',self.handler);if(config.middleware)MIDDLEWARE(config.middleware.split(',').trim(),self.handler);else self.on('ready',self.handler)};self.destroy=()=>$(W).off('hashchange',self.handler)});

COMPONENT('icons','search:Search;scrollbarshadow:0',function(self,config,cls){var cls2='.'+cls,template='<span data-search="{0}"><i class="{1}"></i></span>',events={},container,content,is=false,cachekey;self.singleton();self.readonly();self.blind();self.nocompile();self.redraw=function(){container.html('<div class="{0}"><div class="{0}-header"><div class="{0}-search"><span><i class="ti ti-search clearsearch"></i></span><div><input type="text" placeholder="{1}" class="{0}-search-input"></div></div></div><div class="{0}-scrollbar"><div class="{0}-content"></div></div></div>'.format(cls,config.search));content=container.find(cls2+'-content');self.scrollbar=SCROLLBAR(container.find(cls2+'-scrollbar'),{visibleY:1,shadow:config.scrollbarshadow})};self.rendericons=function(empty){var key=empty?'1':'0';if(cachekey===key)return;cachekey=key;var builder=[];empty&&builder.push(template.format('',''));AJAX('GET '+(config.list||((DEF.cdn||'https://cdn.componentator.com')+'/icons-db.html')),function(response){response=response.split(',');for(var icon of response)builder.push(template.format(icon.toSearch(),'ti ti-'+icon));if(config.custom){AJAX('GET '+config.custom,function(response){response=response.split(',');for(var icon of response)builder.push(template.format(icon.toSearch(),'tic ti-'+icon));container.find(cls2+'-content').html(builder.join(''))})}else container.find(cls2+'-content').html(builder.join(''))})};self.search=function(value){var search=container.find('.clearsearch');search.rclass2('ti-');if(!value.length){search.aclass('ti-search');content.find('.hidden').rclass('hidden');return}value=value.toSearch();search.aclass('ti-times');self.scrollbar.scrollTop(0);var icons=content.find('span');for(var i=0;i<icons.length;i++){var el=$(icons[i]);el.tclass('hidden',el.attrd('search').indexOf(value)===-1)}};self.make=function(){self.aclass(cls+'-area hidden');self.append('<div class="{0}-container"></div>'.format(cls));container=self.find(cls2+'-container');self.event('keydown','input',function(){var t=this;setTimeout2(self.ID,function(){self.search(t.value)},300)});self.element.on('click',function(e){if(e.target===self.dom)self.hide()});self.event('click','.ti-times',function(){self.find('input').val('');self.search('')});self.event('click',cls2+'-content span',function(){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback&&self.opt.callback($(this).find('i').attr('class'));self.hide()});events.click=function(e){var el=e.target,parent=self.dom;do{if(el==parent)return;el=el.parentNode}while(el);self.hide()};self.on('reflow + resize + resize2',self.hide);self.on('scroll',function(e){if(e&&e[0]!==self.scrollbar.area[0])self.hide()});self.redraw()};self.bindevents=function(){if(!events.is){events.is=true;$(document).on('click',events.click)}};self.unbindevents=function(){if(events.is){events.is=false;$(document).off('click',events.click)}};self.show=function(opt){var tmp=opt.element?opt.element instanceof jQuery?opt.element[0]:opt.element.element?opt.element.dom:opt.element:null;if(is&&tmp&&self.target===tmp){self.hide();return}var search=container.find(cls2+'-search-input');search.val('');container.find('.clearsearch').rclass2('ti-').aclass('ti-search');if(M.scope)opt.scope=M.scope();self.target=tmp;self.opt=opt;var css={};if(is){css.left=0;css.top=0;container.css(css)}else self.rclass('hidden');var target=$(opt.element);var w=container.width();var offset=target.offset();if(opt.element){switch(opt.align){case'center':css.left=Math.ceil((offset.left-w/2)+(target.innerWidth()/2));break;case'right':css.left=(offset.left-w)+target.innerWidth();break;default:css.left=offset.left;break}css.top=opt.position==='bottom'?(offset.top-self.element.height()-10):(offset.top+target.innerHeight()+10)}else{css.left=opt.x;css.top=opt.y}if(opt.offsetX)css.left+=opt.offsetX;if(opt.offsetY)css.top+=opt.offsetY;is=true;self.rendericons(opt.empty);if($(W).scrollTop()===0){if(css.top+container.height()>W.innerHeight)css.top=W.innerHeight-container.height()-20}container.css(css);if(opt.scrolltop==null||opt.scrolltop)self.scrollbar.scrollTop(0);search.focus();setTimeout(self.bindevents,50);clearTimeout2(self.ID)};self.clear=function(){content.empty();cachekey=null};self.hide=function(){is=false;self.target=null;self.opt=null;self.unbindevents();self.aclass('hidden');content.find('.hidden').rclass('hidden');setTimeout2(self.ID,self.clear,1000*10)}});

COMPONENT('imageviewer','selector:.img-viewer;container:.img-container;loading:1;unknown:Unknown image',function(self,config,cls){var cls2='.'+cls,isclosed=false,isrendering=false,events={};events.keydown=function(e){switch(e.which){case 38:case 37:self.find('button[name="prev"]').trigger('click');break;case 32:case 39:case 40:self.find('button[name="next"]').trigger('click');break;case 27:self.close();break}};events.bind=function(){if(!events.is){events.is=true;$(W).on('keydown',events.keydown)}};events.unbind=function(){if(events.is){events.is=false;$(W).off('keydown',events.keydown)}};self.readonly();self.blind();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+' hidden');self.append('<div class="{0}-header"><button name="close"><i class="ti ti-times"></i></button><div><b></b><div class="help"></div></div></div><div class="{0}-loading hidden"><div></div></div><div class="{0}-buttons"><button name="prev"><i class="ti ti-arrow-left"></i></button><button name="next"><i class="ti ti-arrow-right"></i></button></div><div class="{0}-viewer"><div class="{0}-cell"><img /></div></div>'.format(cls));self.resize();self.on('resize2',self.resize);$(document.body).on('click',config.selector,function(){var el=$(this);isclosed=false;self.show(el)});self.event('click','button[name]',function(){var t=this;if(!t.disabled){if(t.name==='close')self.close();else self.show($(this.$el))}});self.find('img').on('load',function(){isrendering=false;self.loading(false)});self.event('click',cls2+'-buttons',function(e){if(e.target===this)self.close()})};self.close=function(){isclosed=true;isrendering=false;$('html,body').rclass(cls+'-noscroll');self.aclass('hidden');events.unbind()};self.loading=function(is){if(!config.loading)return;var el=self.find(cls2+'-loading');if(is){el.rclass('hidden',is);return}setTimeout(function(){el.aclass('hidden')},500)};self.show=function(el){if(isrendering||el==null||isclosed||WIDTH()==='xs')return;var parent=el.closest(config.container);var arr=parent.find(config.selector).toArray();var index=arr.indexOf(el[0]);var buttons=self.find(cls2+'-buttons').find('button');buttons[0].disabled=index===0;buttons[1].disabled=index>=arr.length-1;if(!buttons[0].disabled)buttons[0].$el=arr[index-1];if(!buttons[1].disabled)buttons[1].$el=arr[index+1];self.loading(true);isrendering=true;var image=new Image();image.src=el.attr('data-src')||el.attr('src');image.onload=function(){var img=this,ratio,w=image.width,h=image.height,tw=WW-80,th=WH-140;if(w>h){ratio=w/h;if(w>tw)w=tw;h=w/ratio>>0;if(h>th){h=th;w=h*ratio>>0}}else{ratio=h/w;if(h>th)h=th;w=h/ratio>>0;if(w>tw){w=tw;h=w*ratio>>0}}if(isclosed)return;events.bind();self.find('img').attr('src',img.src).attr('width',w).attr('height',h);self.find('.help').html(img.width+'x'+img.height+'px');self.find('b').html(el.attr('alt')||el.attr('title')||config.unknown);self.rclass('hidden');$('html,body').aclass(cls+'-noscroll')}};self.resize=function(){var viewer=self.find(cls2+'-viewer');var loading=self.find(cls2+'-loading');var css={};css.height=WH-45;css.width=WW;viewer.css(css);loading.css(css)}});

COMPONENT('importer',function(self,config){var init=false,clid=null,pending=false,skip=false,content='',singletonkey,isplugin=false,replace=function(value){return!config.adapt&&self.scope?self.makepath(value):value.replace(/\?/g,config.path||config.if)};var replace2=function(value){isplugin=value?value.includes('<ui-plugin'):false;return value?ADAPT(config.path||config.if,config.id,value):value};self.readonly();self.make=function(){if(config.singleton){if(!W.$importercache)W.$importercache={};singletonkey=HASH(config.path+'|'+config.id+'|'+config.url).toString(36);if(W.$importercache[singletonkey]){skip=true;setTimeout(()=>self.remove(),10);return}}var scr=self.find('script');content=(scr.length?scr.html():'');if(content)content=content.replace(/SCR/g,'scr'+'ipt');if(config.parent){var parent=self.parent(config.parent);if(parent&&parent.length)parent[0].appendChild(self.dom)}};var wait=function(){if(isplugin){var name=config.path||config.if;WAIT(()=>PLUGINS[name],self.reload)}else self.reload()};self.reload=function(recompile){if(config.singleton)W.$importercache[singletonkey]=1;config.reload&&EXEC(replace(config.reload));recompile&&COMPILE();setTimeout(function(){pending=false;init=true},1000)};self.setter=function(value){if(pending||skip)return;if(config.if!==value){if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000);return}pending=true;if(clid){clearTimeout(clid);clid=null}if(init){self.reload();return}if(content){self.html(replace2(content));setTimeout(self.reload,50,true)}else{if(M.is20)self.import(config.url+' @prepend',wait,replace2);else self.import(config.url,wait,true,replace2)}};self.clean=function(){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null},1000)}});

COMPONENT('inlinedatepicker','today:Set today;firstday:-1',function(self,config,cls){var cls2='.'+cls,skip=false,current,elyears,elmonths,elbody;self.days=EMPTYARRAY;self.days_short=EMPTYARRAY;self.months=EMPTYARRAY;self.months_short=EMPTYARRAY;self.years_from;self.years_to;self.nocompile();self.validate=function(value){if(!config.required||config.disabled)return true;return value instanceof Date&&!isNaN(value.getTime())};self.configure=function(key,value){switch(key){case'days':if(value instanceof Array)self.days=value;else self.days=value.split(',').trim();self.days_short=[];for(var i=0;i<DAYS.length;i++){DAYS[i]=self.days[i];self.days_short[i]=DAYS[i].substring(0,2).toUpperCase()}break;case'months':if(value instanceof Array)self.months=value;else self.months=value.split(',').trim();self.months_short=[];for(var i=0,length=self.months.length;i<length;i++){var m=self.months[i];MONTHS[i]=m;if(m.length>4)m=m.substring(0,3)+'.';self.months_short.push(m)}break;case'yearfrom':if(value.indexOf('current')!==-1)self.years_from=+(NOW.format('yyyy'));else self.years_from=+(NOW.add(value).format('yyyy'));break;case'yearto':if(value.indexOf('current')!==-1)self.years_to=+(NOW.format('yyyy'));else self.years_to=+(NOW.add(value).format('yyyy'));break}};function getMonthDays(dt){var m=dt.getMonth();var y=dt.getFullYear();if(m===-1){m=11;y--}return(32-new Date(y,m,32).getDate())}self.calculate=function(year,month,selected){var d=new Date(year,month,1,12,0);var output={header:[],days:[],month:month,year:year},firstday=config.firstday===-1?DEF.firstdayofweek:config.firstday,firstcount=0,frm=d.getDay()-firstday;var today=NOW,ty=today.getFullYear();var tm=today.getMonth();var td=today.getDate();var sy=selected?selected.getFullYear():-1;var sm=selected?selected.getMonth():-1;var sd=selected?selected.getDate():-1;var days=getMonthDays(d);if(frm<0)frm=7+frm;while(firstcount++<7){output.header.push({index:firstday,name:self.days_short[firstday]});firstday++;if(firstday>6)firstday=0}var index=0,indexEmpty=0,count=0,prev=getMonthDays(new Date(year,month-1,1,12,0))-frm;var cur;for(var i=0;i<days+frm;i++){var obj={today:false,selected:false,empty:false,future:false,number:0,index:++count};if(i>=frm){obj.number=++index;obj.selected=sy===year&&sm===month&&sd===index;obj.today=ty===year&&tm===month&&td===index;obj.future=ty<year;if(!obj.future&&year===ty){if(tm<month)obj.future=true;else if(tm===month)obj.future=td<index}}else{indexEmpty++;obj.number=prev+indexEmpty;obj.empty=true;cur=d.add('-'+indexEmpty+' days')}if(!obj.empty)cur=d.add(i+' days');obj.month=i>=frm&&obj.number<=days?d.getMonth():cur.getMonth();obj.year=i>=frm&&obj.number<=days?d.getFullYear():cur.getFullYear();obj.date=cur;output.days.push(obj)}indexEmpty=0;for(var i=count;i<42;i++){var cur=d.add(i+' days');var obj={today:false,selected:false,empty:true,future:true,number:++indexEmpty,index:++count};obj.month=cur.getMonth();obj.year=cur.getFullYear();obj.date=cur;output.days.push(obj)}return output};self.setdate=function(dt){var time=self.time.split(':');if(time.length>1){dt.setHours(+(time[0]||'0'));dt.setMinutes(+(time[1]||'0'));dt.setSeconds(+(time[2]||'0'))}self.bind('@touched @modified @setter',dt)};self.make=function(){self.aclass(cls);var conf={},reconfigure=false;if(!config.days){conf.days=[];for(var i=0;i<DAYS.length;i++)conf.days.push(DAYS[i]);reconfigure=true}if(!config.months){conf.months=MONTHS;reconfigure=true}reconfigure&&self.reconfigure(conf);self.event('click',function(e){e.stopPropagation()})};self.makehtml=function(){var builder=[];builder.push('<div class="{0}-header"><span class="{0}-next"><i class="ti ti-angle-right"></i></span><span class="{0}-prev"><i class="ti ti-angle-left"></i></span><div class="{0}-info"><span class="{0}-month">---</span><span class="{0}-year">---</span></div></div><div class="{0}-years hidden"></div><div class="{0}-months"></div><div class="{0}-body hidden"><div class="{0}-week">'.format(cls));for(var i=0;i<7;i++)builder.push('<div></div>');builder.push('</div><div class="{0}-days">'.format(cls));for(var i=0;i<42;i++)builder.push('<div class="{0}-date"><div></div></div>'.format(cls,i));builder.push('</div></div><div class="{0}-footer"><span class="{0}-now">{2}</span></div>'.format(cls,config.close,config.today));self.html(builder.join(''));builder=[];elbody=self.find(cls2+'-body');elmonths=self.find(cls2+'-months');for(var i=0;i<12;i++)builder.push('<div class="{0}-month" data-index="{1}"><div></div></div>'.format(cls,i));elmonths.html(builder.join(''));builder=[];elyears=self.find(cls2+'-years');for(var i=0;i<25;i++)builder.push('<div class="{0}-year"><div></div></div>'.format(cls));elyears.html(builder.join(''));self.makehtml=null;self.find(cls2+'-month').on('click',function(e){var el=$(this);var index=el.attrd('index');var h='hidden';if(index){current.setMonth(+index);self.date(current,true)}else if(!elmonths.hclass(h))index=1;elyears.aclass(h);if(index)elmonths.aclass(h);else{elmonths.find(cls2+'-today').rclass(cls+'-today');elmonths.find(cls2+'-month').eq(current.getMonth()).aclass(cls+'-today');elmonths.rclass(h)}elbody.tclass(h,!elmonths.hclass(h));e.preventDefault();e.stopPropagation()});self.find(cls2+'-year').on('click',function(e){var el=$(this);var year=el.attrd('year');var h='hidden';if(year){current.setFullYear(+year);self.date(current,true)}else if(!elyears.hclass(h))year=1;elmonths.aclass(h);if(year)elyears.aclass(h);else{self.years();elyears.rclass(h)}elbody.tclass(h,!elyears.hclass(h));e.preventDefault();e.stopPropagation()});self.years=function(){var dom=self.find(cls2+'-years').find(cls2+'-year');var year=current.getFullYear();var index=12;for(var i=0;i<25;i++){var val=year-(index--);$(dom[i]).tclass(cls+'-today',val===year).attrd('year',val).find('div')[0].innerHTML=val}};self.find(cls2+'-date').on('click',function(){var dt=$(this).attrd('date').split('-');self.setdate(new Date(+dt[0],+dt[1],+dt[2],12,0,0))});self.find(cls2+'-now').on('click',function(){self.setdate(new Date())});self.find(cls2+'-next').on('click',function(e){if(elyears.hclass('hidden')){current.setMonth(current.getMonth()+1);self.date(current,true)}else{current.setFullYear(current.getFullYear()+25);self.years()}e.preventDefault();e.stopPropagation()});self.find(cls2+'-prev').on('click',function(e){if(elyears.hclass('hidden')){current.setMonth(current.getMonth()-1);self.date(current,true)}else{current.setFullYear(current.getFullYear()-25);self.years()}e.preventDefault();e.stopPropagation()})};self.date=function(value,skipday){var clssel=cls+'-selected';self.makehtml&&self.makehtml();if(typeof(value)==='string')value=value.parseDate();var year=value==null?null:value.getFullYear();if(year&&(year<self.years_from||year>self.years_to))return;if(!value||isNaN(value.getTime())){self.find('.'+clssel).rclass(clssel);value=NOW}var empty=!value;if(skipday){skipday=false;empty=true}if(skip){skip=false;return}value=new Date((value||NOW).getTime());var output=self.calculate(value.getFullYear(),value.getMonth(),value);var dom=self.find(cls2+'-date');self.find(cls2+'-body').rclass('hidden');self.find(cls2+'-months,'+cls2+'-years').aclass('hidden');current=value;for(var i=0;i<42;i++){var item=output.days[i],classes=[cls+'-date'];if(item.empty)classes.push(cls+'-disabled');if(!empty&&item.selected)classes.push(cls+'-selected');if(item.today)classes.push(cls+'-day-today');var el=$(dom[i]);el.attrd('date',item.year+'-'+item.month+'-'+item.number);el.find('div').html(item.number);el.find('i').remove();el.rclass().aclass(classes.join(' '))}if(!skipday){dom=self.find(cls2+'-week').find('div');for(var i=0;i<7;i++)dom[i].innerHTML=output.header[i].name;dom=self.find(cls2+'-months').find(cls2+'-month');for(var i=0;i<12;i++)$(dom[i]).find('div').attrd('index',i)[0].innerHTML=self.months_short[i]}config.badges&&self.SEEX(config.badges,current,function(date){if(!(date instanceof Array))date=[date];for(var i=0;i<date.length;i++){var dt=date[i].getFullYear()+'-'+date[i].getMonth()+'-'+date[i].getDate();var el=self.find(cls2+'-date[data-date="{0}"]'.format(dt));if(el.length&&!el.find('i').length)el.append('<i class="ti ti-bull"></i>')}});var info=self.find(cls2+'-info');info.find(cls2+'-month').html(self.months[current.getMonth()]);info.find(cls2+'-year').html(current.getFullYear())};self.getter=null;self.setter=function(value){if(!value)value=NOW;self.time=value.format('HH:mm:ss');self.date(value)}});

COMPONENT('input','maxlength:200;innerlabel:0;tabindex:0;dirkey:name;dirvalue:id;increment:1;format:auto;autovalue:name;direxclude:false;checkicon:ti ti-check;forcevalidation:1;searchalign:1;height:80;tabs:1;after:\\:;realtime:1',function(self,config,cls){var cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,customtransformer,mask,rawvalue,isdirvisible=false,nobindcamouflage=false,focused=false;self.nocompile();config.realtime&&self.autobind20&&self.autobind20(config.$delay);self.init=function(){Thelpers.ui_input_icon=function(val){return val.charAt(0)==='!'||val.indexOf(' ')!==-1?('<span class="ui-input-icon-custom">'+(val.charAt(0)==='!'?val.substring(1):('<i class="'+val)+'"></i>')+'</span>'):('<i class="ti ti-'+val+'"></i>')};W.ui_input_cache={};W.ui_input_cache.tags={tags:1,'tags-lower':1,'tags-upper':1,'tags-slug':1,'tags-email':1,'tags-phone':1,'tags-url':1,'tags-id':1};W.ui_input_cache.template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ label | raw}}{{ after | raw}}</div>{{ fi}}<div class="{0}-control{{ if licon}} {0}-licon{{ fi}}{{ if ricon || (type === \'number\' && increment) }} {0}-ricon{{ fi}}">{{ if ricon || (type === \'number\' && increment) }}<div class="{0}-icon-right{{ if type === \'number\' && increment && !ricon}} {0}-increment{{ else if riconclick || type === \'date\' || type === \'datetime\' || type === \'time\' || (type === \'search\' && searchalign === 1) || type === \'password\' }} {0}-click{{ fi}}">{{ if type === \'number\' && !ricon}}<i class="ti ti-caret-up"></i><i class="ti ti-caret-down"></i>{{ else}}{{ ricon | ui_input_icon}}{{ fi}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick || (type === \'search\' && searchalign !== 1) }} {0}-click{{ fi}}">{{ licon | ui_input_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}{{ if tags}}<span class="{0}-value" contenteditable="true" tabindex="{{ tabindex}}"></span>{{ else if dirsource || type === \'icon\' || type === \'emoji\' || type === \'color\' }}<div class="{0}-value" tabindex="{{ tabindex}}"></div>{{ else}}{{ if type === \'multiline\' }}<textarea{{ if realtime}} data-jc-bind=""{{ fi}} style="height:{{ height}}px" tabindex="{{ tabindex}}"></textarea>{{ else}}<input type="{{ if type === \'password\' }}password{{ else}}text{{ fi}}" tabindex="{{ tabindex}}" {{ if autofill}} autocomplete="on" name="{{ NAME}}"{{ else}} name="input'+Date.now()+'" autocomplete="new-password" spellcheck="false" role="combobox" aria-expanded="true" aria-invalid="false" aria-autocomplete="list" aria-expanded="true" aria-haspopup="false" autocapitalize="off" autocomplete="off" autocorrect="off"{{ fi}}{{ if realtime}} data-jc-bind=""{{ fi}}{{ if maxlength > 0}} maxlength="{{ maxlength}}"{{ fi}}{{ if autofocus}} autofocus{{ fi}} />{{ fi}}{{ fi}}</div></div>{{ if error}}<div class="{0}-error hidden"><i class="ti ti-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};var dirsourceprepare=function(arr){if(!config.dirfilter)return arr;var fn=FN(config.dirfilter);var output=[];for(var m of arr){if(fn(m))output.push(m)}return output};var dirsourceread=function(){var arr=GET(self.makepath(config.dirsource));return dirsourceprepare(arr)};self.make=function(){if(config.innerlabel&&config.after)config.after='';if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;if(config.placeholder==0)config.placeholder='0';if(config.autofill){if(typeof(config.autofill)==='string'){config.NAME=config.autofill}else{var path=self.path.toString();var index=path.lastIndexOf('.');config.NAME=index===-1?path:path.substring(index+1)}}self.aclass(cls+' invisible'+(ui_input_cache.tags[config.type]?(' '+cls+'-tags'):''));self.rclass('invisible',100);self.redraw();self.event('input change',function(e){if(!config.realtime&&e.type==='change')self.getter(input.val(),false,false);if(nobindcamouflage)nobindcamouflage=false;else self.check()});self.event('click',cls2+'-radio',function(){if(config.disabled){$(this).blur();return}self.change(true);var index=this.getAttribute('data-index');var val=dirsource[index];if(val)self.set(self.itransform(val.id),2)});self.event('click',cls2+'-checkbox',function(){if(config.disabled){$(this).blur();return}self.change(true);var val=self.get();if(val===1)val=0;else if(val===0)val=1;else if(val===true)val=false;else val=true;self.set(self.itransform(val),2)});self.event('focus','input,textarea,'+cls2+'-value',function(){if(config.disabled){$(this).blur();return}focused=true;self.camouflage(false);self.aclass(cls+'-focused');config.autocomplete&&self.EXEC(config.autocomplete,self,input.parent());if(config.autosource){var opt={};opt.element=self.element;var source=GET(self.makepath(config.autosource));if(source instanceof Array){opt.search=function(q,next){var arr=[];q=q.toSearch();for(var m of source){var name=((typeof(m)==='string'?m:m[config.autovalue])||'');if(name&&(!q||name.toSearch().includes(q)))arr.push({[config.autovalue]:name})}next(arr)}}else opt.search=source;opt.callback=function(value){var val=typeof(value)==='string'?value:value[config.autovalue];if(config.autoexec){self.EXEC(config.autoexec,value,function(val){self.set(self.itransform(val),2);self.change();self.bindvalue()})}else{val=self.parser(self.itransform(val));if(W.ui_input_cache.tags[config.type]){if(!val)return;let arr=self.get()||[];if(!(arr instanceof Array))arr=[arr];rawvalue.empty();if(!arr.includes(val)){self.addtag(val);arr.push(val);self.bind('@touched @modified',arr);self.check();setTimeout(()=>self.skipadd=false,500)}}else{self.set(val,2);self.change();self.bindvalue()}}};SETTER('autocomplete/show',opt)}else if(config.mask){setTimeout(function(input){input.selectionStart=input.selectionEnd=0},50,this)}else if(config.dirsource&&(config.autofocus!=false&&config.autofocus!=0)){if(!isdirvisible)self.find(cls2+'-control').trigger('click')}else if(config.type==='date'||config.type==='datetime'||config.type==='time'){setTimeout(function(){self.element.find(cls2+'-icon-right').trigger('click')},300)}});self.event('paste','input,textarea'+(W.ui_input_cache.tags[config.type]?(','+cls2+'-value'):''),function(e){if(W.ui_input_cache.tags[config.type]){e.preventDefault();e.stopPropagation();let text=e.originalEvent.clipboardData.getData('text/plain');text&&document.execCommand('insertText',false,text.replace(/\n/g,'').trim())}else if(config.mask){let val=(e.originalEvent.clipboardData||window.clipboardData).getData('text');self.set(self.itransform(val.replace(/\s|\t/g,'')));e.preventDefault()}self.check()});if(W.ui_input_cache.tags[config.type]){self.event('click',function(){if(!config.disabled)rawvalue.focus()});self.addtag=function(text){rawvalue.before('<span class="{0}-tag"><i class="ti ti-times {0}-tag-remove"></i>{1}</span>'.format(cls,Thelpers.encode(text)))};self.event('click',cls2+'-tag-remove',function(e){e.preventDefault();e.stopPropagation();let el=$(this).parent();let val=el.text();el.remove();let arr=self.get();arr.splice(arr.indexOf(val),1);self.bind('@modified @touched',arr);self.check();rawvalue.focus()});rawvalue.on('keydown',function(e){switch(e.which){case 13:e.preventDefault();e.stopPropagation();SETTER('!autocomplete/hide');SETTER('!directory/hide');setTimeout(function(el){var val=el.text();if(val){val=self.parser(self.itransform(val));if(!val)return;let arr=self.get();if(!arr)arr=[];if(!(arr instanceof Array))arr=[arr];if(!arr.includes(val)){self.addtag(val);arr.push(val);self.bind('@modified @touched',arr)}}el.html('')},100,$(this));break;case 8:if(!this.innerHTML){let prev=$(this).prev();if(prev.length&&prev[0].tagName==='SPAN'){let arr=self.get();if(arr){arr.splice(arr.indexOf(prev.text()),1);self.bind('@modified @touched',arr);prev.remove();self.check()}}}break}})}self.event('keydown','input,textarea',function(e){var t=this,code=e.which;if(t.readOnly||config.readonly||config.disabled){if(e.keyCode!==9){if(config.dirsource){self.find(cls2+'-control').trigger('click');return}e.preventDefault();e.stopPropagation()}return}if(config.tabs&&t.tagName==='TEXTAREA'&&e.keyCode===9){t.setRangeText('\t',t.selectionStart,t.selectionEnd,'end');self.check();e.preventDefault();return}if(!config.disabled&&config.dirsource&&(code===13||code>30)){self.find(cls2+'-control').trigger('click');return}if(config.mask){if(e.metaKey){if(code===8||code===127){e.preventDefault();e.stopPropagation()}return}if(code===32){e.preventDefault();e.stopPropagation();return}var beg=e.target.selectionStart,end=e.target.selectionEnd,val=t.value,c;if(code===8||code===127){if(beg===end){c=config.mask.substring(beg-1,beg);t.value=val.substring(0,beg-1)+c+val.substring(beg);self.curpos(beg-1)}else{for(var i=beg;i<=end;i++){c=config.mask.substring(i-1,i);val=val.substring(0,i-1)+c+val.substring(i)}t.value=val;self.curpos(beg)}e.preventDefault();return}if(code>40){var cur=String.fromCharCode(code);if(mask&&mask[beg]){if(!mask[beg].test(cur)){e.preventDefault();return}}c=config.mask.charCodeAt(beg);if(c!==95){beg++;while(true){c=config.mask.charCodeAt(beg);if(c===95||isNaN(c))break;else beg++}}if(c===95){val=val.substring(0,beg)+cur+val.substring(beg+1);t.value=val;beg++;while(beg<config.mask.length){c=config.mask.charCodeAt(beg);if(c===95)break;else beg++}self.curpos(beg)}else self.curpos(beg+1);e.preventDefault();e.stopPropagation()}}});self.event('blur','input,textarea,'+cls2+'-value',function(){focused=false;if(M.is20)setTimeout(()=>self.camouflage(true),300);else self.camouflage(true);self.rclass(cls+'-focused')});self.itransform=function(value){if(customtransformer){return customtransformer(value)}else if(config.transform){var fn=GET(self.makepath(config.transform));if(fn)value=fn.call(self,value,config)}return value};self.event('click',cls2+'-control',function(){if(config.disabled||isdirvisible)return;if(config.type==='icon'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(val){self.change(true);self.set(self.itransform(val),2);self.check();rawvalue[0].focus()};SETTER((self.caniuse('icons')?'icons':'faicons')+'/show',opt);return}else if(config.type==='color'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(self.itransform(al),2);self.check();rawvalue[0].focus()};SETTER('colorpicker/show',opt);return}else if(config.type==='emoji'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(self.itransform(al),2);self.check();rawvalue[0].focus()};SETTER('emoji/show',opt);return}if(!config.dirsource)return;isdirvisible=true;setTimeout(function(){isdirvisible=false},500);var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource||dirsourceread();opt.offsetY=-1+(config.diroffsety||0);opt.offsetX=0+(config.diroffsetx||0);opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;opt.checkbox=!!config.multiple;if(opt.items instanceof Array)opt.items=CLONE(opt.items);var val=self.get();if(config.multiple){for(var item of opt.items){if(val instanceof Array){item.selectedts=val.indexOf(item[config.dirvalue||config.value]);item.selected=item.selectedts!==-1}else item.selected=false}}else opt.selected=val;if(config.dirraw)opt.raw=true;if(config.dirsearch!=null)opt.search=config.dirsearch;if(dirsource&&config.direxclude==false&&!config.multiple){for(var item of dirsource){if(item)item.selected=typeof(item)==='object'&&item[config.dirvalue]===val}}else if(config.direxclude)opt.exclude=item=>item?item[config.dirvalue]===val:false;opt.close=function(){if(!opt.skipclose){self.bind('@touched');if(!M.is20)self.state(1)}};opt.callback=function(item,el,custom){opt.skipclose=true;if(item==null||(config.multiple&&!item.length)){rawvalue.html('');self.set(self.itransform(config.multiple?[]:null),2);self.change();self.check();return}if(config.multiple){var arr=[];for(var i=0;i<item.length;i++){var m=item[i];arr.push(m[config.dirvalue||config.value])}self.set(self.itransform(arr),2);self.change(true);return}var val=custom||typeof(item)==='string'?item:item[config.dirvalue||config.value];if(custom&&typeof(config.dircustom)==='string'){var fn=GET(self.makepath(config.dircustom));fn(val,function(val){self.set(self.itransform(val),2);self.change(true);self.bindvalue()})}else if(custom){if(val){val=self.itransform(val);self.set(val,2);self.change(true);if(dirsource)self.bindvalue();else input.val(val)}}else{val=self.itransform(val);self.set(val,2);self.change(true);if(dirsource)self.bindvalue();else input.val(val)}rawvalue[0].focus()};SETTER('directory/show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.find(cls2+'-control').trigger('click')}else if(!config.camouflage||$(e.target).hclass(cls+'-placeholder')){if(input.length){input[0].focus()}else rawvalue[0].focus()}}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');var opt;if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(!left&&!config.riconclick){if(config.type==='date'||config.type==='datetime'){opt={};opt.element=self.element;opt.value=self.get();opt.time=config.type==='datetime';opt.ampm=DEF.timeformat&&DEF.timeformat.includes('a');opt.callback=function(val){self.change(true);self.set(self.itransform(val),2)};SETTER('datepicker/show',opt)}else if(config.type==='time'){opt={};opt.element=self.element;opt.value=self.get();opt.callback=function(val){self.change(true);self.set(self.itransform(val))};SETTER('timepicker/show',opt)}else if(config.type==='search')self.set('');else if(config.type==='password')self.password();else if(config.type==='number'||config.type==='number2'){var tmp=$(e.target);if(tmp.attr('class').indexOf('ti-')!==-1){var n=tmp.hclass('ti-caret-up')?1:-1;self.change(true);var val=self.preparevalue((self.get()||0)+(config.increment*n));self.set(self.itransform(val),2)}}return}if(left&&config.liconclick)self.EXEC(config.liconclick,self,el);else if(config.riconclick)self.EXEC(config.riconclick,self,el);else if(left&&config.type==='search')self.set('')})};self.camouflage=function(is){if(config.camouflage){if(is){var t=input[0],arr=t.value.split('');for(var i=0;i<arr.length;i++)arr[i]=typeof(config.camouflage)==='string'?config.camouflage:'•';nobindcamouflage=true;t.value=arr.join('')}else{nobindcamouflage=true;var val=self.get();input[0].value=val==null?'':val}self.tclass(cls+'-camouflaged',is)}};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if((!config.required||config.disabled)&&!self.forcedvalidation())return true;if(config.disabled)return true;if(config.dirsource)return config.multiple?(value?value.length>0:false):(value!=null&&value!=='');if(customvalidator)return customvalidator(value);if(W.ui_input_cache.tags[config.type])return value&&value.length>0;if(config.type==='date'||config.type==='datetime')return value instanceof Date&&!isNaN(value.getTime());if(config.type==='radiobutton')return!!value;if(config.type==='checkbox')return value===true||value===1;if(value==null)value='';else value=value.toString();if(config.mask&&typeof(value)==='string'&&value.indexOf('_')!==-1)return false;if(config.minlength&&value.length<config.minlength)return false;switch(config.type){case'email':return value.isEmail();case'phone':return value.isPhone();case'url':return value.isURL();case'zip':return(/^\d{5}(?:[-\s]\d{4})?$/).test(value);case'currency':case'number':case'number2':if(config.type==='number2'&&(value==null||value==''))return false;value=value.parseFloat();if((config.minvalue!=null&&value<config.minvalue)||(config.maxvalue!=null&&value>config.maxvalue))return false;return config.minvalue==null?value>0:true}return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.password=function(show){var visible=show==null?input.attr('type')==='text':show;input.attr('type',visible?'password':'text');self.find(cls2+'-icon-right').find('i').tclass(config.ricon,visible).tclass('ti-eye-slash',!visible).tclass('ti-eye',visible)};self.preparevalue=function(value){if(config.type==='number'&&(config.type!=='number2'||value)&&(config.minvalue!=null||config.maxvalue!=null)){var tmp=typeof(value)==='string'?+value.replace(',','.'):value;if(isNaN(tmp))tmp=0;if(config.minvalue>tmp)value=config.minvalue;if(config.maxvalue<tmp)value=config.maxvalue}return value};self.getterin=self.getter;self.getter=function(value,realtime,nobind){if(!M.is20&&nobindcamouflage)return;if(config.mask&&config.masktidy){var val=[];for(var i=0;i<value.length;i++){if(config.mask.charAt(i)==='_')val.push(value.charAt(i))}value=val.join('')}self.getterin(self.preparevalue(value),realtime,nobind)};self.setterin=self.setter;self.setter=function(value,path,type){if(config.mask){if(value){if(config.masktidy){var index=0,val=[];for(var i=0;i<config.mask.length;i++){var c=config.mask.charAt(i);val.push(c==='_'?(value.charAt(index++)||'_'):c)}value=val.join('')}if(mask){var arr=[];for(var i=0;i<mask.length;i++){var c=value.charAt(i);if(mask[i]&&mask[i].test(c))arr.push(c);else arr.push(config.mask.charAt(i))}value=arr.join('')}}else value=config.mask}if(config.realtime)self.setterin(value,path,type);else input.val(self.formatter(value));self.bindvalue();config.camouflage&&!focused&&setTimeout(self.camouflage,((M.is20&&type.show)||type==='show')?2000:1,true);config.exec&&self.SEEX(config.exec,value,self.element);if(config.type==='password')self.password(true);else if(W.ui_input_cache.tags[config.type])rawvalue.html('')};self.check=function(){let is=false;if(W.ui_input_cache.tags[config.type]){is=self.find(cls2+'-tag').length>0;placeholder&&placeholder.tclass('hidden',is||!!rawvalue.html());self.tclass(cls+'-binded',is);return}if(config.type!=='radiobutton'){if(config.dirsource)is=!!rawvalue.text();else is=input&&input.length?!!input[0].value:!!self.get()}else{let tmp=self.get();is=tmp&&tmp.length>0}if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-'+(config.searchalign===1?'right':'left')).find('i').tclass(config.searchalign===1?config.ricon:config.licon,!is).tclass('ti-times',is)};self.bindvalue=function(){let value=self.get();if(dirsource&&config.type!=='radiobutton'&&!W.ui_input_cache.tags[config.type]){let item;let text=[];for(item of dirsource){if(typeof(item)==='string'){if(item===value)break;item=null}else if(config.multiple||config.type==='radiobutton'){let v=item[config.dirvalue||config.value];let index=value instanceof Array?value.indexOf(v):-1;if(index!==-1)text.push({index:index,name:item[config.dirkey||config.key]})}else if(item[config.dirvalue||config.value]===value){item=item[config.dirkey||config.key];break}else item=null}if(config.multiple){text.quicksort('index');for(let i=0;i<text.length;i++)text[i]=config.dirraw?text[i].name:'<span class="{0}-tag">{1}</span>'.format(cls,Thelpers.encode(text[i].name));item=text.join('')}else if(value&&item==null&&config.dircustom)item=value;rawvalue.html(item||'')}else if(config.dirsource&&config.type!=='radiobutton'){if(config.dirdetail){setTimeout2(self.ID+'dirdetail',function(){self.EXEC(config.dirdetail,value,function(val){if(config.dirraw)rawvalue.html(val||'');else rawvalue.text(val||'');self.check()},5)});return}else if(config.dirraw)rawvalue.html(value||'');else rawvalue.text(value||'')}else{if(W.ui_input_cache.tags[config.type]){self.find(cls2+'-tag').remove();if(value instanceof Array){for(let m of value)self.addtag(m)}}else{switch(config.type){case'radiobutton':let index=dirsource.findIndex('id',value);self.find(cls2+'-radiobuttons').find(cls2+'-radio').each(function(){let el=$(this);el.tclass(cls+'-checked',el.attr('data-index')==index)});break;case'color':rawvalue.css('background-color',value||'');break;case'icon':rawvalue.html('<i class="{0}"></i>'.format(value||''));break;case'emoji':rawvalue.html(value);break;case'checkbox':self.tclass(cls+'-checked',value===true||value===1);break}}}self.check()};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down';else if(config.type==='date'||config.type==='datetime'){config.ricon='calendar';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='icon'||config.type==='color'||config.type==='emoji'){config.ricon='angle-down';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='time'){config.ricon='clock';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='search')if(config.searchalign===1)config.ricon='search';else config.licon='search';else if(config.type==='password')config.ricon='eye';else if(config.type==='number'||config.type==='number2'){if(!config.align&&!config.innerlabel)config.align=1}}self.tclass(cls+'-masked',!!config.mask);self.rclass2(cls+'-type-');if(config.type)self.aclass(cls+'-type-'+config.type);var html,is=false;if(config.type==='checkbox'){html='<div class="{0}-checkbox"><span><i class="{checkicon}"></i></span><label>{label}</label></div>'.format(cls).args(config)}else if(config.type==='radiobutton'){html=('<div class="{0}-radiobutton">'+(config.label?('<label class="{0}-label">'+config.label+':</label>'):'')+'<div class="{0}-radiobuttons"></div></div>').format(cls)}else{is=true;var opt=CLONE(config);if(opt.type==='number2')opt.type='number';opt.tags=W.ui_input_cache.tags[config.type];html=W.ui_input_cache.template(opt)}self.html(html);if(is){input=self.find('input,textarea');rawvalue=self.find(cls2+'-value');placeholder=self.find(cls2+'-placeholder')}else if(config.type!=='radiobutton')input=rawvalue=placeholder=null};self.radiorender=function(){var builder=[];for(let i=0;i<dirsource.length;i++){let item=dirsource[i];builder.push('<div data-index="{1}" class="{0}-radio"><span><i></i></span>{name}</div>'.format(cls,i).args(item))}self.find(cls2+'-radiobuttons').tclass(cls+'-multiline',!!config.multiline).html(builder.join(''))};self.configure=function(key,value,init){switch(key){case'icon':if(value&&value.indexOf(' ')===-1)config.icon='ti ti-'+value;break;case'dirsource':if(config.dirajax||value.indexOf('/')!==-1){dirsource=null;if(!init)self.bindvalue()}else{if(value.indexOf(',')!==-1){dirsource=dirsourceprepare(self.parsesource(value));if(config.type==='radiobutton')self.radiorender();else if(!init)self.bindvalue()}else{self.datasource(value,function(path,value){dirsource=dirsourceprepare(M.is20?path:value);if(config.type==='radiobutton')self.radiorender();else self.bindvalue()})}}if(config.type!=='radiobutton'){self.tclass(cls+'-dropdown',!!value);input.prop('readonly',!!config.disabled||!!config.dirsource)}break;case'disabled':self.tclass('ui-disabled',!!value);self.reset();break;case'required':self.tclass(cls+'-required',!!value);self.reset();break;case'type':self.type=value;break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?(new Function('value','return '+value)):(function(path){path=self.makepath(path);return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',!!value);self.tclass(cls+'-raw',!value);break;case'monospace':self.tclass(cls+'-monospace',!!value);break;case'transform':customtransformer=value&&(/\(|=|>|<|\+|-|value\.|\)/).test(value)?(new Function('value','return '+value)):null;break;case'maskregexp':if(value){mask=value.toLowerCase().split(',');for(var i=0;i<mask.length;i++){var m=mask[i];if(!m||m==='null')mask[i]='';else mask[i]=new RegExp(m)}}else mask=null;break;case'mask':config.mask=value.replace(/#/g,'_');break}};self.formatter(function(path,value){if(value){switch(config.type){case'id':return(value+'').toLowerCase().replace(/[^a-z0-9]/g,'');case'slug':return(value+'').slug();case'lower':return(value+'').toLowerCase();case'upper':return(value+'').toUpperCase();case'phone':return(value+'').replace(/\s/g,'');case'email':return(value+'').toLowerCase();case'date':var format=config.format;if(format==='auto')format='';return value.format(format||DEF.dateformat||'yyyy-MM-dd');case'datetime':var format=config.format;if(format==='auto')format='';return value.format(format||ENV('ts'));case'time':var format=config.format;if(format==='auto')format='';return value.format(format||ENV('time')||'HH:mm');case'number':return config.format?(config.format==='auto'?value.format():value.format(config.format)):value;case'number2':return value==null?'':config.format?(config.format==='auto'?value.format():value.format(config.format)):value}}return value});self.parser(function(path,value){if(value){var tmp;switch(config.type){case'date':case'datetime':tmp=self.get();if(tmp)tmp=tmp.format('HH:mm');else tmp='';return value+(tmp?(' '+tmp):'');case'id':case'tags-id':return(value+'').toLowerCase().replace(/[^a-z0-9]/g,'');case'slug':case'tags-slug':return(value+'').slug();case'lower':case'email':case'tags-lower':value=value.toLowerCase();break;case'tags-email':value=value.toLowerCase();if(!value.isEmail())value='';break;case'tags-phone':value=value.replace(/\s/g,'');if(!value.isPhone())value='';break;case'upper':case'tags-upper':value=value.toUpperCase();break;case'phone':value=value.replace(/\s/g,'');break;case'number2':if(value){var type=typeof(value);if(type==='string'&&(/^[\-0-9\.\,]+$/).test(value))value=value.parseFloat();else if(type!=='number')value=null}else value=null;break;case'time':tmp=value.split(':');var dt=self.get();value=dt?new Date(dt.getTime()):new Date();value.setHours((tmp[0]||'0').parseInt());value.setMinutes((tmp[1]||'0').parseInt());value.setSeconds((tmp[2]||'0').parseInt());break}}else{switch(config.type){case'number':value=0;break;case'number2':case'date':case'datetime':value=null;break}}return self.itransform(value?config.spaces===false?value.replace(/\s/g,''):value:value)});self.state=function(type,what){if(type){if(type===1&&what===4){self.rclass(cls+'-ok '+cls+'-invalid');self.$oldstate=null;return}var invalid=config.required?self.isInvalid():self.forcedvalidation()?self.isInvalid():false;if(invalid!==self.$oldstate){self.$oldstate=invalid;self.tclass(cls+'-invalid',!!invalid);self.tclass(cls+'-ok',!invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)}}};self.forcedvalidation=function(){if(!config.forcevalidation)return false;if(config.type==='number'||config.type==='number2')return false;var val=self.get();var type=typeof(val);if(config.type==='radiobutton')return!!val;if(config.type==='checkbox')return val===true||val===1;if(type==='string'&&val&&(config.minlength!=null||config.maxlength!=null)){if((config.minlength!=null&&val.length<config.minlength)||(config.maxlength!=null&&val.length>config.maxlength))return true;if(!config.type||(config.type==='string'||config.type==='multiline'))return false}return(config.type==='phone'||config.type==='email')&&(val!=null&&(type==='string'&&val.length!==0))}});

COMPONENT('inputtags','dirkey:name;dirvalue:id;transform:0;enteronly:1;after:\\:',function(self,config,cls){var cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,tags,skip=false;self.nocompile();self.init=function(){Thelpers.ui_inputtags_icon=function(val){return val.charAt(0)==='!'?('<span class="'+cls+'-icon-custom">'+val.substring(1)+'</span>'):('<i class="ti ti-'+val+'"></i>')};W.ui_inputtags_template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="ti ti-{{ icon}}"></i>{{ fi}}{{ label}}{{ after}}</div>{{ fi}}<div class="{0}-control{{ if dirsource}} {0}-dropdown{{ fi}}{{ if licon}} {0}-licon{{ fi}}{{ if ricon}} {0}-ricon{{ fi}}">{{ if ricon}}<div class="{0}-icon-right">{{ ricon | ui_inputtags_icon}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick}} {0}-click{{ fi}}">{{ licon | ui_inputtags_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder && !innerlabel}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}<div class="{0}-tags"><span class="{0}-editable" contenteditable="true"></span></div></div></div>{{ if error}}<div class="{0}-error hidden"><i class="ti ti-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};self.make=function(){if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;config.PATH=self.path.toString().replace(/\./g,'_');self.aclass(cls+' invisible');self.rclass('invisible',100);self.redraw();self.event('input change focusout',function(e){self.check();if(!config.enteronly&&e.type==='focusout'){setTimeout(function(){var val=input.text();val&&self.appendval(val);input.html('')},100)}});self.event('focus',cls2+'-editable',function(){self.aclass(cls+'-focused');config.autocomplete&&self.EXEC(config.autocomplete,self,input.parent());if(config.autosource){var opt={};opt.element=self.element;opt.search=GET(self.makepath(config.autosource));opt.callback=function(value){input.empty();self.appendval(typeof(value)==='string'?value:value[config.autovalue]);self.check()};SETTER('autocomplete/show',opt)}});self.event('blur',cls2+'-editable',function(){self.rclass(cls+'-focused')});self.event('click','.ti-times',function(e){var index=$(this).parent().index();self.removetag(index);e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-tag',function(e){e.stopPropagation();e.preventDefault()});self.findvalue=function(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]&&(arr[i]===val||arr[i][config.value]===val))return arr[i]}};self.event('click',cls2+'-control',function(){if(!config.dirsource||config.disabled)return;var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource;opt.offsetY=-1;opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;if(config.dirvalue&&typeof(dirsource)!=='function'){var val=self.get()||EMPTYARRAY;opt.exclude=function(item){return item?typeof(item)==='string'?self.findvalue(val,item):self.findvalue(val,item[config.dirvalue]):false}}opt.callback=function(item,el,custom){if(item==null||(custom&&!opt.custom))return;var val=custom||(typeof(item)==='string'?item:item[config.dirvalue||config.value]);if(custom){if(typeof(config.dircustom)==='string'){var fn=GET(self.makepath(config.dircustom));fn(val,function(val){self.appendval(val,true)})}else self.appendval(item,true)}else if(!custom)self.appendval(typeof(dirsource)==='function'?item:val)};SETTER('directory/show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label,'+cls2+'-input',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.element.find(cls2+'-control').trigger('click')}else input.focus()}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(left&&config.liconclick)self.EXEC(config.liconclick,self,el);else if(config.riconclick)self.EXEC(config.riconclick,self,el)})};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if(!config.required||config.disabled)return true;if(config.dirsource)return!!value;if(customvalidator)return customvalidator(value);if(value==null)value=EMPTYARRAY;return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.setter=function(){if(skip)skip=false;else self.bindvalue()};self.appendval=function(value,custom){var cur=self.get()||EMPTYARRAY;var is=false,isfn=false,rawvalue=value;if(dirsource&&typeof(dirsource)==='function'){isfn=true;rawvalue=value[config.dirvalue];if(cur.indexOf(rawvalue)!==-1||!self.checkvalue(rawvalue))return}else{rawvalue=self.transform(rawvalue);if(cur.indexOf(rawvalue)!==-1||!self.checkvalue(rawvalue))return}if(config.dirsource){if(custom){is=true;self.appendtag(rawvalue)}else{if(isfn){is=true;self.appendtag(value[config.dirkey])}else{var item=dirsource.findItem(config.dirvalue,rawvalue);if(item){is=true;self.appendtag(item[config.dirkey])}}}}else{is=true;self.appendtag(rawvalue)}if(is){skip=true;self.push(rawvalue,2);self.change(true)}self.check();self.dirinitchecksum=0};self.appendtag=function(text){input.before('<span class="{0}-tag"><i class="ti ti-times"></i>{1}</span>'.format(cls,Thelpers.encode(text)))};self.removetag=function(index){skip=true;tags.find('span').eq(index).remove();self.get().splice(index,1);self.update(true,2);self.change(true);self.check()};self.checkvalue=function(val){return config.check?GET(self.makepath(config.check))(val):true};self.check=function(){var is=!!input[0].innerHTML||(self.get()||EMPTYARRAY).length>0;setTimeout(self.resize,10);if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-right').find('i').tclass(config.ricon,!is).tclass('ti-times',is)};self.dirinitchecksum=0;self.bindvalue=function(){var value=self.get()||EMPTYARRAY;var tmp=HASH(value);if(tmp===self.dirinitchecksum)return;self.dirinitchecksum=tmp;tags.find(cls2+'-tag').remove();if(dirsource){if(typeof(dirsource)==='function'){dirsource(value,function(dirsource){var item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];item.name=self.transform(item.name);if(value.indexOf(item[config.dirvalue||config.value])!=-1)self.appendtag(item[config.dirkey||config.key])}input.empty();self.check()});return}var arr=[],item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];item.name=self.transform(item.name);if(typeof(item)==='string'){if(value.indexOf(item)!==-1)arr.push(item)}else if(value.indexOf(item[config.dirvalue||config.value])!=-1)arr.push(item[config.dirkey||config.key])}for(var i=0;i<arr.length;i++){item=arr[i];item&&self.appendtag(item)}}else{for(var i=0;i<value.length;i++){value[i]=self.transform(value[i]);value[i]&&self.appendtag(value[i])}}input.empty();self.check()};self.resize=function(){var h=self.find(cls2+'-input').innerHeight()+'px';self.find('.{0}-icon-right,.{0}-icon-left'.format(cls)).css({height:h,'line-height':h})};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down'}self.html(W.ui_inputtags_template(config));input=self.find(cls2+'-editable');tags=self.find(cls2+'-tags');placeholder=self.find(cls2+'-placeholder');input.on('paste',function(e){e.preventDefault();e.stopPropagation();var text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');text&&document.execCommand('insertText',false,text)});input.on('keydown',function(e){var el;if(e.which===13){e.preventDefault();e.stopPropagation();el=$(this);setTimeout(function(){var val=el.text();val&&self.appendval(val);el.html('')},100)}else if(e.which===8){if(!this.innerHTML){var prev=$(this).prev();prev.length&&self.removetag(prev.index())}}})};self.configure=function(key,value){switch(key){case'dirsource':var tmp=GET(self.makepath(value));input.prop('contenteditable',!value);if(typeof(tmp)!=='function'){self.datasource(value,function(path,value){if(M.is20)value=path;dirsource=value||EMPTYARRAY;self.bindvalue()})}else dirsource=tmp;break;case'disabled':self.tclass('ui-disabled',value==true);input.attr('contenteditable',!value);self.reset();break;case'required':self.tclass(cls+'-required',value==true);self.reset();break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?FN('value=>'+value):(function(path){return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',value);break}};self.formatter(function(path,value){if(value){switch(config.type){case'lower':return value.toString().toLowerCase();case'upper':return value.toString().toUpperCase()}}return value});self.parser(function(path,value){if(value){switch(config.type){case'lower':value=value.toLowerCase();break;case'upper':value=value.toUpperCase();break}}return value?config.spaces===false?value.replace(/\s/g,''):value:value});self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)};self.transform=function(string){if(typeof string!=='string')return string;switch(config.transform){case 1:return string.toLowerCase();case 2:return string.toUpperCase();case 3:return self.capitalize(string)}return string};self.capitalize=function(string){return string.toLowerCase().replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})}});

COMPONENT('keyvalue','maxlength:100',function(self,config,cls){var cls2='.'+cls,container,content=null,cempty=cls+'-empty',skip=false,empty={},modify=function(val){if(self.modify){self.modify(val,2)}else{self.set(val,2);self.change(true)}};self.nocompile&&self.nocompile();self.template=Tangular.compile('<div class="{0}-item"><div class="{0}-item-remove"><i class="ti ti-times"></i></div><div class="{0}-item-key"><input type="text" name="key" maxlength="{{ max}}"{{ if disabled}} disabled="disabled"{{ fi}} placeholder="{{ placeholder_key}}" value="{{ key}}" autocomplete="new-password" /></div><div class="{0}-item-value"><input type="text" maxlength="{{ max}}" placeholder="{{ placeholder_value}}" value="{{ value}}" autocomplete="new-password" /></div></div>'.format(cls));self.binder=function(fn){self.binder2=fn};self.binder2=function(type,value){return value};self.configure=function(key,value,init,prev){if(init)return;var redraw=false;switch(key){case'disabled':self.tclass('ui-disabled',value);self.find('input').prop('disabled',value);empty.disabled=value;break;case'maxlength':self.find('input').prop('maxlength',value);break;case'placeholderkey':self.find('input[name="key"]').prop('placeholder',value);break;case'placeholdervalue':self.find('input[name="value"]').prop('placeholder',value);break;case'icon':if(value&&prev)self.find('i').rclass2('ti').aclass(value.indexOf(' ')===-1?('ti ti-'+value):value);else redraw=true;break;case'label':redraw=true;break}if(redraw){self.redraw();self.refresh()}};self.redraw=function(){var icon=config.icon,label=config.label||content;if(icon)icon='<i class="{0}"></i>'.format(self.icon(icon));empty.value='';self.html((label?'<div class="'+cls+'-label">{1}{0}:</div>'.format(label,icon):'')+'<div class="'+cls+'-items"></div>'+self.template(empty).replace('-item"','-item '+cls+'-base"'));container=self.find(cls2+'-items')};self.make=function(){empty.max=config.maxlength;empty.placeholder_key=config.placeholderkey;empty.placeholder_value=config.placeholdervalue;empty.value='';empty.disabled=config.disabled;content=self.html();self.aclass(cls);self.disabled&&self.aclass('ui-disabled');self.redraw();self.event('click','.ti-times',function(){if(config.disabled)return;var el=$(this);var parent=el.closest(cls2+'-item');var inputs=parent.find('input');var obj=self.get();!obj&&(obj={});var key=inputs[0].value;parent.remove();delete obj[key];modify(obj)});self.event('focus','input',function(){config.autocomplete&&self.EXEC(config.autocomplete,$(this),self)});self.event('change keydown','input',function(e){if(config.disabled||(e.type==='keydown'&&e.which!==13))return;var el=$(this);var inputs=el.closest(cls2+'-item').find('input');var key=self.binder2('key',inputs[0].value);var value=self.binder2('value',inputs.get(1).value);if(!key||!value)return;var base=el.closest(cls2+'-base').length>0;if(base){var tmp=self.get();!tmp&&(tmp={});tmp[key]=value;modify(tmp);inputs.val('');inputs.eq(0).focus();return}var keyvalue={},k,arr=container.find('input');for(var m of arr){if(m.name==='key'){k=m.value.trim()}else if(k){keyvalue[k]=m.value.trim();k=''}}skip=true;modify(keyvalue)})};self.setter=function(value){if(skip){skip=false;return}if(!value){container.empty();self.aclass(cempty);return}var builder=[],keys=Object.keys(value);for(var i=0;i<keys.length;i++){empty.key=keys[i];empty.value=value[empty.key];builder.push(self.template(empty))}self.tclass(cempty,!builder.length);container.empty().append(builder.join(''))}});

COMPONENT('leaflet','height:200;zoom:11;draggable:0;marker:1;margin:0;maxzoom:19',function(self,config,cls){var meta={markers:[]},skip=false,skipmove=false;self.readonly();self.nocompile();self.destroy=function(){for(var m of meta.markers)m.remove();meta.map.off();meta.markers=null;meta.map=null;meta.marker=null};self.meta=meta;self.make=function(){self.aclass(cls);self.append('<div></div>');meta.container=self.find('div')[0];if(config.height>0)$(meta.container).css('height',config.height);meta.map=L.map(meta.container);meta.tiles=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:config.maxzoom,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(meta.map);var onmove=function(){if(skipmove){skipmove=false;return}if(config.move){var pos=meta.map.getCenter();self.SEEX(config.move,pos.lat+','+pos.lng,meta.map.getZoom())}};meta.map.on('moveend',onmove);meta.map.on('zoomend',onmove);self.on('resize + resize2',self.resize);self.resize()};self.resize=function(){setTimeout2(self.ID,self.resizeforce,300)};self.resizeforce=function(){var height=config.height;if(typeof(height)==='string')height=self.parent(config.height).height()-config.margin;if(meta.height!==height){meta.height=height;$(meta.container).css('height',height);meta.map.invalidateSize()}};self.addmarker=function(pos,name,opt){var gps=self.parse(pos);var item=L.marker(gps.slice(0,2),opt);name&&item.bindPopup(name);meta.markers.push(item);item.addTo(meta.map);return item};self.parse=function(pos){var tmp=pos.split(',').trim();tmp[0]=parseFloat(tmp[0]);tmp[1]=parseFloat(tmp[1]);tmp[2]=tmp[2]?parseInt(tmp[2]):config.zoom;return tmp};self.center=function(pos){var gps=self.parse(pos);meta.map.setView(gps.slice(0,2),gps[2])};self.search=function(name,callback){AJAX('GET https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(name),function(response){if(response instanceof Array){for(var item of response){item.pos=item.lat+','+item.lon;item.name=item.display_name;item.id=item.place_id}}callback(response)})};self.marker=function(pos){if(config.marker){if(meta.marker){meta.marker.setLatLng(pos)}else{var opt={};if(config.draggable)opt.draggable=true;if(config.icon){var iconopt={};iconopt.iconUrl=config.icon;if(config.iconanchor)iconopt.iconAnchor=self.parse(config.iconanchor);if(config.iconsize)iconopt.iconSize=self.parse(config.iconsize);opt.icon=new L.Icon(iconopt)}meta.marker=L.marker(pos,opt);meta.marker.addTo(meta.map);meta.markers.push(meta.marker);meta.marker.on('click',function(e){config.click&&self.SEEX(config.click,e.latlng.lat+','+e.latlng.lng,e)});meta.marker.on('moveend',function(e){skip=true;let tmp=e.target._latlng;let pos=tmp.lat+','+tmp.lng;self.bind('@touched @modified',pos);config.exec&&self.EXEC(config.exec,pos,self)})}}};self.setter=function(value){if(skip){skip=false;return}var address=config.center;if(value){var tmp=value.replace(/\.|,|\s/g,'');if(!(/^\d+$/).test(tmp)){address=value;value=''}}if(value){skipmove=true;var pos=self.parse(value);meta.map.setView(pos.slice(0,2),pos[2]);self.marker(pos);self.resize()}else{if(address){self.search(address,function(response){var item=response[0];if(item){var gps=self.parse(item.pos);var pos=gps.slice(0,2);meta.map.setView(pos,gps[2]);self.marker(pos);skip=true;self.bind('@modified',item.pos);self.setter(item.pos);self.resize()}})}}}},[function(next){let cdn=(DEF.cdn||'https://cdn.componentator.com');IMPORT(cdn+'/leaflet.min@180.css',()=>IMPORT(cdn+'/leaflet.min@180.js',next))}]);

COMPONENT('listdetail','resize:1;width:35%;parent:auto;margin:0;maxwidth:50%;minwidth:20%',function(self,config,cls){var a,b,temp,init,resizer,is=false,cls2='.'+cls,events={};self.readonly();self.make=function(){var arr=self.find('> section');a=$(arr[0]);b=$(arr[1]);a.aclass(cls+'-list');b.aclass(cls+'-detail');self.element.prepend('<div class="{0}-resizer"></div>'.format(cls));self.aclass(cls);temp=$('<div />');temp.aclass(cls+'-temporary');self.resize();self.on('resize + resize2',self.resize);resizer=self.find(cls2+'-resizer');events.move=function(e){e.preventDefault();e.stopPropagation();var tmp=events.touches?e.touches[0]:e,x=events.x-tmp.pageX;resizer.css('left',events.left-x)};events.up=function(){var parent=self.parent(config.parent);var w=parent.width();var left=w-resizer.position().left;if(left<config.minwidth)left=config.minwidth;if(left>config.maxwidth)left=config.maxwidth;config.width=left;a.css('margin-right',left);b.css('width',left);events.unbind();self.resizeforce()};events.bind=function(){if(!events.is){events.is=true;self.aclass(cls+'-resizing');$(W).on('mousemove touchmove',events.move).on('mouseup touchend',events.up)}};events.unbind=function(){if(events.is){events.is=false;self.rclass(cls+'-resizing');$(W).off('mousemove touchmove',events.move).off('mouseup touchend',events.up)}};self.event('mousedown touchstart',cls2+'-resizer',function(e){if(!config.resize)return;events.touches=e.type==='touchstart'?1:0;var tmp=events.touches?e.touches[0]:e;events.x=tmp.pageX;events.left=resizer.position().left;events.bind();e.preventDefault();e.stopPropagation()})};self.resize=function(){setTimeout2(self.ID,self.resizeforce,200)};self.resizeforce=function(){var parent=self.parent(config.parent);var h=parent.height()-config.margin;var w=parent.width();if(typeof(config.width)==='string')config.width=w.inc(config.width)>>0;if(typeof(config.minwidth)==='string')config.minwidth=w.inc(config.minwidth)>>0;if(typeof(config.maxwidth)==='string')config.maxwidth=w.inc(config.maxwidth)>>0;var css={};css.width=config.width;css.height=h;b.css(css);css.height=h;css.left=is?(w-config.width):'-1px';css.width='';resizer.css(css);css.left='';css['margin-right']=is?config.width:'';a.css(css);is&&b.SETTER('*/resize');a.SETTER('*/resize');if(!init){init=true;self.rclass('hidden invisible')}};self.toggle=function(show){if(show===is)return;is=show;if(is)self.dom.insertBefore(b[0],a[0]);else temp[0].appendChild(b[0]);self.tclass(cls+'-visible',is);self.resizeforce()};self.setter=function(value){self.toggle(!!value)}});

COMPONENT('listform','empty:---;default:1;delay:1000',function(self,config,cls){var cls2='.'+cls,rendered=false,skip2=false,skip=false,container,form,items,plugin;self.validate=function(value){if(config.disabled)return true;var valid=config.required?!!(value&&value.length>0):true;if(valid&&config.invalidform)valid=self.$$invalid?false:valid;return valid};self.make=function(){plugin=config.plugin||self.ID;self.aclass(cls+' invisible');if(config.selector){var customselector=$(document).find(config.selector);self.html(customselector.html())}var scr=self.find('script');var tmp;self.template=Tangular.compile(scr.eq(0).html());form='<div class="{0}-form-container hidden{2}"><ui-plugin path="{1}" config="isolated:1"><div class="{0}-form">{3}</div></ui-plugin></div>'.format(cls,plugin,config.formclass?(' '+config.formclass):'',scr.eq(1).html());tmp=scr.eq(2).html();scr.remove();var footer=tmp?'<div class="{0}-footer">{1}</div>'.format(cls,tmp):'';if(footer&&config.footertop)self.append(tmp);self.append('<div class="{0}-container"><div class="{0}-emptylabel">{1}</div><div class="{0}-items"></div></div>'.format(cls,config.empty));if(footer&&!config.footertop)self.append(tmp);container=self.find(cls2+'-items');var entersubmit=function(){self.find('button[name="submit"]').trigger('click')};config.enter&&self.event('keydown','input',function(e){if(config.enter&&e.which===13)setTimeout2(self.ID,entersubmit,200)});self.event('click',cls2+'-item',function(){if(config.disabled)return;var t=this;if(form.$target===t)self.cancel();else self.edit(t)});self.event('click','button',function(e){if(config.disabled)return;var el=$(this);var parent=el.closest(cls2+'-item');var tmp,fn;if(parent.length){var data=parent[0].$data;self.cancel();e.stopPropagation();switch(this.name){case'up':case'down':tmp=parent.aclass(cls+'-item-highlight');tmp.rclass(cls+'-item-highlight',1000);var index=items.indexOf(data);tmp=index+(this.name==='up'?-1:1);if(tmp<0||tmp>=items.length)return;var a=items[tmp];items[tmp]=items[index];items[index]=a;NODEMOVE(parent[0],this.name==='up');skip=true;self.bind('@modified @touched @setter',items);config.move&&self.EXEC(config.move,items);break;case'remove':fn=function(is){self.cancel();if(is!==false&&data){parent.remove();items.splice(items.indexOf(data),1);skip=true;self.bind('@modified @touched @setter',items)}};if(config.remove)self.EXEC(config.remove,data,fn,self.get());else fn();break}return}var is=false;switch(this.name){case'create':self.add();is=true;break;case'submit':case'update':tmp=GET('{0} @reset'.format(plugin));fn=function(tmp){if(tmp){if(!items)items=[];if(form.$target){COPY(tmp,form.$data);self.redraw(form.$target,form.$data)}else{items.push(tmp);self.create(tmp)}self.$$invalid=false;skip=true;self.bind('@modified @touched @setter',items)}self.cancel()};if(config[this.name])self.EXEC(config[this.name],tmp,fn,self.get(),form.$data);else fn(tmp);is=true;break;case'cancel':self.cancel();is=true;break;case'remove':var el=form.$target,data=form.$data;fn=function(is){if(is!==false&&data){el.parentNode.removeChild(el);items.splice(items.indexOf(data),1);skip=true;self.$$invalid=false;self.bind('@modified @touched @setter',items)}self.cancel()};if(config.remove)self.EXEC(config.remove,data,fn,self.get());else fn();is=true;break}if(is){e.preventDefault();e.stopPropagation()}})};self.configure=function(key,value,init){switch(key){case'disabled':self.tclass('ui-'+key,!!value);self.find('button[name="create"]').prop('disabled',!!value);break;case'required':self.tclass(cls+'-'+key,!!value);if(!init)self.validate2();break}};self.add=function(){self.check();if(!$(form).hclass('hidden')&&!form.$data){self.cancel();return}var fn=function(obj){if(config.newbie)obj[config.newbie]=true;if(config.create||!config.default)SET('{0} @reset'.format(plugin),obj);else SET('{0} @default'.format(plugin),obj);self.edit()};if(config.create)self.EXEC(config.create,{},fn,self.get());else fn({})};self.check=function(){if(!self.$$check){form=$(form)[0];container.append(form);self.compile&&self.compile();self.$$check=true;self.$$invalid=true;if(config.invalidform)self.validate2()}};self.edit=function(el){self.check();self.cancel();var before,parent;if(el){parent=el.parentNode;var children=parent.children;for(var i=0;i<children.length;i++){if(children[i]===el){before=children[i+1];break}}form.$target=el;form.$data=el.$data;SET('{0} @reset'.format(plugin),CLONE(el.$data));$(el).aclass(cls+'-selected')}else{parent=container[0];form.$target=form.$data=null}if(before)parent.insertBefore(form,before);else parent.appendChild(form);if(!rendered&&config.delay>300)SETTER('loading/show');setTimeout(function(){if(!rendered&&config.delay>300)SETTER('loading/hide');rendered=true;$(form).tclass(cls+'-new',!el).rclass('hidden');config.autofocus&&self.autofocus(config.autofocus)},rendered?100:config.delay);if(config.invalidform){self.$$invalid=true;self.validate2();skip2=true;self.update()}};self.cancel=function(){if(self.$$check){if(self.$$invalid){self.$$invalid=false;self.validate2();skip2=true;self.update()}if(form.parentNode!==self.dom)self.dom.appendChild(form);form.$target&&$(form.$target).rclass(cls+'-selected');form.$target=form.$data=null;$(form).aclass('hidden')}};self.redraw=function(el,data){el.innerHTML=self.template(data)};self.create=function(item){var dom=document.createElement('DIV');dom.setAttribute('class',cls+'-item'+(config.itemclass?(' '+config.itemclass):''));dom.innerHTML=self.template(item);dom.$data=item;container[0].appendChild(dom)};self.setter=function(value,path,type){if(skip2){skip2=false;return}if((M.is20&&type.init)||!type)self.rclass('invisible');items=value;self.tclass(cls+'-empty',!value||!value.length);self.cancel();if(skip){skip=false;return}form.$data&&self.cancel();container.find(cls2+'-item').remove();if(value){for(var i=0;i<value.length;i++)self.create(value[i])}};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)}});

COMPONENT('listing','pages:3;count:20;scrolltop:1;margin:0;pluralizeitems:# items,# item,# items,# items;pluralizepages:# pages,# page,# pages,# pages',function(self,config,cls){var container,paginate,current,items,pages=0,cls2='.'+cls,layout;self.readonly();self.nocompile&&self.nocompile();self.make=function(){self.find('script').each(function(index){var T=Tangular.compile(this.innerHTML);if(index)layout=T;else self.template=T});self.aclass(cls);self.html('<div class="{0}-scrollbar"><div class="{0}-container"></div></div><div class="{0}-paginate"><div class="{0}-info"></div><div class="{0}-buttons"></div></div>'.format(cls));container=self.find(cls2+'-container');paginate=self.find(cls2+'-paginate');paginate.on('click','button',function(){var index=$(this).attrd('index');switch(index){case'+':index=current+1;if(index>pages)index=1;break;case'-':index=current-1;if(index<1)index=pages;break;default:index=+index;break}self.page(index)});if(config.parent||config.height){self.aclass(cls+'-fixed');self.scrollbar=SCROLLBAR(self.find(cls2+'-scrollbar'),{shadow:config.scrollbarshadow,visibleY:1,orientation:'y'})}self.resize2();self.on('resize + resize2',self.resize2)};self.resize2=function(){setTimeout2(self.ID,self.resize,300)};self.resize=function(){var p=config.parent||config.height;if(p){var margin=config.margin,responsivemargin=config['margin'+WIDTH()];if(responsivemargin!=null)margin=responsivemargin;var parent=self.parent(p);var height=parent.height()-margin-paginate.height()-11;self.find(cls2+'-scrollbar').css('height',height);self.scrollbar.resize()}};self.page=function(index){var builder=[],arr=items.takeskip(config.count,(index-1)*config.count);var g={count:items.length,page:index,pages:pages};for(var i=0;i<arr.length;i++){g.index=i;builder.push(self.template(arr[i],g))}current=index;self.paginate(items.length,index);container.html(layout?layout({page:index,pages:pages,body:builder.join(''),count:items.length}):builder.join(''))};self.paginate=function(count,page){var max=config.pages,half=Math.ceil(max/2);pages=Math.ceil(count/config.count);var pfrom=page-half,pto=page+half,plus=0;if(pfrom<=0){plus=Math.abs(pfrom);pfrom=1;pto+=plus}if(pto>=pages){pto=pages;pfrom=pages-max}if(pfrom<=0)pfrom=1;if(page<half+1){pto++;if(pto>pages)pto--}if(page<2){var template='<button data-index="{0}"><i class="ti ti-caret-{1}"></i></button>',builder=[];builder.push(template.format('-','left'));for(var i=pfrom;i<pto+1;i++)builder.push('<button class="{1}-page" data-index="{0}">{0}</button>'.format(i,cls));builder.push(template.format('+','right'));paginate.find(cls2+'-buttons').html(builder.join(''))}else{var max=half*2+1,cur=(pto-pfrom)+1;if(max>cur&&pages>config.pages&&pfrom>1)pfrom--;paginate.find(cls2+'-page[data-index]').each(function(index){var page=pfrom+index;$(this).attrd('index',page).html(page)})}paginate.find(cls2+'-info').html(pages?(pages.pluralize(config.pluralizepages)+' / '+items.length.pluralize(config.pluralizeitems)):'');paginate.find('.selected').rclass('selected');paginate.find(cls2+'-page[data-index="{0}"]'.format(page)).aclass('selected');paginate.tclass('hidden',pages<2&&!self.scrollbar);self.tclass('hidden',count===0);if(config.scrolltop){if(self.scrollbar)self.scrollbar.scrollTop(0);else $(W).scrollTop(self.element.position().top-50)}};self.setter=function(value){if(value){items=value;self.page(1)}else{items=null;container.empty();paginate.find(cls2+'-buttons').empty();paginate.find(cls2+'-info').aclass('hidden')}}});

COMPONENT('loading',function(self,config,cls){var delay,prev;self.readonly();self.singleton();self.nocompile();self.make=function(){self.aclass(cls+' '+cls+'-'+(config.style||1));self.append('<div><div class="'+cls+'-text hellip"></div></div>');if(M.events){setTimeout(function(){if(!M.events['@flag showloading']){ON('@flag showloading',()=>self.show());ON('@flag hideloading',()=>self.hide(800))}},100)}};self.show=function(text){clearTimeout(delay);if(prev!==text){prev=text;self.find('.'+cls+'-text').html(text||'')}self.rclass('hidden');document.activeElement&&document.activeElement.blur();return self};self.hide=function(timeout){clearTimeout(delay);delay=setTimeout(function(){self.aclass('hidden')},timeout||1);return self}});

COMPONENT('locale',function(self,config){self.singleton();self.readonly();self.nocompile&&self.nocompile();self.use=function(language){if(!language)return;var fdw=0;var nf=1;var tf=24;var df='';switch(language){case'af':nf=2;df='dd/MM/yyyy';tf=24;fdw=0;break;case'sq':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'ar':nf=4;df='yyyy/MM/dd';tf=24;fdw=6;break;case'ar-dz':nf=3;df='dd/yyyy/MM';tf=24;fdw=1;break;case'ar-kw':nf=4;df='dd/MM/yyyy';tf=24;fdw=6;break;case'ar-ly':nf=3;df='dd/yyyy/MM';tf=24;fdw=6;break;case'ar-ma':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'ar-sa':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'ar-tn':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'hy-am':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'az':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'bm':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'be':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'bn':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'bn-bd':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'bs':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'br':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'bg':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'my':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'km':nf=3;df='dd/MM/yyyy';tf=24;fdw=0;break;case'ca':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'tzm':nf=3;df='dd/MM/yyyy';tf=24;fdw=6;break;case'tzm-latn':nf=3;df='dd/MM/yyyy';tf=24;fdw=6;break;case'zh-cn':nf=4;df='yyyy/MM/dd';tf=24;fdw=0;break;case'zh-hk':nf=4;df='yyyy/MM/dd';tf=24;fdw=0;break;case'zh-mo':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'zh-tw':nf=4;df='yyyy/MM/dd';tf=24;fdw=0;break;case'cv':nf=2;df='dd-MM-yyyy';tf=24;fdw=1;break;case'hr':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'cs':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'da':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'nl':nf=3;df='dd-MM-yyyy';tf=24;fdw=1;break;case'nl-be':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'en-au':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'en-ca':nf=4;df='yyyy-MM-dd';tf=12;fdw=0;break;case'en-in':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'en-ie':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'en-il':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'en-nz':nf=4;df='dd/MM/yyyy';tf=12;fdw=1;break;case'en-sg':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'en-gb':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'en':nf=4;df='MM/dd/yyyy';tf=12;fdw=0;break;case'us':nf=4;df='MM-dd-yyyy';tf=12;fdw=0;language='en';break;case'eo':nf=2;df='yyyy-MM-dd';tf=24;fdw=1;break;case'et':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'fo':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'fil':nf=4;df='MM/dd/yyyy';tf=24;fdw=0;break;case'fi':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'fr':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'fr-ca':nf=4;df='yyyy-MM-dd';tf=24;fdw=0;break;case'fr-ch':nf=1;df='dd.MM.yyyy';tf=24;fdw=1;break;case'fy':nf=3;df='dd-MM-yyyy';tf=24;fdw=1;break;case'gl':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'ka':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'de':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'de-at':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'de-ch':nf=1;df='dd.MM.yyyy';tf=24;fdw=1;break;case'el':nf=3;df='dd/MM/yyyy';tf=12;fdw=1;break;case'gu':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'he':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'hi':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'hu':nf=2;df='yyyy.MM.dd';tf=24;fdw=1;break;case'is':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'id':nf=3;df='dd/MM/yyyy';tf=24;fdw=0;break;case'ga':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'it':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'it-ch':nf=1;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ja':nf=4;df='yyyy/MM/dd';tf=24;fdw=0;break;case'jv':nf=3;df='dd/MM/yyyy';tf=24;fdw=0;break;case'kn':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'kk':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'tlh':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'gom-deva':nf=4;df='dd-MM-yyyy';tf=12;fdw=0;break;case'gom-latn':nf=4;df='dd-MM-yyyy';tf=12;fdw=0;break;case'ko':nf=4;df='yyyy.MM.dd';tf=12;fdw=0;break;case'ku':nf=4;df='dd/MM/yyyy';tf=24;fdw=6;break;case'ky':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'lo':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'lv':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'lt':nf=2;df='yyyy-MM-dd';tf=24;fdw=1;break;case'lb':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'mk':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ms-my':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'ms':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'ml':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'dv':nf=4;df='dd/MM/yyyy';tf=24;fdw=5;break;case'mt':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'mi':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'mr':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'mn':nf=4;df='yyyy-MM-dd';tf=24;fdw=1;break;case'me':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ne':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'se':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'nb':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'nn':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'oc-lnc':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'fa':nf=4;df='dd/MM/yyyy';tf=24;fdw=6;break;case'pl':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'pt':nf=2;df='dd/MM/yyyy';tf=24;fdw=0;break;case'pt-br':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'x-pseudo':nf=2;df='dd/MM/yyyy';tf=12;fdw=1;break;case'pa-in':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'ro':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ru':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'gd':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'sr':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'sr-cyrl':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'sd':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'si':nf=4;df='yyyy/MM/dd';tf=12;fdw=1;break;case'sk':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'eu':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;language='en';break;case'sl':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'es':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'es-do':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'es-mx':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'es-us':nf=4;df='MM/dd/yyyy';tf=12;fdw=0;break;case'sw':nf=4;df='dd.MM.yyyy';tf=24;fdw=1;break;case'sv':nf=2;df='yyyy-MM-dd';tf=24;fdw=1;break;case'tl-ph':nf=4;df='MM/dd/yyyy';tf=24;fdw=0;break;case'tg':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'tzl':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ta':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'te':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'tet':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'th':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'bo':nf=4;df='dd/MM/yyyy';tf=12;fdw=0;break;case'tr':nf=3;df='dd.MM.yyyy';tf=24;fdw=1;break;case'tk':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'uk':nf=2;df='dd.MM.yyyy';tf=24;fdw=1;break;case'ur':nf=4;df='dd/MM/yyyy';tf=24;fdw=0;break;case'ug-cn':nf=4;df='yyyy-MM-dd';tf=24;fdw=0;break;case'uz':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'uz-latn':nf=2;df='dd/MM/yyyy';tf=24;fdw=1;break;case'vi':nf=3;df='dd/MM/yyyy';tf=24;fdw=1;break;case'cy':nf=4;df='dd/MM/yyyy';tf=24;fdw=1;break;case'yo':nf=4;df='dd/MM/yyyy';tf=12;fdw=1;break;case'ss':nf=4;df='dd/MM/yyyy';tf=12;fdw=1;break}if(!df)return false;if(config.requests){if(M.is20)DEF.language=language;else DEF.languagehtml=language}DEF.dateformat=df;DEF.timeformat=tf===12?'!HH:mm a':'HH:mm';DEF.firstdayofweek=fdw;DEF.decimalseparator=nf===2||nf===3?',':'.';DEF.thousandsseparator=nf===4?',':nf===3?'.':' ';ENV('ts',(tf===12?'!':'')+df+' - '+(tf===12?DEF.timeformat.substring(1):DEF.timeformat));ENV('date',DEF.dateformat);ENV('time',DEF.timeformat);CONFIG('datepicker,firstday','firstday:'+fdw);CONFIG('timepicker','ampm:'+tf===12?'true':'false');self.path&&self.set({df:df,tf:tf,fdw:fdw,nf:nf});return true};self.make=function(){if(config.language){self.use(config.language)}else{var language=navigator.language.toLowerCase();if(!self.use(language))self.use(language.split('-')[0])}}});

COMPONENT('markdown','highlight:true;charts:false',function(self,config){self.readonly();self.singleton();self.blind();self.nocompile();self.make=function(){let cdn=(DEF.cdn||'https://cdn.componentator.com');if(config.highlight){IMPORT(cdn+'/highlight.min@1020.js');IMPORT(cdn+'/highlight.min@1020.css')}if(config.charts)IMPORT(cdn+'/apexcharts.min@310.js');setTimeout(function(){self.remove()},500);$(document).on('click','.markdown-showsecret,.markdown-showblock',function(){var el=$(this);var next=el.next();next.tclass('hidden');var is=next.hclass('hidden');var icons=el.find('i');if(el.hclass('markdown-showsecret')){icons.eq(0).tclass('ti-unlock',!is).tclass('ti-lock',is);icons.eq(1).tclass('ti-angle-up',!is).tclass('ti-angle-down',is)}else{icons.eq(0).tclass('ti-minus',!is).tclass('ti-plus',is);el.tclass('markdown-showblock-visible',!is)}el.find('b').html(el.attrd(is?'show':'hide'))})};(function Markdown(){var keywords=/\{.*?\}\(.*?\)/g;var linksexternal=/(https|http):\/\//;var format=/__.*?__|_.*?_|\*\*.*?\*\*|\*.*?\*|~~.*?~~|~.*?~/g,ordered=/^[a-z|0-9]{1,3}\.\s|^(-|\*|\+)\s/i;var orderedsize=/^(\s|\t)+/;var code=/`.*?`/g,encodetags=/<|>/g,regdash=/-{2,}/g,regicons=/(^|[^\w]):((fab|far|fas|fal|fad|fa|ti|tic)\s(fa|ti|tic)-)?[a-z-]+:([^\w]|$)/g;var regemptychar=/\s|\W/,regtags=/<[^>]*>/g,encode=function(val){return'&'+(val==='<'?'lt':'gt')+';'};function markdown_code(value){return value?('<code>'+value.substring(1,value.length-1)+'</code>'):''}function markdown_imagelinks(value){if(!value)return'';var end=value.lastIndexOf(')')+1;var img=value.substring(0,end);var url=value.substring(end+2,value.length-1);var label=markdown_links(img);var footnote=label.substring(0,13);if(footnote==='<sup data-id='||footnote==='<span data-id'||label.substring(0,9)==='<a href="')return label;return'<a href="'+url+'"'+(linksexternal.test(url)?' target="_blank"':'')+'>'+label+'</a>'}function markdown_table(value,align,ishead){var columns=value.substring(1,value.length-1).split('|');var builder='';for(var i=0;i<columns.length;i++){var column=columns[i].trim();if(column.charAt(0)!='-'){var a=align[i];builder+='<'+(ishead?'th':'td')+(a&&a!=='left'?(' class="'+a+'"'):'')+'>'+column+'</'+(ishead?'th':'td')+'>'}}return'<tr>'+builder+'</tr>'}function markdown_links(value){if(!value)return'';var end=value.lastIndexOf(']');var img=value.charAt(0)==='!';var text=value.substring(img?2:1,end);var link=value.substring(end+2,value.length-1);if((/^#\d+$/).test(link)){return(/^\d+$/).test(text)?'<sup data-id="{0}" class="markdown-footnote">{1}</sup>'.format(link.substring(1),text):'<span data-id="{0}" class="markdown-footnote">{1}</span>'.format(link.substring(1),text)}if(link.isEmail())return'<a href="mailto:'+link+'" rel="nofollow">'+text+'</a>';if(link.isPhone())return'<a href="tel:'+link+'" rel="nofollow">'+text+'</a>';if(link.substring(0,4)==='www.')link='https://'+link;var nofollow=link.charAt(0)==='@'?' rel="nofollow"':linksexternal.test(link)?' target="_blank"':'';return'<a href="'+link+'"'+nofollow+'>'+text+'</a>'}function markdown_image(value){var end=value.lastIndexOf(']');var text=value.substring(2,end);var link=value.substring(end+2,value.length-1);var responsive=1,f=text.charAt(0);if(f==='+'){responsive=2;text=text.substring(1)}else if(f==='-'){responsive=3;text=text.substring(1)}return'<img src="'+link+'" alt="'+text+'"'+(responsive===1?' class="img-responsive"':responsive===3?' class="markdown-gallery"':'')+' border="0" loading="lazy" />'}function markdown_keywords(value){var keyword=value.substring(1,value.indexOf('}'));var type=value.substring(value.lastIndexOf('(')+1,value.lastIndexOf(')'));return'<span class="markdown-keyword" data-type="{0}">{1}</span>'.format(type,keyword)}function markdown_links2(value){value=value.substring(4,value.length-4);let url=value;if(value.isEmail())url='mailto:'+value;else if(value.isPhone())url='tel:'+value;else if(!linksexternal.test(value))url='http://'+url;return'<a href="'+url+'" target="_blank">'+value+'</a>'}function markdown_format(value,index,text){var p=text.charAt(index-1);var n=text.charAt(index+value.length);if((!p||regemptychar.test(p))&&(!n||regemptychar.test(n))){var beg='',end='',tag;if(value.indexOf('*')!==-1){tag=value.indexOf('**')===-1?'em':'strong';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('_')!==-1){tag=value.indexOf('__')===-1?'u':'b';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('~')!==-1){beg+='<strike>';end='</strike>'+end}var count=value.charAt(1)===value.charAt(0)?2:1;return beg+value.substring(count,value.length-count)+end}return value}function markdown_id(prefix,value){value=value.replace(regtags,'');return prefix+value.slug().replace(regdash,'-')}function markdown_icon(value){var beg=-1,end=-1;for(var i=0;i<value.length;i++){var code=value.charCodeAt(i);if(code===58){if(beg===-1)beg=i+1;else end=i}}var icon=value.substring(beg,end);if(icon.indexOf(' ')===-1)icon='ti ti-'+icon;return value.substring(0,beg-1)+'<i class="'+icon+'"></i>'+value.substring(end+1)}function markdown_urlify(str){return str.replace(/(^|\s)+(((https?:\/\/)|(www\.))[^\s]+)/g,function(url,b,c){var len=url.length,l=url.charAt(len-1);var f=url.charAt(0);if(l==='.'||l===',')url=url.substring(0,len-1);else l='';url=(c==='www.'?'http://'+url:url).trim();return(f.charCodeAt(0)<40?f:'')+'['+url+']('+url+')'+l})}function parseul(builder){var ul={},is=false,currentindex=-1,output=[];for(var i=0;i<builder.length;i++){var line=builder[i];if(line.charAt(0)==='\0'){if(!is)currentindex=output.push('<ul />')-1;var key=currentindex+'';is=true;var tmp=line.substring(1);var index=tmp.indexOf('<');var obj={};obj.index=i;obj.type=tmp.substring(0,2);obj.offset=+tmp.substring(2,index).trim();obj.line=line.substring(index+1);if(ul[key])ul[key].push(obj);else ul[key]=[obj]}else{output.push(line);is=false}}for(var key in ul){var line=+key,arr=ul[key],lines=[],tags=[],prev=null,diff=null,init=false,tmp=null;for(var i=0;i<arr.length;i++){var li=arr[i],beg=li.type==='ul'?'<ul>':li.type==='o1'?'<ol type="1">':'<ol type="a">',end=li.type==='ul'?'</ul>':'</ol>',diff=li.offset-(prev?prev.offset:0);if(!init){init=true;lines.push(beg);tags.push(end)}if(diff>0){var last=lines[lines.length-1];last=last.replace(/<\/li>$/,'');lines[lines.length-1]=last;tags.push(end+'</li>');lines.push(beg);lines.push(li.line)}else if(diff<0){while(diff<0){tmp=tags.pop();lines.push(tmp);diff++}lines.push(li.line)}else{lines.push(li.line)}prev=li}while(tags.length)lines.push(tags.pop());output[line]=lines.join('\n')}return output}FUNC.markdownredraw=function(el,opt){if(!opt)opt=EMPTYOBJECT;if(!el)el=opt.element||$('body');var arr,tmp,prefix=opt.prefix||'';if(!opt.nosecret){arr=el.find('.lang-secret');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;tmp=$(t);tmp.parent().replaceWith('<div class="markdown-secret" data-show="{0}" data-hide="{1}"><span class="markdown-showsecret"><i class="ti ti-lock"></i><i class="ti pull-right ti-angle-down"></i><b>{0}</b></span><div class="hidden">'.format(opt.showsecret||'Show secret data',opt.hidesecret||'Hide secret data')+tmp.html().trim().markdown(opt.secretoptions,true)+'</div></div>')}}}if(!opt.novideo){arr=el.find('.lang-video');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;tmp=$(t);var html=tmp.html();if(html.indexOf('youtube')!==-1)tmp.parent().replaceWith('<div class="markdown-video"><iframe src="https://www.youtube.com/embed/'+html.split('v=')[1]+'" frameborder="0" allowfullscreen></iframe></div>');else if(html.indexOf('vimeo')!==-1)tmp.parent().replaceWith('<div class="markdown-video"><iframe src="//player.vimeo.com/video/'+html.substring(html.lastIndexOf('/')+1)+'" frameborder="0" allowfullscreen></iframe></div>')}}}if(!opt.nochart&&W.ApexCharts){arr=el.find('.lang-barchart');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;tmp=$(t);var arr=tmp.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'bar',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new W.ApexCharts(tmp.parent().empty()[0],options);chart.render()}}arr=el.find('.lang-linechart');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;if(!W.ApexCharts)return;tmp=$(t);var arr=tmp.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'line',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new W.ApexCharts(el.parent().empty()[0],options);chart.render()}}}if(!opt.noiframe){arr=el.find('.lang-iframe');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;tmp=$(t);tmp.parent().replaceWith('<div class="markdown-iframe">'+tmp.html().replace(/&lt;/g,'<').replace(/&gt;/g,'>')+'</div>')}}}if(!opt.nocode&&config.highlight){WAIT('hljs',function(){arr=el.find('.markdown-code');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;tmp=$(t).find('pre code');for(var block of tmp)W.hljs.highlightBlock(block)}}})}arr=el.find('a');for(var t of arr){if(!t.$mdloaded){t.$mdloaded=1;var a=$(t);var href=a.attr('href');var c=href.substring(0,1);if(href==='#'){var beg='',end='',text=a.html();if(text.substring(0,1)==='<')beg='-';if(text.substring(text.length-1)==='>')end='-';a.attr('href','#'+(beg+markdown_id(prefix,a.text())+end))}else if(c!=='/'&&c!=='#')a.attr('target','_blank')}}EMIT('markdown',el,opt);el.find('.markdown-code').rclass('hidden')};Thelpers.markdown=function(val,opt){return val?(val+'').markdown(opt):val};String.prototype.markdown=function(opt,nested){if(opt instanceof jQuery)opt={element:opt};var str=this;if(!opt)opt={};var lines=str.split('\n');var builder=[],ul=[],table=false,iscode=false,isblock=false,ishead=0,isprevblock=false,tmp,prefix=opt.prefix||'',headline='<{0}'+(opt.bookmarks===false?'':' id="{3}"')+' class="markdown-line" data-index="{1}">{2}</{0}>';if(opt.wrap==null)opt.wrap=true;if(opt.linetag==null)opt.linetag='p';var closeul=function(){while(ul.length){var text=ul.pop();builder.push('</'+text+'>')}};var formatlinks=function(val){return markdown_links(val,opt.images)};var linkscope=function(val,index,callback){var beg=-1,beg2=-1,can=false,skip=false,find=false,n;for(var i=index;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;find=true;continue}var codescope=val.substring(i,i+6);if(skip&&codescope==='</code'){skip=false;i+=7;continue}if(skip)continue;if(!find&&codescope==='<code>'){skip=true;continue}var il=val.substring(i,i+4);if(il==='&lt;'){beg2=i;continue}else if(beg2>-1&&il==='&gt;'){callback(val.substring(beg2,i+4),true);beg2=-1;continue}if(c===']'){can=false;find=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);callback(val.substring(beg-(n==='!'?1:0),i+1));can=false;find=false;beg=-1}}};var formatline=function(line){var tmp=[];return line.replace(code,function(text){tmp.push(text);return'\0'}).replace(format,markdown_format).replace(/\0/g,function(){return markdown_code(tmp.shift())})};var imagescope=function(val){var beg=-1,can=false,n;for(var i=0;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;continue}if(c===']'){can=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);var tmp=val.substring(beg-(n==='!'?1:0),i+1);if(tmp.charAt(0)==='!')val=val.replace(tmp,markdown_image(tmp));can=false;beg=-1}}return val};for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(encodetags,encode);if(!lines[i]){if(opt.emptynewline!==false&&!lines[i-1])builder.push('<br />');if(table){table=null;if(opt.tables!==false)builder.push('</tbody></table>')}closeul();builder.push('');continue}var three=lines[i].substring(0,3);if(!iscode&&(three===':::'||(three==='==='))){if(isblock){if(opt.blocks!==false)builder[builder.length-1]+='</div></div>';isblock=false;isprevblock=true;continue}closeul();isblock=true;if(opt.blocks!==false){line=lines[i].substring(3).trim();if(opt.formatting!==false)line=formatline(line);if(opt.custom)line=opt.custom(line);if(opt.html)line=opt.html(line,'block');builder.push('<div class="markdown-block markdown-line" data-line="{0}"><span class="markdown-showblock"><i class="ti ti-plus"></i>{1}</span><div class="hidden">'.format(i,line))}continue}if(!isblock&&lines[i]&&isprevblock){builder.push('<br />');isprevblock=false}if(three==='```'){if(iscode){if(opt.code!==false)builder[builder.length-1]+='</code></pre></div>';iscode=false;continue}closeul();iscode=true;if(opt.code!==false)tmp='<div class="markdown-code markdown-line hidden"><pre class="noscrollbar"><code class="lang-{0}">'.format(lines[i].substring(3));continue}if(iscode){if(opt.code!==false)builder.push(tmp+lines[i]);if(tmp)tmp='';continue}var line=lines[i];if(opt.br!==false)line=line.replace(/&lt;br(\s\/)?&gt;/g,'<br />');if(line.length>10&&opt.urlify!==false&&opt.links!==false)line=markdown_urlify(line);if(opt.custom)line=opt.custom(line);if(line.length>2&&line!=='***'&&line!=='---'){if(opt.formatting!==false)line=formatline(line);if(opt.images!==false)line=imagescope(line);if(opt.links!==false){linkscope(line,0,function(text,inline){if(inline)line=line.replace(text,markdown_links2);else if(opt.images!==false)line=line.replace(text,markdown_imagelinks);else line=line.replace(text,formatlinks)})}if(opt.keywords!==false)line=line.replace(keywords,markdown_keywords);if(opt.icons!==false)line=line.replace(regicons,markdown_icon)}if(!line){if(table){table=null;if(opt.tables!==false)builder.push('</tbody></table>')}}if(line===''&&lines[i-1]===''){closeul();if(opt.emptynewline!==false)builder.push('<br />');continue}if(line[0]==='|'){closeul();if(!table){var next=lines[i+1];if(next[0]==='|'){if(next.indexOf('--')===-1){if(opt.tables!==false)builder.push('<table class="table table-bordered"><thead>');table=[];ishead=2}else{table=[];var columns=next.substring(1,next.length-1).split('|');for(var j=0;j<columns.length;j++){var column=columns[j].trim();var align='left';if(column.charAt(column.length-1)===':')align=column[0]===':'?'center':'right';table.push(align)}if(opt.tables!==false)builder.push('<table class="table table-bordered"><thead>');ishead=1;i++}}else continue}if(opt.tables!==false){if(ishead===1)builder.push(markdown_table(line,table,true)+'</thead><tbody>');else if(ishead===2)builder.push('<tbody>'+markdown_table(line,table));else builder.push(markdown_table(line,table))}ishead=0;continue}if(line.charAt(0)==='#'){closeul();if(line.substring(0,2)==='# '){tmp=line.substring(2).trim();if(opt.headlines!==false){if(opt.html)tmp=opt.html(tmp,'#');builder.push(headline.format('h1',i,tmp,markdown_id(prefix,tmp)))}continue}if(line.substring(0,3)==='## '){tmp=line.substring(3).trim();if(opt.headlines!==false){if(opt.html)tmp=opt.html(tmp,'##');builder.push(headline.format('h2',i,tmp,markdown_id(prefix,tmp)))}continue}if(line.substring(0,4)==='### '){tmp=line.substring(4).trim();if(opt.headlines!==false){if(opt.html)tmp=opt.html(tmp,'###');builder.push(headline.format('h3',i,tmp,markdown_id(prefix,tmp)))}continue}if(line.substring(0,5)==='#### '){tmp=line.substring(5).trim();if(opt.headlines!==false){if(opt.html)tmp=opt.html(tmp,'####');builder.push(headline.format('h4',i,tmp,markdown_id(prefix,tmp)))}continue}if(line.substring(0,6)==='##### '){tmp=line.substring(6).trim();if(opt.headlines!==false){if(opt.html)tmp=opt.html(tmp,'#####');builder.push(headline.format('h5',i,tmp,markdown_id(prefix,tmp)))}continue}}tmp=line.substring(0,3);if(tmp==='---'||tmp==='***'){if(opt.hr!==false)builder.push('<hr class="markdown-line'+(tmp.charAt(0)==='-'?'1':'2')+' markdown-line" data-line="'+i+'" />');continue}if((/^#\d+:(\s)+/).test(line)){if(opt.footnotes!==false){tmp=line.indexOf(':');builder.push('<div class="markdown-footnotebody" data-id="{0}"><span>{0}:</span> {1}</div>'.format(line.substring(1,tmp).trim(),line.substring(tmp+1).trim()))}continue}if(line.substring(0,5)==='&gt; '){if(opt.blockquotes!==false){line=line.substring(5).trim();if(opt.html)line=opt.html(line,'blockquote');builder.push('<blockquote class="markdown-line" data-line="'+i+'">'+line+'</blockquote>')}continue}if(line.substring(0,5)==='&lt; '){if(opt.sections!==false){line=line.substring(5).trim();if(opt.html)line=opt.html(line,'section');builder.push('<section class="markdown-line" data-line="'+i+'">'+line+'</section>')}continue}var tmpline=line.trim();if(opt.ul!==false&&ordered.test(tmpline)){var size=line.match(orderedsize);if(size)size=size[0].length;else size=0;var c=tmpline.charAt(0);var ultype=c==='-'||c==='+'||c==='*'?'ul':'ol',tmpstr=(ultype==='ol'?tmpline.substring(tmpline.indexOf('.')+1):tmpline.substring(2));var istask=false,tt=tmpstr.trim().substring(0,3);istask=tt==='[ ]'||tt==='[x]';var tmpval=tmpstr.trim();if(opt.html)tmpval=opt.html(tmpval,'li');builder.push('\0'+(ultype==='ol'?('o'+((/\d+\./).test(tmpline)?'1':'a')):'ul')+size+'<li data-line="{0}" class="markdown-line{1}">'.format(i,istask?' markdown-task':'')+tmpval.replace(/\[x\]/g,'<i class="ti ti-check-square green"></i>').replace(/\[\s\]/g,'<i class="ti ti-square"></i>')+'</li>')}else{closeul();if(line){line=line.trim();if(opt.html)line=opt.html(line,opt.linetag)}line&&builder.push((opt.linetag?('<'+opt.linetag+' class="markdown-line" data-line="'+i+'">'):'')+line.trim()+(opt.linetag?('</'+opt.linetag+'>'):''))}}closeul();table&&opt.tables!==false&&builder.push('</tbody></table>');iscode&&opt.code!==false&&builder.push('</code></pre>');builder=parseul(builder);if(!opt.noredraw&&typeof(window)==='object')setTimeout(FUNC.markdownredraw,1,null,opt);return(opt.wrap?('<div class="markdown'+(nested?'':' markdown-container')+'">'):'')+builder.join('\n').replace(/\t/g,'    ')+(opt.wrap?'</div>':'')}})();customElements.define('ui-markdown',class extends HTMLElement{constructor(){super();setTimeout(function(el){el.style.display='block';var config=(el.getAttribute('config')||'').parseConfig();if(config.small)el.classList.add('markdown-small');var scr=el.querySelector('scr'+'ipt');var html=Thelpers.markdown((scr?scr.innerHTML:el.innerHTML).trim(),{element:$(el)});if(config.code){html=html.replace(/<code>.*?<\/code>/g,function(text){var index=text.indexOf('{');if(index===-1||text.substring(0,2)==='{{')return text;var color='#d7f6e3',variable=text.substring(index-1);var tmp=variable.substring(0,variable.lastIndexOf('<')).toSearch();if(tmp.length<4)return text;if(tmp==='string'||tmp==='text')color='#f6f5d7';else if(tmp==='date'||tmp==='time'||tmp==='datetime')color='#ffd6d6';else if(tmp==='number')color='#c9e2ef';else if(tmp==='boolean'||tmp==='bool')color='#ded7f6';else if(tmp==='object'||tmp==='json'||tmp==='xml')color='#f6d7d7';var label=text.substring(0,index-1).trim();return label+(label.length>6?'</code> <code style="background-color:'+color+'">':'')+variable.trim()})}el.innerHTML=html},1,this)}static get observedAttributes(){return['config']}})});

COMPONENT('menu','style:2',function(self,config,cls){self.singleton();self.readonly();self.nocompile&&self.nocompile();var cls2='.'+cls,is=false,issubmenu=false,events={},ul,children,prevsub,parentclass,container;self.make=function(){self.aclass('hidden '+cls+'-area');self.append('<div class="{0} {0}-style-{1}"><div class="{0}-items"><ul></ul></div><div class="{0}-submenu hidden"><ul></ul></div>'.format(cls,config.style));container=self.find('> '+cls2);ul=self.find(cls2+'-items').find('ul');children=self.find(cls2+'-submenu');self.element.on('click',function(e){if(e.target===self.dom)self.hide()});self.event('click','li',function(e){var el=$(this);if(!el.hclass(cls+'-divider')&&!el.hclass(cls+'-disabled')){self.opt.scope&&M.scope(self.opt.scope);var index=el.attrd('index').split('-');if(index.length>1){self.opt.callback(self.opt.items[+index[0]].children[+index[1]]);self.hide()}else if(!issubmenu){self.opt.callback(self.opt.items[+index[0]]);self.hide()}}e.preventDefault();e.stopPropagation()});self.event('contextmenu',function(e){e.preventDefault();e.stopPropagation();self.hide()});events.hide=function(){is&&self.hide()};self.event('scroll',events.hide);self.on('reflow + scroll + resize + resize2',events.hide);events.hidechildren=function(){if($(this.parentNode.parentNode).hclass(cls+'-items')){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null;children.aclass('hidden');issubmenu=false}}};events.children=function(){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null}issubmenu=true;var el=prevsub=$(this);var index=+el.attrd('index');var item=self.opt.items[index];el.aclass(cls+'-selected');var html=self.makehtml(item.children,index);children.find('ul').html(html);children.rclass('hidden');var css={},offset=el.position();css.left=ul.width()-5;css.top=offset.top-5;var offsetX=offset.left;offset=self.element.offset();var w=children.width();var left=offset.left+css.left+w;if(left>(WW+30))css.left=(offsetX-w)+5;children.css(css);var leftoffset=children.offset().left;var childrenwidth=children.width();var suboffset=childrenwidth+leftoffset;if(suboffset>WW)children.css('left',-childrenwidth)}};self.bindevents=function(){events.is=true;$(document).on('touchstart mouseenter mousedown',cls2+'-children',events.children);$(W).on('scroll',events.hide);self.element.on('mouseenter','li',events.hidechildren)};self.unbindevents=function(){events.is=false;$(document).off('touchstart mouseenter mousedown',cls2+'-children',events.children);$(W).off('scroll',events.hide);self.element.off('mouseenter','li',events.hidechildren)};self.showxy=function(x,y,items,callback){var opt={};opt.x=x;opt.y=y;opt.items=items;opt.callback=callback;self.show(opt)};self.makehtml=function(items,index){var builder=[],tmp;for(var i=0;i<items.length;i++){var item=items[i];if(typeof(item)==='string'){if(item==='-')tmp='<hr />';else tmp='<span>{0}</span>'.format(item);builder.push('<li class="{0}-divider">{1}</li>'.format(cls,tmp));continue}var cn=item.classname||item.class||'',icon='',color=item.color?'style="color:{color}"'.args(item):'';if(item.icon)icon='<i class="{0}" {1}></i>'.format(item.icon.charAt(0)==='!'?item.icon.substring(1):item.icon.indexOf(' ')===-1?('ti ti-'+item.icon):item.icon,color);else cn=(cn?(cn+' '):'')+cls+'-nofa';tmp='';if(index==null&&item.children&&item.children.length){cn+=(cn?' ':'')+cls+'-children';tmp+='<i class="ti ti-angle-right pull-right"></i>'}if(item.selected)cn+=(cn?' ':'')+cls+'-selected';if(item.disabled)cn+=(cn?' ':'')+cls+'-disabled';tmp+='<div class="{0}-name">{1}{2}{3}</div>'.format(cls,icon,item.name,item.shortcut?'<b>{0}</b>'.format(item.shortcut):'');if(item.note)tmp+='<div class="ui-menu-note">{0}</div>'.format(item.note);builder.push('<li class="{0}" data-index="{2}">{1}</li>'.format(cn,tmp,(index!=null?(index+'-'):'')+i))}return builder.join('')};self.show=function(opt){if(typeof(opt)==='string'){opt={align:opt};opt.element=arguments[1];opt.items=arguments[2];opt.callback=arguments[3];opt.offsetX=arguments[4];opt.offsetY=arguments[5]}var tmp=opt.element?opt.element instanceof jQuery?opt.element[0]:opt.element.element?opt.element.dom:opt.element:null;if(is&&tmp&&self.target===tmp){self.hide();return}var target=opt.element?$(opt.element):null;if(target&&HIDDEN(target))return;self.target=tmp;self.opt=opt;opt.scope=M.scope();var c=opt.classname||opt.class;if(parentclass&&c!==parentclass){self.rclass(parentclass);parentclass=null}self.tclass('ui-large',opt.large==true);if(!opt.nomobile)self.find('{0}'.format(cls2)).aclass('{0}-mobile'.format(cls));issubmenu=false;prevsub=null;var css={};children.aclass('hidden');children.find('ul').empty();ul.html(self.makehtml(opt.items));if(!parentclass&&c){self.aclass(c);parentclass=c}if(is){css.left=0;css.top=0;container.css(css)}else{self.rclass('hidden');self.aclass(cls+'-visible',100);is=true;if(!events.is)self.bindevents()}var plusW=opt.offsetWidth||0;if(opt.fixedwidth){var tmpw=target.width()+plusW;container.css({'max-width':tmpw,width:tmpw});plusW=0}else container.css({'max-width':'',width:''});var w=container.width();if(opt.element){var offset=target.offset();switch(opt.align){case'center':css.left=Math.ceil((offset.left-w/2)+(target.innerWidth()/2));break;case'right':css.left=(offset.left-w)+target.innerWidth();break;default:css.left=offset.left;break}css.top=opt.position==='bottom'?(offset.top-container.height()-10):(offset.top+target.innerHeight()+10)}else{css.left=opt.x;css.top=opt.y}if(opt.position==='bottom')css.top+=10;else css.top-=10;if(opt.offsetX)css.left+=opt.offsetX;if(opt.offsetY)css.top+=opt.offsetY;var mw=w,mh=container.height();if(css.left<0)css.left=10;else if((mw+css.left)>WW)css.left=(WW-mw)-10;if(css.top<0)css.top=10;else if((mh+css.top)>WH)css.top=(WH-mh)-10;container.css(css)};self.hide=function(){events.is&&self.unbindevents();is=false;self.opt&&self.opt.hide&&self.opt.hide();self.target=null;self.opt=null;self.aclass('hidden');self.rclass(cls+'-visible')}});

COMPONENT('message','button:OK;style:2',function(self,config,cls){var cls2='.'+cls,is,events={};self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){var pls=(config.style===2?(' '+cls+'2'):'');self.aclass(cls+' hidden'+pls);if(config.closeoutside)self.event('click',function(e){var node=e.target,skip={SPAN:1,A:1,I:1};if(!skip[node.tagName])self.hide()});else self.event('click','button',self.hide)};events.keyup=function(e){if(e.which===27)self.hide()};events.bind=function(){if(!events.is){$(W).on('keyup',events.keyup);events.is=false}};events.unbind=function(){if(events.is){events.is=false;$(W).off('keyup',events.keyup)}};self.warning=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=null}if(icon&&typeof(icon)!=='string')icon=null;if(message instanceof Array){var builder=[];for(var i=0;i<message.length;i++){var err=message[i].error;err&&builder.push(err)}message=builder.join('<br />')}self.callback=fn;self.content(cls+'-warning',message,icon||'warning')};self.info=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=null}if(icon&&typeof(icon)!=='string')icon=null;if(message instanceof Array){var builder=[];for(var i=0;i<message.length;i++){var err=message[i].error;err&&builder.push(err)}message=builder.join('<br />')}self.callback=fn;self.content(cls+'-info',message,icon||'info-circle')};self.success=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=null}if(icon&&typeof(icon)!=='string')icon=null;self.callback=fn;self.content(cls+'-success',message,icon||'check-circle')};self.response=function(message,callback,response){var fn;if(typeof(message)==='function'){response=callback;fn=message;message=null}else if(typeof(callback)==='function')fn=callback;else{response=callback;fn=null}if(response instanceof Array){var builder=[];for(var i=0;i<response.length;i++){var err=response[i].error;err&&builder.push(err)}self.warning(builder.join('<br />'));SETTER('!loading/hide')}else if(typeof(response)==='string'){self.warning(response);SETTER('!loading/hide')}else{if(message){if(message.length<40&&message.charAt(0)==='?')SET(message,response);else self.success(message)}if(typeof(fn)==='string')SET(fn,response);else if(fn)fn(response)}};self.hide=function(){events.unbind();self.callback&&self.callback();self.aclass('hidden')};self.content=function(classname,text,icon){if(icon.indexOf(' ')===-1)icon='ti ti-'+icon;!is&&self.html('<div><div class="{0}-icon"><i class="{1}"></i></div><div class="{0}-body"><div class="{0}-text"></div><hr /><button>{2}</button></div></div>'.format(cls,icon,config.button));self.rclass2(cls+'-').aclass(classname);self.find(cls2+'-body').rclass().aclass(cls+'-body');is&&self.find(cls2+'-icon').find('.ti').rclass2('ti').aclass(icon);self.find(cls2+'-text').html(text);self.rclass('hidden');self.element.focus();is=true;events.bind();document.activeElement&&document.activeElement.blur();setTimeout(function(){self.aclass(cls+'-visible');setTimeout(function(){self.find(cls2+'-icon').aclass(cls+'-icon-animate');document.activeElement&&document.activeElement.blur()},300)},100)}});

COMPONENT('miniform','zindex:12',function(self,config,cls){var cls2='.'+cls,csspos={};if(!W.$$miniform){W.$$miniform_level=W.$$miniform_level||1;W.$$miniform=true;$(document).on('click',cls2+'-button-close',function(){$(this).component().set(null)});var resize=function(){setTimeout2(self.name,function(){for(var m of M.components){if(m.name===self.name&&!HIDDEN(m.dom)&&(m.ready||(m.$ready&&!m.$removed)))m.resize()}},200)};ON('resize2',resize);$(document).on('click',cls2+'-container',function(e){if(e.target===this){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}var el=$(e.target);if(el.hclass(cls+'-container-cell')){var form=$(this).find(cls2);var c=cls+'-animate-click';form.aclass(c).rclass(c,300);var com=el.parent().component();if(com&&com.config.closeoutside)com.set('')}})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){if(config.cancel)self.EXEC(config.cancel,self.hide);else self.hide()};self.hide=function(){config.close&&self.EXEC(config.close);if(config.independent)self.hideforce();self.esc(false);self.set('')};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){config.hide&&self.SEEX(config.hide);self.aclass('hidden');self.release(true);self.find(cls2).rclass(cls+'-animate');W.$$miniform_level--}};self.resize=function(){if(!config.center||self.hclass('hidden'))return;var ui=self.find(cls2);var fh=ui.innerHeight();var wh=WH,r=(wh/2)-(fh/2);csspos.marginTop=(r>30?(r-15):20)+'px';ui.css(csspos)};self.make=function(){$(document.body).append('<div id="{0}" class="hidden {4}-container invisible"><div class="{4}-container-table"><div class="{4}-container-cell"><div class="{4}" style="max-width:{1}px"><div class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="ti ti-times"></i></button><i class="{4}-icon hidden"></i><span></span></div></div></div></div>'.format(self.ID,config.width||800,self.path,config.closebutton==false?' hidden':'',cls));var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';if(scr.length)scr.remove();var el=$('#'+self.ID);var body=el.find(cls2)[0];while(self.dom.children.length)body.appendChild(self.dom.children[0]);self.rclass('hidden invisible');var csscls=self.attr('class');csscls&&el.aclass(csscls);self.replace(el,true);self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){e.which===13&&!self.find('button[name="submit"]')[0].disabled&&setTimeout2(self.ID+'enter',self.submit,500)})};self.configure=function(key,value,init,prev){switch(key){case'title':self.find(cls2+'-title > span').text(value);break;case'icon':var icon=self.find(cls2+'-icon');icon.rclass2('fa ti');if(value)icon.aclass(self.icon(value)).rclass('hidden');else icon.aclass('hidden');break;case'width':!init&&value!==prev&&self.find(cls2).css('max-width',value+'px');break;case'closebutton':!init&&self.find(cls2+'-button-close').tclass('hidden',value!==true);break}};self.setter=function(value){setTimeout2(cls+'-noscroll',function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)},50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$miniform_level<1)W.$$miniform_level=1;W.$$miniform_level++;self.css('z-index',W.$$miniform_level*config.zindex);self.rclass('hidden');self.resize();self.release(false);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);setTimeout(function(){self.rclass('invisible');self.find(cls2).aclass(cls+'-animate');config.autofocus&&self.autofocus(config.autofocus)},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$miniform_level*config.zindex)+1)},400);config.closeesc&&self.esc(true)}});

COMPONENT('movable','move:true',function(self,config){var events={},draggable,check;self.readonly();self.make=function(){var target=config.global?$(document):config.parent?self.parent(config.parent):self.element;target.on('dragenter dragover dragexit drop dragleave dragstart',config.selector,events.ondrag).on('mousedown',config.selector,events.ondown)};self.configure=function(key,value){if(key==='check')check=value?GET(self.makepath(value)):null};events.ondrag=function(e){if(config.disabled||!draggable){e.preventDefault();return}if(e.type!=='dragstart'){e.stopPropagation();e.preventDefault()}switch(e.type){case'drop':var parent=config.container?$(draggable).closest(config.container)[0]:draggable.parentNode;var a=draggable,b=e.target,ai=-1,bi=-1,is=false;draggable=null;while(true){if(b.parentNode===parent){is=true;break}b=b.parentNode;if(b==null||b.tagName==='HTML')break}if(a===b||!is)return;for(var i=0;i<parent.children.length;i++){var child=parent.children[i];if(a===child)ai=i;else if(b===child)bi=i;if(bi!==-1&&ai!==-1)break}var children,$b=$(e.target);b=$b.filter(config.selector);if(!b.length)b=$b.closest(config.selector);if(b.length)b=b[0];else return;if(config.move){if(ai>bi)parent.insertBefore(a,b);else parent.insertBefore(a,b.nextSibling);children=$(parent).find(config.selector).toArray()}else{children=$(parent).find(config.selector);var tmp=[];for(var i=0;i<children.length;i++){var item=children[i];if(item===a)tmp.push(b);else if(item===b)tmp.push(a);else tmp.push(item)}children=tmp}config.exec&&self.EXEC(config.exec,children,a,b);self.path&&self.change(true);break;case'dragstart':var eo=e.originalEvent;eo.dataTransfer&&eo.dataTransfer.setData('text','1');break;case'dragenter':case'dragover':case'dragexit':case'dragleave':break}};events.ondown=function(e){if(config.disabled)return;if(e.target.nodeName==='INPUT'||e.target.nodeName==='TEXTAREA')draggable=null;else draggable=!check||check($(this))?this:null};self.destroy=function(){$(document).off('dragenter dragover dragexit drop dragleave dragstart',config.selector,events.ondrag).off('mousedown',config.selector,events.ondown)}});

COMPONENT('noscrollbar','margin:0;invisible:1;delay:100;initdelay:250',function(self,config,cls){var container,init=false,cache='',scrolltoforce;self.readonly();self.init=function(){var resize=function(){for(var m of M.components){if(m.name==='noscrollbar'&&m.dom.offsetParent&&(m.ready||(m.$ready&&!m.$removed)))m.resizeforce()}};ON('resize2',()=>setTimeout2('noscrollbarresize',resize,200))};self.configure=function(key,value,init){switch(key){case'minheight':case'margin':case'marginxs':case'marginsm':case'marginmd':case'marginlg':!init&&self.resizeforce();break}};self.scrollbottom=function(val){if(val==null)return self.dom.scrollTop;if(container)self.dom.scrollTop=self.dom.scrollHeight-container.height()-(val||0);return self.dom.scrollTop};self.scrolltop=function(val){if(val==null)return self.dom.scrollTop;self.dom.scrollTop=(val||0);return self.dom.scrollTop};self.make=function(){self.aclass('noscrollbar '+cls);self.css('overflow','auto');config.invisible&&self.aclass('invisible');self.resize()};self.resize=function(){setTimeout2(self.ID,self.resizeforce,200)};self.resizeforce=function(){var el=self.parent(config.parent);var h=el.height();var width=WIDTH();container=el;var key=width+'x'+h+'x'+config.margin;if(cache===key){if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}return}cache=key;var margin=config.margin,responsivemargin=config['margin'+width];if(responsivemargin!=null)margin=responsivemargin;if(margin==='auto')margin=self.element.offset().top;if(h===0){self.$waiting&&clearTimeout(self.$waiting);self.$waiting=setTimeout(self.resize,234);return}if(margin)h-=margin;if(config.minheight&&h<config.minheight)h=config.minheight;self.css('height',h);self.element.SETTER('*','resize');var c=cls+'-hidden';self.hclass(c)&&self.rclass(c,100);if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}if(!init){self.rclass('invisible',config.initdelay);init=true}};self.setter=function(){scrolltoforce=config.scrollto||config.scrolltop;if(scrolltoforce){if(scrolltoforce==='bottom'){if(container){self.scrollbottom(0);scrolltoforce=null}}else{self.scrolltop(0);scrolltoforce=null}}setTimeout(self.resize,config.delay,scrolltoforce)}});

COMPONENT('notify','timeout:3000;position:top-right',function(self,config,cls){var cls2='.'+cls,istop=false,autoclosing;self.singleton();self.readonly();self.nocompile();self.template=Tangular.compile('<div class="{0} {0}-{{ type}} {0}-hidden" data-id="{{ id}}"><figure><div class="{0}-dot"></div><div class="{0}-icon"><i class="ti {{ icon}}"></i></div><div class="{0}-message">{{ message | raw}}</div></figure></div>'.format(cls));self.items={};self.make=function(){self.aclass(cls+'-container');self.event('click',cls2,function(){var el=$(this);self.close(el.attrd('id'));clearTimeout(autoclosing);autoclosing=null;self.autoclose()})};self.configure=function(key,value){if(key==='position'){var c=cls+'-container-';self.rclass2(c).aclass(c+value.replace(/_|\s/,'-'));istop=value.indexOf('top')!==-1}};self.close=function(id){var obj=self.items[id];if(obj){delete self.items[id];var item=self.find('div[data-id="{0}"]'.format(id));item.find('figure').empty();item.animate({height:0},300,function(){item.remove()})}};self.response=function(message,callback,response){var fn;if(typeof(message)==='function'){response=callback;fn=message;message=null}else if(typeof(callback)==='function')fn=callback;else{response=callback;fn=null}if(response instanceof Array){var builder=[];for(var i=0;i<response.length;i++){var err=response[i].error;err&&builder.push(err)}self.append(builder.join('<br />'),2);SETTER('!loading/hide')}else if(typeof(response)==='string'){self.append(response,2);SETTER('!loading/hide')}else{if(message){if(message.length<40&&message.charAt(0)==='?')SET(message,response);else self.append(message,1)}if(typeof(fn)==='string')SET(fn,response);else if(fn)fn(response)}};self.warning=function(message){self.append(message,2)};self.success=function(message){self.append(message,1)};self.info=function(message){self.append(message,3)};self.append=function(message,type){if(!type)type=1;switch(type){case'success':type=1;break;case'warning':type=2;break;case'info':type=3;break}var icon;if(message.charAt(0)==='"'){var index=message.indexOf('"',1);icon=self.icon(message.substring(1,index).trim());message=message.substring(index+1).trim()}var obj={id:Math.floor(Math.random()*100000).toString(36),message:message,type:type,icon:icon||(type===1?'ti-check-circle':type===2?'ti-times-circle':'ti-info-circle')};self.items[obj.id]=obj;var el=$(self.template(obj));if(istop)self.element.append(el);else self.element.prepend(el);self.autoclose();setTimeout(function(){el.rclass(cls+'-hidden')},20)};self.autoclose=function(){if(autoclosing)return;autoclosing=setTimeout(function(){clearTimeout(autoclosing);autoclosing=null;var el=self.find(cls2);el.length>1&&self.autoclose();el.length&&self.close(el.eq(istop?0:(el.length-1)).attrd('id'))},config.timeout)}});

COMPONENT('page','hide:1;loading:1;delay:500;delayloading:800',function(self,config,cls){var init=false,clid=null,downloading=false,isresizing=false,cache={},isplugin=false;self.releasemode&&self.releasemode('true');self.readonly();self.make=function(){self.aclass(cls)};self.resize=function(){if(config.absolute){var pos=self.element.position();var obj={};obj.width=WW-pos.left;obj.height=WH-pos.top;self.css(obj)}};var replace=function(value){return value.replace(/\?/g,config.path||config.if)};self.setter=function(value){var is=false;if(value instanceof Array){for(let m of value){if(m&&cache[m]){is=true;break}}}else is=value?cache[value]:false;if(is){if(downloading)return;if(config.absolute&&!isresizing){self.on('resize2',self.resize);isresizing=true}if(self.dom.hasChildNodes()){if(clid){clearTimeout(clid);clid=null}self.release(false);var done=function(){config.hide&&self.rclass('hidden');config.reload&&EXEC(replace(config.reload));config.default&&DEFAULT(replace(config.default),true);var invisible=self.hclass('invisible');invisible&&self.rclass('invisible',config.delay);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200);config.autofocus&&self.autofocus(config.autofocus)};if(config.check)EXEC(replace(config.check),done);else done()}else{config.loading&&SETTER('loading/show');downloading=true;setTimeout(function(){var preparator;if(config.replace)preparator=GET(replace(config.replace));else{preparator=function(content){var path=replace(config.path||config.if);isplugin=content.includes('<ui-plugin');return ADAPT(path,config.id,content)}}var callback=function(){if(!init){config.init&&EXEC(replace(config.init));init=true}var watcher=function(){if(isplugin){var name=config.path||config.if;WAIT(()=>PLUGINS[name],done)}else done()};var done=function(){config.hide&&self.rclass('hidden');self.release(false);config.reload&&EXEC(replace(config.reload),true);config.default&&DEFAULT(replace(config.default),true);config.loading&&SETTER('loading/hide',config.delayloading);var invisible=self.hclass('invisible');invisible&&self.rclass('invisible',config.delay);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200);downloading=false;config.autofocus&&self.autofocus(config.autofocus)};EMIT('pages.'+config.if,self.element,self);if(config.check)EXEC(replace(config.check),watcher);else watcher()};if(M.is20)self.import(replace(config.url)+' @prepend',callback,preparator);else self.import(replace(config.url),callback,true,preparator)},200)}}else{if(!self.hclass('hidden')){config.hidden&&EXEC(replace(config.hidden));config.hide&&self.aclass('hidden'+(config.invisible?' invisible':''));self.release(true)}if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000)}};self.emitresize=function(){self.element.SETTER('*/resize')};self.configure=function(key,value){switch(key){case'if':var tmp=(value+'').split(',').trim();cache={};for(var i=0;i<tmp.length;i++)cache[tmp[i]]=1;break;case'absolute':var is=!!value;self.tclass(cls+'-absolute',is);break}};self.clean=function(){if(self.hclass('hidden')){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null;setTimeout(FREE,1000)},1000)}}});

COMPONENT('permissions','placeholder:Search;types:C,R,U,D;default:R;autoremove:1;autoexclude:1',function(self,config,cls){var cls2='.'+cls,skip=false,dirsource=EMPTYARRAY,types=EMPTYARRAY,tbody;self.configure=function(key,value){switch(key){case'types':types=value.split(',');for(let i=0;i<types.length;i++){let tmp=types[i].split('|');types[i]={id:tmp[0],name:tmp[1]||tmp[0]}}self.recompile();break;case'disabled':self.tclass(cls+'-disabled',value);break;case'dirsource':if(value){if(value.includes(',')){dirsource=value.parseSource();self.redraw()}else{self.datasource(value,function(value,path){dirsource=CLONE(M.is20?value:path);self.redraw()})}}break}};self.redraw=function(){setTimeout2(self.ID,self.redrawforce,50)};self.redrawforce=function(){if(!dirsource)return;let items=self.get();tbody.empty();if(!items||!items.length){config.empty&&tbody.append('<tr><td class="{0}-empty"><i class="ti ti-database"></i>{1}</td></tr>'.format(cls,config.empty));return}let builder=[];let remove=[];let cache={};for(let m of items){let op=m.substring(0,1);let who=m.substring(1);if(cache[who])cache[who].push(op);else cache[who]=[op]}for(let key in cache){let name=dirsource.findValue('id',key,'name');if(name)builder.push(self.template({id:key,name:name,value:cache[key]}));else if(config.autoremove)remove.push(key)}if(remove.length){for(let m of remove)items.splice(items.indexOf(m),1)}if(items.length)tbody.html(builder.join(''));else config.empty&&tbody.append('<tr><td class="{0}-empty"><i class="ti ti-database"></i>{1}</td></tr>'.format(cls,config.empty))};self.recompile=function(){var builder=['<tr data-id="{{ id}}"><td class="{0}-text"><i class="ti ti-trash {0}-remove red"></i>{{ name | raw}}</td>'];for(let type of types)builder.push('<td class="{0}-type{{ if value.includes(\'{1}\') }} {0}-checked{{ fi}}" data-type="{1}"><i class="ti"></i>{2}</td>'.format(cls,type.id,type.name));builder.push('</tr>');self.template=Tangular.compile(builder.join('').format(cls))};self.make=function(){self.aclass(cls);config.disabled&&self.aclass(cls+'-disabled');self.html('<div class="{0}-header"><i class="ti ti-plus-circle green"></i><span>{1}</span></div><div class="{0}-container invisible"><table><tbody></tbody></table></div>'.format(cls,self.html()));tbody=self.find('tbody');self.event('click',cls2+'-header',function(){if(config.disabled)return;let items=self.get()||[];let opt={};let used={};for(let m of items){let id=m.substring(1);used[id]=1}opt.raw=!!config.dirraw;opt.element=$(this);opt.placeholder=config.placeholder;opt.items=dirsource;if(config.autoexclude)opt.exclude=item=>used[item.id];opt.callback=function(selected){if(!used[selected.id]){items.push(types[0].id+selected.id);self.bind('@modified @touched @setter',items);config.exec&&self.EXEC(config.exec,items)}};SETTER('directory/show',opt)});self.event('click',cls2+'-type',function(){if(config.disabled)return;let el=$(this);let tr=el.closest('tr');let is=false;el.tclass(cls+'-checked');let id=ATTRD(el);let items=self.get();let types=[];tr.find(cls2+'-checked').each(function(){let checked=$(this);let type=ATTRD(checked,'type');types.push(type)});let rem=[];for(let item of items){if(item.substring(1)===id)rem.push(item)}for(let item of rem)items.splice(items.indexOf(item),1);for(let type of types)items.push(type+id);self.bind('@modified @touched',items);config.exec&&self.EXEC(config.exec,items)});self.event('click',cls2+'-remove',function(e){if(config.disabled)return;var el=$(this);var id=el.closest('tr').attrd('id');var items=self.get();items=items.remove(n=>n.substring(1)===id);self.bind('@modified @touched @setter',items);config.exec&&self.EXEC(config.exec,items)})};self.setter=function(value){self.redraw();self.find(cls2+'-container').rclass('invisible')}});

COMPONENT('pictures','grid:4',function(self,config,cls){var cls2='.'+cls,container,template=Tangular.compile(`{{ foreach item in value}}
<div class="{0}-item" draggable="true" data-id="{{ item}}">
	<span class="{0}-remove"><i class="ti ti-remove"></i></span>
	<img src="{{ item}}" class="img-responsive" alt="" />
</div>
{{ end}}
`.format(cls));self.make=function(){self.aclass(cls);W[self.ID+'reorder']=function(img){if(config.disabled)return;let arr=[];for(let m of img)arr.push(ATTRD(m));self.bind('@modified @touched',arr)};self.append('<ui-component name="movable" config="selector:.{0}-item;exec:{1};disabled:{3}" class="grid-{2}"></ui-component>'.format(cls,self.ID+'reorder',config.grid,config.disabled));container=self.find('ui-component');self.event('click',cls2+'-remove',function(){if(config.disabled)return;var el=$(this);var model=self.get();var index=model.indexOf(ATTRD(el));if(index!=-1){model.splice(index,1);self.bind('@modified @touched',model);el.closest(cls2+'-item').remove()}});self.event('click',cls2+'-empty',function(){if(config.disabled)return;self.EXEC(config.upload,function(response){var model=self.get();if(!model||!(model instanceof Array))model=[];if(response instanceof Array)model.push.apply(model,response);else model.push(response);self.bind('@modified @touched @setter',model)})})};self.destroy=function(){delete W[self.ID+'reorder']};self.configure=function(key,value,init){if(key==='disabled'&&!init)container.component().reconfigure({disabled:value})};self.setter=function(value){let html=template({value:value||EMPTYARRAY});DIFFDOM(container,cls2+'-item',html)}});

COMPONENT('preview','width:200;height:100;convert:jpg;background:#FFFFFF;quality:90;customize:1;schema:{file\\:base64,name\\:filename}',function(self,config,cls){var empty,img,canvas,name,content=null;self.readonly();self.nocompile&&self.nocompile();self.configure=function(key,value,init){if(init)return;var redraw=false;switch(key){case'width':case'height':case'background':setTimeout2(self.id+'reinit',self.reinit,50);break;case'label':case'icon':redraw=true;break}redraw&&setTimeout2(self.id+'redraw',function(){self.redraw();self.refresh()},50)};self.reinit=function(){canvas=document.createElement('canvas');canvas.width=config.width;canvas.height=config.height;var ctx=canvas.getContext('2d');ctx.fillStyle=config.background;ctx.fillRect(0,0,config.width,config.height);empty=canvas.toDataURL('image/png');canvas=null};var resizewidth=function(w,h,size){return Math.ceil(w*(size/h))};var resizeheight=function(w,h,size){return Math.ceil(h*(size/w))};self.reupload=function(){name='image.'+config.convert;img&&self.resizeforce(img[0])};self.resizeforce=function(image){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');canvas.width=config.width;canvas.height=config.height;ctx.fillStyle=config.background;ctx.fillRect(0,0,config.width,config.height);var w=0,h=0,x=0,y=0,is=false,diff=0,propw='naturalWidth',proph='naturalHeight';if(config.customize){if(config.percentage){config.width=(image[propw]/100)*config.percentage>>0;config.height=(image[proph]/100)*config.percentage>>0;canvas.width=config.width;canvas.height=config.height;ctx.fillStyle=config.background;ctx.fillRect(0,0,config.width,config.height);empty=canvas.toDataURL('image/png')}if(image[propw]>config.width||image[proph]>config.height){if(image[propw]>image[proph]){w=resizewidth(image[propw],image[proph],config.height);h=config.height;if(w<config.width){w=config.width;h=resizeheight(image[propw],image[proph],config.width)}if(w>config.width){diff=w-config.width;x-=(diff/2)>>0}is=true}else if(image[proph]>image[propw]){w=config.width;h=resizeheight(image[propw],image[proph],config.width);if(h<config.height){h=config.height;w=resizewidth(image[propw],image[proph],config.height)}if(h>config.height){diff=h-config.height;y-=(diff/2)>>0}is=true}}}if(!is){if(image[propw]<config.width&&image[proph]<config.height){w=image[propw];h=image[proph];x=(config.width/2)-(image[propw]/2);y=(config.height/2)-(image[proph]/2)}else if(image[propw]>=image[proph]){w=config.width;h=image[proph]*(config.width/image[propw]);y=(config.height/2)-(h/2)}else{h=config.height;w=(image[propw]*(config.height/image[proph]))>>0;x=(config.width/2)-(w/2)}}ctx.drawImage(image,x,y,w,h);var base64=canvas.toDataURL('image/'+(config.convert==='jpg'?'jpeg':config.convert),config.quality*0.01);img.attr('src',base64);self.upload(base64)};self.redraw=function(){var label=config.label||content;self.html((label?('<div class="'+cls+'-label">{0}{1}:</div>'.format(config.icon?'<i class="{0}"></i>'.format(config.icon.indexOf(' ')===-1?('ti ti-'+config.icon):config.icon):'',label)):'')+'<input type="file" accept="image/*" class="hidden" /><img src="{0}" class="img-responsive" alt="" />'.format(empty,config.width,config.height));img=self.find('img');img[0].crossOrigin='anonymous';img[0].onerror=()=>self.set('');img.on('click',function(){if(config.exec)self.EXEC(config.exec,val=>self.bind('@modified @touched',val));else self.find('input').trigger('click')})};self.make=function(){content=self.html();self.aclass(cls+(config.center?(' '+cls+'-centered'):''));self.reinit();self.redraw();self.event('change','input',function(){var file=this.files[0];file&&self.load(file);this.value=''});self.event('dragenter dragover dragexit drop dragleave',function(e){e.stopPropagation();e.preventDefault();switch(e.type){case'drop':break;default:return}var dt=e.originalEvent.dataTransfer;if(dt&&dt.files.length){var file=e.originalEvent.dataTransfer.files[0];file&&self.load(file)}})};function dataURLtoFile(dataurl,filename){var arr=dataurl.split(',');var mime=arr[0].match(/:(.*?);/)[1];var bstr=atob(arr[arr.length-1]);var n=bstr.length,u8arr=new Uint8Array(n);while(n--)u8arr[n]=bstr.charCodeAt(n);return new File([u8arr],filename,{type:mime})}self.load=function(file){name=file.name.replace(/\.(png|gif|jpeg|svg|webp)$/i,'.'+config.convert);self.getOrientation(file,function(orient){var reader=new FileReader();reader.onload=function(){var img=new Image();img.onload=function(){if(config.keeporiginal&&img.width==config.width&&img.height==config.height){self.upload(reader.result,file.name)}else{self.resizeforce(img);self.change(true)}};img.crossOrigin='anonymous';if(orient<2)img.src=reader.result;else self.resetOrientation(reader.result,orient,url=>img.src=url)};reader.readAsDataURL(file)})};self.upload=function(base64,filename){if(base64){var url=config.url.env(true);if(config.output==='file'){var file=dataURLtoFile(base64,filename||name);var data=new FormData();data.append('file',file);UPLOAD(url,data,ERROR(function(response){self.change(true);self.set(config.map?FN(config.map)(response):response)}))}else{var data=(new Function('base64','filename','return '+config.schema))(base64,filename||name);AJAX((url.indexOf(' ')===-1?'POST ':'')+url,data,ERROR(function(response){self.change(true);self.set(config.map?FN(config.map)(response):response)}))}}};self.setter=function(value){if(value&&config.preview)value=FN(config.preview)(value);if(!value&&config.empty)value=config.empty;img.attr('src',value?value:empty)};self.getOrientation=function(file,callback){var reader=new FileReader();reader.onload=function(e){var view=new DataView(e.target.result);if(view.getUint16(0,false)!=0xFFD8)return callback(-2);var length=view.byteLength,offset=2;while(offset<length){var marker=view.getUint16(offset,false);offset+=2;if(marker==0xFFE1){if(view.getUint32(offset+=2,false)!=0x45786966)return callback(-1);var little=view.getUint16(offset+=6,false)==0x4949;offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++)if(view.getUint16(offset+(i*12),little)==0x0112)return callback(view.getUint16(offset+(i*12)+8,little))}else if((marker&0xFF00)!=0xFF00)break;else offset+=view.getUint16(offset,false)}return callback(-1)};reader.readAsArrayBuffer(file.slice(0,64*1024))};self.resetOrientation=function(src,srcOrientation,callback){var img=new Image();img.onload=function(){var width=img.width,height=img.height,canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');canvas.width=width;canvas.height=height;switch(srcOrientation){case 2:ctx.transform(-1,0,0,1,width,0);break;case 3:ctx.transform(-1,0,0,-1,width,height);break;case 4:ctx.transform(1,0,0,-1,0,height);break;case 5:ctx.transform(0,1,1,0,0,0);break;case 6:ctx.transform(-1,0,0,1,width,0);break;case 7:ctx.transform(0,-1,-1,0,height,width);break;case 8:ctx.transform(0,-1,1,0,0,width);break}ctx.drawImage(img,0,0);if(srcOrientation===6){var canvas2=document.createElement('canvas');canvas2.width=width;canvas2.height=height;var ctx2=canvas2.getContext('2d');ctx2.scale(-1,1);ctx2.drawImage(canvas,-width,0);callback(canvas2.toDataURL())}else callback(canvas.toDataURL())};img.src=src}});

COMPONENT('printer','delay:500;delayprint:500;delayclose:1000',function(self,config,cls){self.nocompile();self.readonly();self.singleton();self.make=function(){self.aclass(cls)};self.print=function(title,html,test){if(html==null||html===true){test=html===true;html=title;title=''}if(html.indexOf('<body>')===-1)html='<html><head><title>{0}</title><meta charset="utf-8" /></head><body style="font-family:Arial;font-size:14px;margin:0;padding:0;color:#000">{1}</body></html>'.format(title,html);if(test){let win=W.open('','','width=800,height=600');win.document.write(html);return}var iframe=$('<ifra'+'me src="about:blank" frameborder="0" scrolling="no"></ifr'+'ame>')[0];self.dom.appendChild(iframe);setTimeout(function(){let win=iframe.contentWindow;let doc=win.document;doc.open();doc.write(html);doc.close();setTimeout(()=>win.print(),config.delayprint);setTimeout(()=>self.dom.removeChild(iframe),config.delayclose)},config.delay)}});

COMPONENT('prompt','zindex:12;width:400;cancel:Cancel;submit:OK',function(self,config,cls){var cls2='.'+cls,body,input,op={};self.readonly();self.singleton();op.cancel=function(){var val=input.val();self.opt.cancel&&self.opt.cancel(val);self.hide()};op.submit=function(){var val=input.val();if(!val||(!self.opt.newbie&&val===self.opt.value)){op.cancel();return}self.opt.callback(val);self.hide()};self.make=function(){$(document.body).append('<div id="{1}" class="{0} {0}-container hidden"><div class="{0}-area"><div class="{0}-body"><div class="{0}-title"></div><div class="{0}-summary"></div><div class="{0}-input"><input type="text" /></div><div class="{0}-buttons"><button name="cancel">{cancel}</button><button name="submit">{submit}</button></div></div>'.format(cls,self.ID).args(config));self.replace('#'+self.ID);body=self.find(cls2+'-body');input=self.find('input');self.event('click',function(e){var tag=e.target.tagName;if(tag!=='INPUT'&&tag!=='BUTTON')self.autofocus('input')});self.event('click','.cancel',self.hide);self.event('click','button[name]',function(){var t=this;if(!t.disabled)op[t.name]()});self.event('keydown','input',function(e){switch(e.which){case 13:op.submit();break;case 27:op.cancel();break}})};self.hide=function(){if(!self.opt)return;self.opt.hide&&self.opt.hide();self.opt=null;self.aclass('hidden',100)};self.show=function(opt){self.opt=opt;$('html').aclass(cls+'-noscroll');var title=opt.name||opt.title||'';input.attr('type',opt.type||'text');input.val(opt.value||'');self.find(cls2+'-title').tclass('hidden',!title).html(title);self.find(cls2+'-summary').tclass('hidden',!opt.summary).html(opt.summary||'');self.css('z-index',opt.zindex||config.zindex);body.css({'max-width':opt.width||config.width});self.tclass(cls+'-centered',opt.centered===true);self.rclass('hidden');self.autofocus('input')}});

COMPONENT('radiobutton','inline:1',function(self,config,cls){var cls2='.'+cls,template='<div data-value="{1}"><i></i><span>{0}</span></div>';self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'disabled':self.tclass('ui-disabled',value);break;case'required':self.find(cls2+'-label').tclass(cls+'-label-required',value);break;case'type':self.type=config.type;break;case'label':self.find(cls2+'-label').html(value);break;case'items':self.find('div[data-value]').remove();var builder=[];value.replace(/\\,/g,'\0').split(',').forEach(function(item){item=item.replace(/\0/g,',').split('|');builder.push(template.format((item[0]||item[1]),item[1]||item[0]))});self.append(builder.join(''));self.refresh();break;case'datasource':self.datasource(value,self.bind);break}};self.make=function(){var builder=[],label=config.label||self.html();label&&builder.push('<div class="'+cls+'-label{1}">{0}</div>'.format(label,config.required?(' '+cls+'-label-required'):''));self.aclass(cls+(!config.inline?(' '+cls+'-block'):'')+(config.disabled?' ui-disabled':''));self.event('click','div[data-value]',function(){if(config.disabled)return;var value=self.parser($(this).attrd('value'));self.set(value);self.change(true)});self.html(builder.join(''));config.items&&self.reconfigure('items:'+config.items);config.datasource&&self.reconfigure('datasource:'+config.datasource);config.type&&(self.type=config.type)};self.validate=function(value){return config.disabled||!config.required?true:!!value};self.setter=function(value){self.find('div[data-value]').each(function(){var el=$(this);var is=el.attrd('value')===(value==null?null:value.toString());el.tclass(cls+'-selected',is);el.find('.ti').tclass('ti-circle',!is).tclass('ti-bull',is)})};self.bind=function(path,arr){if(!arr)arr=EMPTYARRAY;var builder=[],propText=config.text||'name',propValue=config.value||'id',type=typeof(arr[0]);var notObj=type==='string'||type==='number';for(var i=0,length=arr.length;i<length;i++){var item=arr[i];if(notObj)builder.push(template.format(item,item));else builder.push(template.format(item[propText],item[propValue]))}self.find('div[data-value]').remove();self.append(builder.join(''));self.refresh()}});

COMPONENT('ready','delay:800',function(self,config){self.readonly();self.blind();self.make=function(){config.rclass&&self.rclass(config.rclass,config.adelay||config.delay);config.aclass&&self.aclass(config.aclass,config.rdelay||config.delay);self.rclass('invisible',config.adelay||config.delay);config.focus&&setTimeout(function(){self.autofocus(config.focus===true||config.focus===1?null:config.focus).focus()},config.fdelay||(config.delay+5))}});

COMPONENT('search','class:hidden;delay:50;attribute:data-search;splitwords:1;delaydatasource:100',function(self,config,cls){self.readonly();self.make=function(){config.datasource&&self.datasource(config.datasource,function(){setTimeout(function(){self.refresh()},config.delaydatasource)})};self.search=function(){var value=self.get();var elements=self.find(config.selector);var length=elements.length;if(!value){elements.rclass(config.class);self.rclass2(cls+'-');config.exec&&self.SEEX(config.exec,{hidden:0,count:length,total:length,search:'',is:false});return}var raw=value.trim();var search=raw.toSearch();var count=0,hidden=0,custom=config.custom?GET(self.makepath(config.custom)):null;if(config.splitwords){search=search.split(' ');raw=raw.split(' ')}self.aclass(cls+'-used');for(var i=0;i<length;i++){var el=elements.eq(i);var is=false;if(custom){is=!custom(el,search);el.tclass(config.class,is);if(is)hidden++;else count++;continue}var val=(el.attr(config.attribute)||'').trim();var fuzzy=val.toSearch();if(search instanceof Array){for(var j=0;j<raw.length;j++){if(val.indexOf(raw[j])===-1){is=true;break}}if(is){is=false;for(var j=0;j<search.length;j++){if(fuzzy.indexOf(search[j])===-1){is=true;break}}}}else is=fuzzy.indexOf(search)===-1&&val.indexOf(raw)===-1;el.tclass(config.class,is);if(is)hidden++;else count++}self.tclass(cls+'-empty',!count);config.exec&&self.SEEX(config.exec,{total:length,hidden:hidden,count:count,search:search,is:true})};self.setter=function(value){if(!config.selector||!config.attribute||value==null)return;setTimeout2('search'+self.ID,self.search,config.delay)}});

COMPONENT('searchdata','class:hidden;delay:50;key:name;splitwords:1',function(self,config,cls){self.readonly();self.configure=function(key,value){if(key==='datasource')self.datasource(value,self.search)};self.searchforce=function(){var value=self.get();var datasource=GET(self.makepath(config.datasource))||EMPTYARRAY;if(!value){self.rclass2(cls+'-');config.output&&SET(self.makepath(config.output),datasource);return}var raw=value.trim();var search=raw.toSearch();var output=[],is=false;if(config.splitwords){search=search.split(' ');raw=raw.split(' ')}self.aclass(cls+'-used');for(var item of datasource){var val=item[config.key]||'',fuzzy=val.toSearch();if(search instanceof Array){for(var j=0;j<raw.length;j++){if(val.indexOf(raw[j])===-1){is=true;break}}if(is){is=false;for(var j=0;j<search.length;j++){if(fuzzy.indexOf(search[j])===-1){is=true;break}}}}else is=fuzzy.indexOf(search)===-1&&val.indexOf(raw)===-1;if(!is)output.push(item)}self.tclass(cls+'-empty',!output.length);config.output&&SET(self.makepath(config.output),output)};self.search=function(){setTimeout2(self.ID,self.searchforce,config.delay)};self.setter=self.search});

COMPONENT('searchinput','searchicon:ti ti-search;cancelicon:ti ti-times;align:left;realtime:1',function(self,config,cls){var input,icon,prev,prev2;self.novalidate&&self.novalidate();self.make=function(){self.aclass(cls+' '+cls+'-'+config.align);self.html('<span><i class="{0}"></i></span><div><input type="text" autocomplete="new-password" maxlength="100" placeholder="{1}" /></div>'.format(config.searchicon,config.placeholder));input=self.find('input');if(config.realtime){input.attr('data-jc-bind','');self.autobind20&&self.autobind20(200)}else{input.on('change',function(){let value=input.value;prev2=value;self.check();self.path&&self.bind('@touched @modified',value);config.exec&&self.SEEX(config.exec,value,self.element)})}input=input[0];icon=self.find('i');self.event('click','span',function(){prev&&self.set('')});config.autofocus&&self.autofocus()};self.focus=function(){input&&input.focus()};self.check=function(){var is=!!input.value.trim();if(is!==prev){icon.rclass().aclass(is?config.cancelicon:config.searchicon);prev=is;self.tclass(cls+'-is',is)}};self.clear=function(){input.value='';config.exec&&self.SEEX(config.exec,input.value,self.element);self.check()};self.setter=function(value,path,type){var val=value||'';if(input.value!==val)input.value=val;if(prev2!==input.value){prev2=input.value;type&&config.exec&&self.SEEX(config.exec,input.value,self.element)}self.check()}});

COMPONENT('selected','class:selected;selector:a;attr:if;attror:or;delay:50',function(self,config){self.readonly();var highlight=function(){var cls=config.class,val=self.get()||'';var arr=self.find(config.selector);for(var m of arr){var el=$(m);var or=el.attrd(config.attror)||'';if(el.attrd(config.attr)===val||(or&&val.includes(or)))el.aclass(cls);else if(el.hclass(cls))el.rclass(cls)}};self.configure=function(key,value){switch(key){case'datasource':self.datasource(value,function(){setTimeout2(self.ID,highlight,config.delay)});break}};self.setter=function(){setTimeout2(self.ID,highlight,config.delay)}});

COMPONENT('selection','remember:1;key:id;class:selected;click:.selection;selector:.selection;attr:id;event:click;dblclickselectall:1',function(self,config,cls){self.make=function(){self.aclass(cls);self.event(config.event,config.click,function(e){e.preventDefault();e.stopPropagation();var el=$(this);if(config.click!==config.selector)el=el.find(config.selector);self.toggle(el)});if(config.dblclickselectall){self.event('dblclick',config.click,function(){self.selecttoggle()})}config.cancel&&self.watch(self.makepath(config.cancel),self.selectnone)};self.selectall=function(){var arr=self.find(config.selector);var sel=[];for(var i=0;i<arr.length;i++){var el=$(arr[i]);sel.push(el.attrd(config.attr));el.aclass(config.class)}self.bind('@modified @touched',sel)};self.selectnone=function(){var model=self.get();if(model&&model.length){var arr=self.find(config.selector);for(var i=0;i<arr.length;i++){var el=$(arr[i]);el.rclass(config.class)}self.bind('@modified @touched',[])}};self.selecttoggle=function(){var arr=self.find(config.selector);var sel=[];for(var i=0;i<arr.length;i++){var el=$(arr[i]);if(el.hclass(config.class)){el.rclass(config.class)}else{sel.push(el.attrd(config.attr));el.aclass(config.class)}}self.bind('@modified @touched',sel)};self.toggle=function(id){if(id instanceof jQuery)id=id.attrd(config.attr);var model=self.get();var added=false;if(model==null){model=[id];added=true;self.rewrite(model)}else{var index=model.indexOf(id);if(index===-1){model.push(id);added=true}else model.splice(index,1)}var el=self.find(config.selector+'[data-{0}="{1}"]'.format(config.attr,id));el.tclass(config.class,added);self.bind('@modified @touched',model)};self.recalc=function(){var arr=self.find(config.selector);var model=self.get()||EMPTYARRAY;for(var i=0;i<arr.length;i++){var el=$(arr[i]);el.tclass(config.class,model.indexOf(el.attrd(config.attr))!==-1)}};var datasource=function(path,value){if(M.is20)value=path;if(!config.remember){self.bind('@modified',[]);return}if(!value)value=EMPTYARRAY;var model=self.get()||EMPTYARRAY;var rem=[];for(var i=0;i<model.length;i++){var item=value.findItem(config.key,model[i]);if(!item)rem.push(model[i])}for(var i=0;i<rem.length;i++)model.splice(model.indexOf(rem[i]),1);self.bind('@modified @setter',model)};self.configure=function(key,value){if(key==='datasource')self.datasource(value,datasource)};self.setter=function(value){setTimeout2(self.ID,self.recalc,10)}});

COMPONENT('servergrid','colwidth:150;pluralizepages:# pages,# page,# pages,# pages;pluralizeitems:# items,# item,# items,# items;margin:0;filter:Filter;opacity:0.3;scrolltop:1',function(self,config,cls){var cls2='.'+cls,nodes={},filtercache={sort:'',filter:{},page:1,pages:1},Ttd=Tangular.compile('<div class="{0}-td {0}-c{{ value.id}}{{ if value.align}} {0}-{{ value.align}}{{ fi}} {0}-{1}" style="width:{{ value.width}}px{{ if value.color}};background:{{ value.color}}{{ fi}}">{{ value.text | raw}}</div>'.format(cls,self.ID));var Tth=Tangular.compile('<div class="{0}-th{{ if value.sorting}} {0}-sort{{ fi}}{{ if value.alignheader}} {0}-{{ value.alignheader}}{{ fi}}" style="width:{{ value.width}}px" data-id="{{ value.id}}">{{ if value.sorting}}<span class="{0}-btn-sort"><i class="ti {{ if value.sort === \'asc\' }}ti-angle-up{{ else if value.sort === \'desc\' }}ti-angle-down{{ else}}ti-arrows-v{{ fi}}"></i></span>{{ fi}}<div>{{ if value.icon}}<i class="{{ value.icon}}"></i>{{ fi}}{{ value.name | raw}}</div></div>'.format(cls));var Ttf=Tangular.compile('<div class="{0}-tf{{ if value.filter}} {0}-tf-is{{ fi}}" style="width:{{ value.width}}px"><i class="{0}-clear ti ti-times"></i><input data-name="{{ value.id}}"{{ if !value.filtering}} disabled{{ fi}}{{ if value.placeholder}} placeholder="{{ value.placeholder}}"{{ fi}}{{ if value.filter}} value="{{ value.filter}}"{{ fi}}{{ if cls}} class="{{ cls}}"{{ fi}} autocomplete="new-password" role="combobox" aria-expanded="true" aria-invalid="false" aria-autocomplete="list" aria-haspopup="false" autocapitalize="off" autocorrect="off" spellcheck="false"{{ if value.dirsource}} readonly{{ fi}} /></div>'.format(cls));var scrollY=0,scrollX=0,emptyrows=0,rgba=function(hex,alpha){if(hex&&/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){let c=hex.substring(1).split('');if(c.length===3)c=[c[0],c[0],c[1],c[1],c[2],c[2]];c='0x'+c.join('');return'rgba('+[(c>>16)&255,(c>>8)&255,c&255].join(',')+','+alpha+')'}return'rgba(0,0,0,'+alpha+')'};self.make=function(){self.aclass(cls);self.append('<div class="{0}-container"><div class="{0}-table"><div class="{0}-header"></div><div class="{0}-rows"><div class="{0}-data"></div></div></div></div><div class="{0}-pagination"><span class="{0}-pagination-count">0</span><button name="first" disabled><i class="ti ti-angle-double-left"></i></button><button name="prev" disabled><i class="ti ti-angle-left"></i></button><input autocomplete="new-password" spellcheck="false" role="combobox" aria-expanded="true" aria-invalid="false" aria-autocomplete="list" autocapitalize="off" autocorrect="off" disabled value="1" /><button name="next" disabled><i class="ti ti-angle-right"></i></button><button name="last" disabled><i class="ti ti-angle-double-right"></i></button><span class="{0}-pagination-pages">0</span></div>'.format(cls));config.noborder&&self.aclass(cls+'-noborder');config.checkbox&&self.aclass(cls+'-checkbox');if(config.click||config.cell)self.aclass(cls+'-pointer');nodes.container=self.find(cls2+'-container');nodes.scrollbarX=SCROLLBAR(nodes.container,{visibleX:true,orientation:'x',controls:self.element,wrap:false});nodes.table=self.find(cls2+'-table');nodes.header=self.find(cls2+'-header');nodes.rows=self.find(cls2+'-rows');nodes.data=self.find(cls2+'-data');nodes.sizer=self.find(cls2+'-sizer');nodes.pagination={};let pe=self.find(cls2+'-pagination');nodes.pagination.element=pe;nodes.pagination.first=pe.find('button[name="first"]');nodes.pagination.last=pe.find('button[name="last"]');nodes.pagination.prev=pe.find('button[name="prev"]');nodes.pagination.next=pe.find('button[name="next"]');nodes.pagination.page=pe.find('input');nodes.pagination.pages=pe.find(cls2+'-pagination-pages');nodes.pagination.count=pe.find(cls2+'-pagination-count');nodes.scrollbarY=SCROLLBAR(nodes.rows,{visibleY:true,shadow:config.scrollbarshadow,orientation:'y',controls:self.element,marginY:50,wrap:false});self.resizeforce();self.event('click',cls2+'-'+self.ID,function(){if(!config.cell)return;let el=$(this);nodes.cellhighlight&&nodes.cellhighlight.rclass('highlight');nodes.cellhighlight=el;let td=el.closest(cls2+'-td');let index=td.index();let model=self.get();let column=model.columns[index-1];let row=model.items[+td.parent().attrd('index')];el.aclass('highlight');config.cell&&self.SEEX(config.cell,row,el,column)});self.event('click',cls2+'-row_'+self.ID,function(e){if(!config.click)return;let target=e?e.target:null;if(target&&target.tagName==='A'||$(target).closest('a').length)return;let el=$(this);nodes.rowhighlight&&nodes.rowhighlight.rclass('highlight');nodes.rowhighlight=el;let model=self.get();let row=model.items[+el.attrd('index')];el.aclass('highlight');config.click&&self.SEEX(config.click,row,el)});nodes.pagination.first.on('click',()=>self.page(1));nodes.pagination.prev.on('click',()=>self.page(filtercache.page-1));nodes.pagination.next.on('click',()=>self.page(filtercache.page+1));nodes.pagination.last.on('click',()=>self.page(filtercache.pages));nodes.pagination.page.on('change',function(){let page=+this.value;if(!isNaN(page)&&page>=0)self.page(page)});nodes.header.on('change','input',()=>self.filter());nodes.rows.on('scroll',()=>scrollY=nodes.rows[0].scrollTop);nodes.container.on('scroll',()=>scrollX=nodes.container[0].scrollLeft);self.event('click',cls2+'-th-number',function(){let el=$(this);let model=self.get();el.tclass('selected');let selected=el.hclass('selected');for(let m of model.items)m.$selected=selected;nodes.data.find('> '+cls2+'-row').tclass('selected',selected);self.selected()});self.event('click',cls2+'-number',function(e){if(!config.checkbox)return;e.preventDefault();e.stopPropagation();let el=$(this).closest(cls2+'-row');let index=+ATTRD(el,'index');let model=self.get();let row=model.items[index];el.tclass('selected');row.$selected=el.hclass('selected');self.selected()});self.event('click',cls2+'-sort',function(e){let model=self.get();let el=$(this);let id=ATTRD(el);let column=model.columns.findItem('id',id);switch(column.sort){case'asc':column.sort='';break;case'desc':column.sort='asc';break;default:column.sort='desc';break}for(let m of model.columns){if(m.sorting&&m!==column&&m.sort)m.sort=''}filtercache.sort=column.sort?(column.id+'_'+column.sort):'';config.exec&&self.EXEC(config.exec,'sort',filtercache.filter,filtercache.sort,filtercache.page)});self.event('click',cls2+'-clear',function(e){e.stopPropagation();e.preventDefault();let model=self.get();let el=$(this).closest(cls2+'-tf');let input=el.find('input');input.val('');self.filter()});self.event('click',cls2+'-dirsource',function(e){e.stopPropagation();e.preventDefault();let model=self.get();let input=$(this);let opt={};let column=model.columns.findItem('id',input.attrd('name'));opt.element=input;opt.items=column.dirsource;opt.offsetY=24;opt.offsetX=2;opt.callback=function(selected){input.val(selected.name);self.filter()};SETTER('directory/show',opt)})};self.resize=function(){setTimeout2(self.ID,self.resizeforce,50)};self.resizeforce=function(){if(!config.height&&!config.parent)return;let height=0;if(config.height){height=config.height-config.margin}else{let parent=self.parent(config.parent);height=parent.height()-config.margin}let rowsheight=height-36-36-22;emptyrows=Math.ceil(rowsheight/33);nodes.container.css('height',height-35);nodes.rows.css('height',rowsheight);nodes.scrollbarX&&nodes.scrollbarX.resize();nodes.scrollbarY&&nodes.scrollbarY.resize()};self.filter=function(){let model=self.get();let inputs=nodes.header.find('input');let obj={};for(let m of inputs){if(!m.disabled){let name=m.getAttribute('data-name');let col=model.columns.findItem('id',name);if(col){let val=m.value;col.filter=val;if(col.dirsource)val=val==null||val==''?null:col.dirsource.findValue('name',val,'id');if(val!=null&&val!=='')obj[name]=val}}}filtercache.filter=obj;config.exec&&self.EXEC(config.exec,'filter',filtercache.filter,filtercache.sort,filtercache.page)};self.page=function(page){if(page>filtercache.pages)page=filtercache.pages;else if(page<0)page=1;filtercache.page=page;config.exec&&self.EXEC(config.exec,'page',filtercache.filter,filtercache.sort,filtercache.page)};self.selected=function(){let model=self.get();let selected=[];for(let m of model.items){if(m.$selected)selected.push(m)}config.checked&&self.SEEX(config.checked,selected)};self.setter=function(value,path,flags){if(!value){config.exec&&self.EXEC(config.exec,'filter',filtercache.filter,filtercache.sort,filtercache.page);return}let builder=[];let filter=[];let width=40;builder.push(('<div class="{0}-th {0}-th-number">'+(config.checkbox?'<em><i class="ti ti-check"></i></em>':'')+'</div>').format(cls));filter.push('<div class="{0}-th-number">&nbsp;</div>'.format(cls));filtercache.page=value.page||1;filtercache.pages=value.pages||1;if(!value.count)value.count=0;for(let col of value.columns){if(col.filtering==true)col.placeholder=config.filter;if(!col.width)col.width=config.colwidth;switch(col.align){case 0:col.align='left';break;case 1:col.align='center';break;case 2:col.align='right';break}switch(col.alignheader){case 0:col.alignheader='left';break;case 1:col.alignheader='center';break;case 2:col.alignheader='right';break}switch(col.alignfilter){case 0:col.alignfilter='left';break;case 1:col.alignfilter='center';break;case 2:col.alignfilter='right';break}if(!col.alignheader&&col.align)col.alignheader=col.align;if(!col.alignfilter&&col.align)col.alignfilter=col.align;width+=col.width+2;let ccls='';if(col.dirsource)ccls+=(ccls?' ':'')+'{0}-dirsource';if(col.alignfilter)ccls+=(ccls?' ':'')+'{0}-'+col.alignfilter;let obj={value:col,cls:ccls.format(cls)};builder.push(Tth(obj));filter.push(Ttf(obj))}width+=15;nodes.header.html('<div class="{0}-row">{1}</div><div class="{0}-filter">{2}</div>'.format(cls,builder.join(''),filter.join('')));builder.length=0;for(let i=0;i<value.items.length;i++){let row=value.items[i];let html='<div class="{0}-row {0}-row_{1}{3}" data-index="{2}">'.format(cls,self.ID,i,row.$selected?' selected':'');html+=('<div class="{0}-td {0}-number">'+(config.checkbox?'<em><i class="ti ti-check"></i></em>':'')+'<span>{1}</span></div>').format(cls,i+1);for(let col of value.columns){let obj={};obj.text=row[col.id];if(obj.text instanceof Date)obj.text=obj.text.format('[ts]');let color=col.color||col.bg;obj.width=col.width;obj.color=color?rgba(color,config.opacity):'';obj.id=col.id;obj.align=col.align;html+=Ttd({value:obj})}builder.push(html+'</div>')}let diff=emptyrows-value.items.length;let empty='<div class="{0}-row-empty"></div>'.format(cls);for(let i=0;i<diff;i++)builder.push(empty);nodes.pagination.pages.html(value.pages.pluralize(config.pluralizepages));nodes.pagination.count.html(value.count.pluralize(config.pluralizeitems));nodes.pagination.first.prop('disabled',value.page<=1);nodes.pagination.last.prop('disabled',value.page>=value.pages);nodes.pagination.prev.prop('disabled',value.page<=1);nodes.pagination.next.prop('disabled',value.page>=value.pages);nodes.pagination.page.prop('disabled',value.pages<=1).val(value.page+'');nodes.table.css('width',width);nodes.data.html(builder.join(''));self.tclass(cls+'-noscroll',diff>0);self.resizeforce();self.selected();if(config.scrolltop&&!flags.noscroll){setTimeout(function(){nodes.scrollbarY.resize();nodes.scrollbarY.scrollTop(0)},500)}}});

COMPONENT('shortcuts',function(self){var items=[],length=0,keys={},keys_session={},issession=false;self.singleton();self.readonly();self.blind();self.nocompile&&self.nocompile();var cb=function(o,e){o.callback(e,o.owner)};self.make=function(){$(W).on('keydown',function(e){var f=e.key||'',c=e.keyCode;if(f.length>1&&f.charAt(0)==='F')c=0;else f='-';var key=(e.ctrlKey?1:0)+''+(e.altKey?1:0)+''+(e.shiftKey?1:0)+''+(e.metaKey?1:0)+f+c;if(issession){if(!keys_session[key])return}else{if(!keys[key])return}if(length&&!e.isPropagationStopped()){for(var i=0;i<length;i++){var o=items[i];if(o.fn(e)){if(o.prepare&&!o.prepare(e,e.target))continue;if(o.prevent){e.preventDefault();e.stopPropagation()}setTimeout(cb,100,o,e);return}}}});ON('component + knockknock',self.refresh)};self.refreshforce=function(){var arr=document.querySelectorAll('.shortcut');var index=0;while(true){var item=items[index++];if(item==null)break;if(item.owner){index--;items.splice(index,1)}}for(var i=0;i<arr.length;i++){var shortcut=arr[i].getAttribute('data-shortcut');shortcut&&self.register(shortcut,self.execshortcut,true,null,arr[i])}};self.session=function(callback){issession=true;keys_session={};callback(self.register)};self.end=function(){issession=false};self.execshortcut=function(e,owner){var evt=$.Event('click');evt.shortcutEvent=evt.shortcut=e;$(owner).trigger(evt)};self.refresh=function(){setTimeout2(self.ID,self.refreshforce,500)};self.exec=function(shortcut){var item=items.findItem('shortcut',shortcut.toLowerCase().replace(/\s/g,''));item&&item.callback(null,$(item.owner))};self.register=function(shortcut,callback,prevent,prepare,owner){if(typeof(prevent)==='function'){var tmp=prepare;prepare=prevent;prevent=tmp}var currentkeys=issession?keys_session:keys,ismac=M.ua.os.toLowerCase()==='mac';var special=ismac?'metaKey':'ctrlKey',specialindex=ismac?3:0;shortcut.split(',').trim().forEach(function(shortcut){var builder=[],alias=[],cachekey=[0,0,0,0,'-',0];shortcut.split('+').trim().forEach(function(item){var lower=item.toLowerCase();alias.push(lower);switch(lower){case'ctrl':cachekey[0]=1;break;case'alt':cachekey[1]=1;break;case'shift':cachekey[2]=1;break;case'win':case'meta':case'cmd':cachekey[3]=1;break}switch(lower){case'ctrl':case'alt':case'shift':builder.push('e.{0}Key'.format(lower));return;case'win':case'meta':case'cmd':builder.push('e.metaKey');return;case'ins':builder.push('e.keyCode===45');cachekey[5]=45;return;case'space':builder.push('e.keyCode===32');cachekey[5]=32;return;case'tab':builder.push('e.keyCode===9');cachekey[5]=9;return;case'esc':builder.push('e.keyCode===27');cachekey[5]=27;return;case'enter':builder.push('e.keyCode===13');cachekey[5]=13;return;case'backspace':builder.push('e.keyCode===8');cachekey[5]=8;break;case'del':case'delete':builder.push('e.keyCode===46');cachekey[5]=46;return;case'save':builder.push('(e.{0}&&e.keyCode===83)'.format(special));cachekey[specialindex]=1;cachekey[5]=83;return;case'remove':builder.push('((e.{0}&&e.keyCode===8)||e.keyCode===46)'.format(special));cachekey[5]=-1;return;case'clone':builder.push('(e.{0}&&e.keyCode===68)'.format(special));cachekey[specialindex]=1;cachekey[5]=68;return;case'selectall':builder.push('(e.{0}&&e.keyCode===65)'.format(special));cachekey[specialindex]=1;cachekey[5]=65;return;case'copy':builder.push('(e.{0}&&e.keyCode===67)'.format(special));cachekey[specialindex]=1;cachekey[5]=67;return;case'undo':builder.push('(e.{0}&&e.keyCode===90)'.format(special));cachekey[specialindex]=1;cachekey[5]=90;return;case'redo':builder.push('(e.{0}&&e.shiftKey&&e.keyCode===90)'.format(special));cachekey[specialindex]=1;cachekey[5]=90;return;case'refresh':builder.push('e.key===\'F5\'');cachekey[5]=116;return;case'up':builder.push('e.keyCode===38');cachekey[5]=38;return;case'down':builder.push('e.keyCode===40');cachekey[5]=40;return;case'right':builder.push('e.keyCode===39');cachekey[5]=39;return;case'left':builder.push('e.keyCode===37');cachekey[5]=37;return;case'f1':case'f2':case'f3':case'f4':case'f5':case'f6':case'f7':case'f8':case'f9':case'f10':case'f11':case'f12':var a=item.toUpperCase();builder.push('e.key===\'{0}\''.format(a));cachekey[4]=a;return;case'capslock':builder.push('e.which===20');cachekey[5]=20;return}var num=item.parseInt();if(num){builder.push('e.which==='+num);cachekey[5]=num}else{num=item.toUpperCase().charCodeAt(0);cachekey[5]=num;builder.push('e.keyCode==={0}'.format(num))}});items.push({shortcut:alias.join('+'),fn:new Function('e','return '+builder.join('&&')),callback:callback,prevent:prevent,owner:owner,prepare:prepare});length=items.length;var k;if(cachekey[5]===-1){cachekey[5]=8;cachekey[3]=1;k=cachekey.join('');currentkeys[k]=1;cachekey[3]=0;cachekey[5]=46}k=cachekey.join('');currentkeys[k]=1});if(!owner)self.refresh();return self}});

COMPONENT('spotlight','height:40;placeholder:Search',function(self,config,cls){var cls2='.'+cls,container,timeout,input,search,scroller=null,is=false,selectedindex=0,resultscount=0,skip=false,checksum,prevclass;self.items=null;self.template=Tangular.compile('<figure data-index="{{ $.index}}"{{ if selected}} class="selected"{{ fi}}>{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ if html}}{{ html | raw}}{{ else}}{{ name | raw}}{{ fi}}</figure>');self.callback=null;self.readonly();self.singleton();self.nocompile&&self.nocompile();var onclick=function(e){if(is&&(!$(e.target).closest(cls2).length))self.hide()};self.select=function(index){var item=self.items[index];if(item){self.opt.callback&&self.opt.callback(item);if(!self.opt.recent)return;var key='spotlight'+(self.opt.id||'');var arr=CACHE(key)||[];var id=HASH(item)+'';item.spotlightid=id;if(arr.length&&arr.findItem('spotlightid',id))return;arr.unshift(item);if(arr.length>10)arr.pop();CACHE(key,arr,typeof(self.opt.recent)==='string'?self.opt.recent:'1 month')}};self.make=function(){self.aclass(cls+'-layer hidden');self.append('<div class="{1}"><div class="{1}-search"><span><i class="ti ti-search"></i></span><div><input type="text" placeholder="{0}" class="{1}-search-input" /></div></div><div class="{1}-container"><div class="{1}-items"></div></div></div>'.format(config.placeholder,cls));container=self.find(cls2+'-items');scroller=self.find(cls2+'-container');input=self.find('input');search=self.find(cls2);self.event('click','figure[data-index]',function(e){self.select(+this.getAttribute('data-index'));self.hide();e.preventDefault();e.stopPropagation()});self.on('resize2',function(){is&&self.hide(0)});self.event('keydown','input',function(e){skip=false;switch(e.which){case 27:skip=true;self.hide();self.opt.cancel&&self.opt.cancel();break;case 13:skip=true;var sel=self.find('figure.selected');sel.length&&self.select(+sel.attrd('index'));self.hide();break;case 38:skip=true;selectedindex--;if(selectedindex<0)selectedindex=0;else self.move();break;case 40:skip=true;selectedindex++;if(selectedindex>=resultscount)selectedindex=resultscount;else self.move();break}if(skip){e.preventDefault();e.stopPropagation()}});self.event('keyup','input',function(){if(!skip)setTimeout2(self.id,self.search,self.opt.delay||100,null,this.value)})};self.search=function(value){if(typeof(self.opt.search)==='function'){self.opt.search(value,self.render)}else{var url=self.opt.search.format(encodeURIComponent(value));if(self.opt.cache){if(M.is20)AJAX(url+' <'+self.opt.cache+'>',self.render);else AJAXCACHE(url,self.render,self.opt.cache)}else AJAX(url,self.render)}};self.move=function(){var itemheight=self.opt.height||config.height,counter=0,h=scroller.css('max-height').parseInt();container.find('figure').each(function(){var el=$(this);if(el.hclass('hidden'))return;var is=selectedindex===counter;el.tclass('selected',is);if(is){var t=(itemheight*counter)-itemheight;scroller.scrollTop((t+itemheight*5)>h?t:0)}counter++})};self.render=function(items,noremap){if(items){if(!(items instanceof Array)){self.render(items.items||items.response);return}if(!noremap&&self.opt.remap){var tmp=self.opt.remap(items);if(tmp)items=tmp}var newchecksum;if(self.items&&items){newchecksum=HASH(STRINGIFY(items,true));if(checksum===newchecksum)return}checksum=newchecksum;self.items=items}selectedindex=0;resultscount=self.items.length;var builder=[],indexer={};for(var i=0;i<self.items.length;i++){var item=items[i];indexer.index=i;if(item.icon)item.icon=self.icon(item.icon);builder.push(self.template(item,indexer))}container.html(builder);self.move()};self.show=function(opt){if(is){clearTimeout(timeout);self.hide(0);return}var key='spotlight'+(opt.id||'');var recent=CACHE(key);if(self.opt&&self.opt.id!==opt.id)self.items=[];$(document).on('touchstart mousedown',onclick);self.opt=opt;input.prop('placeholder',opt.placeholder||config.placeholder);prevclass&&self.rclass(prevclass);prevclass=null;if(opt.class){prevclass=opt.class;self.aclass(opt.class)}self.rclass('hidden');if(opt.recent==null)opt.recent='3 days';if(opt.clear)input.val('');if(!self.items||!self.items.length){selectedindex=0;if(recent&&recent.length)self.render(recent,true);else{self.render([]);opt.init&&self.search('')}}var w=((WW/(isMOBILE?1.1:1.3))>>0);search.css({width:w,left:((WW-w)/2)});scroller.css({width:w+50,'max-height':(WH/(isMOBILE?2.3:1.3))>>0});setTimeout(function(){self.aclass(cls+'-visible')},100);setTimeout(function(){input.focus()},500);is=true;$('html,body').aclass(cls+'-noscroll')};self.hide=function(sleep){if(is){clearTimeout(timeout);timeout=setTimeout(function(){$(document).off('touchstart mousedown',onclick);self.aclass('hidden').rclass(cls+'-visible');is=false;$('html,body').rclass(cls+'-noscroll')},sleep?sleep:100)}}});

COMPONENT('table','highlight:true;border:true;unhighlight:true;multiple:false;pk:id;visibleY:1;scrollbar:0;pluralizepages:# pages,# page,# pages,# pages;pluralizeitems:# items,# item,# items,# items;margin:0',function(self,config,cls){var cls2='.'+cls,etable,ebody,eempty,ehead,eheadsize,efooter,container,opt={selected:[]},templates={},sizes={},names={},aligns={},sorts={},dcompile=false,prevsort,prevhead,extradata;self.readonly();self.nocompile();self.make=function(){self.aclass(cls+' invisible'+(config.detail?(' '+cls+'-detailed'):'')+((config.highlight||config.click||config.exec)?(' '+cls+'-selectable'):'')+(config.border?(' '+cls+'-border'):'')+(config.flat?(' '+cls+'-flat'):'')+(config.noborder?(' noborder'):''));self.find('script').each(function(){var el=$(this);var type=el.attrd('type');switch(type){case'detail':var h=el.html();dcompile=h.COMPILABLE();templates.detail=Tangular.compile(h);return;case'empty':templates.empty=el.html();return}var display=(el.attrd('display')||'').toLowerCase();var template=Tangular.compile(el.html());var size=(el.attrd('size')||'').split(',');var name=(el.attrd('head')||'').split(',');var align=(el.attrd('align')||'').split(',');var sort=(el.attrd('sort')||'').split(',');var i;for(i=0;i<align.length;i++){switch(align[i].trim()){case'0':align[i]='left';break;case'1':align[i]='center';break;case'2':align[i]='right';break}}display=(display||'').split(',').trim();for(i=0;i<align.length;i++)align[i]=align[i].trim();for(i=0;i<size.length;i++)size[i]=size[i].trim().toLowerCase();for(i=0;i<sort.length;i++)sort[i]=sort[i].trim();for(i=0;i<name.length;i++){name[i]=name[i].trim().replace(/'[a-z-\s]+'/,function(val){if(val.indexOf(' ')===-1)val=val+' ti';return'<i class="ti-{0}"></i>'.format(val.replace(/'/g,''))})}if(!size[0]&&size.length===1)size=EMPTYARRAY;if(!align[0]&&align.length===1)align=EMPTYARRAY;if(!name[0]&&name.length===1)name=EMPTYARRAY;if(display.length){for(i=0;i<display.length;i++){templates[display[i]]=template;sizes[display[i]]=size.length?size:null;names[display[i]]=name.length?name:null;aligns[display[i]]=align.length?align:null;sorts[display[i]]=sort.length?sort:null}}else{templates.lg=templates.md=templates.sm=templates.xs=template;sizes.lg=sizes.md=sizes.sm=sizes.xs=size.length?size:null;names.lg=names.md=names.sm=names.xs=name.length?name:null;sorts.lg=sorts.md=sorts.sm=sorts.xs=sort.length?sort:null;aligns.lg=aligns.md=aligns.sm=aligns.xs=align.length?align:null}});self.html('<div class="{0}-headcontainer"><table class="{0}-head"><thead></thead></table></div><div class="{0}-container"><table class="{0}-table"><thead></thead><tbody class="{0}-tbody"></tbody></table><div class="{0}-empty hidden"></div></div>'.format(cls));etable=self.find(cls2+'-table');ebody=etable.find('tbody');eempty=self.find(cls2+'-empty').html(templates.empty||'');ehead=self.find(cls2+'-head thead');eheadsize=etable.find('thead');container=self.find(cls2+'-container');etable.on('click','button',function(){if(config.click){var btn=$(this);var row=opt.items[+btn.closest('tr').attrd('index')];self.SEEX(config.click,btn[0].name,row,btn)}});if(config.paginate){self.append('<div class="{0}-footer"><div class={0}-pagination-items hidden-xs"></div><div class="{0}-pagination"><button name="page-first" disabled><i class="ti ti-angle-double-left"></i></button><button name="page-prev" disabled><i class="ti ti-angle-left"></i></button><div><input type="text" name="page" maxlength="5" class="{0}-pagination-input" /></div><button name="page-next" disabled><i class="ti ti-angle-right"></i></button><button name="page-last" disabled><i class="ti ti-angle-double-right"></i></button></div><div class="{0}-pagination-pages"></div></div>'.format(cls));efooter=self.find(cls2+'-footer');efooter.on('change',cls2+'-pagination-input',function(){var value=self.get();var val=+this.value;if(isNaN(val))return;if(val>=value.pages)val=value.pages;else if(val<1)val=1;value.page=val});efooter.on('click','button',function(){var data=self.get();var model={};model.page=data.page;model.limit=data.limit;if(prevsort)model.sort=prevsort&&prevsort.type?(prevsort.name+'_'+prevsort.type):'';switch(this.name){case'page-first':model.page=1;self.SEEX(config.paginate,model);break;case'page-last':model.page=data.pages;self.SEEX(config.paginate,model);break;case'page-prev':model.page-=1;self.SEEX(config.paginate,model);break;case'page-next':model.page+=1;self.SEEX(config.paginate,model);break}})}if(config.scrollbar){self.scrollbar=SCROLLBAR(container,{visibleY:!!config.visibleY});ehead.parent().parent().aclass(cls+'-scrollbar')}templates.empty&&templates.empty.COMPILABLE()&&COMPILE(eempty);self.event('click','.sort',function(){if(self.hclass(cls+'-isempty'))return;var th=$(this);var i=th.find('i');var type;if(i.attr('class')==='ti'){prevsort&&prevsort.el.find('i').rclass2('ti-');i.aclass('ti-long-arrow-up');type='asc'}else if(i.hclass('ti-long-arrow-up')){i.rclass('ti-long-arrow-up').aclass('ti-long-arrow-down');type='desc'}else if(i.hclass('ti-long-arrow-down')){i.rclass('ti-long-arrow-down');type=''}var index=th.index();var data=self.get();prevsort={index:index,type:type,el:th,name:sorts[WIDTH()][index]};if(config.paginate){var model={};model.page=data.page;model.limit=data.limit;model.sort=type?(prevsort.name+'_'+type):undefined;self.SEEX(config.paginate,model)}else if(prevsort.name){opt.items=(data.items?data.items:data).slice(0);if(type)opt.items.quicksort(prevsort.name,type==='asc');else{var tmp=self.get()||EMPTYARRAY;opt.items=tmp.items?tmp.items:tmp;prevsort=null}opt.sort=type?(prevsort.name+'_'+type):undefined;config.filter&&self.EXEC(config.filter,opt,'sort');self.redraw()}});var blacklist={A:1,BUTTON:1},dblclick=0,forceselect=function(el,index,is){if(!config.highlight){config.exec&&self.SEEX(config.exec,opt.items[index],el);return}if(config.multiple){if(is){if(config.unhighlight){el.rclass(cls+'-selected');config.detail&&self.row_detail(el);opt.selected=opt.selected.remove(index);config.exec&&self.SEEX(config.exec,self.selected(),el)}}else{opt.selected.push(index);el.aclass(cls+'-selected');config.exec&&self.SEEX(config.exec,self.selected(),el);config.detail&&self.row_detail(el)}}else{if(is&&!config.unhighlight)return;if(opt.selrow){opt.selrow.rclass(cls+'-selected');config.detail&&self.row_detail(opt.selrow);opt.selrow=null;opt.selindex=-1}if(is){config.exec&&self.SEEX(config.exec);return}opt.selindex=index;opt.selrow=el;el.aclass(cls+'-selected');config.exec&&self.SEEX(config.exec,opt.items[index],el);config.detail&&self.row_detail(el)}};ebody.on('click','> tr',function(e){var el=$(this);var node=e.target;if(blacklist[node.tagName]||(node.tagName==='SPAN'&&node.getAttribute('class')||'').indexOf('link')!==-1)return;if(node.tagName==='I'){var parent=$(node).parent();if(blacklist[parent[0].tagName]||(parent[0].tagName==='SPAN'&&parent.hclass('link')))return}var now=Date.now();var isdblclick=dblclick?(now-dblclick)<250:false;dblclick=now;var index=+el.attrd('index');if(index>-1){var is=config.highlight?el.hclass(cls+'-selected'):true;if(isdblclick&&config.dblclick&&is){self.forceselectid&&clearTimeout(self.forceselectid);self.SEEX(config.dblclick,opt.items[index],el);return}self.forceselectid&&clearTimeout(self.forceselectid);self.forceselectid=setTimeout(forceselect,config.dblclick?is?250:1:1,el,index,is)}});var resize=function(){setTimeout2(self.ID,self.resize,500)};self.on('resize2 + resize',resize)};self.resize2=function(){self.scrollbar&&setTimeout2(self.ID+'scrollbar',self.scrollbar.resize,300)};self.resize=function(){var display=WIDTH();if(display!==opt.display&&sizes[display]&&sizes[display]!==sizes[opt.display]){self.refresh();return}if(config.height>0)self.find(cls2+'-container').css('height',config.height-config.margin);else if(config.height){var el=self.parent(config.height);var header=self.find(cls2+'-head');var plus=(config.noborder?0:2);var footer=config.paginate?(self.find(cls2+'-footer').height()+plus):0;self.find(cls2+'-container').css('height',el.height()-header.height()-footer-plus-config.margin)}self.scrollbar&&self.scrollbar.resize()};self.row_detail=function(el){var index=+el.attrd('index');var row=opt.items[index],eld=el.next();if(el.hclass(cls+'-selected')){if(eld.hclass(cls+'-detail')){eld.rclass('hidden')}else{el.after('<tr class="{0}-detail"><td colspan="{1}" data-index="{2}"></td></tr>'.format(cls,el.find('td').length,index));eld=el.next();var tmp;if(config.detail===true){tmp=eld.find('td');tmp.html(templates.detail(row,{index:index,user:window.user,data:extradata}));dcompile&&COMPILE(tmp)}else{tmp=eld.find('td');self.EXEC(config.detail,row,function(row){var is=typeof(row)==='string';tmp.html(is?row:templates.detail(row,{index:index,user:window.user,data:extradata}));if((is&&row.COMPILABLE())||dcompile)COMPILE(tmp)},tmp)}}}else eld.hclass(cls+'-detail')&&eld.aclass('hidden');self.resize2()};self.redrawrow=function(index,row){if(typeof(index)==='number')index=ebody.find('tr[data-index="{0}"]'.format(index));if(index.length){var template=templates[opt.display],indexer={};indexer.data=extradata;indexer.user=W.user;indexer.index=+index.attrd('index');var is=index.hclass(cls+'-selected');var next=index.next();index.replaceWith(template(row,indexer).replace('<tr','<tr data-index="'+indexer.index+'"'));next.hclass(cls+'-detail')&&next.remove();is&&ebody.find('tr[data-index="{0}"]'.format(indexer.index)).trigger('click')}};self.appendrow=function(row){var index=opt.items.indexOf(row);if(index==-1)index=opt.items.push(row)-1;var template=templates[opt.display],indexer={};indexer.data=extradata;indexer.user=W.user;indexer.index=index;ebody.append(template(row,indexer).replace('<tr','<tr data-index="'+indexer.index+'"'))};self.removerow=function(row){var index=opt.items.indexOf(row);if(index==-1)return;opt.selected=opt.selected.remove(index);opt.items.remove(row)};self.redraw=function(){var clsh='hidden',count=0,indexer={user:W.user,data:extradata},builder=[],template=templates[WIDTH()];if(template){for(var i=0;i<opt.items.length;i++){var item=opt.items[i];count++;indexer.index=i;builder.push(template(item,indexer).replace('<tr','<tr data-index="'+i+'"'))}}count&&ebody.html(builder.join(''));eempty.tclass(clsh,count>0);etable.tclass(clsh,count==0);self.tclass(cls+'-isempty',count===0);config.redraw&&self.EXEC(config.redraw,self)};self.redrawpagination=function(){if(!config.paginate)return;var value=self.get();efooter.find('button').each(function(){var el=$(this);var dis=true;switch(this.name){case'page-next':dis=value.page>=value.pages;break;case'page-prev':dis=value.page===1;break;case'page-last':dis=!value.pages||value.page===value.pages;break;case'page-first':dis=value.page===1;break}el.prop('disabled',dis)});efooter.find('input')[0].value=value.page;efooter.find(cls2+'-pagination-pages')[0].innerHTML=value.pages.pluralize.apply(value.pages,config.pluralizepages);efooter.find(cls2+'-pagination-items')[0].innerHTML=value.count.pluralize.apply(value.count,config.pluralizeitems)};self.selected=function(){var rows=[];for(var i=0;i<opt.selected.length;i++){var row=opt.items[opt.selected[i]];row&&rows.push(row)}return rows};self.configure=function(key,value){switch(key){case'pluralizepages':config.pluralizepages=value.split(',').trim();break;case'pluralizeitems':config.pluralizeitems=value.split(',').trim();break;case'datasource':self.datasource(value,self.bind);break;case'paginate':case'exec':case'click':case'filter':case'redraw':if(value&&value.SCOPE)config[key]=value.SCOPE(self,value);break}};self.bind=function(path,val){extradata=val};self.setter=function(value){if(config.paginate&&value==null){var model={};model.page=1;if(prevsort)model.sort=prevsort&&prevsort.type?(prevsort.name+'_'+prevsort.type):'';self.EXEC(config.paginate,model);return}var data=value?value.items?value.items:value:value,empty=!data||!data.length,clsh='hidden';if(!self.isinit){self.rclass('invisible',10);self.isinit=true}var display=WIDTH();var builder=[],buildersize=[],selected=opt.selected.slice(0);for(var i=0;i<selected.length;i++){var row=opt.items[selected[i]];selected[i]=row[config.pk]}var size=sizes[display],name=names[display],align=aligns[display],sort=sorts[display];if(prevhead!==display){if((size&&size.length)||(name&&name.length)||(align&&align.length)){var arr=name||size||align;for(var i=0;i<arr.length;i++){var w=!size||size[i]==='0'?'auto':size[i];builder.push('<th style="width:{0};text-align:{2}"{3}>{1}</th>'.format(w,(sort&&sort[i]?'<i class="ti"></i>':'')+(name?name[i]:''),align?align[i]:'left',sort&&sort[i]?' class="sort"':''));buildersize.push('<th style="width:{0}"></th>'.format(w))}ehead.parent().tclass('hidden',!name);ehead.html('<tr>{0}</tr>'.format(builder.join('')));eheadsize.html('<tr>{0}</tr>'.format(buildersize.join('')))}else ehead.html('');prevsort=null;prevhead=display}setTimeout(self.resize,100);opt.display=display;opt.items=data?data.slice(0):0;opt.data=value;opt.selindex=-1;opt.selrow=null;opt.selected=[];opt.sort=prevsort;self.redrawpagination();config.filter&&self.EXEC(config.filter,opt,'refresh');config.exec&&self.SEEX(config.exec,config.multiple?[]:null);if(empty){etable.aclass(clsh);eempty.rclass(clsh);self.aclass(cls+'-isempty');config.hidewhenempty&&self.aclass('hidden');return}config.hidewhenempty&&self.rclass('hidden');self.redraw();if(config.remember){for(var i=0;i<selected.length;i++){if(selected[i]){var index=opt.items.findIndex(config.pk,selected[i]);if(index!==-1)ebody.find('tr[data-index="{0}"]'.format(index)).trigger('click')}}}}});

COMPONENT('tabmenu','class:selected;selector:li;attr:id',function(self,config,cls){var old,oldtab,loaded=false;self.readonly();self.nocompile();self.make=function(){self.aclass(cls);self.event('click',config.selector,function(){if(!config.disabled){var el=$(this);if(!el.hclass(config.class))self.bind('@touched @modified @setter',el.attrd(config.attr))}});var scr=self.find('script');if(scr.length){self.template=Tangular.compile(scr.html());scr.remove()}};self.configure=function(key,value){switch(key){case'disabled':self.tclass('ui-disabled',!!value);break;case'datasource':self.datasource(value,function(path,value){if(M.is20)value=path;if(value instanceof Array){old=null;self.html(self.template({value:value}));self.refresh()}},true);break}};self.setter=function(value){if(!loaded){loaded=true;self.rclass('invisible hidden',10)}if(old===value)return;oldtab&&oldtab.rclass(config.class);oldtab=self.find(config.selector+'[data-'+config.attr+'="'+value+'"]').aclass(config.class);old=value;config.exec&&self.EXEC(config.exec,value)}});

COMPONENT('tabs','tabs:1',function(self,config,cls){var cls2='.'+cls,open=[],manual=false;self.make=function(){self.aclass(cls);var parent=document.createElement('DIV');parent.classList.add(cls+'-tabs');NODEINSERT(parent,self.dom.children[0],true);self.find('> section').aclass('hidden').each(function(){let el=$(this);let div=document.createElement('DIV');el.aclass('hidden');div.classList.add(cls+'-item');div.classList.add(cls+'-item-'+self.ID);let icon=el.attrd('icon')||config.icon;div.innerHTML=(icon?'<i class="{0}"></i>'.format(icon):'')+(el.attr('title')||el.attrd('name'));div.setAttribute('data-id',el.attrd('id'));el.attr('title',null);parent.appendChild(div)});self.event('click',cls2+'-item-'+self.ID,function(e){let el=$(this);let section=self.element.find('> section[data-id="{0}"]'.format(ATTRD(el)));let id=section.attrd('id');if(section.hclass('hidden'))open=id;self.bind('@touched @modified @setter',open||null)})};self.setter=function(value){self.find(cls2+'-item-'+self.ID).each(function(){let item=$(this);let id=ATTRD(item);let is=value===id;let el=self.element.find('> section[data-id="{0}"]'.format(id));el.tclass('hidden',!is);item.tclass('selected',is)});self.rclass('invisible hidden')}});

Thelpers.autoformat=function(value,format){if(value===false||value===true)return'<i class="ti ti-{0}"></i>'.format(value?'check-square':'square');if(value instanceof Date)return value.format(format||'[date]');if(value instanceof Array){var builder=[];for(let m of value)builder.push('<span class="badge badge-medium mr5">{0}</span>'.format(m.toString().encode()));return builder.join('')}var type=typeof(value);if(!value||typeof(value)==='object')return value;if(type==='number')return typeof(format)==='string'?value.currency(format):value.format(format||0);value=value.trim();if(value.includes('@'))return'<a href="mailto:{0}">{0}</a>'.format(value);if((/^http(s)\:\//).test(value))return'<a href="{0}" target="_blank">{0}</a>'.format(value);if(value.charAt(0)==='#')return'<i class="ti ti-square-alt" style="color:{0}"></i>'.format(value);if((/[0-9\s\-\+]/).test(value))return'<a href="tel:{0}">{0}</a>'.format(value.replace(/\s/g,''));return value};

Thelpers.filesize=function(value,decimals,type){return value?value.filesize(decimals,type):'...'};Number.prototype.filesize=function(decimals,type){if(typeof(decimals)==='string'){var tmp=type;type=decimals;decimals=tmp}var value,t=this;switch(type){case'bytes':value=t;break;case'KB':value=t/1024;break;case'MB':value=filesizehelper(t,2);break;case'GB':value=filesizehelper(t,3);break;case'TB':value=filesizehelper(t,4);break;default:type='bytes';value=t;if(value>1023){value=value/1024;type='KB'}if(value>1023){value=value/1024;type='MB'}if(value>1023){value=value/1024;type='GB'}if(value>1023){value=value/1024;type='TB'}break}type=' '+type;return(decimals===undefined?value.format(2).replace('.00',''):value.format(decimals))+type};function filesizehelper(number,count){while(count--){number=number/1024;if(number.toFixed(3)==='0.000')return 0}return number}

var TTIC=['#1abc9c','#2ecc71','#3498db','#9b59b6','#34495e','#16a085','#2980b9','#8e44ad','#2c3e50','#f1c40f','#e67e22','#e74c3c','#d35400','#c0392b'];Thelpers.initials=function(value){if(value){var index=value.indexOf('.');var arr=value.substring(index+1).replace(/\s{2,}/g,' ').trim().split(' ');var initials=((arr[0].substring(0,1)+(arr[1]||'').substring(0,1))).toUpperCase();var sum=0;for(var i=0;i<value.length;i++)sum+=value.charCodeAt(i);return'<span class="initials" style="background-color:{1}" title="{2}">{0}</span>'.format(Thelpers.encode(initials),TTIC[sum%TTIC.length],Thelpers.encode(value))}};Thelpers.initialsbase64=function(value,width,height){if(value){var index=value.indexOf('.');var arr=value.substring(index+1).replace(/\s{2,}/g,' ').trim().split(' ');var initials=((arr[0].substring(0,1)+(arr[1]||'').substring(0,1))).toUpperCase();var sum=0;for(var i=0;i<value.length;i++)sum+=value.charCodeAt(i);var canvas=W.$initialscanvas;if(!canvas)canvas=W.$initialscanvas=document.createElement('CANVAS');if(canvas.width!=width)canvas.width=width;if(canvas.height!=height)canvas.height=height;var color=TTIC[sum%TTIC.length],ctx=canvas.getContext('2d');ctx.fillStyle=color;ctx.fillRect(0,0,width,height);ctx.font='bold '+((width/2)>>0)+'px Arial';ctx.fillStyle='#FFFFFF';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(initials,(width/2),(height/2>>0)+5);return canvas.toDataURL('image/png')}};

Thelpers.jsonformat=function(json,format){var reguid2=/"{14,}[a-z]{3}[01]{1}|^\d{9,14}[a-z]{2}[01]{1}a|"\d{4,18}[a-z]{2}\d{1}[01]{1}b|"[0-9a-f]{4,18}[a-z]{2}\d{1}[01]{1}c|"[0-9a-z]{4,18}[a-z]{2}\d{1}[01]{1}d/;if(typeof(json)==='object')json=JSON.stringify(json,null,'\t');else if(json.indexOf('\t')===-1)json=JSON.stringify(JSON.parse(json),null,'\t');json=json.replace(/&/g,'&amp;').replace(/<|>/g,function(text){return text==='<'?'&lt;':'&gt;'});return json.replace(/\t.*?:\s/g,function(text){return'<span class="json-key">'+text.encode()+'</span>'}).replace(/\/span>(false|true)/g,function(val){val=val.substring(6).encode();return'/span><span class="json-boolean json-'+val+'">'+val+'</span>'}).replace(/\/span>[\d.]+/g,function(val){return'/span><span class="json-number">'+val.substring(6).encode()+'</span>'}).replace(/\/span>"[\d-]+T[\d:.]+Z"/g,function(val){return'/span><span class="json-date">'+new Date(val.substring(7,val.length-1)).format(format||'yyyy-MM-dd HH:mm:ss')+'</span>'}).replace(/\/span>null/g,function(){return'/span><span class="json-null">null</span>'}).replace(/\/span>"#[a-f0-9]{6}"/gi,function(val){val=val.substring(7,val.length-1).encode();return'/span>"<span class="json-color" style="color:'+val+'">'+val+'</span>"'}).replace(reguid2,function(text){return'<span class="json-uid">'+text.encode()+'</span>'})};

Thelpers.rgba=function(hex,alpha){if(hex&&/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){var c=hex.substring(1).split('');if(c.length===3)c=[c[0],c[0],c[1],c[1],c[2],c[2]];c='0x'+c.join('');return'rgba('+[(c>>16)&255,(c>>8)&255,c&255].join(',')+','+alpha+')'}return'rgba(0,0,0,'+alpha+')'};

COMPONENT('timepicker',function(self,config,cls){var cls2='.'+cls,bindedevents=false,timeout=0,is;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+' hidden invisible');self.append('<div class="{0}-hours"><i class="ti ti-chevron-up"></i><input type="text" maxlength="2" /><i class="ti ti-chevron-down"></i></div><div class="{0}-minutes"><i class="ti ti-chevron-up"></i><input type="text" maxlength="2" /><i class="ti ti-chevron-down"></i></div><div class="{0}-seconds hidden"><i class="ti ti-chevron-up"></i><input type="text" maxlength="2" /><i class="ti ti-chevron-down"></i></div><div class="{0}-ampm hidden"><i class="ti ti-chevron-up"></i><span>AM</span><i class="ti ti-chevron-down"></i></div>'.format(cls));var fn=function(e){if(is&&(e.type!=='keydown'||e.which===27))self.hide(1)};self.on('reflow',fn);self.on('scroll',fn);self.on('resize',fn);self.event('keydown','input',function(e){var code=e.which;if(code===38||code===40){e.preventDefault();$(this).parent().find('.ti-chevron-'+(code===38?'up':'down')).trigger('click');return}if(code===13||code===27){self.hide(1);return}if((code===9||code===8||code===37||code===39||code===27||(code>47&&code<58))){if(code>47||code===8)self.update()}else e.preventDefault()});self.event('click','i',function(){var el=$(this);var parent=el.parent();var cls=parent.attr('class');var up=el.hclass('ti-chevron-up');var type=cls.substring(cls.lastIndexOf('-')+1);var val;switch(type){case'hours':case'minutes':case'seconds':var input=parent.find('input');val=+input.val();if(up)val++;else val--;if(val<0){if(type==='hours')val=self.opt.ampm?12:23;else val=59}else{if(type==='hours'){if(self.opt.ampm){if(val>12)val=0}else if(val>23)val=0}else{if(val>59)val=0}}val=val.toString();input.val(self.opt.ampm?val:(val.length>1?val:('0'+val)));break;case'ampm':var span=self.find('span');val=span.text().toLowerCase();if(val==='am')val='PM';else val='AM';span.html(val);break}self.update()});self.update=function(){setTimeout2(self.ID,function(){var current=self.opt.current,h=+(self.find(cls2+'-hours input').val()||'0');var m=+(self.find(cls2+'-minutes input').val()||'0');var s=+(self.find(cls2+'-seconds input').val()||'0');var ampm=+self.find(cls2+'-ampm span').html().toLowerCase();if(!self.opt.seconds)s=0;if(ampm==='pm')h+=12;current.setHours(h);current.setMinutes(m);current.setSeconds(s);if(self.opt.callback)self.opt.callback(current);else if(self.opt.path)SET(self.opt.path,current)},500)};self.event('click',function(e){e.preventDefault();e.stopPropagation()});self.bindevents=function(){if(!bindedevents){bindedevents=true;$(document).on('click',fn);$(W).on('scroll',fn).on('keydown',fn)}};self.unbindevents=function(){if(bindedevents){bindedevents=false;$(document).off('click',fn);$(W).off('scroll',fn).off('keydown',fn)}}};self.show=self.toggle=function(opt){var el=opt.element;if(el instanceof jQuery)el=el[0];if(self.target===el){self.hide(0);return}var value=opt.value||opt.date||opt.time||NOW;if(typeof(value)==='string'){opt.path=value;value=GET(value)}var count=0;if(opt.ampm==null)opt.ampm=!!config.ampm;if(opt.seconds==null)opt.seconds=!!config.seconds;self.find(cls2+'-seconds').tclass('hidden',!opt.seconds);self.find(cls2+'-ampm').tclass('hidden',!opt.ampm);if(opt.seconds)count++;if(opt.ampm)count++;var ampm=opt.ampm;self.find(cls2+'-hours input').val(value.format(ampm?'!H':'HH'));self.find(cls2+'-minutes input').val(value.format(ampm?'m':'mm'));self.find(cls2+'-seconds input').val(value.format(ampm?'s':'ss'));self.find(cls2+'-ampm span').html(value.format('a').toUpperCase());opt.current=value;self.target=el;self.opt=opt;self.bindevents();el=$(el);var off=el.offset();self.rclass2(cls+'-').tclass(cls+'-'+count).aclass('invisible').rclass('hidden');if(opt.align){var w=self.element.width();switch(opt.align){case'center':off.left=Math.ceil((off.left-w/2)+(el.innerWidth()/2));break;case'right':off.left=(off.left-w)+el.innerWidth();break}}if(opt.offsetX)off.left+=opt.offsetX;if(opt.offsetY)off.top+=opt.offsetY;off.top+=el.innerHeight()+12;self.element.css(off);self.rclass('invisible');clearTimeout(timeout);setTimeout(function(){is=true},500)};self.hide=function(sleep){if(!is){self.target=null;return}clearTimeout(timeout);timeout=setTimeout(function(){self.unbindevents();if(self.opt){self.opt.close&&self.opt.close();self.opt.close=null}self.aclass('hidden invisible');self.target=null;is=false},sleep?sleep:100)}});

COMPONENT('totaltemplates',function(self,config){var cache={};self.singleton();self.render=function(template,model,callback){if(!(template.includes('>')||template.includes(';')||template.includes('"')||template.includes(',')||template.includes('{'))){if(cache[template]){self.render(cache[template],model,callback)}else{AJAX('GET '+template,function(response){cache[template]=response.replace(/~CDN~/g,DEF.cdn||'https://cdn.componentator.com');self.render(cache[template],model,callback)})}return}if(typeof(model)==='function'){callback=model;model=null}var helpers={},strhelpers='',raw=template,beg=template.indexOf('<scr'+'ipt>');var end;if(beg!==-1){end=template.indexOf('</scr'+'ipt>',beg+8);strhelpers=template.substring(beg+8,end).trim();template=template.substring(0,beg)+template.substring(end+9)}if(!model){beg=template.indexOf('<scr'+'ipt type="text/json">');if(beg!==-1){end=template.indexOf('</scr'+'ipt>',beg+8);model=PARSE(template.substring(beg+25,end).trim());template=template.substring(0,beg)+template.substring(end+9)}}if(!model)model=EMPTYOBJECT;if(strhelpers)new Function('Thelpers',strhelpers)(helpers);var value=Tangular.render(template,{value:model},null,helpers);callback&&callback(value,raw);return value};self.preview=function(template,model,print){let cdn=DEF.cdn||'https://cdn.componentator.com';self.render(template,model,function(html,raw){var d=W.open();var ismd=(/<(html|body|div|span|b|em|strong|h1|h2|h3|img)/i).test(raw)===false;if(ismd){if(!html.markdown)WARN('j-TotalTempates error: j-Markdown is not declared');html=`<!DOCTYPE html><html><head><meta charset="utf-8" /><link href="{1}/spa.min@20.css" rel="stylesheet" type="text/css" /><style>.markdown-small .markdown{font-size:14px;line-height:20px}.markdown{font-size:16px;line-height:22px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';color:#404040;overflow:hidden;padding:0}.markdown-container > *:last-child{margin-bottom:0}.markdown code{font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace;white-space:pre}.markdown h1{cursor:default;margin:0 0 20px;font-size:30px;padding:0 0 13px;border-bottom:1px solid #E0E0E0;color:#000;line-height:38px;font-family:-apple-systm,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;line-height:32px;font-weight:bold}.markdown h2{cursor:default;margin:0 0 18px;font-weight:bold;font-size:25px;padding:0 0 8px;border-bottom:1px solid #E0E0E0;color:#000;line-height:28px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}.markdown h3{cursor:default;margin:0 0 10px;font-size:20px;padding:0 0 5px;color:#404040;font-weight:bold;line-height:22px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}.markdown h4,.markdown h5{cursor:default;margin:0 0 10px;font-size:17px;color:#404040;font-weight:bold;line-height:22px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';background-color:#F0F0F0;padding:4px 3px;border-radius:var(--radius);border-bottom:1px solid #E0E0E0}.markdown p{margin:0 0 15px;padding-left:0;padding-right:0}.markdown p code,.markdown li code,.markdown section code,.markdown blockquote code,.markdown h1 code,.markdown h2 code,.markdown h3 code,.markdown h4 code,.markdown td code{background-color:#E0E0E0;padding:1px 4px 2px;border-radius:var(--radius);font-size:14px}.markdown p code,.markdown section code,.markdown li code,.markdown blockquote code,.markdown td code{border:1px solid #E0E0E0;background-color:#F5F5F5}.markdown pre{padding:0;border-radius:var(--radius);margin:20px 0;width:100%}.markdown pre code{padding:10px;font-size:14px;line-height:18px;overflow-scrolling:touch;border-radius:var(--radius)}.markdown table{margin:0 0 15px;width:auto !important}.markdown ul{margin:0 0 20px 0;padding:0 0 0 2em}.markdown ul ul{margin-bottom:0}.markdown img{max-width:100%}.markdown th{background-color:#F8F8F8}.markdown blockquote{padding:15px 20px;background-color:#F0F0F0;margin:10px 0 20px;border-radius:var(--radius)}.markdown section{padding:15px 20px;background-color:#FFFED1;margin:10px 0 15px;border-radius:var(--radius)}.markdown hr{border-color:#E0E0E0;border-width:2px}.markdown-line2{border-width:4px !important;margin:15px 0 30px !important}.markdown h1 code{font-size:28px;font-weight:normal;background-color:#DAE8F8}.markdown h2 code{font-size:23px;font-weight:normal;background-color:#DAE8F8}.markdown h3 code{font-size:18px;font-weight:normal;background-color:#DAE8F8}.markdown h4 code{font-size:17px;font-weight:normal;background-color:#DAE8F8}.markdown a code{background-color:#DAE8F8;text-decoration:none !important;border-color:#D5DFEB}.markdown-footnote{background-color:rgba(0,0,0,0.1);padding:0 2px;border-radius:var(--radius);cursor:help}.markdown-footnotebody{font-size:11px;border-top:1px solid #E0E0E0;font-family:Arial;color:#505050}.markdown-showsecret{cursor:pointer;display:block;padding:8px 15px;user-select:none;font-size:14px}.markdown-showsecret b{margin-left:8px}.markdown-showsecret .pull-right{margin:2px 0 0}.markdown-secret{padding:0;border-radius:var(--radius);border:1px solid #E0E0E0}.markdown-secret > div{padding:15px 15px 1px;border-radius:0 0 var(--radius) var(--radius);background-color:#F8F8F8}.markdown-small p code,.markdown-small li code,.markdown-small section code,.markdown-small blockquote code,.markdown-small td code,.markdown-small pre code{font-size:12px}.markdown-task > i:first-child{margin-right:5px}.markdown-code{margin-bottom:15px}.markdown-block{margin:0}.markdown-block:last-child{margin-bottom:15px}.markdown-block > div{padding:10px 10px 1px;border:1px solid #E0E0E0;margin:10px 0;border-radius:var(--radius)}.markdown-block > div > *:last-child{margin-bottom:10px}.markdown-showblock{cursor:pointer;display:block;padding:3px 0;user-select:none;border-bottom:1px solid #E0E0E0}.markdown-showblock i{width:16px;font-size:12px;padding:6px 0 0;float:left}.markdown-showblock-visible{border-bottom:0}.markdown-video{position:relative;padding-bottom:56.25%;padding-top:25px;height:0;margin-bottom:15px}.markdown-video iframe{position:absolute;top:0;left:0;width:100%;height:100%}.markdown-small p,.markdown-small section,.markdown-small blockquote,.markdown-small table,.markdown-small .markdown-code{margin-bottom:10px}.ui-dark .markdown{color:#C0C0C0}.ui-dark .markdown blockquote{color:#FFF;background-color:#444}.ui-dark .markdown th{background-color:#404040}.ui-dark .markdown h2{color:#FFF;border-bottom-color:#404040}.ui-dark .markdown h1{color:#FFF;border-bottom-color:#404040}.ui-dark .markdown h1 code{background-color:#404040}.ui-dark .markdown hr{border-color:#404040}.ui-dark .markdown h2 code{background-color:#404040}.ui-dark .markdown h3 code{background-color:#404040}.ui-dark .markdown h4 code{background-color:#404040}.ui-dark .markdown section{background-color:#6d6c52}.ui-dark .markdown a code{background-color:#303030;border-color:#454545}.ui-dark .markdown h4,.ui-dark .markdown h5{color:#C0C0C0;background-color:#505050;border-bottom:1px solid #404040}.ui-dark .markdown p code,.ui-dark .markdown section code,.ui-dark .markdown li code,.ui-dark .markdown blockquote code,.ui-dark .markdown td code{border-color:#404040;background-color:#505050}.ui-dark .markdown-footnote{background-color:rgba(255,255,255,0.1)}.ui-dark .markdown-footnotebody{border-top-color:#505050;color:#888}.ui-dark .markdown-block > div,.ui-dark .markdown-showblock{border-color:#404040}.ui-dark .markdown-secret{border:1px solid #404040}.ui-dark .markdown-secret > div{background-color:#303030}</style></head><body><div style="max-width:900px;margin:30px auto;width:100%">{0}</div></body></html>`.format(html.markdown?html.markdown():html,cdn)}else if(!html.includes('<html'))html=`<!DOCTYPE html><html><head><meta charset="utf-8" /><link href="{1}/spa.min@20.css" rel="stylesheet" type="text/css" /></head><body>{0}</body></html>`.format(html,cdn);if(d&&d.document){d.document.write(html);print&&setTimeout(d=>d.print(),print==true?1000:print,d)}else WARN('j-TotalTempates error: pop-up windows are blocked')})};self.on('service',function(counter){if(counter%5===0)cache={}})});

COMPONENT('tree','autoreset:false;checkednested:true;reselect:false;iconoptions:ti ti-ellipsis-h;key:path',function(self,config,cls){var cls2='.'+cls,cache=null,counter=0,expanded={},selindex=-1,ddfile=null,ddtarget=null,dragged=null;self.readonly();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls);self.template=Tangular.compile(('<div'+(config.dragdrop?' draggable="true"':'')+' class="{0}-item{{ if children}} {0}-expand{{ fi}}" title="{{ name}}" data-index="{{ $pointer}}">'+(config.checked?'<div class="{0}-checkbox"><i class="ti ti-check"></i></div><div class="{0}-label">':'')+'<i class="ti {{ if children}}{0}-folder{{ else}}{{ icon | def(\'ti-file-alt\') }}{{ fi}}"></i>'+(config.options?('<span class="{0}-options"><i class="'+config.iconoptions+'"></i></span>'):'')+'<div class="{0}-item-name{{ if classname}} {{ classname}}{{ fi}}">{{ if html}}{{ html | raw}}{{ else}}{{ name}}{{ fi}}</div></div>'+(config.checked?'</div>':'')).format(cls));self.event('click',cls2+'-checkbox',function(e){e.stopPropagation();var el=$(this);var c=cls+'-checkbox-checked';el.tclass(c);config.checkednested&&el.closest(cls2+'-node').find(cls2+'-checkbox').tclass(c,el.hclass(c));SEEX(self.makepath(config.checked),self.checked(),self)});self.event('click',cls2+'-item',function(){var el=$(this);var index=+el.attrd('index');self.select(index)});self.event('click',cls2+'-options',function(e){e.preventDefault();e.stopPropagation();var el=$(this);var index=+el.closest(cls2+'-item').attrd('index');config.options&&self.EXEC(config.options,cache[index],el)});self.event('contextmenu',cls2+'-item',function(e){e.preventDefault();var el=$(this);var index=el.attrd('index');config.contextmenu&&self.EXEC(config.contextmenu,cache[index],el)});self.event('focusout','input',function(){var input=$(this);var el=input.parent();el.html(el[0].$def);el[0].$def=null});var dragdrop=(config.upload||config.dragdrop);dragdrop&&self.event('dragenter dragover dragexit drop dragleave dragstart',function(e){if(e.type==='dragstart'){var el=$(e.target);if(!el.hclass(cls+'-item'))el=el.closest(cls2+'-item');if(el&&el.length){e.originalEvent.dataTransfer.setData('text','1');dragged=el;return}dragged=null}e.stopPropagation();e.preventDefault();switch(e.type){case'drop':break;case'dragenter':case'dragover':if(e.target!==ddtarget||(ddtarget&&e.target!==ddtarget.parentNode)){ddtarget=e.target;ddfile&&ddfile.rclass(cls+'-ddhere');ddfile=$(ddtarget);if(!ddfile.hclass(cls+'-item'))ddfile=ddfile.closest(cls2+'-item');ddfile.aclass(cls+'-ddhere')}return;default:setTimeout2(self.id,function(){ddfile&&ddfile.rclass(cls+'-ddhere');ddfile=null;ddtarget=null},100);return}var index=-1;if(e.originalEvent.dataTransfer.files.length){if(ddfile)index=+ddfile.attrd('index');config.upload&&self.EXEC(config.upload,cache[index],e.originalEvent.dataTransfer.files)}else{var tmp=$(e.target);if(!tmp.hclass(cls+'-item'))tmp=tmp.closest(cls2+'-item');tmp.length&&config.dragdrop&&self.EXEC(config.dragdrop,cache[+dragged.attrd('index')],cache[+tmp.attrd('index')],dragged,tmp);dragged=null}ddfile&&ddfile.rclass(cls+'-ddhere');ddfile=null});self.event('keydown','input',function(e){if(e.which===13||e.which===27){var input=$(this);var el=input.parent();if(e.which===27){el.html(el[0].$def);el[0].$def=null}else{var val=input.val().replace(/[^a-z0-9.\-_]/gi,'');var index=+input.closest(cls2+'-item').attrd('index');var item=cache[index],newname=item.path.substring(0,item.path.length-item.name.length)+val;self.EXEC(config.rename,cache[index],newname,function(is){el.html(is?val:el[0].$def);if(is){item.path=newname;item.name=val;self.select(index)}})}}})};self.findindex=function(prop,val,tree){if(!tree)tree=self.get();var item=tree.findItem(prop||config.key,val);if(item)return item.$pointer;for(var i=0;i<tree.length;i++){var item=tree[i];if(item.children){var index=self.findindex(prop,val,item.children);if(index!=null)return index}}};self.select=function(index,noeval,reinit){if(typeof(index)==='string')index=self.findindex(null,index);var el=self.find('[data-index="{0}"]'.format(index));var c='-selected';if(el.hclass(cls+'-expand')){var parent=el.parent();if(config.selectexpand){self.find(cls2+c).rclass(cls+c);el.aclass(cls+c)}if(!reinit)parent.tclass(cls+'-show');var is=parent.hclass(cls+'-show');var item=cache[index];if(config.pk)expanded[item[config.pk]]=1;else expanded[index]=1;!noeval&&config.exec&&SEEX(self.makepath(config.exec),item,true,is);selindex=index}else{!el.hclass(cls+c)&&self.find(cls2+c).rclass(cls+c);el.aclass(cls+c);!noeval&&config.exec&&SEEX(self.makepath(config.exec),cache[index],false);selindex=index}};self.checked=function(){var items=[];self.find(cls2+'-checkbox-checked').each(function(){var item=cache[+$(this).parent().attrd('index')];item&&items.push(item)});return items};self.rename=function(index){if(typeof(index)==='string')index=self.findindex(null,index);var div=self.find('[data-index="{0}"] .ui-tree-item-name'.format(index));if(div[0].$def)return;div[0].$def=div.html();div.html('<input type="text" value="{0}" />'.format(div[0].$def));div.find('input').focus()};self.select2=function(index){self.expand(index);self.select(index,true)};self.unselect=function(){var cls=config.selected;self.find('.'+cls).rclass(cls)};self.clear=function(){expanded={};selindex=-1};self.expand=function(index){if(index==null){self.find(cls2+'-expand').each(function(){$(this).parent().aclass(cls+'-show')})}else{if(typeof(index)==='string')index=self.findindex(null,index);self.find('[data-index="{0}"]'.format(index)).each(function(){var el=$(this);if(el.hclass(cls+'-expand')){el.parent().aclass(cls+'-show')}else{while(true){el=el.closest(cls2+'-children').prev();if(!el.hclass(cls+'-expand'))break;el.parent().aclass(cls+'-show')}}})}};self.collapse=function(index){if(index==null){self.find(cls2+'-expand').each(function(){$(this).parent().rclass(cls+'-show')})}else{if(typeof(index)==='string')index=self.findindex(null,index);self.find('[data-index="{0}"]'.format(index)).each(function(){var el=$(this);if(el.hclass(cls+'-expand')){el.parent().rclass(cls+'-show')}else{while(true){el=el.closest(cls2+'-children').prev();if(!el.hclass(cls+'-expand'))break;el.parent().rclass(cls+'-show');var parent=el.parent().aclass(cls+'-show');var tmp=+parent.find('> .item').attrd('index');var item=cache[tmp],key=config.pk?item[config.pk]:counter;expanded[key]=1;item.isopen=true}}})}};self.renderchildren=function(builder,item,level,selected){builder.push('<div class="{0}-children {0}-children{1}" data-level="{1}">'.format(cls,level));item.children.forEach(function(item){counter++;item.$pointer=counter;cache[counter]=item;var key=config.pk?item[config.pk]:counter;if(key===selected)selindex=counter;builder.push('<div class="{0}-node{1}">'.format(cls,expanded[key]&&item.children?' ui-tree-show':''));builder.push(self.template(item));item.children&&self.renderchildren(builder,item,level+1,selected);builder.push('</div>')});builder.push('</div>')};self.reset=function(){var cls=config.selected;self.find('.'+cls).rclass(cls)};self.first=function(){cache.first&&self.select(cache.first.$pointer)};self.setter=function(value){config.autoreset&&self.clear();var builder=[],selected=selindex===-1?-1:config.pk?cache[selindex][config.pk]:cache[selindex];selindex=-1;counter=0;cache={};var isexpand=false;value&&value.forEach(function(item){counter++;item.$pointer=counter;cache[counter]=item;var key=config.pk?item[config.pk]:counter;if(key===selected)selindex=counter;builder.push('<div class="{0}-node{1}">'.format(cls,expanded[key]&&item.children?' ui-tree-show':'')+self.template(item));if(expanded[key])isexpand=true;if(item.children)self.renderchildren(builder,item,1,selected);else if(!cache.first)cache.first=item;builder.push('</div>')});self.html(builder.join(''));if(selindex!==-1){self.select(selindex,!config.reselect,true)}else config.first!==false&&cache.first&&setTimeout(self.first,100);if(!isexpand&&config.expanded)self.expand();config.checked&&self.EXEC(config.checked,EMPTYARRAY,self)}});

COMPONENT('validate','delay:100;flags:visible;changes:0;strictchanges:0',function(self,config,cls){var elements=null,def='button[name="submit"]',flags=null,tracked=false,reset=false,old,track,currentvalue,customvalidation=null,currentpath='';self.readonly();self.make=function(){elements=self.find(config.selector||def);currentpath=self.path.toString()};self.configure=function(key,value,init){switch(key){case'selector':if(!init)elements=self.find(value||def);break;case'flags':if(value){flags=value.split(',');for(var i=0;i<flags.length;i++)flags[i]='@'+flags[i];flags=flags.join(' ')}else flags=null;break;case'track':track=value.split(',').trim();break;case'if':customvalidation=new Function('value','path','return '+value);break}};var settracked=function(){tracked=0};var backup=null,current=null;self.setter=function(value,path,type){currentvalue=value;var is=path===currentpath||path.length<currentpath.length,isreset=false;if(M.version>=20){type=type.init||type.reset?0:1;if(!type)isreset=true;config.modified=!isreset;config.touched=!isreset}if(config.changes){current=STRINGIFY(value,config.strictchanges!=true);if(M.version>=20){if(isreset)backup=current;else is=backup===current}else if(is){backup=current;is=true}else is=backup===current}if(reset!==is){reset=is;self.tclass(cls+'-modified',!reset)}if((type===1||type===2)&&track&&track.length){for(var i=0;i<track.length;i++){if(path.indexOf(track[i])!==-1){tracked=1;return}}if(tracked===1){tracked=2;setTimeout(settracked,config.delay*3)}}};var check=function(){var arr=COMPONENTS(self.path+(flags?(' '+flags):''));var disabled=false,modified=false;for(var m of arr){if(m===self)continue;if(config.validonly){if(m.config.invalid){disabled=true;break}}else if(m.config.invalid){disabled=true;break}else if(m.config.modified)modified=true}if(!disabled){if(!config.validonly)disabled=modified==false}if(!disabled&&config.if)disabled=!customvalidation(self.get(),'');if(!disabled&&config.changes&&backup===current)disabled=true;if(HIDDEN(self.element))disabled=true;if(disabled!==old){elements.prop('disabled',disabled);self.tclass(cls+'-ok',!disabled);self.tclass(cls+'-no',disabled);old=disabled;if(!old&&config.exec)self.SEEX(config.exec,currentvalue);config.output&&self.SEEX(config.output,!disabled)}};self.state2=function(){setTimeout2(self.ID,check,config.delay)};self.state=function(type,what){var isreset=jComponent.is20?(!config.modified&&!config.touched):(type===3||what===3);if(isreset){self.rclass(cls+'-modified');tracked=0;backup=current}setTimeout2(self.ID,check,config.delay)}});

COMPONENT('viewbox','margin:0;scroll:true;delay:100;resizedelay:200;initdelay:250;scrollbar:1;visibleY:1;height:100;invisible:1',function(self,config,cls){var eld,elb,scrollbar,cls2='.'+cls,init=false,cache,scrolltoforce;self.readonly();self.init=function(){var resize=function(){setTimeout2(self.name,function(){for(var m of M.components){if(m.name==='viewbox'&&!HIDDEN(m.dom)&&(m.ready||(m.$ready&&!m.$removed)))m.resize()}},200)};self.on('resize2',resize)};self.destroy=function(){scrollbar&&scrollbar.destroy()};self.configure=function(key,value,init){switch(key){case'disabled':eld.tclass('hidden',!value);break;case'minheight':case'margin':case'marginxs':case'marginsm':case'marginmd':case'marginlg':!init&&self.resizeforce();break;case'selector':config.parent=value;self.resize();break}};self.scrollbottom=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(elb[0].scrollHeight-self.dom.clientHeight)-(val||0);return elb[0].scrollTop};self.scrolltop=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(val||0);return elb[0].scrollTop};self.make=function(){var centered='';if(config.centered)centered='<div><div class="{0}-centered-table"><div class="{0}-centered-cell"></div></div></div>'.format(cls);config.invisible&&self.aclass('invisible');config.scroll&&MAIN.version>17&&self.element.wrapInner('<div class="'+cls+'-body">'+centered+'</div>');self.element.prepend('<div class="'+cls+'-disabled hidden"></div>');eld=self.find('> .{0}-disabled'.format(cls)).eq(0);elb=self.find('> .{0}-body'.format(cls)).eq(0);self.aclass('{0} {0}-hidden'.format(cls));if(config.scroll){if(config.scrollbar){if(MAIN.version>17){var scrolledcache=null,scrolled=function(scrollbar){if(config.togglescrolled){if(!scrolledcache)scrolledcache=self.parent(config.togglescrolled);scrolledcache&&scrolledcache.tclass(cls+'-scrolled',scrollbar.scrollTop()>0)}};scrollbar=W.SCROLLBAR(self.find(cls2+'-body'),{native:config.scrollbar==='native',shadow:config.scrollbarshadow,visibleY:config.visibleY,visibleX:config.visibleX,orientation:config.visibleX?null:'y',parent:self.element,onscroll:scrolled});self.scrollbar=scrollbar;self.scrolltop=scrollbar.scrollTop;self.scrollbottom=scrollbar.scrollBottom}else self.aclass(cls+'-scroll')}else{self.aclass(cls+'-scroll');if(M.version<19)self.find(cls2+'-body').aclass('noscrollbar')}}self.resize()};self.released=function(is){!is&&self.resize()};var css={};self.resize=function(){setTimeout2(self.ID,self.resizeforce,config.resizedelay)};self.resizeforce=function(){var el=self.parent(config.parent);var h=el.height();var w=el.width();var width=WIDTH();var mywidth=self.element.width();var key=width+'x'+mywidth+'x'+w+'x'+h+'x'+config.margin;if(cache===key){scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}return}cache=key;var margin=config.margin,responsivemargin=config['margin'+width];if(responsivemargin!=null)margin=responsivemargin;if(margin==='auto')margin=self.element.offset().top;if(h===0||w===0){self.$waiting&&clearTimeout(self.$waiting);self.$waiting=setTimeout(self.resize,234);return}h=((h/100)*config.height)-margin;if(config.minheight&&h<config.minheight)h=config.minheight;if(config.centered)elb.find(cls2+'-centered-table').css('min-height',h);css.height=h;css.width=mywidth;eld.css(css);css.width='';self.css(css);elb.length&&elb.css(css);self.element.SETTER('*/resize');var c=cls+'-hidden';self.hclass(c)&&self.rclass(c,100);scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}if(!init){self.rclass('invisible',config.initdelay);init=true}};self.resizescrollbar=function(){scrollbar&&scrollbar.resize()};self.setter=function(){scrolltoforce=config.scrollto||config.scrolltop;if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}setTimeout(self.resize,config.delay,scrolltoforce)}});

COMPONENT('virtualwire','selector:.virtualwire;max:50;repeat:100',function(self,config,cls){var old,waiter,div;self.make=function(){div=document.createElement('DIV');div.style='position:absolute;left:-1000px;top:-1000px;z-index:-1;visibility:hidden';document.body.appendChild(div);self.aclass(cls)};self.destroy=function(){div.parentNode.removeChild(div);div=null};self.restore=function(){if(old){div.appendChild(old[0]);var exec=old.attrd('out');exec&&self.EXEC(exec);old=null}};self.backup=function(el){if(!el||!el.length){self.restore();return}if(old&&old[0]===el[0])return;self.restore();el.rclass('hidden invisible');self.dom.appendChild(el[0]);old=el;var exec=el.attrd('in');exec&&self.EXEC(exec)};self.load=function(value,count){waiter&&clearTimeout(waiter);waiter=null;if(count>config.max)return;var el=$(config.selector+'[data-if="'+value+'"],'+config.selector+'[data-scope="'+value+'"]');if(el.length)self.backup(el);else waiter=setTimeout(self.load,config.repeat,value,(count||0)+1)};self.setter=function(value){self.restore();if(value){waiter&&clearTimeout(waiter);self.load(value)}}});

COMPONENT('windows','menuicon:ti ti-navicon;reoffsetresize:0;zindex:5;maximizemargin:0 0 0 0',function(self,config,cls){var cls2='.'+cls,cache={},services=[],events={},drag={},prevfocused,serviceid,data=[],lastWW=WW,lastWH=WH,resizer,position=[];self.make=function(){self.aclass(cls);self.append('<div class="{0}-resizer hidden"></div>'.format(cls));resizer=self.find(cls2+'-resizer');self.event('click',cls2+'-control',function(){var el=$(this);var name=el.attrd('name');var item=cache[el.closest(cls2+'-item').attrd('id')];switch(name){case'close':item.setcommand('close');break;case'minimize':item.setcommand('toggleminimize');break;case'maximize':item.setcommand('togglemaximize');break;case'menu':item.meta.menu&&item.meta.menu.call(item,el);break;default:item.setcommand(name);break}});self.event('mousedown touchstart',cls2+'-item',function(){if(prevfocused){if(prevfocused[0]==this)return;prevfocused.rclass(cls+'-focused')}var el=$(this);var id=el.attrd('id');prevfocused=el.aclass(cls+'-focused');var meta=cache[id];if(meta&&meta.meta.focus)meta.meta.focus();var index=position.indexOf(meta);position.push(position.splice(index,1)[0]);self.reorder()});self.event('mousedown touchstart',cls2+'-title,'+cls2+'-resize',events.down);self.on('resize2',self.resize2);serviceid=setInterval(events.service,5000)};self.finditem=function(id){return cache[id]};self.send=function(type,body){for(var i=0;i<data.length;i++)data[i].meta.data(type,body,data[i].element)};self.destroy=function(){clearInterval(serviceid)};self.resize2=function(){setTimeout2(self.ID,self.resize,200)};self.recompile=function(){setTimeout2(self.ID+'compile',COMPILE,50)};self.resizeforce=function(){self.element.find(cls2+'-maximized').each(function(){cache[$(this).attrd('id')].setcommand('maximize')});if(config.reoffsetresize){var diffWW=lastWW-WW,diffWH=lastWH-WH,keys=Object.keys(cache);for(var i=0;i<keys.length;i++){var win=cache[keys[i]];win.setoffset(win.x-diffWW,win.y-diffWH)}lastWW=WW;lastWH=WH}};self.resize=function(){setTimeout2(self.ID+'resize',self.resizeforce,300)};events.service=function(){for(var i=0;i<services.length;i++){var tmp=services[i];if(tmp.$service)tmp.$service++;else tmp.$service=1;tmp.meta.service&&tmp.meta.service.call(tmp,tmp.$service,tmp.element)}};events.down=function(e){var E=e;if(e.type==='touchstart'){drag.touch=true;e=e.touches[0]}else drag.touch=false;if(e.target.nodeName==='I')return;var el=$(this);var parent=el.closest(cls2+'-item');if(parent.hclass(cls+'-maximized'))return;drag.resize=el.hclass(cls+'-resize');drag.is=false;E.preventDefault();$('body').aclass(cls+'-prevent');self.aclass(cls+'-moving');var myoffset=self.element.position();var pos;if(drag.resize){var c=el.attr('class');drag.el=el.closest(cls2+'-item');drag.dir=c.match(/-(tl|tr|bl|br)/)[0].substring(1);pos=drag.el.position();var m=self.element.offset();drag.body=drag.el.find(cls2+'-body');drag.plus=m;drag.x=pos.left;drag.y=pos.top;drag.width=drag.el.width();drag.title=drag.el.find(cls2+'-title').height();drag.height=drag.body.height()+drag.title+2;resizer.css({left:drag.x,top:drag.y,width:drag.width,height:drag.height}).rclass('hidden')}else{drag.el=el.closest(cls2+'-item');pos=drag.el.position();drag.x=e.pageX-pos.left;drag.y=e.pageY-pos.top}$('body').aclass(cls+'-block');drag.offX=myoffset.left;drag.offY=myoffset.top;drag.item=cache[drag.el.attrd('id')];if(drag.item.meta.actions){if(drag.resize){if(drag.item.meta.actions.resize==false)return;drag.resize=true}else{if(drag.item.meta.actions.move==false)return}}drag.el.aclass(cls+'-dragged');$(W).on('mousemove touchmove',events.move).on('mouseup touchend',events.up)};events.move=function(e){var evt=e;if(drag.touch)evt=e.touches[0];var obj={};drag.is=true;if(drag.resize){var x=evt.pageX-drag.offX-drag.plus.left,y=evt.pageY-drag.offY-drag.plus.top,off=drag.item.meta.offset,w,h;switch(drag.dir){case'tl':obj.left=x;obj.top=y;w=drag.width-(x-drag.x);h=drag.height-(y-drag.y);if((off.minwidth&&w<off.minwidth)||(off.minheight&&h<off.minheight)||(off.maxwidth&&w>off.maxwidth)||(off.maxheight&&h>off.maxheight))break;if(drag.resize===true||drag.resize==='width'){obj.width=w;resizer.css(obj)}if(drag.resize===true||drag.resize==='height'){obj.height=h;delete obj.width;delete obj.top;resizer.css(obj)}break;case'tr':w=x-drag.x;h=drag.height-(y-drag.y);if((off.minwidth&&w<off.minwidth)||(off.minheight&&h<off.minheight)||(off.maxwidth&&w>off.maxwidth)||(off.maxheight&&h>off.maxheight))break;if(drag.resize===true||drag.resize==='width'){obj.width=w;obj.top=y;resizer.css(obj)}if(drag.resize===true||drag.resize==='height'){obj.height=h;delete obj.width;delete obj.top;resizer.css(obj)}break;case'bl':w=drag.width-(x-drag.x);h=y-drag.y;if((off.minwidth&&w<off.minwidth)||(off.minheight&&h<off.minheight)||(off.maxwidth&&w>off.maxwidth)||(off.maxheight&&h>off.maxheight))break;if(drag.resize===true||drag.resize==='width'){obj.left=x;obj.width=w;resizer.css(obj);delete obj.width}if(drag.resize===true||drag.resize==='height'){obj.height=h;resizer.css(obj)}break;case'br':w=x-drag.x;h=y-drag.y;if((off.minwidth&&w<off.minwidth)||(off.minheight&&h<off.minheight)||(off.maxwidth&&w>off.maxwidth)||(off.maxheight&&h>off.maxheight))break;if(drag.resize===true||drag.resize==='width'){obj.width=w;resizer.css(obj);delete obj.width}if(drag.resize===true||drag.resize==='height'){obj.height=h;resizer.css(obj)}break}drag.item.ert&&clearTimeout(drag.item.ert);drag.item.ert=setTimeout(drag.item.emitresize,100)}else{obj.left=evt.pageX-drag.x-drag.offX;obj.top=evt.pageY-drag.y-drag.offY;if(obj.top<0)obj.top=0;drag.el.css(obj)}if(!drag.touch)e.preventDefault()};events.up=function(){self.rclass(cls+'-moving');drag.el.rclass(cls+'-dragged');$('body').rclass(cls+'-block');$(W).off('mousemove touchmove',events.move).off('mouseup touchend',events.up);resizer.aclass('hidden',1);if(!drag.is)return;var item=drag.item,meta=item.meta,pos=drag.resize?resizer.position():drag.el.position();drag.is=false;drag.x=meta.offset.x=item.x=pos.left;drag.y=meta.offset.y=item.y=pos.top;if(drag.resize){item.width=meta.offset.width=resizer.width();item.height=meta.offset.height=resizer.height()-drag.title;drag.el.css({left:drag.x,top:drag.y,width:item.width});drag.body.css({height:item.height});meta.resize&&meta.resize.call(item,item.width,item.height,drag.body,item.x,item.y);self.element.SETTER('*/resize')}meta.move&&meta.move.call(item,item.x,item.y,drag.body);self.wsave(item);self.change(true)};var wsavecallback=function(item){var key='win_'+item.meta.cachekey,obj={};obj.x=item.x;obj.y=item.y;obj.width=item.width;obj.height=item.height;obj.ww=WW;obj.wh=WH;obj.hidden=item.meta.hidden;PREF.set(key,obj,'1 month')};self.wsave=function(obj){if(obj.meta.actions&&obj.meta.actions.autosave)setTimeout2(self.ID+'_win_'+obj.meta.cachekey,wsavecallback,500,null,obj)};self.reorder=function(){for(var index=0;index<position.length;index++)position[index].container.css('z-index',config.zindex+index)};self.wadd=function(item){var hidden='',ishidden=false;if(!item.cachekey)item.cachekey=item.id;if(item.cachekey)item.cachekey+=''+item.offset.width+'x'+item.offset.height;if(item.actions&&item.actions.autosave){pos=PREF['win_'+item.cachekey];if(pos){var mx=0,my=0,keys=Object.keys(cache);var plus=0;for(var i=0;i<keys.length;i++){if(cache[keys[i]].meta.cachekey===item.cachekey)plus+=50}if(config.reoffsetresize&&pos.ww!=null&&pos.wh!=null){mx=pos.ww-WW;my=pos.wh-WH}item.offset.x=(pos.x-mx)+plus;item.offset.y=(pos.y-my)+plus;item.offset.width=pos.width;item.offset.height=pos.height;if(pos.hidden&&(item.hidden==null||item.hidden)){ishidden=true;item.hidden=true}}}if(!ishidden)ishidden=item.hidden;hidden=ishidden?' hidden':'';var el=$('<div class="{0}-item{2}" data-id="{id}" style="left:{x}px;top:{y}px;width:{width}px"><span class="{0}-resize {0}-resize-tl"></span><span class="{0}-resize {0}-resize-tr"></span><span class="{0}-resize {0}-resize-bl"></span><span class="{0}-resize {0}-resize-br"></span><div class="{0}-title"><i class="ti ti-times {0}-control" data-name="close"></i><i class="ti ti-maximize {0}-control" data-name="maximize"></i><i class="ti ti-underscore {0}-control" data-name="minimize"></i><i class="{1} {0}-control {0}-lastbutton" data-name="menu"></i><span>{{ title}}</span></div><div class="{0}-body" style="height:{height}px"></div></div>'.format(cls,config.menuicon,hidden).args(item.offset).args(item));var body=el.find(cls2+'-body');var pos;body.append(item.html);if(typeof(item.html)==='string'&&item.html.COMPILABLE())self.recompile();if(item.actions){if(item.actions.resize==false)el.aclass(cls+'-noresize');if(item.actions.move==false)el.aclass(cls+'-nomove');var noclose=item.actions.close==false;if(item.actions.hide)noclose=false;if(noclose)el.aclass(cls+'-noclose');if(item.actions.maximize==false)el.aclass(cls+'-nomaximize');if(item.actions.minimize==false)el.aclass(cls+'-nominimize');if(!item.actions.menu)el.aclass(cls+'-nomenu')}var obj=cache[item.id]={};obj.main=self;obj.meta=item;obj.element=body;obj.container=el;obj.x=item.offset.x;obj.y=item.offset.y;obj.width=item.offset.width;obj.height=item.offset.height;item.element=el;if(item.buttons){var builder=[];for(var i=0;i<item.buttons.length;i++){var btn=item.buttons[i],icon=self.icon(btn.icon);builder.push('<i class="ti ti-{1} {0}-control" data-name="{2}"></i>'.format(cls,icon,btn.name))}builder.length&&el.find(cls2+'-lastbutton').before(builder.join(''))}item.make&&item.make.call(cache[item.id],body);obj.emitresize=function(){obj.ert=null;obj.element.SETTER('*/resize')};obj.setsize=function(w,h,nosave){var t=this,obj={};if(w){obj.width=t.width=t.meta.offset.width=w;t.element.parent().css('width',w)}if(h){t.element.css('height',h);t.height=t.meta.offset.height=h}t.ert&&clearTimeout(t.ert);t.ert=setTimeout(t.emitresize,100);if(nosave!=true)self.wsave(t)};obj.setcommand=function(type){var el=obj.element.parent();var c;switch(type){case'toggle':obj.setcommand(obj.meta.hidden?'show':'hide');break;case'show':if(obj.meta.hidden){obj.meta.hidden=false;obj.element.parent().rclass('hidden');self.wsave(obj);self.resize2()}break;case'close':case'hide':if(type==='hide'&&obj.meta.hidden)return;if(obj.meta.close){obj.meta.close(function(){self.wrem(obj.meta,true);self.resize2()})}else{self.wrem(obj.meta,true);self.resize2()}break;case'maximize':if(obj.meta.maximize){obj.meta.maximize()}else{c=cls+'-maximized';if(!el.hclass(c)){obj.prevwidth=obj.width;obj.prevheight=obj.height;obj.prevx=obj.x;obj.prevy=obj.y;el.aclass(c);obj.setcommand('resetminimize')}let margin=config.maximizemargin.split(' ');let ww=self.element.width()||WW;let wh=self.element.height()||WH;obj.setoffset(0+(+margin[0]),0+(+margin[1]),true);obj.setsize(ww-(+margin[2]),wh-obj.element.position().top-(+margin[3]),true)}break;case'resetmaximize':if(obj.meta.maximize){obj.meta.maximize('reset')}else{c=cls+'-maximized';if(el.hclass(c)){obj.setoffset(obj.prevx,obj.prevy);obj.setsize(obj.prevwidth,obj.prevheight);el.rclass(c)}}break;case'togglemaximize':if(obj.meta.maximize){obj.meta.maximize('toggle')}else{c=cls+'-maximized';obj.setcommand(el.hclass(c)?'resetmaximize':'maximize')}break;case'minimize':if(obj.meta.minimize){obj.meta.minimize()}else{c=cls+'-minimized';if(!el.hclass(c))el.aclass(c)}break;case'resetminimize':if(obj.meta.minimize){obj.meta.minimize('reset')}else{c=cls+'-minimized';el.hclass(c)&&el.rclass(c)}break;case'toggleminimize':if(obj.meta.minimize){obj.meta.minimize('toggle')}else{c=cls+'-minimized';obj.setcommand(el.hclass(c)?'resetminimize':'minimize')}break;case'resize':obj.setsize(obj.width,obj.height);break;case'move':obj.setoffset(obj.x,obj.y);break;case'focus':obj.setcommand('resetminimize');prevfocused&&prevfocused.rclass(cls+'-focused');prevfocused=obj.element.parent().aclass(cls+'-focused');if(obj.meta.focus)obj.meta.focus();var index=position.indexOf(obj);var item=position.splice(index,1)[0];position.push(item);self.reorder();break;default:if(obj.meta.buttons){var btn=obj.meta.buttons.findItem('name',type);if(btn&&btn.exec)btn.exec.call(obj,obj)}break}};obj.settitle=function(title){let t=this;let eltitle=t.element.parent().find(cls2+'-title > span');let icon=eltitle.find('i').attr('class');eltitle.html((icon?'<i class="{0}"></i>'.format(icon):'')+title)};obj.setoffset=function(x,y,nosave){var t=this,obj={};if(x!=null)obj.left=t.x=t.meta.offset.x=x;if(y!=null)obj.top=t.y=t.meta.offset.y=y;t.element.parent().css(obj);if(nosave!=true)self.wsave(t)};obj.meta.service&&services.push(obj);obj.meta.data&&data.push(obj);self.append(el);position.push(obj);item.offset.maximized&&obj.setcommand('maximize');setTimeout(obj=>obj.setcommand('focus'),100,obj);return obj};self.wrem=function(item,notify){var obj=cache[item.id];if(obj){var main=obj.element.closest(cls2+'-item');if(obj.meta.actions.hide){obj.meta.hidden=true;main.aclass('hidden');self.wsave(obj)}else{var index=position.indexOf(obj);if(index!==-1)position.splice(index,1);obj.meta.destroy&&obj.meta.destroy.call(obj);main.off('*');main.find('*').off('*');main.remove();delete cache[item.id];var index=services.indexOf(obj);if(index!==-1)services.splice(index,1);index=data.indexOf(obj);if(index!==-1)data.splice(index,1);var arr=self.get();arr.splice(arr.findIndex('id',item.id),1);notify&&self.update()}}};self.setter=function(value){if(!value)value=EMPTYARRAY;var updated={};for(var i=0;i<value.length;i++){var item=value[i];if(!cache[item.id])cache[item.id]=self.wadd(item);updated[item.id]=1}var keys=Object.keys(cache);for(var i=0;i<keys.length;i++){var key=keys[i];if(!updated[key])self.wrem(cache[key].meta)}};self.toggle=function(id){var item=cache[id];item&&item.setcommand('toggle')};self.show=function(id){var item=cache[id];item&&item.setcommand('show')};self.title=function(id,title){var item=cache[id];item&&item.settitle(title)};self.maximize=function(id){var item=cache[id];item&&item.setcommand('maximize')};self.minimize=function(id){var item=cache[id];item&&item.setcommand('minimize')};self.focus=function(id){var item=cache[id];item&&item.setcommand('focus')};self.hide=function(id){var item=cache[id];item&&item.setcommand('hide')};self.close=function(id){var item=cache[id];item&&item.setcommand('close')}});

COMPONENT('wysiwyg','required:0;links:false;ul:true;code:true;ul:true;allowrawpaste:0',function(self,config,cls){var cls2='.'+cls,timers={},buttons={},D=document,placeholder,editor;function selectall(el){var doc=W.document,sel,range;if(W.getSelection&&doc.createRange){sel=W.getSelection();range=doc.createRange();range.selectNodeContents(el);sel.removeAllRanges();sel.addRange(range)}else if(doc.body.createTextRange){range=doc.body.createTextRange();range.moveToElementText(el);range.select()}}var findparent=function(node){while(node){if(node===editor[0])return;if(node.parentNode===editor[0])return node;node=node.parentNode}};var check=function(node,tag){while(node){if(node===editor[0])return;if(node.tagName===tag)return node;node=node.parentNode}};var clean=function(node){var tag=D.createTextNode($(node).text());editor[0].replaceChild(tag,node);selectall(tag)};self.validate=function(value){if(!config.required)return true;var type=typeof(value);if(type==='undefined'||type==='object')value='';else value=value.toString();self.emit('reflow',self.name);return value.length>0};self.make=function(){self.aclass(cls);self.attr('wysiwyg','true');var buttons=[];buttons.push('<button name="bold"><i class="ti ti-bold"></i></button><button name="italic"><i class="ti ti-italic"></i></button><button name="underline"><i class="ti ti-underline"></i></button></button>');if(config.ul)buttons.push('<button name="ul"><i class="ti ti-list"></i></button>');if(config.code)buttons.push('<button name="code"><i class="ti ti-highlighter"></i></button>');if(config.links)buttons.push('<button name="link"><i class="ti ti-link"></i></button>');self.append('<div class="{0}-toolbar">{2}</div><div class="{0}-placeholder">{1}</div><div class="{0}-body" contenteditable="true"></div>'.format(cls,config.placeholder,buttons.join('')));editor=self.find(cls2+'-body');placeholder=self.find(cls2+'-placeholder');placeholder.on('click',function(){placeholder.aclass('hidden');editor.focus()});self.find('button').on('click',function(){editor.focus();switch(this.name){case'bold':D.execCommand('Bold',false,null);break;case'italic':D.execCommand('Italic',false,null);break;case'underline':D.execCommand('Underline',false,null);break;case'ul':var node=self.getNode();var selection=self.getSelection();D.execCommand('insertHtml',false,'<ul><li>{0}</li></ul>'.format((node===editor[0]?selection:node.innerHTML)||''));break;case'mark':var node=self.getNode();var tag=check(node,'SPAN');if(tag){clean(tag)}else{var selection=self.getSelection();selection&&D.execCommand('insertHtml',false,'<span class="marked">{0}</span>'.format(node===editor[0]?selection:node.innerHTML))}break;case'code':var node=self.getNode();var tag=check(node,'CODE');if(tag){clean(tag)}else{var selection=self.getSelection();selection&&D.execCommand('insertHtml',false,'<code>{0}</code>'.format(node===editor[0]?selection:node.innerHTML))}break;case'clean':var selection=self.getSelection();if(selection){node=self.getSelection(true)}else{node=findparent(self.getNode());node&&clean(node)}break;case'link':var node=self.getNode();var tag=check(node,'A');if(tag){clean(tag)}else{var id='#URL'+Date.now();var html=self.getSelection();if(html){D.execCommand('CreateLink',false,id);var a=self.find('a[href="{0}"]'.format(id)).attr('target','_blank').attr('href',html);self.event('link',a)}}break}}).each(function(){buttons[this.name]=this});var el=self.element;el.on('selectstart',function(){clearTimeout(timers.selection);timers.selection=setTimeout(function(){self.event('select',self.getSelection())},500)});editor.on('focus',function(){clearTimeout(timers.focused);clearInterval(timers.changes);timers.changes=null;self.focused=true;self.event('focus',self);placeholder.aclass('hidden')});self.save=function(){self.bind('@touched @modified',editor.html())};editor.on('click',function(e){e.target&&self.event('click',e.target)});editor.on('blur',function(){var t=editor.text().trim();placeholder.tclass('hidden',!!t||editor.find('li').length>0);clearTimeout(timers.focused);clearInterval(timers.changes);timers.changes=null;self.save();timers.focused=setTimeout(function(){self.event('blur',self)},200)});editor.on('paste',function(e){if(config.allowrawpaste)return;e.preventDefault();e.stopPropagation();var text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');self.event('paste',text)});editor.on('keydown',function(e){if(!timers.changes)timers.changes=setInterval(self.save,1000);if(!e.metaKey&&!e.ctrlKey)return;if(e.which===66){D.execCommand('Bold',false,null);e.preventDefault();e.stopPropagation();return}if(e.which===76){e.preventDefault();e.stopPropagation();var html=self.getSelection();if(html){var id='#URL'+Date.now();D.execCommand('CreateLink',false,id);var a=self.find('a[href="{0}"]'.format(id)).attr('target','_blank').attr('href',html);self.event('link',a)}return}if(e.which===73){D.execCommand('Italic',false,null);e.preventDefault();e.stopPropagation();return}if(e.which===85){D.execCommand('Underline',false,null);e.preventDefault();e.stopPropagation();return}});var notify=function(e){timers.notify=null;self.event('cursor',e.target)};el.on('keydown',function(e){timers.notify&&clearTimeout(timers.notify);timers.notify=setTimeout(notify,100,e)})};self.exec=function(){D.execCommand.apply(D,arguments);return self};self.insert=function(value,encoded){D.execCommand(encoded?'insertText':'insertHtml',false,value);return self};var loadformat=function(){var node=self.getNode();var toolbar={};while(node){if(node===editor[0])return toolbar;switch(node.tagName){case'B':toolbar.bold=1;break;case'I':toolbar.italic=1;break;case'A':toolbar.link=1;break;case'SPAN':toolbar.mark=1;break;case'CODE':toolbar.code=1;break;case'S':toolbar.strike=1;break;case'U':toolbar.underline=1;break}node=node.parentNode}return toolbar};self.event=function(type,value){if(type==='click'||type==='cursor'){var format=loadformat();var keys=Object.keys(buttons);for(var i=0;i<keys.length;i++){var key=keys[i],btn=buttons[key],is=format[key]===1;if(btn.prevstate!==is){if(is)btn.classList.add('selected');else btn.classList.remove('selected');btn.prevstate=is}}}if(type==='paste')self.insert(value,true)};self.getNode=function(){var node=D.getSelection().anchorNode;if(node)return(node.nodeType===3?node.parentNode:node)};self.getSelection=function(node){if(D.selection&&D.selection.type==='Text')return D.selection.createRange().htmlText;else if(!W.getSelection)return;var sel=W.getSelection();if(!sel.rangeCount)return'';var container=D.createElement('div');for(var i=0,len=sel.rangeCount;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());return node?container:container.innerHTML};self.focus=function(){editor.focus()};self.setter=function(value,path,type){var val=value?(value+'').trim():'';self.reset();editor.html(val);placeholder.tclass('hidden',!!val)};self.state=function(type){if(!type)return;var invalid=self.isInvalid();if(invalid!==self.$oldstate){self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)}}});